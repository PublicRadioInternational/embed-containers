var EntityEmbed=EntityEmbed||{};!function(){function e(e){return e=$.extend(!0,{},r,e),e.data.debug=e.debug,e.data.auth_token=e.auth_token,$.ajax({timeout:15e3,crossDomain:!0,type:e.methodType,dataType:"json",url:e.path,data:JSON.stringify(e.data)})}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function n(t){return t.methodType="POST",e(t)}function i(e){r.auth_token=e}function a(e){return r.auth_token}var r={data:{},debug:0,auth_token:"",path:""},l=/^[^.]*staging[^.]*\.|\.dev$/,s=l.test(window.location.host);s&&(r.debug=1,i("abc123")),EntityEmbed.apiService={put:t,post:o,get:n,setAuthToken:i,getAuthToken:a}}();var EntityEmbed=EntityEmbed||{};!function(){var e={},t="entity-embed-active",o="medium-editor-button-active",n="medium-insert-images-toolbar",i="medium-insert-images-toolbar2",a="entity-embed-secondary-toolbar-locator",r=function(e,t){var o="";t?(o="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active";var n='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var i in e){var a=e[i];a.label&&(n+='<li><button class="medium-editor-action" data-action="'+i+'">'+a.label+"</button></li>")}return n+="</ul></div>"};toolbarManager=function(e,o,n,i){var a=this;a.mediumEditorAddon=e,a.styles=o,a.actions=n,i&&(t=i),a.events()},toolbarManager.prototype.events=function(){var e=this;$(document).on("click","."+n+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+i+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this;e.append(r(t.actions)),t.$actionToolbar=$("."+i),t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(t,o){var i=this,a=$.extend(i.styles,{}),l=!0;if(o.options.styles){for(var s in o.options.styles)o.options.styles[s]?l=!1:delete a[s];l||(t.append(r(a,o.name)),e[o.name]=$("."+n+"."+o.name+"StyleToolbar"),e[o.name].hide())}},toolbarManager.prototype.showToolbars=function(n,i){var a,r=this,l=$("."+t);r.currentToolbarEmbedType=i,r.$actionToolbar.show(),e[r.currentToolbarEmbedType]&&(e[r.currentToolbarEmbedType].find("button").each(function(){l.hasClass("entity-embed-"+$(this).data("action"))&&(a=$(this),a.addClass(o))}),e[r.currentToolbarEmbedType].show(),a&&a.addClass(o)),r.positionToolbars(n)},toolbarManager.prototype.styleToolbarDo=function(e){var n=this,i=e.closest("li").closest("ul"),a=$("."+t);i.find("."+o).removeClass(o),e.addClass(o),i.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(o)?n.addStyle(a,t,e.data("action"),!0):(a.removeClass(t),n.styles[e.data("action")].removed&&n.styles[e.data("action")].removed(a))})},toolbarManager.prototype.addStyle=function(e,o,n,i){var a=this;e.addClass(o),a.styles[n].added&&a.styles[n].added(e),i&&setTimeout(function(){a.positionToolbars($("."+t))},50)},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,n=$("."+t),i=o.actions[e.data("action")].clicked;i(o.mediumEditorAddon,n)},toolbarManager.prototype.hideToolbar=function(){var t=this;t.$actionToolbar.hide(),t.$actionToolbar.find("button").removeClass(o),t.currentToolbarEmbedType&&e[t.currentToolbarEmbedType]&&(e[t.currentToolbarEmbedType].hide(),e[t.currentToolbarEmbedType].find("button").removeClass(o),t.currentToolbarEmbedType=null)},toolbarManager.prototype.positionToolbars=function(t){var o=this,n=t.find("."+a);0===n.length&&(n=t),l=t.offset().top+2;var i=n.offset().left+n.width()+4;i>$(window).width()-o.$actionToolbar.width()&&(l-=o.$actionToolbar.height()+8,i=$(window).width()-o.$actionToolbar.width()-50),o.$actionToolbar.css({top:l,left:i});var r=e[o.currentToolbarEmbedType];if(r){var l=t.offset().top-r.height()-8-2-5;0>l&&(l=0),r.css({top:l,left:t.offset().left+t.width()/2-r.width()/2})}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,n){var i=n||this;i.name=o,t=$.extend(!0,{},i.defaultOptions,t),i.options=$.extend(!0,{},t,e),i.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{put:"https://test-services.pri.org/admin/embed/edit",post:"https://test-services.pri.org/admin/embed/edit",get:"https://test-services.pri.org/admin/embed/fetch",getAll:"https://test-services.pri.org/admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e){},e.prototype.getModelFromForm=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control, .embed-modal-file-input"),i=0;i<n.length;i++){var a=n[i].name,r=n[i].type,l=null;l="file"===r?n[i].files[0]:n[i].value,a&&(o.model[a]=l)}},e.prototype.populateFormWithModel=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control"),i=0;i<n.length;i++)if(!n[i].type||-1===n[i].type.indexOf("file"))if(n[i].type&&-1!==n[i].type.indexOf("select")){var a=$(n[i]).find("option"),r=o.model[n[i].name],l=0;a.each(function(e){this.value===r&&(l=e)}),n[i].selectedIndex=l}else o.model[n[i].name]&&(n[i].value=o.model[n[i].name])},e.prototype.clearForm=function(e,t){var o=t||this;o.$validator&&o.$validator.resetForm();for(var n=e.find("form"),i=0;i<n.length;i++)n[i].reset();o.model=o.cleanModel()},e.prototype.editorEvents=function(){},e.prototype.parseForEditor=function(){return'<pre class="embedded-content">'+JSON.stringify(this.model,null,4)+"</pre>"},e.prototype.validate=function(e,t,o){var n=o||this,i=e;return i.is("form")||(i=e.find("form")),n.$validator=i.validate(n.options.validationOptions),n.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return e?(o.model.object_type=o.options.object_type,EntityEmbed.apiService.post({path:o.options.httpPaths.post,data:o.model})):EntityEmbed.apiService.put({path:o.options.httpPaths.put,data:o.model})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,n){var i=this;i.$el=$(e),i.options=$.extend(!0,{},t,o),i.scope={},n&&(i.scope=n),i.scope.modalCtrl=i,i.$el.data("scope",i.scope),i.options.functions.init.before(i.scope),i.init(),i.options.functions.init.after(i.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e){e.$el.toggleClass(e.activeClass),e.$backdrop.toggleClass(e.activeClass),e.$closeBtn.toggleClass(e.activeClass),e.isActive=!e.isActive},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();if(e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$backdrop.click(function(){e.$el.abortModal()}),e.options.showCloseBtn){var o=e.generateId();e.$el.prepend(e.closeBtnHtml(o)),e.$closeBtn=$("."+e.closeBtnClass+"#"+o),e.$closeBtn.click(function(){e.$el.abortModal()})}e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,n){var i=this;i.$el.find(e).on(t,function(e){o(e,i.$el.data("scope"),n)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t=$.data(this[0],"ctrl");if(t&&!t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.promise=$.Deferred(),t.options.functions.open.before(i),t.toggle(t),t.options.functions.open.after(i);var a=.1*$(window).height(),r=a+$(document).scrollTop();return t.$el.css("top",r),t.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.options.functions.abort.before(i)&&(t.toggle(t),t.options.functions.abort.after(i),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.options.functions.complete.before(i)&&(t.toggle(t),t.options.functions.complete.after(i),"pending"===t.promise.state()&&t.promise.resolve())}})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e),o.init()}var t={modalId:"leave-confirmation-modal",viewPath:"modal/modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(){var e=this;e.$abortEl=$("#"+e.options.abortElId),e.$completeEl=$("#"+e.options.completeElId)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3};var t=void 0,o=!1,n={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",selectExisting:"#btn-select-existing-embed",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{selectExistingTableBody:".embed-modal-select-existing tbody",selectExistingTableRow:".embed-modal-select-existing-item",selectExistingActiveItem:"embed-modal-active-row",saveSpinner:"#embed-modal-spinner"}},i=function(e,t){return'<tr class="embed-modal-select-existing-item" id="'+t+'"><td>'+e+"</tr></td>"},a=function(e,t){$(".editable").attr("contenteditable",t)},r=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},l=function(e,t){t&&(e.currentEmbedType&&(e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=p(t),e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex)},s=function(e){var t=e.embedTypes[0].options.object_type;l(e,t),e.$embedTypeSelect.show()},d=function(e){var t=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,i=e.currentEmbedType.validate(e.currentEmbedType.$view,t);if(!o&&e.currentEmbedType.$view.find("form").valid()){if(o=!0,$(n.elements.saveSpinner).show(),e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),t)var a=function(t){return"ERROR"===t.status?void console.log("POST failed"):"string"==typeof t.response?void console.log("Failed to POST embed type: "+t.response):(e.currentEmbedType.model.object_id=t.response.object_id,console.log("POST succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("POST failed"),e.failCallback&&e.failCallback()};else var a=function(t){return"ERROR"===t.status?void console.log("PUT failed"):"string"==typeof t.response?void console.log("Failed to PUT embed type: "+t.response):(console.log("PUT succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("PUT failed"),e.failCallback&&e.failCallback()};var l=function(t){o=!1,$(n.elements.saveSpinner).hide(),e.alwaysCallback&&e.alwaysCallback()};e.currentEmbedType.saveEmbed(t).done(a).fail(r).always(l),i.resetForm()}},c=function(e){$(n.elements.selectExistingTableRow).remove(),EntityEmbed.apiService.post({path:e.currentEmbedType.options.httpPaths.getAll,data:{object_type:e.currentEmbedType.options.object_type,auth_token:"abc123"}}).done(function(t){if("string"==typeof t.response)return void console.log("Failed to get list of current embed types for the Select Existing page.: "+t.response);if(t.response.data){e.selectExistingItems=t.response.data;for(var o=0;o<e.selectExistingItems.length;o++){var a=$(i(e.selectExistingItems[o].title,e.selectExistingItems[o].object_id));$(n.elements.selectExistingTableBody).append(a),e.modalCtrl.registerEvent(a,"click",function(e,t){var o=!$(e.currentTarget).hasClass(n.elements.selectExistingActiveItem);$(n.elements.selectExistingTableBody).find("."+n.elements.selectExistingActiveItem).removeClass(n.elements.selectExistingActiveItem),o?($(e.currentTarget).addClass(n.elements.selectExistingActiveItem),$(n.buttons.selectExisting).removeClass("disabled")):$(n.buttons.selectExisting).addClass("disabled")})}}}).fail(function(e){console.log("Failed to get list of current embed types for the Select Existing page.")})},u=function(e){$(n.buttons.showSelectExisting).show(),e.$embedTypeSelect.show(),$(n.containers.selectExistingEmbed).slideUp(),$(n.containers.createNewEmbed).slideDown(),$(n.containers.selectButtons).hide(),$(n.containers.createButtons).show()},m=function(e){$(n.buttons.showSelectExisting).hide(),e.$embedTypeSelect.hide(),$(n.containers.selectExistingEmbed).is(":visible")&&($(n.containers.selectExistingEmbed).slideUp(),$(n.containers.createNewEmbed).slideDown()),$(n.containers.selectButtons).hide(),$(n.containers.createButtons).show(),$(n.buttons.showSelectExisting).hide()},p=function(e){var o=$.grep(t,function(t){return t.options.object_type==e});return o.length>0?o[0]:null},f=function(e,t){var o='<figure contenteditable="false" id="'+e.model.object_id+'" data-embed-type="'+e.options.object_type+'" >'+e.parseForEditor()+"</figure>";return t?'<div class="entity-embed-container">'+o+"</div>":o};e.prototype.generateEmbedHtml=f,e.prototype.functions={init:{before:function(e){e.currentEmbedType=null,t=e.embedTypes,$(n.elements.saveSpinner).hide()},after:function(e){e.$modalBody.find(n.containers.selectExistingEmbed).load("modal/modal_selectedExisting.html",function(e,t,o){console.log("modal_selectedExisting.html load completed with status: "+t),$(n.buttons.selectExisting).addClass("disabled")});for(var t=0,o=0;o<e.embedTypes.length;o++){var i=e.embedTypes[o];e.$embedTypeSelect.append('<option value="'+i.options.object_type+'">'+i.options.displayName+"</option>"),e.$modalBody.find(n.containers.createNewEmbed).append('<div id="'+i.name+'"></div>');var a=e.$modalBody.find("#"+i.name);a.load(i.options.viewPath,function(e,t,o){console.log(i.options.viewPath+" load completed with status: "+t)}),i.$view=a,i.optionIndex=t,a.hide(),t++}setTimeout(function(){for(var t=0;t<e.embedTypes.length;t++)e.embedTypes[t].initModal(e.embedTypes[t].$view)},200);var r=new EntityEmbed.confirmModalDefaults;n.elements.confirmModal="#"+r.options.modalId,$("#"+r.options.modalId).load(r.options.viewPath,function(t,o,n){if(console.log("leave confirmation modal load completed with status: "+o),"error"!==o){var i={parentModalCtrl:e.modalCtrl};r.init(),$("#"+r.options.modalId).modal(r,i)}}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(e,t){t.currentEmbedType.clearForm(t.currentEmbedType.$view);var o=e.currentTarget.options[e.currentTarget.selectedIndex].value;l(t,o),t.modalType===EntityEmbed.embedModalTypes.selectExisting&&c(t)}),e.modalCtrl.registerEvent(n.buttons.saveEmbed,"click",function(e,t){d(t)}),e.modalCtrl.registerEvent(n.buttons.showSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.selectExisting,c(t),$(n.containers.createNewEmbed).slideUp(),$(n.containers.selectExistingEmbed).slideDown(),$(n.containers.createButtons).hide(),$(n.containers.selectButtons).show()}),e.modalCtrl.registerEvent(n.buttons.cancelSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.add,u(t)}),e.modalCtrl.registerEvent(n.buttons.selectExisting,"click",function(e,t){$(n.buttons.selectExisting).hasClass("disabled")||EntityEmbed.apiService.get({path:t.currentEmbedType.options.httpPaths.get,data:{object_id:$("."+n.elements.selectExistingActiveItem).attr("id")}}).done(function(e){return"string"==typeof e.response?void console.log("Failed to get list of current embed types for the Select Existing page.: "+e.response):(t.currentEmbedType.model=e.response,void t.modalCtrl.$el.completeModal())}).fail(function(e){console.log("failed to get embed type!")})})}},open:{before:function(e){a(e,"false"),e.embedType?(l(e,e.embedType),delete e.embedType):s(e)},after:function(e){e.modalType==EntityEmbed.embedModalTypes.edit?(m(e),EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(t){return"string"==typeof t.response?void console.log("Failed to get embed type: "+t.response):(l(e,t.response.object_type),e.currentEmbedType.model=t.response,e.staleModel=$.extend(!0,{},t.response),void e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view))}).fail(function(e){console.log("failed to get embed type!")})):e.modalType==EntityEmbed.embedModalTypes.add?u(e):e.modalType==EntityEmbed.embedModalTypes.addSingle&&(u(e),e.$embedTypeSelect.hide())}},abort:{before:function(e){if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var t in e.currentEmbedType.model)if(!e.staleModel[t]||e.staleModel[t]!==e.currentEmbedType.model[t])return $(n.elements.confirmModal).openModal(),!1}else if(r(e.currentEmbedType.$view))return $(n.elements.confirmModal).openModal(),!1;var o=e.currentEmbedType.validate(e.currentEmbedType.$view,!0);return o.resetForm(),delete e.confirmedLeave,!0},after:function(e){a(e,"true")}},complete:{before:function(e){return!0},after:function(e){if(a(e,"true"),e.$currentEditorLocation.length>0){e.$currentEditorLocation.addClass("entity-embed-editor-line");var t=e.$currentEditorLocation.html(f(e.currentEmbedType,!e.$currentEditorLocation.is(".entity-embed-container"))),o=jQuery.Event("entityEmbedAdded");o.embedType=e.currentEmbedType,t.find(".entity-embed-container").trigger(o)}e.modalCtrl.promise.resolve({data:e.currentEmbedType.model,options:e.currentEmbedType.options})}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="audio",n={viewPath:e+"modal/modal_audio.html",displayName:"Audio",object_type:"audio",audioLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",upload:{required:!0,extension:"mp3"},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"https://test-services.pri.org/admin/embed/file-upload"}},i=".uploaded-audio-file",a=".cancel-upload-file-btn",r=".edit-chosen-file-btn",l=function(e,t){return t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(e="/"+t),e+t)};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=3,t.prototype.audioPreviewClass="audio-preview",t.prototype.cleanModel=function(){return{title:null,url_path:null,credit:null,creditLink:null}},t.prototype.initModal=function(e){var t=this;t.$mp3Form=e.find('input[name="upload"]'),e.find(r).on("click",function(){e.find(i).hide(),e.find(r).hide(),t.$mp3Form.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$mp3Form.hide(),e.find(a).hide(),t.$mp3Form.parent().find("#upload-error").is(":visible")&&t.$mp3Form.parent().find("#upload-error").hide(),e.find(r).show(),e.find(i).show()})},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.audioPreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(r).hide(),t.$mp3Form.show()},t.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;return delete t.model.upload,t.parent.saveEmbed(e,t).then(function(e){if(o){var n=new FormData;return n.append("upload",o),$.ajax({url:t.options.httpPaths.uploadFile,type:"POST",data:n,headers:{"x-auth-token":EntityEmbed.apiService.getAuthToken(),"x-object-id":e.response.object_id,"x-debug":"1"},processData:!1,contentType:!1})}}).done(function(e){t.model.url_path=e.response.url_path})},t.prototype.generateUploadedPreview=function(){var e=this;if(e.model.object_id){var t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<audio controls class="'+e.audioPreviewClass+'"><source src="'+l(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio>'}return'<div class="'+e.audioPreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},t.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$mp3Form.hide(),e.find(i).show(),e.find(r).show(),e.find(i).append(t.generateUploadedPreview()))},t.prototype.parseForEditor=function(){var e=this,t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<div class="audio-embed"><audio controls><source src="'+l(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio><div class="credit">Credit: '+e.model.credit+'</div><div class="link">Link: '+e.model.creditLink+"</div></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="customText",n="custom-text-editor",i={viewPath:e+"modal/modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=5,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a,r;o[i].id==n?(a=o[i].attributes.name.nodeValue,r=o[i].innerHTML):(a=o[i].name,r=o[i].value),a&&r&&(t.model[a]=r)}},t.prototype.cleanModel=function(){return{title:null,displayTitle:null,text:null}},t.prototype.clearForm=function(e,t){var t=this;t.parent.clearForm(e,t);for(var o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++)o[n].type&&-1!==o[n].type.indexOf("select")?o[n].selectedIndex=0:(o[n].value=null,o[n].innerHTML="");t.model=t.cleanModel()},t.prototype.populateFormWithModel=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)if(o.type&&-1!==o[i].type.indexOf("select")){var a=$(o[i]).find("option"),r=t.model[o[i].name],l=0;a.each(function(e){this.value===r&&(l=e)}),o[i].selectedIndex=l}else o[i].value=t.model[o[i].name],o[i].id==n&&(o[i].innerHTML=t.model[o[i].attributes.name.nodeValue])},t.prototype.initModal=function(e){new MediumEditor("#"+n)},t.prototype.parseForEditor=function(){var e=this;return'<div class="custom-text-embed"><div class="display-title">'+e.model.displayTitle+'</div><div class="custom-text">'+e.model.customText+"</div></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="externalLink",n={viewPath:e+"modal/modal_externalLink.html",displayName:"External Link",object_type:"external-link",validationOptions:{rules:{title:"required",url:"required",linkText:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=9,t.prototype.cleanModel=function(){return{thumbnailFile:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null}},t.prototype.initModal=function(e){var t=this;e.find("input[name='thumbnailFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(e,o){o.submit().complete(function(e,o,n){"success"===o?e&&e.responseJSON&&e.responseJSON.path&&(t.model.thumbnailFile=e.responseJSON.path):(console.log('file upload completed with status "'+o+'"'),console.log(e))})}})},t.prototype.parseForEditor=function(){var e=this;return'<div class="external-link-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="teaser">'+e.model.teaser+'</div><a class="btn btn-primary external-link" href="'+e.model.url+'">'+e.model.linkText+"</a></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,i,n,t)}var n="facebook",i={viewPath:t+"modal/modal_facebook.html",displayName:"Facebook",object_type:"facebook",validationOptions:{rules:{title:"required",url:"required"}}};o.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[n]=o,o.prototype.orderIndex=7,o.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++){var i=o[n].name,a=o[n].value;i&&a&&(t.model[i]=a)}var r="embedCode",l='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s);js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));</script><div class="fb-post" data-href="'+this.model.url+'" data-width="500"></div>';t.model[r]=l},o.prototype.cleanModel=function(){return{title:null,url:null}},o.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed"><div class="facebook-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="facebook-info"><span>click here to show the toolbars</span></div></div>'},o.prototype.activateEditorEmbed=function(){e.FB&&e.FB.XFBML.parse()}}(window,"");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="globalBuzz",n={viewPath:e+"modal/modal_globalBuzz.html",displayName:"Global Buzz",object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=13,t.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><img class ="buzz-field-quote-png" src="http://www.pri.org/sites/all/themes/pri/images/icon-open-quote.png"><div class="buzz-quote-inner">'+e.model.quote+'</div></div><div class="buzz-field-quote-credit">'+e.model.credit+'</div><a class="btn btn-primary global-buzz-link" href="'+e.model.quoteUrl+'">'+e.model.quoteUrlText+"</a></div></div></article></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="iframe",n={viewPath:e+"modal/modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=11,t.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1}},t.prototype.parseForEditor=function(){return'<div class="iframe-embed"><div class="iframe-info"><span>click here to show the toolbars</span></div><iframe src="'+this.model.url+'" frameborder="0" scrolling="'+this.model.allowsScroll+'"></iframe><div class="iframe-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="image",n={viewPath:e+"modal/modal_image.html",displayName:"Image(s)",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"https://test-services.pri.org/admin/image-license/list",uploadFile:"https://test-services.pri.org/admin/embed/file-upload"}},i=".uploaded-image-file",a=".cancel-upload-image-btn",r=".edit-chosen-file-btn",l=function(e,t){return t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t)};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=1,t.prototype.imagePreviewClass="image-preview",t.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null}},t.prototype.loadLicenses=function(e){var t=this,o="<option disabled selected>-- select a license --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(t){if(t.response.data){var n=[];n.push(o);for(var i=0;i<t.response.data.length;i++)n.push('<option value="'+t.response.data[i].license+'">'+t.response.data[i].title+"</option>");e.find('[name="license"]').html(n)}}).fail(function(e){console.log("failed to find load image license options")})},t.prototype.initModal=function(e){var t=this;t.loadLicenses(e),t.$imageForm=e.find('input[name="upload"]'),e.find(r).on("click",function(){e.find(i).hide(),e.find(r).hide(),t.$imageForm.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$imageForm.hide(),e.find(a).hide(),t.$imageForm.parent().find("#upload-error").is(":visible")&&t.$imageForm.parent().find("#upload-error").hide(),e.find(i).show(),e.find(r).show()})},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.imagePreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(r).hide(),t.$imageForm.show()},t.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;return delete t.model.upload,t.parent.saveEmbed(e,t).then(function(e){if(o){var n=new FormData;return n.append("upload",o),$.ajax({url:t.options.httpPaths.uploadFile,type:"POST",data:n,headers:{"x-auth-token":EntityEmbed.apiService.getAuthToken(),"x-object-id":e.response.object_id,"x-debug":"1"},processData:!1,contentType:!1})}}).done(function(e){t.model.url_path=e.response.url_path})},t.prototype.generateUploadedImgPreview=function(){var e=this;return e.model.object_id?'<img class="'+e.imagePreviewClass+'" src="'+l(e.options.imageLocation,e.model.url_path)+'">':'<div class="'+e.imagePreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},t.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$imageForm.hide(),e.find(i).show(),e.find(r).show(),e.find(i).append(t.generateUploadedImgPreview()));
var o=l(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}g.parent().hasClass(p.getValue("WRAPPER_CSS_CLASS"))&&(i(),o()),e(),n(),E=$("#"+a()),f.get("placeholder")&&g.attr("placeholder",f.get("placeholder"))}function a(){var e=g.attr("id");return e=p.getValue("CONTAINER_ID")+e}function r(){function e(){y("autocompleteOff",!0)&&r(),t(),o(),n(),i(),a()}function t(){g.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=f.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];return e}function o(e,t){return f.get("matchResponseProperty")!==!1?"string"==typeof f.get("matchResponseProperty")?t[f.get("matchResponseProperty")]===e:"function"==typeof f.get("matchResponseProperty")?f.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<f.get("minCharNumber"))){if("list-required"!==f.get("data")){var n=f.get("data"),i=h.init(n);i=h.updateCategories(i,n),i=h.processData(i,e),c(i,e),g.parent().find("li").length>0?l():s()}var a=t();(void 0===a.url||""===a.url)&&(a.url=f.get("url")),(void 0===a.dataType||""===a.dataType)&&(a.dataType=f.get("dataType")),void 0!==a.url&&"list-required"!==a.url&&(a.url=a.url(e),a.data=f.get("preparePostData")(a.data,e),$.ajax(a).done(function(t){var n=h.init(t);n=h.updateCategories(n,t),n=h.convertXml(n),o(e,t)&&(n=h.processData(n,e),c(n,e)),h.checkIfDataExists(n)&&g.parent().find("li").length>0?l():s(),f.get("ajaxCallback")()}).fail(function(){b.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:s(),u();break;case 38:e.preventDefault(),T.length>0&&w>0&&(w-=1,g.val(f.get("getValue")(T[w])),d(w));break;case 40:e.preventDefault(),T.length>0&&w<T.length-1&&(w+=1,g.val(f.get("getValue")(T[w])),d(w));break;default:if(e.keyCode>40||8===e.keyCode){var o=g.val();f.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?f.get("requestDelay")>0?(void 0!==m&&clearTimeout(m),m=setTimeout(function(){t(o)},f.get("requestDelay"))):t(o):s()}}})}function o(){g.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&w>-1&&(g.val(f.get("getValue")(T[w])),f.get("list").onKeyEnterEvent(),f.get("list").onChooseEvent(),w=-1,s(),e.preventDefault())})}function n(){g.off("keypress")}function i(){g.focus(function(){""!==g.val()&&T.length>0&&(w=-1,l())})}function a(){g.blur(function(){setTimeout(function(){w=-1,s()},250)})}function r(){g.attr("autocomplete","off")}e()}function l(){E.trigger("show.eac")}function s(){E.trigger("hide.eac")}function d(e){E.trigger("selectElement.eac",e)}function c(e,t){E.trigger("loadElements.eac",[e,t])}function u(){g.trigger("blur")}var m,p=new e.Constans,f=new e.Configuration(o),b=new e.Logger,v=new e.Template(o.template),h=new e.ListBuilderService(f,e.proccess),y=f.equals,g=t,E="",T=[],w=-1;e.consts=p,this.getConstants=function(){return p},this.getConfiguration=function(){return f},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return w},this.getItemData=function(e){return T.length<e||void 0===T[e]?-1:T[e]},this.getSelectedItemData=function(){return this.getItemData(w)},this.build=function(){i()},this.init=function(){n()}},e.easyAutocompleteHandles=[],e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e}(EasyAutocomplete||{});$.fn.easyAutocomplete=function(e){return this.each(function(){var t=$(this),o=new EasyAutocomplete.main(t,e);EasyAutocomplete.inputHasId(t)||EasyAutocomplete.assignRandomId(t),o.init(),EasyAutocomplete.easyAutocompleteHandles[t.attr("id")]=o})},$.fn.getSelectedItemIndex=function(){var e=$(this).attr("id");return void 0!==e?EasyAutocomplete.easyAutocompleteHandles[e].getSelectedItemIndex():-1},$.fn.getItemData=function(e){var t=$(this).attr("id");return void 0!==t&&e>-1?EasyAutocomplete.easyAutocompleteHandles[t].getItemData(e):-1},$.fn.getSelectedItemData=function(){var e=$(this).attr("id");return void 0!==e?EasyAutocomplete.easyAutocompleteHandles[e].getSelectedItemData():-1};