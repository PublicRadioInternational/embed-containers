var EntityEmbed=EntityEmbed||{};!function(){function e(e,t,o,i,n,r){i||(i=function(){}),n||(n=function(){}),r||(r=function(){}),$.support.cors=!0,o.auth_token="abc123",o.debug=1,$.ajax({timeout:15e3,crossDomain:!0,type:"POST",dataType:"json",url:t,data:JSON.stringify(o)}).done(i).fail(n).always(r)}function t(){}t.prototype.put=function(t,o,i,n,r){e("PUT",t,o,i,n,r)},t.prototype.post=function(t,o,i,n,r){e("POST",t,o,i,n,r)},t.prototype.get=function(t,o,i,n,r){e("GET",t,o,i,n,r)},t.prototype.del=function(){console.log("apiService.delete is not yet implemented")},EntityEmbed.apiService=new t}();var EntityEmbed=EntityEmbed||{};!function(){var e={},t="entity-embed-active",o="medium-editor-button-active",i="medium-insert-images-toolbar",n="medium-insert-images-toolbar2",r="entity-embed-secondary-toolbar-locator",a="entity-embed-editor-line",l="entity-embed-container",d=function(e,t){var o="";t?(o="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active";var i='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var n in e){var r=e[n];r.label&&(i+='<li><button class="medium-editor-action" data-action="'+n+'">'+r.label+"</button></li>")}return i+="</ul></div>"};toolbarManager=function(e,o,i,n){var r=this;r.mediumEditorAddon=e,r.styles=o,r.actions=i,n&&(t=n),r.events()},toolbarManager.prototype.events=function(){var e=this;$(document).on("click","."+i+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+n+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this;e.append(d(t.actions)),t.$actionToolbar=$("."+n),t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(t,o){var n=this,r=$.extend(n.styles,{}),a=!0;if(o.options.styles){for(var l in o.options.styles)o.options.styles[l]?a=!1:delete r[l];a||(t.append(d(r,o.name)),e[o.name]=$("."+i+"."+o.name+"StyleToolbar"),e[o.name].hide())}},toolbarManager.prototype.showToolbars=function(t){var i,n=this,r=t.parent();n.currentToolbarEmbedType=t.attr("data-embed-type"),n.$actionToolbar.show(),e[n.currentToolbarEmbedType]&&(e[n.currentToolbarEmbedType].find("button").each(function(){r.hasClass("entity-embed-"+$(this).data("action"))&&(i=$(this),i.addClass(o))}),i||(i=e[n.currentToolbarEmbedType].find("button").first()),i.addClass(o),n.styleToolbarDo(i),e[n.currentToolbarEmbedType].show()),n.positionToolbars(t)},toolbarManager.prototype.styleToolbarDo=function(e){var i=this,n=e.closest("li").closest("ul"),r=$("."+t).closest("."+a);n.find("."+o).removeClass(o),e.addClass(o),n.find("button").each(function(){var e=$(this),n="entity-embed-"+e.data("action");e.hasClass(o)?(r.addClass(n),i.styles[e.data("action")].added&&i.styles[e.data("action")].added(r),setTimeout(function(){i.positionToolbars($("."+t))},50)):(r.removeClass(n),i.styles[e.data("action")].removed&&i.styles[e.data("action")].removed(r))})},toolbarManager.prototype.actionToolbarDo=function(e){var t=this,o=$("."+l),i=t.actions[e.data("action")].clicked;i(t.mediumEditorAddon,o)},toolbarManager.prototype.hideToolbar=function(){var t=this;t.$actionToolbar.hide(),t.$actionToolbar.find("button").removeClass(o),t.currentToolbarEmbedType&&e[t.currentToolbarEmbedType]&&(e[t.currentToolbarEmbedType].hide(),e[t.currentToolbarEmbedType].find("button").removeClass(o),t.currentToolbarEmbedType=null)},toolbarManager.prototype.positionToolbars=function(t){var o=this,i=t.find("."+r);0===i.length&&(i=t),l=t.offset().top+2;var n=i.offset().left+i.width()+4;n>$(window).width()-o.$actionToolbar.width()&&(l-=o.$actionToolbar.height()+8,n=$(window).width()-o.$actionToolbar.width()-50),o.$actionToolbar.css({top:l,left:n});var a=e[o.currentToolbarEmbedType];if(a){var l=t.offset().top-a.height()-8-2-5;0>l&&(l=0),a.css({top:l,left:t.offset().left+t.width()/2-a.width()/2})}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbedTypes=EntityEmbedTypes||{};!function(){"use strict";function e(e,t,o,i){var n=i||this;n.name=o,t=$.extend(!0,{},n.defaultOptions,t),n.options=$.extend(!0,{},t,e),n.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{put:"",post:"",get:"",del:""},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e){},e.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var n=o[i].name,r=o[i].value;n&&r&&(t.model[n]=r)}},e.prototype.populateFormWithModel=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)if(o[i].type&&-1!==o[i].type.indexOf("select")){var n=$(o[i]).find("option"),r=t.model[o[i].name],a=0;n.each(function(e){this.value===r&&(a=e)}),o[i].selectedIndex=a}else t.model[o[i].name]&&(o[i].value=t.model[o[i].name])},e.prototype.clearForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)o[i].type&&-1!==o[i].type.indexOf("select")?o[i].selectedIndex=0:o[i].value=null;t.model=t.cleanModel()},e.prototype.editorEvents=function(){},e.prototype.parseForEditor=function(){return'<pre class="embedded-content">'+JSON.stringify(this.model,null,4)+"</pre>"},e.prototype.validate=function(e){var t=this,o=e.find("form");return o.validate(t.options.validationOptions)},EntityEmbedTypes.genericEmbed=e,Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,i){var n=this;n.$el=$(e),n.options=$.extend(!0,{},t,o),n.scope={},i&&(n.scope=i),n.scope.modalCtrl=n,n.$el.data("scope",n.scope),n.options.functions.init.before(n.scope),n.init(),n.options.functions.init.after(n.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(){var e=this,t=e.closeBtnClass+" "+e.options.closeBtnIcon;return'<i class="'+t+'"></i>'},e.prototype.toggle=function(e){e.$el.toggleClass(e.activeClass),e.$backdrop.toggleClass(e.activeClass),e.$closeBtn.toggleClass(e.activeClass),e.isActive=!e.isActive},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$backdrop.click(function(){e.$el.abortModal()}),e.options.showCloseBtn&&(e.$el.after(e.closeBtnHtml()),e.$closeBtn=$("."+e.closeBtnClass),e.$closeBtn.click(function(){e.$el.abortModal()})),e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,i){var n=this;n.$el.find(e).on(t,function(e){o(e,n.$el.data("scope"),i)})},$.fn.modal=function(t,o){return this.each(function(){$.data(this,"ctrl")||(t||(t={}),$.data(this,"ctrl",new e(this,t,o)))})},$.fn.openModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&!t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}t.options.functions.open.before(t.$el.data("scope")),t.toggle(t),t.options.functions.open.after(t.$el.data("scope"))}})},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}t.options.functions.abort.before(t.$el.data("scope"))&&(t.toggle(t),t.options.functions.abort.after(t.$el.data("scope")))}})},$.fn.completeModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}t.options.functions.complete.before(t.$el.data("scope"))&&(t.toggle(t),t.options.functions.complete.after(t.$el.data("scope")))}})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e),o.init()}var t={modalId:"leave-confirmation-modal",viewPath:"modal/modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(){var e=this;e.$abortEl=$("#"+e.options.abortElId),e.$completeEl=$("#"+e.options.completeElId)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,edit:1,selectExisting:2};var t={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",selectExisting:"#btn-select-existing-embed",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{selectExistingTableBody:".embed-modal-select-existing tbody",selectExistingTableRow:".embed-modal-select-existing-item",selectExistingActiveItem:"embed-modal-active-row"}},o=function(e,t){return'<tr class="embed-modal-select-existing-item" id="'+t+'"><td>'+e+"</tr></td>"},i=function(e,t){var o=e.$currentEditorLocation[0].parentNode.className;o=o.split(" "),$("."+o[0]).attr("contenteditable",t)},n=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t};e.prototype.functions={init:{before:function(e){e.currentEmbedType=null,e.setModalView=function(e,t){t&&(e.currentEmbedType&&(e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=$.grep(e.embedTypes,function(e){return e.options.object_type==t})[0],e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex)},e.resetModalView=function(e){var t=e.embedTypes[0].options.object_type;e.setModalView(e,t)},e.saveEmbed=function(e){var t=e.currentEmbedType.validate(e.currentEmbedType.$view);e.currentEmbedType.$view.find("form").valid()&&(e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),e.modalType==EntityEmbed.embedModalTypes.edit?(e.currentEmbedType.model.object_id=e.currentEmbedType.model.id,EntityEmbed.apiService.put(e.currentEmbedType.options.httpPaths.put,e.currentEmbedType.model,function(t){return"ERROR"===t.status?void console.log("put failed"):(console.log("put succeeded"),void e.modalCtrl.$el.completeModal())},function(e){console.log("put failed")})):e.modalType==EntityEmbed.embedModalTypes.add&&(e.currentEmbedType.model.object_type=e.currentEmbedType.options.object_type,EntityEmbed.apiService.post(e.currentEmbedType.options.httpPaths.post,e.currentEmbedType.model,function(t){return"ERROR"===t.status?void console.log("post failed"):(e.currentEmbedType.model.object_id=t.response.object_id,console.log("post succeeded"),void e.modalCtrl.$el.completeModal())},function(e){console.log("post failed")})),t.resetForm())},e.populateSelectExistingView=function(e){$(t.elements.selectExistingTableRow).remove(),EntityEmbed.apiService.get(e.currentEmbedType.options.httpPaths.get,{object_id:e.currentEmbedType.options.getAllObjectId},function(i){if(i.response.list){e.selectExistingItems=i.response.list;for(var n=0;n<e.selectExistingItems.length;n++){var r=$(o(e.selectExistingItems[n].title,e.selectExistingItems[n].id));$(t.elements.selectExistingTableBody).append(r),e.modalCtrl.registerEvent(r,"click",function(e,o){var i=!$(e.currentTarget).hasClass(t.elements.selectExistingActiveItem);$(t.elements.selectExistingTableBody).find("."+t.elements.selectExistingActiveItem).removeClass(t.elements.selectExistingActiveItem),i?($(e.currentTarget).addClass(t.elements.selectExistingActiveItem),$(t.buttons.selectExisting).removeClass("disabled")):$(t.buttons.selectExisting).addClass("disabled")})}}},function(e){console.log("Failed to get list of current embed types for the Select Existing page.")})},e.showCreateNewEmbedView=function(e){$(t.buttons.showSelectExisting).show(),e.$embedTypeSelect.show(),$(t.containers.selectExistingEmbed).slideUp(),$(t.containers.createNewEmbed).slideDown(),$(t.containers.selectButtons).hide(),$(t.containers.createButtons).show()},e.showEditEmbedView=function(e){$(t.buttons.showSelectExisting).hide(),e.$embedTypeSelect.hide(),$(t.containers.selectExistingEmbed).is(":visible")&&($(t.containers.selectExistingEmbed).slideUp(),$(t.containers.createNewEmbed).slideDown()),$(t.containers.selectButtons).hide(),$(t.containers.createButtons).show(),$(t.buttons.showSelectExisting).hide()},e.generateEmbedHtml=function(e,t){var o="entity-embed";e.$currentEditorLocation.addClass("entity-embed-editor-line"),e.currentEmbedType.defaultStyle&&(o+=" "+e.currentEmbedType.defaultStyle);var i='<div class="entity-embed-container"><figure contenteditable="false" class="'+o+'" id="'+e.currentEmbedType.model.object_id+'" data-embed-type="'+e.currentEmbedType.name+'" >'+e.currentEmbedType.parseForEditor()+"</figure></div>";return t&&(i+='<p class="entity-embed-new-line">&nbsp</p>'),i}},after:function(e){e.$modalBody.find(t.containers.selectExistingEmbed).load("modal/modal_selectedExisting.html",function(e,o,i){console.log("modal_selectedExisting.html load completed with status: "+o),$(t.buttons.selectExisting).addClass("disabled")});for(var o=0,i=0;i<e.embedTypes.length;i++){var n=e.embedTypes[i];e.$embedTypeSelect.append('<option value="'+n.options.object_type+'">'+n.options.displayName+"</option>"),e.$modalBody.find(t.containers.createNewEmbed).append('<div id="'+n.name+'"></div>');var r=e.$modalBody.find("#"+n.name);r.load(n.options.viewPath,function(e,t,o){console.log(n.options.viewPath+" load completed with status: "+t)}),n.$view=r,n.optionIndex=o,r.hide(),o++}setTimeout(function(){for(var t=0;t<e.embedTypes.length;t++)e.embedTypes[t].initModal(e.embedTypes[t].$view)},200);var a=new EntityEmbed.confirmModalDefaults;t.elements.confirmModal="#"+a.options.modalId,$("#"+a.options.modalId).load(a.options.viewPath,function(t,o,i){if(console.log("leave confirmation modal load completed with status: "+o),"error"!==o){var n={parentModalCtrl:e.modalCtrl};a.init(),$("#"+a.options.modalId).modal(a,n)}}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(e,t){t.currentEmbedType.clearForm(t.currentEmbedType.$view);var o=e.currentTarget.options[e.currentTarget.selectedIndex].value;t.setModalView(t,o),t.modalType===EntityEmbed.embedModalTypes.selectExisting&&t.populateSelectExistingView(t)}),e.modalCtrl.registerEvent(t.buttons.saveEmbed,"click",function(e,t){t.saveEmbed(t)}),e.modalCtrl.registerEvent(t.buttons.showSelectExisting,"click",function(e,o){o.modalType=EntityEmbed.embedModalTypes.selectExisting,o.populateSelectExistingView(o),$(t.containers.createNewEmbed).slideUp(),$(t.containers.selectExistingEmbed).slideDown(),$(t.containers.createButtons).hide(),$(t.containers.selectButtons).show()}),e.modalCtrl.registerEvent(t.buttons.cancelSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.add,t.showCreateNewEmbedView(t)}),e.modalCtrl.registerEvent(t.buttons.selectExisting,"click",function(e,o){$(t.buttons.selectExisting).hasClass("disabled")||EntityEmbed.apiService.get(o.currentEmbedType.options.httpPaths.get,{object_id:$("."+t.elements.selectExistingActiveItem).attr("id")},function(e){o.currentEmbedType.model=e.response,o.modalCtrl.$el.completeModal()},function(e){console.log("failed to get embed type!")})})}},open:{before:function(e){},after:function(e){i(e,"false"),e.modalType==EntityEmbed.embedModalTypes.edit?(e.showEditEmbedView(e),EntityEmbed.apiService.get(e.currentEmbedType.options.httpPaths.get,{object_id:e.embedId},function(t){e.currentEmbedType.clearForm(e.currentEmbedType.$view),e.setModalView(e,t.response.object_type),e.currentEmbedType.model=t.response,e.staleModel=$.extend(!0,{},t.response),e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view)},function(e){console.log("failed to get embed type!")})):e.modalType==EntityEmbed.embedModalTypes.add&&(e.showCreateNewEmbedView(e),e.resetModalView(e))}},abort:{before:function(e){if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var o in e.currentEmbedType.model)if(!e.staleModel[o]||e.staleModel[o]!==e.currentEmbedType.model[o])return $(t.elements.confirmModal).openModal(),!1}else if(n(e.currentEmbedType.$view))return $(t.elements.confirmModal).openModal(),!1;var i=e.currentEmbedType.validate(e.currentEmbedType.$view);return i.resetForm(),delete e.confirmedLeave,!0},after:function(e){e.showCreateNewEmbedView(e),i(e,"true")}},complete:{before:function(e){return!0},after:function(e){i(e,"true");var t=0==$(".entity-embed-new-line").length;e.$currentEditorLocation.html(e.generateEmbedHtml(e,t))}}},EntityEmbed.embedModalDefaults=e}(),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="audio",n={viewPath:e+"modal/modal_audio.html",displayName:"Audio",httpPaths:{put:"",post:"",get:"",del:""},object_type:"audio",validationOptions:{rules:{title:"required",url:"required",credit:"required",creditLink:"required",audioFile:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=3,o.prototype.cleanModel=function(){return{title:null,file:[],credit:null,creditLink:null}},o.prototype.initModal=function(e){var t=this;e.find("input[name='audioFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(e,o){o.submit().complete(function(e,o,i){"success"===o?e&&e.responseJSON&&e.responseJSON.path&&(t.model.file=e.responseJSON.path):(console.log('file upload completed with status "'+o+'"'),console.log(e))})}})},o.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e),$("#audioList").children().remove()},o.prototype.parseForEditor=function(){var e=this,t=e.model.file.substring(e.model.file.lastIndexOf(".")+1);return'<div class="audio-embed"><audio controls><source src="'+e.model.file+'" type="audio/'+t+'"></audio><div class="credit">Credit: '+e.model.credit+'</div><div class="link">Link: '+e.model.creditLink+"</div></div>"}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,r,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="customText",n="custom-text-editor",r={viewPath:e+"modal/modal_customText.html",displayName:"Custom Text",httpPaths:{put:"",post:"",get:"",del:""},object_type:"custom",validationOptions:{rules:{title:"required",displayTitle:"required",customText:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=5,o.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var r,a;o[i].id==n?(r=o[i].attributes.name.nodeValue,a=o[i].innerHTML):(r=o[i].name,a=o[i].value),r&&a&&(t.model[r]=a)}},o.prototype.cleanModel=function(){return{title:null,displayTitle:null,text:null}},o.prototype.clearForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)o[i].type&&-1!==o[i].type.indexOf("select")?o[i].selectedIndex=0:(o[i].value=null,o[i].innerHTML="");t.model=t.cleanModel()},o.prototype.populateFormWithModel=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)if(o.type&&-1!==o[i].type.indexOf("select")){var r=$(o[i]).find("option"),a=t.model[o[i].name],l=0;r.each(function(e){this.value===a&&(l=e)}),o[i].selectedIndex=l}else o[i].value=t.model[o[i].name],o[i].id==n&&(o[i].innerHTML=t.model[o[i].attributes.name.nodeValue])},o.prototype.initModal=function(e){new MediumEditor("#"+n)},o.prototype.parseForEditor=function(){var e=this;return'<div class="custom-text-embed"><div class="display-title">'+e.model.displayTitle+'</div><div class="custom-text">'+e.model.customText+"</div></div>"}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="externalLink",n={viewPath:e+"modal/modal_externalLink.html",displayName:"External Link",httpPaths:{put:"",post:"",get:"",del:""},object_type:"external-link",validationOptions:{rules:{title:"required",displayTitle:"required",url:"required",linkText:"required",teaser:"required",thumbnailFile:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=9,o.prototype.cleanModel=function(){return{thumbnailFile:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null}},o.prototype.initModal=function(e){var t=this;e.find("input[name='thumbnailFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(e,o){o.submit().complete(function(e,o,i){"success"===o?e&&e.responseJSON&&e.responseJSON.path&&(t.model.thumbnailFile=e.responseJSON.path):(console.log('file upload completed with status "'+o+'"'),console.log(e))})}})},o.prototype.parseForEditor=function(){var e=this;return'<div class="external-link-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="teaser">'+e.model.teaser+'</div><a class="btn btn-primary external-link" href="'+e.model.url+'">'+e.model.linkText+"</a></div>"}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="facebook",n={viewPath:e+"modal/modal_facebook.html",displayName:"Facebook",httpPaths:{put:"",post:"",get:"",del:""},object_type:"facebook",validationOptions:{rules:{title:"required",url:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=7,o.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var n=o[i].name,r=o[i].value;n&&r&&(t.model[n]=r)}var a="embedCode",l='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s);js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));</script><div class="fb-post" data-href="'+this.model.url+'" data-width="500"></div>';t.model[a]=l},o.prototype.cleanModel=function(){return{title:null,url:null}},o.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed"><div class="facebook-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="facebook-info"><span>click here to show the toolbars</span></div></div>'}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="globalBuzz",n={viewPath:e+"modal/modal_globalBuzz.html",displayName:"Global Buzz",httpPaths:{put:"",post:"",get:"",del:""},object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",credit:"required",quoteUrlText:"required",quoteUrl:"required",url:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=13,o.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null}},o.prototype.parseForEditor=function(){var e=this;return'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><img class ="buzz-field-quote-png" src="http://www.pri.org/sites/all/themes/pri/images/icon-open-quote.png"><div class="buzz-quote-inner">'+e.model.quote+'</div></div><div class="buzz-field-quote-credit">'+e.model.credit+'</div><a class="btn btn-primary global-buzz-link" href="'+e.model.quoteUrl+'">'+e.model.quoteUrlText+"</a></div></div></article></div>"}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="iframe",n={viewPath:e+"modal/modal_iframe.html",displayName:"iFrame",httpPaths:{put:"",post:"",get:"",del:""},object_type:"iframe",validationOptions:{rules:{title:"required",url:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=11,o.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1}},o.prototype.parseForEditor=function(){return'<div class="iframe-embed"><div class="iframe-info"><span>click here to show the toolbars</span></div><iframe src="'+this.model.url+'" frameborder="0" scrolling="'+this.model.allowsScroll+'"></iframe><div class="iframe-info"><span>click here to show the toolbars</span></div></div>'}}("",EntityEmbedTypes);var EntityEmbed=EntityEmbed||{};!function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="image",n={viewPath:e+"modal/modal_image.html",displayName:"Image(s)",httpPaths:{put:"",post:"",get:"",del:""},object_type:"image",validationOptions:{rules:{title:"required",altText:"required",credit:"required",creditLink:"required",caption:"required",imageFile:"required"}}},r=function(e){EntityEmbed.apiService.get(e,{object_id:"2e7d8341d92a499dae3a19019550d518"},function(e){if(e.response.list){for(var t=[],o=0;o<e.response.list.length;o++)t[o]="<option>"+e.response.list[o].licenseName+"</option>";$("#license").html(t)}},function(e){console.log("failed to find object with that id")})};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=1,o.prototype.cleanModel=function(){return{file:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null}},o.prototype.initModal=function(e){var t=this;r(this.options.httpPaths.get),e.find("input[name='imageFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(e,o){o.submit().complete(function(e,o,i){"success"===o?e&&e.responseJSON&&e.responseJSON.path&&(t.model.file=e.responseJSON.path):(console.log('file upload completed with status "'+o+'"'),console.log(e))})}})},o.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e),$("#imagesList").children().remove()},o.prototype.parseForEditor=function(){var e=this;return'<div class="images-embed"><img class="entity-embed-secondary-toolbar-locator" src="'+e.model.file+'" /><div class="images-embed-caption">'+e.model.caption+'</div><div class="images-embed-credit">Credit: '+e.model.credit+"</div></div>"}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="instagram",n={viewPath:e+"modal/modal_instagram.html",displayName:"Instagram",httpPaths:{put:"",post:"",get:"",del:""},object_type:"instagram",validationOptions:{rules:{title:"required",url:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=8,o.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var n=o[i].name,r=o[i].value;n&&r&&(t.model[n]=r)}var a="embedCode",l='<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="6" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: auto; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px); "><a href="'+t.model.url+'" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank"></a></blockquote><script async defer src="//platform.instagram.com/en_US/embeds.js"></script>';t.model[a]=l},o.prototype.cleanModel=function(){return{title:null,url:null}},o.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed"><div class="instagram-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="instagram-info"><span>click here to show the toolbars</span></div></div>'}}("",EntityEmbedTypes);var EntityEmbed=EntityEmbed||{};!function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="newsletterSubscribe",n={viewPath:e+"modal/modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",httpPaths:{put:"",post:"",get:"",del:""},object_type:"newsletter",validationOptions:{rules:{title:"required",displayTitle:"required",teaser:"required"}}},r=function(e){EntityEmbed.apiService.get(e,{object_id:"2e7d8341d92a499dae3a19019550d518"},function(e){if(e.response.list){for(var t=[],o=0;o<e.response.list.length;o++)t[o]="<option value="+e.response.list[o].licenseCode+">"+e.response.list[o].licenseName+"</option>";$("#subscription").html(t)}},function(e){console.log("failed to find object with that id")})};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=12,o.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletterId:null,teaser:null}},o.prototype.initModal=function(e){r(this.options.httpPaths.get)},o.prototype.parseForEditor=function(){var e=this;return'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="subscribe-form"><div class="teaser">'+e.model.teaser+'</div><div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}("",EntityEmbedTypes);var EntityEmbed=EntityEmbed||{};!function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");
var i="relatedLink",n={viewPath:e+"modal/modal_relatedLink.html",displayName:"Related Link",httpPaths:{put:"",post:"",get:"",del:""},object_type:"related-link",validationOptions:{rules:{title:"required",displayTitle:"required"}}},r=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=10,o.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[]}};var a=function(e,t){EntityEmbed.apiService.get(t.options.httpPaths.get,{object_id:"dbbc5fc38d2e4d359572743d2c00d581"},function(t){var o={data:t.response.stories,getValue:"Title",list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0}}};$(e).easyAutocomplete(o),$(e).focus()},function(e){console.log("failed to retrieve any stories!")})};o.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e);for(var o=e.find(".related-link-url"),i=0;i<o.length;i++)t.model.links.push(o[i].value)},o.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e);for(var o="related-link-url",i=($el.find("#related-link-list"),$el.find("#add-link-btn")),n=0;n<t.model.links.length;n++)i.click(),e.find("."+o).last().val(t.model.links[n])},o.prototype.initModal=function(e){var t=this,o="related-link-url",i="remove-link-btn",n=e.find("#related-link-list"),l=e.find("#add-link-btn");l.click(function(){var e=r();n.append('<div class="'+o+'"><div class="embed-modal-form"><input id="'+e+'" type="url" placeholder="link url" class="embed-modal-form-control" required></div><button class="'+i+'"><i class="fa fa-minus"></i></button></div>'),$("#"+e).keydown(function(){$("#"+e).keydown(a("#"+e,t))})}),e.on("click","."+i,function(){$(document.activeElement).closest("."+o).remove()})}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,r,n,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i,n="slideshow",r={viewPath:e+"modal/modal_slideshow.html",displayName:"Slideshow",httpPaths:{put:"",post:"",get:"",del:""},object_type:"slideshow",validationOptions:{rules:{slideshowTitle:"required",displayTitle:"required",imageFile:"required",creditLink:"required",credit:"required",title:"required",altText:"required",caption:"required"}}},a=function(){for(var e="",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e},l="#embed-modal-slideshow-image",d=".embed-modal-slideshow-image-select",s={},c=function(){var e=$(l).find("legend").attr("data-image-id");i.getModelFromForm($(l)),s[e]=i.model},p=function(e){var t=$("#"+e),o=$(l).find("legend").attr("data-image-id");o&&""!==o?(c(),i.clearForm($(l)),i.model=s[e],i.populateFormWithModel($(l))):($(l).show(),$(d).show()),$(l).find("legend").attr("data-image-id",e),$(d).val(t.val())};o.inherits(t.genericEmbed),t[n]=o,o.prototype.orderIndex=2,o.prototype.cleanModel=function(){return{title:null,images:[]}},o.prototype.initModal=function(e){var t=this;t.model=t.cleanModel(),i=$.grep(EntityEmbed.embedTypes,function(e){return"image"==e.name})[0],e.find("input[name='imageFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(t,o){o.submit().complete(function(t,n,r){if("success"===n){if(!t||!t.responseJSON||!t.responseJSON.path)return console.log('file upload completed with status "'+n+'"'),void console.log(t);var l=a();s[l]=i.cleanModel();var c=0;for(var m in s)c+=1;var u=$('<option id="'+l+'">image '+c+"</option>");o.context=u.appendTo(e.find(d)),p(l)}})}}),e.on("change",d,function(e){var t=$(e.currentTarget.options[e.currentTarget.selectedIndex]);p(t.attr("id"))})},o.prototype.getModelFromForm=function(e){var t=this;c(),t.model.title=e.find("input[name=slideshowTitle]").val(),t.model.images=[];for(var o in s)t.model.images.push(s[o])},o.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e),e.find(d).children().remove(),$(l).hide(),$(d).hide(),e.find("legend").attr("data-image-id","")}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="twitter",n={viewPath:e+"modal/modal_twitter.html",displayName:"Twitter",httpPaths:{put:"",post:"",get:"",del:""},object_type:"tweet",validationOptions:{rules:{title:"required",tweet:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=6,o.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var n=o[i].name,r=o[i].value;n&&r&&(t.model[n]=r)}var a="embedCode",l='<blockquote class="twitter-tweet" data-lang="en" style="width:50%; margin:auto;"><a href="'+this.model.tweet+'"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>';t.model[a]=l},o.prototype.cleanModel=function(){return{title:null,url:null}},o.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed"><div class="twitter-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="twitter-info"><span>click here to show the toolbars</span></div></div>'}}("",EntityEmbedTypes),function(e,t){"use strict";function o(e){var t=this;t.parent.constructor(e,n,i,t)}if(!t)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var i="video",n={viewPath:e+"modal/modal_video.html",displayName:"Video",httpPaths:{put:"",post:"",get:"",del:""},object_type:"video",validationOptions:{rules:{title:"required",url:"required"}}};o.inherits(t.genericEmbed),t[i]=o,o.prototype.orderIndex=4,o.prototype.cleanModel=function(){return{title:null,url:null}},o.prototype.parseForEditor=function(){var e=this;return $.support.cors=!0,$.ajax({crossDomain:!0,cache:!1,async:!1,timeout:15e3,url:"http://medium.iframe.ly/api/oembed?iframe=1",dataType:"json",data:{url:e.model.url},success:function(t){e.model.videoHtmlString=$(t.html).find("iframe").attr("style","").prop("outerHTML")},error:function(e,t,o){}}),'<div class="video-embed"><div class="video-info"><span>click here to show the toolbars</span></div><div class="overlay"></div>'+e.model.videoHtmlString+'<div class="video-info"><span>click here to show the toolbars</span></div></div>'}}("",EntityEmbedTypes);var EntityEmbed=EntityEmbed||{};!function(e,t,o,i,n){"use strict";function r(o,i){var n=this;n.el=o,n.$el=e(o),n.templates=t.MediumInsert.Templates,n.core=n.$el.data("plugin_"+a),n.options=e.extend(!0,{},s,i),n._defaults=s,n._name=a,n.toolbarManager=new EntityEmbed.toolbarManager(n,n.options.styles,n.options.actions,d),n.core.getEditor()&&(n.core.getEditor()._serializePreEmbeds=n.core.getEditor().serialize,n.core.getEditor().serialize=n.editorSerialize,n.core.getEditor().loadStory=n.loadStory),n.init()}var a="mediumInsert",l="EntityEmbeds",d="entity-embed-active",s={modalOptions:{},modalScope:{$embedTypeSelect:e(""),$modalBody:e("")},$modalEl:e(""),insertBtn:".medium-insert-buttons",fileUploadOptions:{url:"upload.php",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i},styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}}},embedTypes:{image:{},video:{},audio:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},globalBuzz:{},newsletterSubscribe:{},iframe:{},customTexd:{}}};r.prototype.init=function(){var t=this;t.toolbarManager.createActionToolbar(e("body")),t.events(),t.embedTypes=[];for(var o in i)if(t.options.embedTypes[o]){var n=new i[o](t.options.embedTypes[o]);t.embedTypes.push(n),t.toolbarManager.createStyleToolbar(e("body"),n)}t.embedTypes.sort(function(e,t){return e.orderIndex-t.orderIndex}),EntityEmbed.embedTypes=t.embedTypes;var r,a=new EntityEmbed.embedModalDefaults;r=t.options.modalOptions?e.extend(!0,{},a,t.options.modalOptions):a;var l={embedTypes:t.embedTypes};l=e.extend(!0,{},t.options.modalScope,l),t.options.$modalEl.modal(r,l)},r.prototype.events=function(){var t=this;e(o).ready(function(){e(t.options.insertBtn).click(function(e){e.stopPropagation(),t.add()})}),e(o).on("click",function(o){e(o.target).is(".medium-editor-action")||e(o.target.parentElement).is(".medium-editor-action")||0==t.$el.find("."+d).length||(e("."+d).removeClass(d),t.toolbarManager.hideToolbar())}).on("click",".entity-embed",function(o){t.toggleSelectEmbed(e(this)),o.stopPropagation()}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=t.$el.find("."+d).length&&t.toolbarManager.hideToolbar()})},r.prototype.getCore=function(){return this.core},r.prototype.editorSerialize=function(){var t=this,o=t._serializePreEmbeds(),i={storyHtml:"",embeds:[]};return e.each(o,function(t){var n=e("<div />").html(o[t].value);n.find(".entity-embed-new-line").remove();for(var r=n.find(".entity-embed-container"),a=0;a<r.length;a++){var l=e(r[a]).find("figure");if(l){var d={id:l.attr("id"),style:l.attr("class"),type:l.attr("data-embed-type")};i.embeds.push(d),e(r[a]).html("[["+(i.embeds.length-1)+"]]")}}i.storyHtml+=n.html()}),i},r.prototype.loadStory=function(e){EntityEmbed.apiService.get("https://test-services.pri.org/admin/embed/edit",{object_id:e},function(e){for(var t,o=/\[\[[0-9]*\]\]/gi;t=o.exec(e.response.storyHtml);){var i=t[0];parseInt(i.substring(2,i.length-2))}},function(t){console.log("Failed to get story with id "+e)})},r.prototype.add=function(){var t=this,o={$currentEditorLocation:e(".medium-insert-active"),modalType:EntityEmbed.embedModalTypes.add};t.options.$modalEl.openModal(o)},r.prototype.editEmbed=function(e){var t=this,o={$currentEditorLocation:e.parent(),modalType:EntityEmbed.embedModalTypes.edit,embedId:e.find("figure").attr("id")};t.toolbarManager.hideToolbar(),t.options.$modalEl.openModal(o)},r.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove()},r.prototype.toggleSelectEmbed=function(e){var t=this;e.toggleClass(d),t.options.actions&&(e.hasClass(d)?t.toolbarManager.showToolbars(e):t.toolbarManager.hideToolbar())},e.fn[a+l]=function(t){return this.each(function(){e.data(this,"plugin_"+a+l)||e.data(this,"plugin_"+a+l,new r(this,t))})}}(jQuery,window,document,EntityEmbedTypes);