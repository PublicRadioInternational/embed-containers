var EntityEmbed=EntityEmbed||{};!function(){function e(e){return e=$.extend(!0,{},r,e),e.data.debug=e.debug,e.data.auth_token=e.auth_token,$.ajax({timeout:15e3,crossDomain:!0,type:e.methodType,dataType:"json",url:e.path,data:JSON.stringify(e.data)})}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function n(t){return t.methodType="POST",e(t)}function i(e){r.auth_token=e}function a(e){return r.auth_token}var r={data:{},debug:0,auth_token:"",path:""},l=/^[^.]*staging[^.]*\.|\.dev$/,s=l.test(window.location.host);s&&(r.debug=1,i("abc123")),EntityEmbed.apiService={put:t,post:o,get:n,setAuthToken:i,getAuthToken:a}}();var EntityEmbed=EntityEmbed||{};!function(){var e={},t="entity-embed-active",o="medium-editor-button-active",n="medium-insert-images-toolbar",i="medium-insert-images-toolbar2",a="entity-embed-secondary-toolbar-locator",r=function(e,t){var o="";t?(o="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active";var n='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var i in e){var a=e[i];a.label&&(n+='<li><button class="medium-editor-action" data-action="'+i+'">'+a.label+"</button></li>")}return n+="</ul></div>"};toolbarManager=function(e,o,n,i){var a=this;a.mediumEditorAddon=e,a.styles=o,a.actions=n,i&&(t=i),a.events()},toolbarManager.prototype.events=function(){var e=this;$(document).on("click","."+n+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+i+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this;e.append(r(t.actions)),t.$actionToolbar=$("."+i),t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(t,o){var i=this,a=$.extend(i.styles,{}),l=!0;if(o.options.styles){for(var s in o.options.styles)o.options.styles[s]?l=!1:delete a[s];l||(t.append(r(a,o.name)),e[o.name]=$("."+n+"."+o.name+"StyleToolbar"),e[o.name].hide())}},toolbarManager.prototype.showToolbars=function(n,i){var a,r=this,l=$("."+t);r.currentToolbarEmbedType=i,r.$actionToolbar.show(),e[r.currentToolbarEmbedType]&&(e[r.currentToolbarEmbedType].find("button").each(function(){l.hasClass("entity-embed-"+$(this).data("action"))&&(a=$(this),a.addClass(o))}),e[r.currentToolbarEmbedType].show(),a&&a.addClass(o)),r.positionToolbars(n)},toolbarManager.prototype.styleToolbarDo=function(e){var n=this,i=e.closest("li").closest("ul"),a=$("."+t);i.find("."+o).removeClass(o),e.addClass(o),i.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(o)?n.addStyle(a,t,e.data("action"),!0):(a.removeClass(t),n.styles[e.data("action")].removed&&n.styles[e.data("action")].removed(a))})},toolbarManager.prototype.addStyle=function(e,o,n,i){var a=this;e.addClass(o),a.styles[n].added&&a.styles[n].added(e),i&&setTimeout(function(){a.positionToolbars($("."+t))},50)},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,n=$("."+t),i=o.actions[e.data("action")].clicked;i(o.mediumEditorAddon,n)},toolbarManager.prototype.hideToolbar=function(){var t=this;t.$actionToolbar.hide(),t.$actionToolbar.find("button").removeClass(o),t.currentToolbarEmbedType&&e[t.currentToolbarEmbedType]&&(e[t.currentToolbarEmbedType].hide(),e[t.currentToolbarEmbedType].find("button").removeClass(o),t.currentToolbarEmbedType=null)},toolbarManager.prototype.positionToolbars=function(t){var o=this,n=t.find("."+a);0===n.length&&(n=t),l=t.offset().top+2;var i=n.offset().left+n.width()+4;i>$(window).width()-o.$actionToolbar.width()&&(l-=o.$actionToolbar.height()+8,i=$(window).width()-o.$actionToolbar.width()-50),o.$actionToolbar.css({top:l,left:i});var r=e[o.currentToolbarEmbedType];if(r){var l=t.offset().top-r.height()-8-2-5;0>l&&(l=0),r.css({top:l,left:t.offset().left+t.width()/2-r.width()/2})}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,n){var i=n||this;i.name=o,t=$.extend(!0,{},i.defaultOptions,t),i.options=$.extend(!0,{},t,e),i.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{put:"https://test-services.pri.org/admin/embed/edit",post:"https://test-services.pri.org/admin/embed/edit",get:"https://test-services.pri.org/admin/embed/fetch",getAll:"https://test-services.pri.org/admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e){},e.prototype.getModelFromForm=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control, .embed-modal-file-input"),i=0;i<n.length;i++){var a=n[i].name,r=n[i].type,l=null;l="file"===r?n[i].files[0]:n[i].value,a&&(o.model[a]=l)}},e.prototype.populateFormWithModel=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control"),i=0;i<n.length;i++)if(!n[i].type||-1===n[i].type.indexOf("file"))if(n[i].type&&-1!==n[i].type.indexOf("select")){var a=$(n[i]).find("option"),r=o.model[n[i].name],l=0;a.each(function(e){this.value===r&&(l=e)}),n[i].selectedIndex=l}else o.model[n[i].name]&&(n[i].value=o.model[n[i].name])},e.prototype.clearForm=function(e,t){var o=t||this;o.$validator&&o.$validator.resetForm();for(var n=e.find("form"),i=0;i<n.length;i++)n[i].reset();o.model=o.cleanModel()},e.prototype.editorEvents=function(){},e.prototype.parseForEditor=function(){return'<pre class="embedded-content">'+JSON.stringify(this.model,null,4)+"</pre>"},e.prototype.validate=function(e,t,o){var n=o||this,i=e;return i.is("form")||(i=e.find("form")),n.$validator=i.validate(n.options.validationOptions),n.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return e?(o.model.object_type=o.options.object_type,EntityEmbed.apiService.post({path:o.options.httpPaths.post,data:o.model})):EntityEmbed.apiService.put({path:o.options.httpPaths.put,data:o.model})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,n){var i=this;i.$el=$(e),i.options=$.extend(!0,{},t,o),i.scope={},n&&(i.scope=n),i.scope.modalCtrl=i,i.$el.data("scope",i.scope),i.options.functions.init.before(i.scope),i.init(),i.options.functions.init.after(i.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e){e.$el.toggleClass(e.activeClass),e.$backdrop.toggleClass(e.activeClass),e.$closeBtn.toggleClass(e.activeClass),e.isActive=!e.isActive},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();if(e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$backdrop.click(function(){e.$el.abortModal()}),e.options.showCloseBtn){var o=e.generateId();e.$el.prepend(e.closeBtnHtml(o)),e.$closeBtn=$("."+e.closeBtnClass+"#"+o),e.$closeBtn.click(function(){e.$el.abortModal()})}e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,n){var i=this;i.$el.find(e).on(t,function(e){o(e,i.$el.data("scope"),n)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t=$.data(this[0],"ctrl");if(t&&!t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.promise=$.Deferred(),t.options.functions.open.before(i),t.toggle(t),t.options.functions.open.after(i);var a=.1*$(window).height(),r=a+$(document).scrollTop();return t.$el.css("top",r),t.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.options.functions.abort.before(i)&&(t.toggle(t),t.options.functions.abort.after(i),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.options.functions.complete.before(i)&&(t.toggle(t),t.options.functions.complete.after(i),"pending"===t.promise.state()&&t.promise.resolve())}})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e),o.init()}var t={modalId:"leave-confirmation-modal",viewPath:"modal/modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(){var e=this;e.$abortEl=$("#"+e.options.abortElId),e.$completeEl=$("#"+e.options.completeElId)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3};var t=void 0,o=!1,n={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",selectExisting:"#btn-select-existing-embed",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{selectExistingTableBody:".embed-modal-select-existing tbody",selectExistingTableRow:".embed-modal-select-existing-item",selectExistingActiveItem:"embed-modal-active-row",saveSpinner:"#embed-modal-spinner"}},i=function(e,t){return'<tr class="embed-modal-select-existing-item" id="'+t+'"><td>'+e+"</tr></td>"},a=function(e,t){$(".editable").attr("contenteditable",t)},r=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},l=function(e,t){t&&(e.currentEmbedType&&(e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=p(t),e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex)},s=function(e){var t=e.embedTypes[0].options.object_type;l(e,t),e.$embedTypeSelect.show()},d=function(e){var t=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,i=e.currentEmbedType.validate(e.currentEmbedType.$view,t);if(!o&&e.currentEmbedType.$view.find("form").valid()){if(o=!0,$(n.elements.saveSpinner).show(),e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),t)var a=function(t){return"ERROR"===t.status?void console.log("POST failed"):"string"==typeof t.response?void console.log("Failed to POST embed type: "+t.response):(e.currentEmbedType.model.object_id=t.response.object_id,console.log("POST succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("POST failed"),e.failCallback&&e.failCallback()};else var a=function(t){return"ERROR"===t.status?void console.log("PUT failed"):"string"==typeof t.response?void console.log("Failed to PUT embed type: "+t.response):(console.log("PUT succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("PUT failed"),e.failCallback&&e.failCallback()};var l=function(t){o=!1,$(n.elements.saveSpinner).hide(),e.alwaysCallback&&e.alwaysCallback()};e.currentEmbedType.saveEmbed(t).done(a).fail(r).always(l),i.resetForm()}},c=function(e){$(n.elements.selectExistingTableRow).remove(),EntityEmbed.apiService.post({path:e.currentEmbedType.options.httpPaths.getAll,data:{object_type:e.currentEmbedType.options.object_type,auth_token:"abc123"}}).done(function(t){if("string"==typeof t.response)return void console.log("Failed to get list of current embed types for the Select Existing page.: "+t.response);if(t.response.data){e.selectExistingItems=t.response.data;for(var o=0;o<e.selectExistingItems.length;o++){var a=$(i(e.selectExistingItems[o].title,e.selectExistingItems[o].object_id));$(n.elements.selectExistingTableBody).append(a),e.modalCtrl.registerEvent(a,"click",function(e,t){var o=!$(e.currentTarget).hasClass(n.elements.selectExistingActiveItem);$(n.elements.selectExistingTableBody).find("."+n.elements.selectExistingActiveItem).removeClass(n.elements.selectExistingActiveItem),o?($(e.currentTarget).addClass(n.elements.selectExistingActiveItem),$(n.buttons.selectExisting).removeClass("disabled")):$(n.buttons.selectExisting).addClass("disabled")})}}}).fail(function(e){console.log("Failed to get list of current embed types for the Select Existing page.")})},u=function(e){$(n.buttons.showSelectExisting).show(),e.$embedTypeSelect.show(),$(n.containers.selectExistingEmbed).slideUp(),$(n.containers.createNewEmbed).slideDown(),$(n.containers.selectButtons).hide(),$(n.containers.createButtons).show()},m=function(e){$(n.buttons.showSelectExisting).hide(),e.$embedTypeSelect.hide(),$(n.containers.selectExistingEmbed).is(":visible")&&($(n.containers.selectExistingEmbed).slideUp(),$(n.containers.createNewEmbed).slideDown()),$(n.containers.selectButtons).hide(),$(n.containers.createButtons).show(),$(n.buttons.showSelectExisting).hide()},p=function(e){var o=$.grep(t,function(t){return t.options.object_type==e});return o.length>0?o[0]:null},f=function(e,t){var o='<figure contenteditable="false" id="'+e.model.object_id+'" data-embed-type="'+e.options.object_type+'" >'+e.parseForEditor()+"</figure>";return t?'<div class="entity-embed-container">'+o+"</div>":o};e.prototype.generateEmbedHtml=f,e.prototype.functions={init:{before:function(e){e.currentEmbedType=null,t=e.embedTypes,$(n.elements.saveSpinner).hide()},after:function(e){e.$modalBody.find(n.containers.selectExistingEmbed).load("modal/modal_selectedExisting.html",function(e,t,o){console.log("modal_selectedExisting.html load completed with status: "+t),$(n.buttons.selectExisting).addClass("disabled")});for(var t=0,o=0;o<e.embedTypes.length;o++){var i=e.embedTypes[o];e.$embedTypeSelect.append('<option value="'+i.options.object_type+'">'+i.options.displayName+"</option>"),e.$modalBody.find(n.containers.createNewEmbed).append('<div id="'+i.name+'"></div>');var a=e.$modalBody.find("#"+i.name);a.load(i.options.viewPath,function(e,t,o){console.log(i.options.viewPath+" load completed with status: "+t)}),i.$view=a,i.optionIndex=t,a.hide(),t++}setTimeout(function(){for(var t=0;t<e.embedTypes.length;t++)e.embedTypes[t].initModal(e.embedTypes[t].$view)},200);var r=new EntityEmbed.confirmModalDefaults;n.elements.confirmModal="#"+r.options.modalId,$("#"+r.options.modalId).load(r.options.viewPath,function(t,o,n){if(console.log("leave confirmation modal load completed with status: "+o),"error"!==o){var i={parentModalCtrl:e.modalCtrl};r.init(),$("#"+r.options.modalId).modal(r,i)}}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(e,t){t.currentEmbedType.clearForm(t.currentEmbedType.$view);var o=e.currentTarget.options[e.currentTarget.selectedIndex].value;l(t,o),t.modalType===EntityEmbed.embedModalTypes.selectExisting&&c(t)}),e.modalCtrl.registerEvent(n.buttons.saveEmbed,"click",function(e,t){d(t)}),e.modalCtrl.registerEvent(n.buttons.showSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.selectExisting,c(t),$(n.containers.createNewEmbed).slideUp(),$(n.containers.selectExistingEmbed).slideDown(),$(n.containers.createButtons).hide(),$(n.containers.selectButtons).show()}),e.modalCtrl.registerEvent(n.buttons.cancelSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.add,u(t)}),e.modalCtrl.registerEvent(n.buttons.selectExisting,"click",function(e,t){$(n.buttons.selectExisting).hasClass("disabled")||EntityEmbed.apiService.get({path:t.currentEmbedType.options.httpPaths.get,data:{object_id:$("."+n.elements.selectExistingActiveItem).attr("id")}}).done(function(e){return"string"==typeof e.response?void console.log("Failed to get list of current embed types for the Select Existing page.: "+e.response):(t.currentEmbedType.model=e.response,void t.modalCtrl.$el.completeModal())}).fail(function(e){console.log("failed to get embed type!")})})}},open:{before:function(e){a(e,"false"),e.embedType?(l(e,e.embedType),delete e.embedType):s(e)},after:function(e){e.modalType==EntityEmbed.embedModalTypes.edit?(m(e),EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(t){return"string"==typeof t.response?void console.log("Failed to get embed type: "+t.response):(l(e,t.response.object_type),e.currentEmbedType.model=t.response,e.staleModel=$.extend(!0,{},t.response),void e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view))}).fail(function(e){console.log("failed to get embed type!")})):e.modalType==EntityEmbed.embedModalTypes.add?u(e):e.modalType==EntityEmbed.embedModalTypes.addSingle&&(u(e),e.$embedTypeSelect.hide())}},abort:{before:function(e){if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var t in e.currentEmbedType.model)if(!e.staleModel[t]||e.staleModel[t]!==e.currentEmbedType.model[t])return $(n.elements.confirmModal).openModal(),!1}else if(r(e.currentEmbedType.$view))return $(n.elements.confirmModal).openModal(),!1;var o=e.currentEmbedType.validate(e.currentEmbedType.$view,!0);return o.resetForm(),delete e.confirmedLeave,!0},after:function(e){a(e,"true")}},complete:{before:function(e){return!0},after:function(e){if(a(e,"true"),e.$currentEditorLocation.length>0){e.$currentEditorLocation.addClass("entity-embed-editor-line");var t=e.$currentEditorLocation.html(f(e.currentEmbedType,!0)),o=jQuery.Event("entityEmbedAdded");o.embedType=e.currentEmbedType,t.find(".entity-embed-container").trigger(o)}e.modalCtrl.promise.resolve({data:e.currentEmbedType.model,options:e.currentEmbedType.options})}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="audio",n={viewPath:e+"modal/modal_audio.html",displayName:"Audio",object_type:"audio",audioLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",upload:{required:!0,extension:"mp3"},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"https://test-services.pri.org/admin/embed/file-upload"}},i=".uploaded-audio-file",a=".cancel-upload-file-btn",r=".edit-chosen-file-btn",l=function(e,t){return t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(e="/"+t),e+t)};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=3,t.prototype.audioPreviewClass="audio-preview",t.prototype.cleanModel=function(){return{title:null,url_path:null,credit:null,creditLink:null}},t.prototype.initModal=function(e){var t=this;t.$mp3Form=e.find('input[name="upload"]'),e.find(r).on("click",function(){e.find(i).hide(),e.find(r).hide(),t.$mp3Form.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$mp3Form.hide(),e.find(a).hide(),t.$mp3Form.parent().find("#upload-error").is(":visible")&&t.$mp3Form.parent().find("#upload-error").hide(),e.find(r).show(),e.find(i).show()})},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.audioPreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(r).hide(),t.$mp3Form.show()},t.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;return delete t.model.upload,t.parent.saveEmbed(e,t).then(function(e){if(o){var n=new FormData;return n.append("upload",o),$.ajax({url:t.options.httpPaths.uploadFile,type:"POST",data:n,headers:{"x-auth-token":EntityEmbed.apiService.getAuthToken(),"x-object-id":e.response.object_id,"x-debug":"1"},processData:!1,contentType:!1})}}).done(function(e){t.model.url_path=e.response.url_path})},t.prototype.generateUploadedPreview=function(){var e=this;if(e.model.object_id){var t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<audio controls class="'+e.audioPreviewClass+'"><source src="'+l(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio>'}return'<div class="'+e.audioPreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},t.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$mp3Form.hide(),e.find(i).show(),e.find(r).show(),e.find(i).append(t.generateUploadedPreview()))},t.prototype.parseForEditor=function(){var e=this,t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<div class="audio-embed"><audio controls><source src="'+l(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio><div class="credit">Credit: '+e.model.credit+'</div><div class="link">Link: '+e.model.creditLink+"</div></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="customText",n="custom-text-editor",i={viewPath:e+"modal/modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=5,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a,r;o[i].id==n?(a=o[i].attributes.name.nodeValue,r=o[i].innerHTML):(a=o[i].name,r=o[i].value),a&&r&&(t.model[a]=r)}},t.prototype.cleanModel=function(){return{title:null,displayTitle:null,text:null}},t.prototype.clearForm=function(e,t){var t=this;t.parent.clearForm(e,t);for(var o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++)o[n].type&&-1!==o[n].type.indexOf("select")?o[n].selectedIndex=0:(o[n].value=null,o[n].innerHTML="");t.model=t.cleanModel()},t.prototype.populateFormWithModel=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)if(o.type&&-1!==o[i].type.indexOf("select")){var a=$(o[i]).find("option"),r=t.model[o[i].name],l=0;a.each(function(e){this.value===r&&(l=e)}),o[i].selectedIndex=l}else o[i].value=t.model[o[i].name],o[i].id==n&&(o[i].innerHTML=t.model[o[i].attributes.name.nodeValue])},t.prototype.initModal=function(e){new MediumEditor("#"+n)},t.prototype.parseForEditor=function(){var e=this;return'<div class="custom-text-embed"><div class="display-title">'+e.model.displayTitle+'</div><div class="custom-text">'+e.model.customText+"</div></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="externalLink",n={viewPath:e+"modal/modal_externalLink.html",displayName:"External Link",object_type:"external-link",validationOptions:{rules:{title:"required",url:"required",linkText:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=9,t.prototype.cleanModel=function(){return{thumbnailFile:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null}},t.prototype.initModal=function(e){var t=this;e.find("input[name='thumbnailFile']").fileupload({dataType:"json",replaceFileInput:!1,add:function(e,o){o.submit().complete(function(e,o,n){"success"===o?e&&e.responseJSON&&e.responseJSON.path&&(t.model.thumbnailFile=e.responseJSON.path):(console.log('file upload completed with status "'+o+'"'),console.log(e))})}})},t.prototype.parseForEditor=function(){var e=this;return'<div class="external-link-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="teaser">'+e.model.teaser+'</div><a class="btn btn-primary external-link" href="'+e.model.url+'">'+e.model.linkText+"</a></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="facebook",n={viewPath:e+"modal/modal_facebook.html",displayName:"Facebook",object_type:"facebook",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=7,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++){var i=o[n].name,a=o[n].value;i&&a&&(t.model[i]=a)}var r="embedCode",l='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s);js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));</script><div class="fb-post" data-href="'+this.model.url+'" data-width="500"></div>';t.model[r]=l},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed"><div class="facebook-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="facebook-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="globalBuzz",n={viewPath:e+"modal/modal_globalBuzz.html",displayName:"Global Buzz",object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=13,t.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><img class ="buzz-field-quote-png" src="http://www.pri.org/sites/all/themes/pri/images/icon-open-quote.png"><div class="buzz-quote-inner">'+e.model.quote+'</div></div><div class="buzz-field-quote-credit">'+e.model.credit+'</div><a class="btn btn-primary global-buzz-link" href="'+e.model.quoteUrl+'">'+e.model.quoteUrlText+"</a></div></div></article></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="iframe",n={viewPath:e+"modal/modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=11,t.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1}},t.prototype.parseForEditor=function(){return'<div class="iframe-embed"><div class="iframe-info"><span>click here to show the toolbars</span></div><iframe src="'+this.model.url+'" frameborder="0" scrolling="'+this.model.allowsScroll+'"></iframe><div class="iframe-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="image",n={viewPath:e+"modal/modal_image.html",displayName:"Image(s)",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"https://test-services.pri.org/admin/image-license/list",uploadFile:"https://test-services.pri.org/admin/embed/file-upload"}},i=".uploaded-image-file",a=".cancel-upload-image-btn",r=".edit-chosen-file-btn",l=function(e,t){return t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t)};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=1,t.prototype.imagePreviewClass="image-preview",t.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null}},t.prototype.loadLicenses=function(e){var t=this,o="<option disabled selected>-- select a license --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(t){if(t.response.data){var n=[];n.push(o);for(var i=0;i<t.response.data.length;i++)n.push('<option value="'+t.response.data[i].license+'">'+t.response.data[i].title+"</option>");e.find('[name="license"]').html(n)}}).fail(function(e){console.log("failed to find load image license options")})},t.prototype.initModal=function(e){var t=this;t.loadLicenses(e),t.$imageForm=e.find('input[name="upload"]'),e.find(r).on("click",function(){e.find(i).hide(),e.find(r).hide(),t.$imageForm.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$imageForm.hide(),e.find(a).hide(),t.$imageForm.parent().find("#upload-error").is(":visible")&&t.$imageForm.parent().find("#upload-error").hide(),e.find(i).show(),e.find(r).show()})},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.imagePreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(r).hide(),t.$imageForm.show()},t.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;return delete t.model.upload,t.parent.saveEmbed(e,t).then(function(e){if(o){var n=new FormData;return n.append("upload",o),$.ajax({url:t.options.httpPaths.uploadFile,type:"POST",data:n,headers:{"x-auth-token":EntityEmbed.apiService.getAuthToken(),"x-object-id":e.response.object_id,"x-debug":"1"},processData:!1,contentType:!1})}}).done(function(e){t.model.url_path=e.response.url_path})},t.prototype.generateUploadedImgPreview=function(){var e=this;return e.model.object_id?'<img class="'+e.imagePreviewClass+'" src="'+l(e.options.imageLocation,e.model.url_path)+'">':'<div class="'+e.imagePreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},t.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$imageForm.hide(),e.find(i).show(),e.find(r).show(),e.find(i).append(t.generateUploadedImgPreview()))},t.prototype.parseForEditor=function(){var e=this;return'<div class="images-embed"><img class="entity-embed-secondary-toolbar-locator" src="'+l(e.options.imageLocation,e.model.url_path)+'" /><div class="images-embed-caption">'+e.model.caption+'</div><div class="images-embed-credit">Credit: '+e.model.credit+"</div></div>";
}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="instagram",n={viewPath:e+"modal/modal_instagram.html",displayName:"Instagram",object_type:"instagram",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=8,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++){var i=o[n].name,a=o[n].value;i&&a&&(t.model[i]=a)}var r="embedCode",l='<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="6" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: auto; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px); "><a href="'+t.model.url+'" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank"></a></blockquote><script async defer src="//platform.instagram.com/en_US/embeds.js"></script>';t.model[r]=l},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed"><div class="instagram-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="instagram-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="newsletterSubscribe",n={viewPath:e+"modal/modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",object_type:"newsletter",validationOptions:{rules:{title:"required",newsletter:"required"}},httpPaths:{getNewsletters:"https://test-services.pri.org/admin/newsletter/list"}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=12,t.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletterId:null,teaser:null}},t.prototype.initModal=function(e){var t=this,o="<option disabled selected>-- select a newsletter --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getNewsletters}).done(function(t){if(t.response.data){var n=[];n.push(o);for(var i=0;i<t.response.data.length;i++)n.push('<option value="'+t.response.data[i].newsletter_id+'" >'+t.response.data[i].title+"</option>");e.find('[name="newsletter"]').html(n)}}).fail(function(){console.log("failed to load newsletter subscription options")})},t.prototype.parseForEditor=function(){var e=this;return'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="subscribe-form"><div class="teaser">'+e.model.teaser+'</div><div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}if(!EntityEmbed.embedTypes)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var o="relatedLink",n={viewPath:e+"modal/modal_relatedLink.html",displayName:"Related Link",object_type:"related-link",validationOptions:{rules:{title:"required"}},httpPaths:{getRelatedStories:"https://test-services.pri.org/admin/content/list"}},i=[],a=[],r=[],l=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=10,t.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[]}},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t);var o=e.find("#related-link-list");o.children().remove()},t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;2>n;n++){var i=o[n].name,r=o[n].value;i&&r&&(t.model[i]=r)}for(var n=0;n<a.length;n++)t.model.links.push(a[n])},t.prototype.populateFormWithModel=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++)if(o[n].type&&-1!==o[n].type.indexOf("select")){var i=$(o[n]).find("option"),a=t.model[o[n].name],l=0;i.each(function(e){this.value===a&&(l=e)}),o[n].selectedIndex=l}else t.model[o[n].name]&&(o[n].value=t.model[o[n].name]);for(var s="embed-modal-form-control",d=(e.find("#related-link-list"),e.find("#add-link-btn")),n=0;n<t.model.links.length;n++)d.click(),e.find("."+s).last().val(t.model.links[n].value),r[n]=!0};var s=function(e,t,o){var n=/^[^.]*staging[^.]*\.|\.dev$/,i=n.test(window.location.host),l=0,s=t-1;void 0===r[s]?r.push(!1):r[s]=!1,i&&(l=1);var d={url:function(e){return o.options.httpPaths.getRelatedStories},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},ajaxSettings:{dataType:"json",method:"POST",data:{auth_token:"abc123",debug:l}},preparePostData:function(t){return t.title=$(e).val(),JSON.stringify(t)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(t){r[s]=!0;var o=$(e).getSelectedItemData().object_id,n=$(e).getSelectedItemData().title;void 0===a[s]?a.push({key:o,value:n}):(a[s].key=o,a[s].value=n)},onHideListEvent:function(){r[s]!==!1||$(e).is(":focus")||$(e).val(""),$(e).focusout(function(){a[s]&&a[s].value!=$(e).val()&&$(e).val(a[s].value)})}},requestDelay:600},c="#btn-save-modal";$(e).easyAutocomplete(d),$(e).focus(function(){$(c).prop("disabled",!0)}),$(e).focusout(function(){$(c).prop("disabled",!1)})};t.prototype.initModal=function(e){var t=this,o="related-link-url",n="remove-link-btn",a=e.find("#related-link-list"),r=e.find("#add-link-btn"),d=0;r.click(function(){var e=l();i.push(e),d++,a.append('<div class="'+o+'"><div class="embed-modal-form"><input id="'+e+'" type="text" placeholder="Begin typing story title" class="embed-modal-form-control" required/></div><button class="'+n+'"><i class="fa fa-minus"></i></button></div>'),s("#"+e,d,t)}),e.on("click","."+n,function(){$(document.activeElement).closest("."+o).remove()})},t.prototype.parseForEditor=function(){var e=this;return'<div class="relatedLink-embed"><p class="relatedLink-embed-uiText"> <strong>Embed Type:</strong> Related Link </p><p  class="relatedLink-embed-uiText"> <strong>Title:</strong> '+e.model.title+"</p></div>"}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,n,t)}var o,n="slideshow",i={viewPath:e+"modal/modal_slideshow.html",displayName:"Slideshow",object_type:"slideshow",validationOptions:{rules:{slideshowTitle:"required",title:"required",altText:"required",license:"required"}}},a=function(){for(var e="",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e},r="#embed-modal-slideshow-image",l=".embed-modal-slideshow-image-list",s={},d=null,c="slideshow-radio-label-text",u="#radio-option-placeholder",m=function(e,t){$(u).is(":visible")&&$(u).hide();var o=t||a(),n='<label class="slideshow-radio"><input type="radio" id="'+o+'" name="radioOption"><span class="'+c+'">'+e+'</span><label class="slideshow-image-error"></label></label>';return $(l).append(n),o},p=function(){o.getModelFromForm($(r)),s[d]=o.model},f=function(e){$("#"+e);if(d&&""!==d){if(d===e)return;p(),o.clearForm($(r)),o.model=s[e],o.populateFormWithModel($(r))}else $(r).show();d=e};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[n]=t,t.prototype.orderIndex=2,t.prototype.cleanModel=function(){return{title:null,displayTitle:null,images:[]}},t.prototype.initModal=function(e){var t=this;t.model=t.cleanModel();for(var n in EntityEmbed.embedTypes)if("imagesEmbed"===EntityEmbed.embedTypes[n].name){o=new EntityEmbed.embedTypes[n],o.initModal($(r)),$(r).hide();break}return o?($.validator.addMethod("slideshowImage",function(e,t,o){var n=t.id,i=!0;return(n||s[n])&&(i=!(!s[n].title||!s[n].license||!s[n].altText||!s[n].upload&&!s[n].url_path)),this.optional(t)||i},"missing required fields"),o.loadLicenses(e),$(".slideshow-image-add").on("click",function(){var e=1;for(var t in s)e+=1;var n=m("image "+e);s[n]=o.cleanModel()}),$(l).on("click",function(e){var t=$(l+" :checked");0!=t.length&&f(t.attr("id"))}),void $(r).find('input[name="title"]').on("blur",function(){var e=$(this).val();if(""!==e){var t=$("#"+d).parent();t.find("."+c).text(e)}})):void console.log("could not find image embed for use in slideshow embed")},t.prototype.saveEmbed=function(e){var t=this,n=[];t.model.slideshowTitle&&delete t.model.slideshowTitle;for(var i=0;i<t.model.images.length;i++){o.model=t.model.images[i];var a=!o.model.object_id,r=o.saveEmbed(a);r.done(function(e){return function(o){return"ERROR"==o.status?void console.log("failed to put/post a slideshow image"):void(t.model.images[e]={object_id:o.response.object_id,order:e})}}(i)).fail(function(e){return function(){console.log("failed to save a slideshow image number "+e)}}(i)),n.push(r)}return $.when.apply($,n).then(function(){return t.parent.saveEmbed(e,t)})},t.prototype.validate=function(e,t){var n=this;return o.validate($(r),t),n.parent.validate(e.find("form").first(),t,n)},t.prototype.getModelFromForm=function(e){var t=this;p(),t.model.title=e.find("input[name=slideshowTitle]").val(),t.model.displayTitle=e.find("input[name=displayTitle]").val(),t.model.images=[];for(var o in s)t.model.images.push(s[o])},t.prototype.populateFormWithModel=function(e){var t=this,n=[];t.model.slideshowTitle=t.model.title,t.parent.populateFormWithModel(e.find("form").first(),t),$(l).hide(),$(u).hide(),t.model.images.sort(function(e,t){return e.order-t.order});for(var i=0;i<t.model.images.length;i++)m("image "+(i+1),t.model.images[i].object_id),0===i&&$("#"+t.model.images[i].object_id).attr("checked","");for(var i=0;i<t.model.images.length;i++){var a=EntityEmbed.apiService.get({path:o.options.httpPaths.get,data:{object_id:t.model.images[i].object_id,auth_token:EntityEmbed.apiService.getAuthToken}});a.done(function(e){return function(t){if("ERROR"===t.status||"string"==typeof t.response)return void console.log("could not load slideshow image number "+e);s[t.response.object_id]=t.response;var n=$("#"+t.response.object_id).parent();n.find("."+c).text(t.response.title),0==e&&(o.model=t.response)}}(t.model.images[i].order)).fail(function(e){return function(){console.log("could not load slideshow image number "+e)}}(t.model.images[i].order)),n.push(a)}$.when.apply($,n).done(function(){$(l).show(),$(r).show(),o.populateFormWithModel($(r))})},t.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),o&&o.clearForm($(r)),s={},d="",e.find(".slideshow-radio").remove(),$(r).hide(),$(u).show()}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="twitter",n={viewPath:e+"modal/modal_twitter.html",displayName:"Twitter",object_type:"twitter",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=6,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),n=0;n<o.length;n++){var i=o[n].name,a=o[n].value;i&&a&&(t.model[i]=a)}var r="embedCode",l='<blockquote class="twitter-tweet" data-lang="en" style="width:50%; margin:auto;"><a href="'+t.model.url+'"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>';t.model[r]=l},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed"><div class="twitter-info"><span>click here to show the toolbars</span></div><div class="overlay">'+e.model.embedCode+'</div><div class="twitter-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,n,o,t)}var o="video",n={viewPath:e+"modal/modal_video.html",displayName:"Video",object_type:"video",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=4,t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return $.support.cors=!0,$.ajax({crossDomain:!0,cache:!1,async:!1,timeout:15e3,url:"http://medium.iframe.ly/api/oembed?iframe=1",dataType:"json",data:{url:e.model.url},success:function(t){e.model.videoHtmlString=$(t.html).find("iframe").attr("style","").prop("outerHTML")},error:function(e,t,o){}}),'<div class="video-embed"><div class="video-info"><span>click here to show the toolbars</span></div><div class="overlay"></div>'+e.model.videoHtmlString+'<div class="video-info"><span>click here to show the toolbars</span></div></div>'}}("");var EntityEmbed=EntityEmbed||{};!function(){$.embed_modal_create=function(e){var t={modalOptions:{},modalScope:{$embedTypeSelect:null,$modalBody:null},$modalEl:null,embedTypes:{image:{},slideshow:{},video:{},audio:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},globalBuzz:{},newsletterSubscribe:{},iframe:{},customText:{}}};defaultModalSelectors=function(){t.$modalEl||(t.$modalEl=$("#embed-modal")),t.modalScope.$embedTypeSelect||(t.modalScope.$embedTypeSelect=$("#select-embed-type")),t.modalScope.$modalBody||(t.modalScope.$modalBody=$(".embed-modal-body")),t.modalOptions.$abortEl||(t.modalOptions.$abortEl=$("#btn-abort-modal"))},defaultModalSelectors(),e=$.extend(!0,{},t,e);var o=[];for(var n in EntityEmbed.embedTypes)if(e.embedTypes[n]){var i=new EntityEmbed.embedTypes[n](e.embedTypes[n]);o.push(i)}o.sort(function(e,t){return e.orderIndex-t.orderIndex});var a={},r=new EntityEmbed.embedModalDefaults;a=e.modalOptions?$.extend(!0,{},r,e.modalOptions):r;var l={embedTypes:o};return l=$.extend(!0,{},e.modalScope,l),e.$modalEl.modal(a,l),EntityEmbed.$embedModal=e.$modalEl,EntityEmbed.currentEmbedTypes=o,EntityEmbed.$embedModal},$.embed_modal_open=function(e){var t={$currentEditorLocation:$(""),embedTypeStr:null,id:null};EntityEmbed.$embedModal||$.embed_modal_create({modalOptions:e}),e=$.extend(!0,{},t,e);var o;o=e.id?EntityEmbed.embedModalTypes.edit:e.embedTypeStr?EntityEmbed.embedModalTypes.addSingle:EntityEmbed.embedModalTypes.add;var n={$currentEditorLocation:e.$currentEditorLocation,modalType:o,embedId:e.id,embedType:e.embedTypeStr};return EntityEmbed.$embedModal.openModal(n)}}();var EntityEmbed=EntityEmbed||{};!function(e,t,o,n){"use strict";function i(e){var t,o,n="[[",i="]]";return o=[s,e.index,e.id].join(":"),t=[n,o,i].join("")}function a(t){var o=e.grep(EntityEmbed.currentEmbedTypes,function(e){return e.options.object_type==t})[0];return o&&e.extend(!0,{},o)}function r(o,n){var i=this;i.el=o,i.$el=e(o),i.templates=t.MediumInsert.Templates,i.core=i.$el.data("plugin_"+l),i.options=e.extend(!0,{},m,n),i._defaults=m,i._name=l,i.toolbarManager=new EntityEmbed.toolbarManager(i,i.options.styles,i.options.actions,d),i.core.getEditor()&&(i.core.getEditor().get_content=function(){return i.getContent()},i.core.getEditor().load_content=function(e){i.loadContent(e)}),i.init()}var l="mediumInsert",s="EntityEmbeds",d="entity-embed-active",c=".medium-insert-active",d="entity-embed-active",u="entity-embed-container",m={label:'<span class="fa fa-code"></span>',styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}},newline:{label:'<span class="fa fa-i-cursor"></span>',clicked:function(e,t){e.addNewline(t)}}}};r.prototype.init=function(){var t=this;t.toolbarManager.createActionToolbar(e("body")),t.events(),EntityEmbed.$embedModal||e.embed_modal_create();for(var o in EntityEmbed.currentEmbedTypes)t.toolbarManager.createStyleToolbar(e("body"),EntityEmbed.currentEmbedTypes[o])},r.prototype.events=function(){var t=this;e(o).on("click",function(o){e(o.target).is(".medium-editor-action")||e(o.target.parentElement).is(".medium-editor-action")||0==t.$el.find("."+d).length||(e("."+d).removeClass(d),t.toolbarManager.hideToolbar())}).on("click","."+u,function(o){t.toggleSelectEmbed(e(this)),o.stopPropagation()}).on("keydown",".editable.editor",function(t){if(8==t.which||46==t.which){var o=e(".editable.editor p").length;if(1>=o){var n=e(".editable.editor p").text();n&&""!==n||t.preventDefault()}}}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=t.$el.find("."+d).length&&t.toolbarManager.hideToolbar()}).on("entityEmbedAdded","."+u,function(o){t.addEmbed(e(this),o.embedType)})},r.prototype.getCore=function(){return this.core},r.prototype.getContent=function(){var t=this,o=t.core.getEditor().serialize(),n={html:"",embeds:[]};return e.each(o,function(t){var a,r;a=e("<div />").html(o[t].value),r=a.find(".entity-embed-container",a),r.each(function(t){var o,a,r,l;o=e(this),a=o.find("figure"),a?(r={index:t,id:a.attr("id"),type:a.attr("data-embed-type")},n.embeds.push(r),l=i(r),o.html(l)):o.remove()}),n.html+=a.html()}),n},r.prototype.loadContent=function(t){function o(t){var o;if(!t)return void n();if(r=t.html||"",!t.embeds)return void n();s=[],o=[];for(var c=0;c<t.embeds.length;c++)if(l=a(t.embeds[c].type)){l.model=l.cleanModel(),t.embeds[c].embedType=l;var u=EntityEmbed.apiService.get({path:t.embeds[c].embedType.options.httpPaths.get,data:{object_id:t.embeds[c].id}});u.done(function(e){return function(t){var o,n;return"ERROR"===t.status?(console.log("failed to get embed object!"),t):(e.embedType.model=t.response,s.push(e),n=i(e),o=EntityEmbed.embedModalDefaults.prototype.generateEmbedHtml(e.embedType,!1),void(r=r.split(n).join(o)))}}(t.embeds[c])),o.push(u)}e.when.apply(e,o).done(function(){var e,t,o,i={};n();for(var a=0;a<s.length;a++)e=s[a],i[e.id]||(i[e.id]=!0,t=d.$el.find('[id="'+e.id+'"]'),o=t.html(),console.log("Reattached Embed",e.id,o,e),t.html(o))})}function n(){d.core.getEditor().setContent(r)}var r,l,s,d=this,c="string"==typeof t,u=c&&/<[^>]>/g.test(t);return t?(r=c?u?t:"":t.html,void(c&&!u?EntityEmbed.apiService.get({path:"https://test-services.pri.org/admin/embed/edit",data:{object_id:t}}).done(function(e){return"ERROR"===e.status?void console.log("Failed to get story with id "+t):void o(e.repsonse)}).fail(function(e){console.log("Failed to get story with id "+t)}):o(t))):void console.log("Must provide either story id or serialived story data.")},r.prototype.add=function(){var t={$currentEditorLocation:e(c)};e.embed_modal_open(t)},r.prototype.editEmbed=function(t){var o=this,n={$currentEditorLocation:e("."+d),id:t.find("figure").attr("id"),embedTypeStr:t.find("[data-embed-type]").attr("data-embed-type")};o.toolbarManager.hideToolbar(),e.embed_modal_open(n)},r.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove(),t.core.triggerInput()},r.prototype.addNewline=function(e){var t=this,o='<p class="entity-embed-new-line">&nbsp</p>';e.before(o),e.after(o),t.toolbarManager.positionToolbars(e)},r.prototype.toggleSelectEmbed=function(t){var o=this,n=e("."+d),i=t.find("[data-embed-type]").attr("data-embed-type"),r=a(i);o.toolbarManager.hideToolbar(),n.toggleClass(d),t.toggleClass(d),o.options.actions&&(t.hasClass(d)?o.toolbarManager.showToolbars(t,r.name):o.toolbarManager.hideToolbar())},r.prototype.addEmbed=function(e,t){var o=this,n=t.defaultStyle.replace("entity-embed-","");o.toolbarManager.addStyle(e,t.defaultStyle,n,!1),o.core.triggerInput()},e.fn[l+s]=function(t){return this.each(function(){e.data(this,"plugin_"+l+s)||e.data(this,"plugin_"+l+s,new r(this,t))})}}(jQuery,window,document);var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),o>t?-1:t>o?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),t===o}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,n=e.categories.length;n>o;o+=1){var i=e.categories[o];for(var a in l.categories[0])void 0===i[a]&&(i[a]=l.categories[0][a]);t.push(i)}e.categories=t}}function o(){function t(e,o){var n=e||{};for(var i in e)void 0!==o[i]&&null!==o[i]&&("object"!=typeof o[i]||o[i]instanceof Array?n[i]=o[i]:t(e[i],o[i]));return void 0!==o.data&&null!==o.data&&"object"==typeof o.data&&(n.data=o.data),n}l=t(l,e)}function n(){if("list-required"!==l.url&&"function"!=typeof l.url){var t=l.url;l.url=function(){return t}}if(void 0!==l.ajaxSettings.url&&"function"!=typeof l.ajaxSettings.url){var t=l.ajaxSettings.url;l.ajaxSettings.url=function(){return t}}if("string"==typeof l.listLocation){var o=l.listLocation;l.listLocation="XML"===l.dataType.toUpperCase()?function(e){return $(e).find(o)}:function(e){return e[o]}}if("string"==typeof l.getValue){var n=l.getValue;l.getValue=function(e){return e[n]}}void 0!==e.categories&&(l.categoriesAssigned=!0)}function i(){l.ajaxSettings=void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?e.ajaxSettings:{}}function a(e){return void 0!==l[e]&&null!==l[e]}function r(e,t){function o(t,i){for(var a in i)void 0===t[a]&&e.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"!=typeof t[a]||n(a)||o(t[a],i[a])}function n(e){var t=["ajaxSettings","template"];return Array.prototype.contains=function(e){for(var t=this.length;t--;)if(this[t]===e)return!0;return!1},t.contains(e)}o(l,t)}var l={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=l.getValue(e),t=l.getValue(t),t>e?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e=l.getValue(e),t=l.getValue(t),e===t}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]};this.get=function(e){return l[e]},this.equals=function(e,t){return!(!a(e)||l[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==l.url||"list-required"!==l.data},this.checkRequiredProperties=function(){for(var e in l)if("required"===l[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){r(e,t)},t(),o(),l.loggerEnabled===!0&&r(console,e),i(),n()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function o(t,o){function n(){var n,i={};return void 0!==t.xmlElementName&&(i.xmlElementName=t.xmlElementName),void 0!==t.listLocation?n=t.listLocation:void 0!==e.get("listLocation")&&(n=e.get("listLocation")),void 0!==n?"string"==typeof n?i.data=$(o).find(n):"function"==typeof n&&(i.data=n(o)):i.data=o,i}function i(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=o[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(o)):e.data=o,e}var a={};if(a="XML"===e.get("dataType").toUpperCase()?n():i(),void 0!==t.header&&(a.header=t.header),void 0!==t.maxNumberOfElements&&(a.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(a.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var r=t.getValue;a.getValue=function(e){return e[r]}}else"function"==typeof t.getValue&&(a.getValue=t.getValue);else a.getValue=e.get("getValue");return a}function n(t){var o=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){o.push(this)}),o}this.init=function(t){var o=[],n={};return n.data=e.get("listLocation")(t),n.getValue=e.get("getValue"),n.maxListSize=e.get("list").maxNumberOfElements,o.push(n),o},this.updateCategories=function(t,n){if(e.get("categoriesAssigned")){t=[];for(var i=0;i<e.get("categories").length;i+=1){var a=o(e.get("categories")[i],n);t.push(a)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var o=0;o<t.length;o+=1)t[o].data=n(t[o]);return t},this.processData=function(o,n){for(var i=0,a=o.length;a>i;i+=1)o[i].data=t(e,o[i],n);return o},this.checkIfDataExists=function(e){for(var t=0,o=e.length;o>t;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(e,t,o){function n(t,o){var n=[],i="";if(e.get("list").match.enabled)for(var a=0,r=t.length;r>a;a+=1)i=e.get("getValue")(t[a]),e.get("list").match.caseSensitive||("string"==typeof i&&(i=i.toLowerCase()),o=o.toLowerCase()),i.search(o)>-1&&n.push(t[a]);else n=t;return n}function i(e){return void 0!==t.maxNumberOfElements&&e.length>t.maxNumberOfElements&&(e=e.slice(0,t.maxNumberOfElements)),e}function a(t){return e.get("list").sort.enabled&&t.sort(e.get("list").sort.method),t}var r=t.data,l=o;return r=n(r,l),r=i(r),r=a(r)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},o=function(e){var o,n=e.fields;return"description"===e.type?(o=t.description.method,"string"==typeof n.description?o=function(e,t){return e+" - <span>"+t[n.description]+"</span>"}:"function"==typeof n.description&&(o=function(e,t){return e+" - <span>"+n.description(t)+"</span>"}),o):"iconRight"===e.type?("string"==typeof n.iconSrc?o=function(e,t){return e+"<img class='eac-icon' src='"+t[n.iconSrc]+"' />"}:"function"==typeof n.iconSrc&&(o=function(e,t){return e+"<img class='eac-icon' src='"+n.iconSrc(t)+"' />"}),o):"iconLeft"===e.type?("string"==typeof n.iconSrc?o=function(e,t){return"<img class='eac-icon' src='"+t[n.iconSrc]+"' />"+e}:"function"==typeof n.iconSrc&&(o=function(e,t){return"<img class='eac-icon' src='"+n.iconSrc(t)+"' />"+e}),o):"links"===e.type?("string"==typeof n.link?o=function(e,t){return"<a href='"+t[n.link]+"' >"+e+"</a>"}:"function"==typeof n.link&&(o=function(e,t){return"<a href='"+n.link(t)+"' >"+e+"</a>"}),o):"custom"===e.type?e.method:t.basic.method},n=function(e){return e&&e.type&&e.type&&t[e.type]?o(e):t.basic.method},i=function(e){var o=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var o=t[e.type].cssClass;return function(){return o}}():o};this.getTemplateClass=i(e),this.build=n(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,o){function n(){return 0===g.length?void b.error("Input field doesn't exist."):f.checkDataUrlProperties()?f.checkRequiredProperties()?(i(),void r()):void b.error("Will not work without mentioned properties."):void b.error("One of options variables 'data' or 'url' must be defined.")}function i(){function e(){var e=$("<div>"),o=p.getValue("WRAPPER_CSS_CLASS");f.get("theme")&&""!==f.get("theme")&&(o+=" eac-"+f.get("theme")),f.get("cssClasses")&&""!==f.get("cssClasses")&&(o+=" "+f.get("cssClasses")),""!==h.getTemplateClass()&&(o+=" "+h.getTemplateClass()),e.addClass(o),g.wrap(e),f.get("adjustWidth")===!0&&t()}function t(){var e=g.outerWidth();g.parent().css("width",e)}function o(){g.unwrap()}function n(){var e=$("<div>").addClass(p.getValue("CONTAINER_CLASS"));e.attr("id",a()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(f.get("list").showAnimation.type){case"slide":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").slideDown(t,o);break;case"fade":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").fadeIn(t),o;break;default:e.find("ul").show()}f.get("list").onShowListEvent()}).on("hide.eac",function(){switch(f.get("list").hideAnimation.type){case"slide":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").slideUp(t,o);break;case"fade":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,o);break;default:e.find("ul").hide()}f.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(w).addClass("selected"),f.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,o,n){var i="",a=e.find("ul");a.empty().detach(),T=[];for(var l=0,s=0,c=o.length;c>s;s+=1){var u=o[s].data;if(0!==u.length){void 0!==o[s].header&&o[s].header.length>0&&a.append("<div class='eac-category' >"+o[s].header+"</div>");for(var m=0,p=u.length;p>m&&l<o[s].maxListSize;m+=1)i=$("<li><div class='eac-item'></div></li>"),function(){var e=m,t=l,a=o[s].getValue(u[e]);i.find(" > div").on("click",function(){g.val(a).trigger("change"),w=t,d(t),f.get("list").onClickEvent(),f.get("list").onChooseEvent()}).mouseover(function(){w=t,d(t),f.get("list").onMouseOverEvent()}).mouseout(function(){f.get("list").onMouseOutEvent()}).html(h.build(r(a,n),u[e]))}(),a.append(i),T.push(u[m]),l+=1}}e.append(a),f.get("list").onLoadEvent()})}(),g.after(e)}function i(){g.next("."+p.getValue("CONTAINER_CLASS")).remove()}function r(e,t){return f.get("highlightPhrase")&&""!==t?s(e,t):e}function l(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function s(e,t){var o=l(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}g.parent().hasClass(p.getValue("WRAPPER_CSS_CLASS"))&&(i(),o()),e(),n(),E=$("#"+a()),f.get("placeholder")&&g.attr("placeholder",f.get("placeholder"))}function a(){var e=g.attr("id");return e=p.getValue("CONTAINER_ID")+e}function r(){function e(){y("autocompleteOff",!0)&&r(),t(),o(),n(),i(),a()}function t(){g.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=f.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];
return e}function o(e,t){return f.get("matchResponseProperty")!==!1?"string"==typeof f.get("matchResponseProperty")?t[f.get("matchResponseProperty")]===e:"function"==typeof f.get("matchResponseProperty")?f.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<f.get("minCharNumber"))){if("list-required"!==f.get("data")){var n=f.get("data"),i=v.init(n);i=v.updateCategories(i,n),i=v.processData(i,e),c(i,e),g.parent().find("li").length>0?l():s()}var a=t();(void 0===a.url||""===a.url)&&(a.url=f.get("url")),(void 0===a.dataType||""===a.dataType)&&(a.dataType=f.get("dataType")),void 0!==a.url&&"list-required"!==a.url&&(a.url=a.url(e),a.data=f.get("preparePostData")(a.data,e),$.ajax(a).done(function(t){var n=v.init(t);n=v.updateCategories(n,t),n=v.convertXml(n),o(e,t)&&(n=v.processData(n,e),c(n,e)),v.checkIfDataExists(n)&&g.parent().find("li").length>0?l():s(),f.get("ajaxCallback")()}).fail(function(){b.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:s(),u();break;case 38:e.preventDefault(),T.length>0&&w>0&&(w-=1,g.val(f.get("getValue")(T[w])),d(w));break;case 40:e.preventDefault(),T.length>0&&w<T.length-1&&(w+=1,g.val(f.get("getValue")(T[w])),d(w));break;default:if(e.keyCode>40||8===e.keyCode){var o=g.val();f.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?f.get("requestDelay")>0?(void 0!==m&&clearTimeout(m),m=setTimeout(function(){t(o)},f.get("requestDelay"))):t(o):s()}}})}function o(){g.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&w>-1&&(g.val(f.get("getValue")(T[w])),f.get("list").onKeyEnterEvent(),f.get("list").onChooseEvent(),w=-1,s(),e.preventDefault())})}function n(){g.off("keypress")}function i(){g.focus(function(){""!==g.val()&&T.length>0&&(w=-1,l())})}function a(){g.blur(function(){setTimeout(function(){w=-1,s()},250)})}function r(){g.attr("autocomplete","off")}e()}function l(){E.trigger("show.eac")}function s(){E.trigger("hide.eac")}function d(e){E.trigger("selectElement.eac",e)}function c(e,t){E.trigger("loadElements.eac",[e,t])}function u(){g.trigger("blur")}var m,p=new e.Constans,f=new e.Configuration(o),b=new e.Logger,h=new e.Template(o.template),v=new e.ListBuilderService(f,e.proccess),y=f.equals,g=t,E="",T=[],w=-1;e.consts=p,this.getConstants=function(){return p},this.getConfiguration=function(){return f},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return w},this.getItemData=function(e){return T.length<e||void 0===T[e]?-1:T[e]},this.getSelectedItemData=function(){return this.getItemData(w)},this.build=function(){i()},this.init=function(){n()}},e.easyAutocompleteHandles=[],e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e}(EasyAutocomplete||{});$.fn.easyAutocomplete=function(e){return this.each(function(){var t=$(this),o=new EasyAutocomplete.main(t,e);EasyAutocomplete.inputHasId(t)||EasyAutocomplete.assignRandomId(t),o.init(),EasyAutocomplete.easyAutocompleteHandles[t.attr("id")]=o})},$.fn.getSelectedItemIndex=function(){var e=$(this).attr("id");return void 0!==e?EasyAutocomplete.easyAutocompleteHandles[e].getSelectedItemIndex():-1},$.fn.getItemData=function(e){var t=$(this).attr("id");return void 0!==t&&e>-1?EasyAutocomplete.easyAutocompleteHandles[t].getItemData(e):-1},$.fn.getSelectedItemData=function(){var e=$(this).attr("id");return void 0!==e?EasyAutocomplete.easyAutocompleteHandles[e].getSelectedItemData():-1};