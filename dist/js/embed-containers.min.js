!function(){EntityEmbed=EntityEmbed||{};var e={};e.modal="null",e["modal/modal_audio.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">MP3 File</label><input class="embed-modal-input embed-modal-file-input" type="file" name="upload"> <span class="fa fa-times cancel-upload-file-btn"></span> <span class="fa fa-cog edit-chosen-file-btn"></span> <span class="uploaded-audio-file"></span></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div id="audio-credits" class="embed-modal-form"><div class="embed-modal-half-column"><label for="credit" class="embed-modal-label">Credit</label><input id="credit" class="embed-modal-form-control embed-modal-input" type="text" name="credit"></div><div class="embed-modal-half-column"><label for="creditLink" class="embed-modal-label">Credit Link</label><input id="creditLink" class="embed-modal-form-control embed-modal-input" type="url" name="creditLink"></div></div></div></form>',e["modal/modal_confirmation.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header"><h3>Are you sure you want to leave?</h3></div><div class="embed-modal-body"><h4>All your changes will be lost if you leave this window!</h4></div><div class="embed-modal-footer"><button id="btn-confirm-leave">Yes - Leave</button> <button id="btn-cancel-leave">No - Stay</button></div></div></div>',e["modal/modal_customText.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control embed-modal-input"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="control-label" for="customText">Text</label><div name="customText" type="text" placeholder="Type your text. Highlight words to trigger the styles editor" class="embed-modal-form-control" id="custom-text-editor"></div></div></div></div></form>',e["modal/modal_externalLink.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">Image Thumbnail File</label><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"> <span class="fa fa-times cancel-upload-image-btn"></span> <span class="fa fa-cog edit-chosen-file-btn"></span><div class="uploaded-image-file"></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="linkText">External Link Text</label><input name="linkText" type="text" placeholder="Enter link text" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">External Link Url</label><input name="url" type="url" placeholder="Enter URL" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="3" class="embed-modal-form-control"></textarea></div></div></div></form>',e["modal/modal_facebook.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form has-error"><label class="embed-modal-label" for="url">Facebook Status</label><input name="url" type="url" placeholder="Enter URL to status" class="embed-modal-form-control"></div></div></div></form>',e["modal/modal_globalBuzz.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="quote">Quote</label><textarea name="quote" type="text" placeholder="Enter quote" rows="5" class="embed-modal-form-control"></textarea></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label clas="embed-modal-label" for="quoteText">Quote Url Text</label><input name="quoteUrlText" type="text" placeholder="Enter URL label" class="embed-modal-form-control"></div><div class="embed-modal-form"><label clas="embed-modal-label" for="quoteUrl">Quote Url</label><input name="quoteUrl" type="url" placeholder="Enter URL" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="credit">Credit</label><input name="credit" type="text" placeholder="Attribute the source" class="embed-modal-form-control"></div></div></div></form>',e["modal/modal_iframe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Source</label><input name="url" type="url" placeholder="Enter URL or iframe source code" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Height</label><div class="embed-modal-input-group"><input name="height" type="number" placeholder="" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Width</label><div class="embed-modal-input-group"><input name="width" type="number" placeholder="Full Width" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="allowsScroll">Scroll</label><select name="allowsScroll" class="embed-modal-form-control"><option>No</option><option>Yes</option></select></div></div></div></form>',e["modal/modal_image.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><label class="embed-modal-label" for="upload">Image File</label><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"> <span class="fa fa-times cancel-upload-image-btn"></span> <span class="fa fa-cog edit-chosen-file-btn"></span><div class="uploaded-image-file"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="title" class="embed-modal-label">Title</label><input class="embed-modal-input embed-modal-form-control" type="text" name="title"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="altText" class="embed-modal-label">Alt Text</label><input class="embed-modal-input embed-modal-form-control" type="text" name="altText"></div></div></div><div class="embed-modal-row"><div class="embed-modal-form"><div class="embed-modal-half-column"><label for="credit" class="embed-modal-label">Credit</label><input class="embed-modal-input embed-modal-form-control" type="text" name="credit"></div><div class="embed-modal-half-column"><label for="creditLink" class="embed-modal-label">Credit Link</label><input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="caption" class="embed-modal-label">Caption</label><input class="embed-modal-input embed-modal-form-control" type="text" name="caption"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="license" class="embed-modal-label">License</label><select class="embed-modal-form-control" type="text" name="license"></select></div></div></div></form>',e["modal/modal_instagram.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Insert Instagram URL</label><input name="url" type="url" placeholder="Enter URL to instagram post" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',e["modal/modal_main.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header"><button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="embed-modal-half-column"><h3 class="header-title"></h3></div><div class="embed-modal-half-column"><select class="embed-modal-form-control" id="select-embed-type"></select></div></div><div class="embed-modal-body"><div id="embed-modal-create-new"></div><div id="embed-modal-select-existing"></div></div><div class="embed-modal-footer"><div id="embed-modal-buttons-create"><button id="btn-show-select-existing">Select Existing Embed</button><!-- TODO : add publishing state dropdown --><!-- TODO : publishing state dropdown affects Save button text --> <i class="fa fa-spinner fa-spin" id="embed-modal-spinner"></i> <button id="btn-save-modal">Save</button> <button id="btn-abort-modal">Close</button></div><div id="embed-modal-buttons-select"><button id="btn-cancel-select-existing">Cancel</button></div></div><!-- the leave confirmation modal will be loaded here --><div class="embed-modal" id="leave-confirmation-modal"><div></div></div></div></div>',e["modal/modal_newsletterSubscribe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="3" class="embed-modal-form-control"></textarea></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="newsletter">Select Newsletter</label><select name="newsletter" class="embed-modal-form-control"></select></div></div></div></form>',e["modal/modal_relatedLink.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title to display" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><label class="embed-modal-label">Links</label><div class="progress"><div id="related-links-progress" class="progress-bar progress-bar-info"></div></div><ul id="related-link-list"></ul></div></div><hr><div class="embed-modal-row"><div class="related-link-add"><input name="linkInput" type="text" id="add-link-eac" placeholder="Begin typing a title. Select one to add link." class="embed-modal-form-control"></div></div></form>',e["modal/modal_slideshow.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="slideshowTitle" class="embed-modal-label">Slideshow Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title for internal use" type="text" name="slideshowTitle"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="displayTitle" class="embed-modal-label">Display Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title to display" type="text" name="displayTitle"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column image-list-container"><label>Image List</label><div class="slideshow-image-add"><i class="fa fa-plus"></i></div><div class="slideshow-image-select-existing"><i class="fa fa-search-plus"></i></div><div class="embed-modal-slideshow-image-list"><p class="radio-option-placeholder">click <i class="fa fa-plus"></i> to add an image</p><p class="radio-option-placeholder">click <i class="fa fa-search-plus"></i> to select an existing image</p></div></div></div></form><hr><div class="embed-modal-row" id="embed-modal-slideshow-image-select-existing"><div class="simg-query-container"><label class="embed-modal-label" for="simg-query">Search for Image(s)</label><input type="text" class="embed-modal-form-control" name="simg-query" placeholder="begin typing image title "></div><div id="slideshow-image-select-btns"><button id="btn-cancel-select-existing-simg">Cancel</button></div></div><div id="embed-modal-slideshow-image"><form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"> <span class="fa fa-times cancel-upload-image-btn"></span><div class="uploaded-image-file"><div><label>Chosen Image</label><span class="fa fa-cog edit-chosen-file-btn"></span></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="title" class="embed-modal-label">Title</label><input class="embed-modal-input embed-modal-form-control" type="text" name="title"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="altText" class="embed-modal-label">Alt Text</label><input class="embed-modal-input embed-modal-form-control" type="text" name="altText"></div></div></div><div class="embed-modal-row"><div class="embed-modal-form"><div class="embed-modal-half-column"><label for="credit" class="embed-modal-label">Credit</label><input class="embed-modal-input embed-modal-form-control" type="text" name="credit"></div><div class="embed-modal-half-column"><label for="creditLink" class="embed-modal-label">Credit Link</label><input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="caption" class="embed-modal-label">Caption</label><input class="embed-modal-input embed-modal-form-control" type="text" name="caption"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="license" class="embed-modal-label">License</label><select class="embed-modal-form-control" type="text" name="license" id="license"></select></div></div></div></form></div>',e["modal/modal_twitter.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="tweetUrl">Tweet URL</label><input name="url" type="url" placeholder="Enter URL to tweet" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',e["modal/modal_video.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Video URL</label><input name="url" type="url" placeholder="Enter URL to video" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',EntityEmbed.templateCache=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){e=$.extend(!0,{},r,e);var t={timeout:15e3,crossDomain:!0,type:e.methodType,dataType:"json",url:e.domainName+e.path};return e.headers?(e.headers["x-auth-token"]=e.auth_token,e.headers["x-debug"]=e.debug,t.headers=e.headers,t.processData=!1,t.contentType=!1,t.data=e.data):(e.data.debug=e.debug,e.data.auth_token=e.auth_token,t.data=JSON.stringify(e.data)),$.ajax(t)}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function i(t){return t.methodType="Post",e(t)}function a(e){r.auth_token=e}function n(e){return r.auth_token}function l(e){return r.domainName}function d(e){r.domainName=e,r.domainName.endsWith("/")||(r.domainName+="/")}var r={data:{},debug:0,auth_token:"",domainName:"",path:""},s=/^[^.]*staging[^.]*\.|\.dev$/,m=s.test(window.location.host);m&&(r.auth_token="abc123",r.debug=1),EntityEmbed.apiService={set:t,get:o,uploadFile:i,setAuthToken:a,getAuthToken:n,getDomainName:l,setDomainName:d}}();var EntityEmbed=EntityEmbed||{};!function(){var e={},t="entity-embed-active",o="medium-editor-button-active",i="medium-insert-images-toolbar",a="medium-insert-images-toolbar2",n="entity-embed-secondary-toolbar-locator",l="entityEmbedToolbarEventsReady",d=function(e,t){var o="";t?(o="medium-insert-images-toolbar medium-editor-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o="medium-insert-images-toolbar2 medium-editor-toolbar medium-editor-toolbar-active";var i='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var a in e){var n=e[a];n.label&&(i+='<li><button class="medium-editor-action" data-action="'+a+'">'+n.label+"</button></li>")}return i+="</ul></div>"};toolbarManager=function(e,o,i,a){var n=this;n.mediumEditorAddon=e,n.styles=o,n.actions=i,a&&(t=a),n.events()},toolbarManager.prototype.events=function(){var e=this,t=$(document);t.data(l)||t.data(l,!0).on("click","."+i+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+a+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this,o=e.find("."+a);o.length||(o=$(d(t.actions)),e.append(o)),t.$actionToolbar=o,t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(t,o){var a=this,n=$.extend(a.styles,{}),l=!0,r=t.find("."+i+"."+o.name+"StyleToolbar");if(o.options.styles){for(var s in o.options.styles)o.options.styles[s]?l=!1:delete n[s];l||(r.length||(r=$(d(n,o.name)),t.append(r)),e[o.name]=r,e[o.name].hide())}},toolbarManager.prototype.showToolbars=function(i,a){var n,l=this,d=$("."+t);l.currentToolbarEmbedType=a,l.$actionToolbar.show(),e[l.currentToolbarEmbedType]&&(e[l.currentToolbarEmbedType].find("button").each(function(){d.hasClass("entity-embed-"+$(this).data("action"))&&(n=$(this),n.addClass(o))}),e[l.currentToolbarEmbedType].show(),n&&n.addClass(o)),l.positionToolbars(i)},toolbarManager.prototype.hideToolbars=function(){$(".medium-editor-toolbar").hide()},toolbarManager.prototype.styleToolbarDo=function(e){var i=this,a=e.closest("li").closest("ul"),n=$("."+t);a.find("."+o).removeClass(o),e.addClass(o),a.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(o)?i.addStyle(n,t,e.data("action"),!0):(n.removeClass(t),i.styles[e.data("action")].removed&&i.styles[e.data("action")].removed(n))}),i.mediumEditorAddon.core.triggerInput()},toolbarManager.prototype.addStyle=function(e,o,i,a){var n=this;e.addClass(o),n.styles[i].added&&n.styles[i].added(e),a&&setTimeout(function(){n.positionToolbars($("."+t))},50)},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,i=$("."+t),a=o.actions[e.data("action")].clicked;a(o.mediumEditorAddon,i)},toolbarManager.prototype.hideToolbar=function(){var t=this;t.$actionToolbar.hide(),t.$actionToolbar.find("button").removeClass(o),t.currentToolbarEmbedType&&e[t.currentToolbarEmbedType]&&(e[t.currentToolbarEmbedType].hide(),e[t.currentToolbarEmbedType].find("button").removeClass(o),t.currentToolbarEmbedType=null)},toolbarManager.prototype.positionToolbars=function(t){var o=this,i=t.find("."+n);0===i.length&&(i=t),d=t.offset().top+2;var a=i.offset().left+i.width()+4;a>$(window).width()-o.$actionToolbar.width()&&(d-=o.$actionToolbar.height()+8,a=$(window).width()-o.$actionToolbar.width()-50),o.$actionToolbar.css({top:d,left:a});var l=e[o.currentToolbarEmbedType];if(l){var d=t.offset().top-l.height()-8-2-5;0>d&&(d=0),l.css({top:d,left:t.offset().left+t.width()/2-l.width()/2})}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,i){var a=i||this;a.name=o,t=$.extend(!0,{},a.defaultOptions,t),a.options=$.extend(!0,{},t,e),a.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{set:"admin/embed/edit",get:"admin/embed/fetch",getAll:"admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{focusCleanup:!0,errorPlacement:function(e,t){var o=t.parent();o.is(".embed-modal-input-group")?e.insertAfter(o):e.insertAfter(t)}}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e){},e.prototype.getModelFromForm=function(e,t){for(var o=t||this,i=e.find(".embed-modal-form-control, .embed-modal-file-input"),a=0;a<i.length;a++){var n=i[a].name,l=i[a].type,d=null;d="file"===l?i[a].files[0]:i[a].value,n&&(o.model[n]=d)}o.model.html_rendered=o.parseForEditor()},e.prototype.populateFormWithModel=function(e,t){for(var o=t||this,i=e.find(".embed-modal-form-control"),a=0;a<i.length;a++)if(!i[a].type||-1===i[a].type.indexOf("file"))if(i[a].type&&-1!==i[a].type.indexOf("select")){var n=$(i[a]).find("option"),l=o.model[i[a].name],d=0;n.each(function(e){this.value===l&&(d=e)}),i[a].selectedIndex=d}else o.model[i[a].name]&&(i[a].value=o.model[i[a].name])},e.prototype.clearForm=function(e,t){var o=t||this,i=e;i.is("form")||(i=e.find("form")),i.each(function(){$(this).validate(o.options.validationOptions).resetForm()});for(var a=e.find("form"),n=0;n<a.length;n++)a[n].reset();o.model=o.cleanModel()},e.prototype.parseForEditor=function(){var e=this;return'<div class="embedded-content"><div class="ui-text"> <strong>Embed Type: </strong>'+e.options.object_type+'</div><div class="ui-text"> <strong>Title: </strong> '+e.model.title+"</div></div>"},e.prototype.validate=function(e,t,o){var i=o||this,a=e;return a.is("form")||(a=e.find("form")),i.$validator=a.each(function(){$(this).validate(i.options.validationOptions)}),i.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return e&&(o.model.object_type=o.options.object_type),EntityEmbed.apiService.set({path:o.options.httpPaths.set,data:o.model})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,i){var a=this;a.$el=$(e),a.options=$.extend(!0,{},t,o),a.scope={},i&&(a.scope=i),a.scope.modalCtrl=a,a.$el.data("scope",a.scope),a.options.functions.init.before(a.scope),a.init(),a.options.functions.init.after(a.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e,t){var o=e.$el.data("scope");e.isActive=t,e.$el.toggle(e.isActive).toggleClass("in",e.isActive),e.$backdrop.toggle(e.isActive).toggleClass("in",e.isActive),o.parentModal||$("body").toggleClass("embed-modal-open",e.isActive)},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$el.click(function(t){t.target===e.$el[0]&&e.$el.abortModal()}),e.options.showCloseBtn&&(e.$closeBtn=e.$el.find(".close"),e.$closeBtn.click(function(){e.$el.abortModal()})),e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,i){var a=this;a.$el.find(e).on(t,function(e){o(e,a.$el.data("scope"),i)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t=$.data(this[0],"ctrl");if(t){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");return t.promise=$.Deferred(),t.options.functions.open.before(a),t.toggle(t,!0),t.options.functions.open.after(a),t.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");t.options.functions.abort.before(a)&&(t.toggle(t,!1),t.options.functions.abort.after(a),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");t.options.functions.complete.before(a)&&(t.toggle(t,!1),t.options.functions.complete.after(a),"pending"===t.promise.state()&&t.promise.resolve())}})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e),o.init()}var t={modalId:"leave-confirmation-modal",viewPath:"modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(){var e=this;e.$abortEl=$("#"+e.options.abortElId),e.$completeEl=$("#"+e.options.completeElId)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3,selectExistingSingle:4};var t=void 0,o=!1,i={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{saveSpinner:"#embed-modal-spinner",headerText:".header-title"}},a=function(e,t){$(".editable").attr("contenteditable",t)},n=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},l=function(e,t){if(t){e.currentEmbedType&&(e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=u(t),e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex;var o="Add ";e.modalType===EntityEmbed.embedModalTypes.edit&&(o="Edit "),o+=e.currentEmbedType.options.displayName,$(i.elements.headerText).text(o)}},d=function(e){var t=e.embedTypes[0].options.object_type;l(e,t),e.$embedTypeSelect.show()},r=function(e){for(var t=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,a=e.currentEmbedType.validate(e.currentEmbedType.$view,t),n=!0,l=0;l<a.length;l++)n=$(e.currentEmbedType.$validator[l]).valid()&&n;if(!o&&n){if(o=!0,$(i.elements.saveSpinner).show(),e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),t)var d=function(t){return"ERROR"===t.status?void console.log("POST failed"):"string"==typeof t.response?void console.log("Failed to POST embed type: "+t.response):(e.currentEmbedType.model.object_id=t.response.object_id,
console.log("POST succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("POST failed"),e.failCallback&&e.failCallback()};else var d=function(t){return"ERROR"===t.status?void console.log("PUT failed"):"string"==typeof t.response?void console.log("Failed to PUT embed type: "+t.response):(console.log("PUT succeeded"),e.modalCtrl.$el.completeModal(),void(e.successCallback&&e.successCallback(t.response)))},r=function(t){console.log("PUT failed"),e.failCallback&&e.failCallback()};var s=function(t){o=!1,$(i.elements.saveSpinner).hide(),e.alwaysCallback&&e.alwaysCallback(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)};e.currentEmbedType.saveEmbed(t).done(d).fail(r).always(s)}},s=function(e){$(i.buttons.showSelectExisting).show(),e.$embedTypeSelect.show(),$(i.containers.selectExistingEmbed).slideUp(),$(i.containers.createNewEmbed).slideDown(),$(i.containers.selectButtons).hide(),$(i.containers.createButtons).show(),$(i.containers.selectExistingEmbed).find(".query-container").hide()},m=function(e){$(i.buttons.showSelectExisting).hide(),e.$embedTypeSelect.hide(),$(i.containers.selectExistingEmbed).is(":visible")&&($(i.containers.selectExistingEmbed).slideUp(),$(i.containers.createNewEmbed).slideDown()),$(i.containers.selectButtons).hide(),$(i.containers.createButtons).show(),$(i.buttons.showSelectExisting).hide()},c=function(e,t){e.modalType=EntityEmbed.embedModalTypes.selectExisting,$(i.containers.createNewEmbed).slideUp(),$(i.containers.selectExistingEmbed).slideDown(),$(i.containers.createButtons).hide(),$(i.containers.selectButtons).show(),$(i.containers.selectExistingEmbed).find("."+e.currentEmbedType.options.object_type+"-query-container").show(),t?($(i.buttons.cancelSelectExisting).hide(),e.$embedTypeSelect.hide()):($(i.buttons.cancelSelectExisting).show(),e.$embedTypeSelect.show())},u=function(e){var o=$.grep(t,function(t){return t.options.object_type==e});return o.length>0?o[0]:null},p=function(e,t){var o='<figure contenteditable="false" id="'+e.model.object_id+'" data-embed-type="'+e.options.object_type+'" >'+e.parseForEditor()+'<div class="entity-embed-blocker"></div></figure>';return t?'<div class="entity-embed-container">'+o+"</div>":o},b=function(e,t){var o=/^[^.]*staging[^.]*\.|\.dev$/,a=o.test(window.location.host),n={auth_token:EntityEmbed.apiService.getAuthToken(),object_type:e.options.object_type};a&&(n.debug=1);var l={ajaxSettings:{dataType:"json",method:"POST",data:n},requestDelay:600,url:function(t){return n.title=t,EntityEmbed.apiService.getDomainName()+e.options.httpPaths.getAll},listLocation:function(e){return e.response.data},getValue:function(e){return e.title},preparePostData:function(t){return t.title=$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').val(),JSON.stringify(t)},list:{maxNumberOfElements:20,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var t=$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').getSelectedItemData(),o=t.object_id;$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').val(""),EntityEmbed.apiService.get({path:e.options.httpPaths.get,data:{object_id:o}}).done(function(t){if("string"==typeof t.response)return void console.log("Failed to get list of current embed types for the Select Existing page: "+t.response);var o=jQuery.Event("existingItemSelected");o.embedModel=t.response,$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').trigger(o)}).fail(function(e){console.log("failed to get embed type!")})}}};$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').easyAutocomplete(l),$(i.containers.selectExistingEmbed).find('input[name="'+e.options.object_type+'-query"]').closest(".easy-autocomplete").removeAttr("style")},f=function(e){return'<div class="embed-modal-row '+e.options.object_type+'-query-container query-container"><div class="embed-modal-full-column"><label class="embed-modal-label" for="query">Search for '+e.options.displayName+'</label><input type="text" class="embed-modal-form-control" name="'+e.options.object_type+'-query" placeholder="begin typing '+e.options.displayName+' title "></div></div>'};e.prototype.generateEmbedHtml=p,e.prototype.functions={init:{before:function(e){e.currentEmbedType=null,t=e.embedTypes,$(i.elements.saveSpinner).hide()},after:function(e){function t(e,t){e.initModal(t)}var o,a,n,d,m,u,p,v;for(v=0;v<e.embedTypes.length;v++)$(i.containers.selectExistingEmbed).append(f(e.embedTypes[v])),o=$(i.containers.selectExistingEmbed).find('input[name="'+e.embedTypes[v].options.object_type+'-query"]'),b(e.embedTypes[v],e.modalCtrl),$(i.containers.selectExistingEmbed).find("."+e.embedTypes[v].options.object_type+"-query-container").hide(),e.modalCtrl.registerEvent(o,"existingItemSelected",function(e,t){t.currentEmbedType.model=e.embedModel,t.modalCtrl.$el.completeModal()});for(v=0;v<e.embedTypes.length;v++)u=e.embedTypes[v],e.$embedTypeSelect.append('<option value="'+u.options.object_type+'">'+u.options.displayName+"</option>"),a=$('<div id="'+u.name+'"></div>'),e.$modalBody.find(i.containers.createNewEmbed).append(a),p=e.modalHtmlLocation+u.options.viewPath,EntityEmbed.templateCache&&EntityEmbed.templateCache[p]?(a.html(EntityEmbed.templateCache[p]),t(u,a)):a.load(p,function(e,o){return function(i,a,n){console.log(e.options.viewPath+" load completed with status: "+a),EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[o]=$(this).html(),t(e,$(this))}}(u,p)),u.$view=a,u.optionIndex=v,a.hide();d={parentModalCtrl:e.modalCtrl},m=new EntityEmbed.confirmModalDefaults,i.elements.confirmModal="#"+m.options.modalId,n=$("#"+m.options.modalId),p=e.modalHtmlLocation+m.options.viewPath,EntityEmbed.templateCache&&EntityEmbed.templateCache[p]?(n.html(EntityEmbed.templateCache[p]),m.init(),n.modal(m,d)):n.load(p,function(e,t,o){console.log("leave confirmation modal load completed with status: "+t),"error"!==t&&(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[p]=n.html(),m.init(),n.modal(m,d))}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(e,t){var o=e.currentTarget.options[e.currentTarget.selectedIndex].value;t.currentEmbedType.clearForm(t.currentEmbedType.$view),l(t,o),t.modalType===EntityEmbed.embedModalTypes.selectExisting&&($(i.containers.selectExistingEmbed).find(".query-container").hide(),$(i.containers.selectExistingEmbed).find("."+t.currentEmbedType.options.object_type+"-query-container").show())}),e.modalCtrl.registerEvent(i.buttons.saveEmbed,"click",function(e,t){r(t)}),e.modalCtrl.registerEvent(i.buttons.showSelectExisting,"click",function(e,t){c(t,t.modalType===EntityEmbed.embedModalTypes.addSingle||t.modalType===EntityEmbed.embedModalTypes.selectExistingSingle)}),e.modalCtrl.registerEvent(i.buttons.cancelSelectExisting,"click",function(e,t){t.modalType=EntityEmbed.embedModalTypes.add,s(t)})}},open:{before:function(e){a(e,"false"),e.embedType?(l(e,e.embedType),delete e.embedType):d(e)},after:function(e){switch(e.modalType){case EntityEmbed.embedModalTypes.edit:m(e),EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(t){return"string"==typeof t.response?void console.log("Failed to get embed type: "+t.response):(l(e,t.response.object_type),e.currentEmbedType.model=t.response,e.staleModel=$.extend(!0,{},t.response),void e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view))}).fail(function(e){console.log("failed to get embed type!")});break;case EntityEmbed.embedModalTypes.add:s(e);break;case EntityEmbed.embedModalTypes.addSingle:s(e),e.$embedTypeSelect.hide();break;case EntityEmbed.embedModalTypes.selectExisting:c(e);break;case EntityEmbed.embedModalTypes.selectExistingSingle:c(e,!0)}}},abort:{before:function(e){var t=this;if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var o in e.currentEmbedType.model)if(!e.staleModel[o]||e.staleModel[o]!==e.currentEmbedType.model[o])return $(i.elements.confirmModal).openModal({parentModal:t}),!1}else if(n(e.currentEmbedType.$view))return $(i.elements.confirmModal).openModal({parentModal:t}),!1;return e.currentEmbedType.clearForm(e.currentEmbedType.$view),delete e.confirmedLeave,!0},after:function(e){a(e,"true")}},complete:{before:function(e){return!0},after:function(e){var t,o,i,n;if(a(e,"true"),e.$currentEditorLocation.length>0){for(o=e.$currentEditorLocation.attr("class").split(" "),t=$(p(e.currentEmbedType,!0)),i=0,n=o.length;n>i;i++)t.addClass(o[i]);e.$currentEditorLocation.replaceWith(t)}e.modalCtrl.promise.resolve({data:e.currentEmbedType.model,embedType:e.currentEmbedType,$embed:e.$currentEditorLocation})}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="audio",o={viewPath:"modal_audio.html",displayName:"Audio",object_type:"audio",audioLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",upload:{required:!0,extension:"mp3"},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"admin/embed/file-upload"}},i=".uploaded-audio-file",a=".cancel-upload-file-btn",n=".edit-chosen-file-btn",l=".embed-modal-file-input",d=function(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(e="/"+t),e+t):""};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=3,e.prototype.audioPreviewClass="audio-preview",e.prototype.cleanModel=function(){return{title:null,url_path:null,credit:null,creditLink:null}},e.prototype.initModal=function(e){var t=this;t.$mp3Form=e.find('input[name="upload"]'),e.find(n).on("click",function(){e.find(i).hide(),e.find(n).hide(),t.$mp3Form.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$mp3Form.hide(),e.find(a).hide(),t.$mp3Form.parent().find("#upload-error").is(":visible")&&t.$mp3Form.parent().find("#upload-error").hide(),e.find(n).show(),e.find(i).show()}),e.find(l).on("change",function(){var t=e.find(l)[0].files[0].name;e.find("[name=title]").val(t)})},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.audioPreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(n).hide(),t.$mp3Form.show()},e.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},e.prototype.generateUploadedPreview=function(){var e=this;if(e.model.object_id){var t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<audio controls class="'+e.audioPreviewClass+'"><source src="'+d(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio>'}return'<div class="'+e.audioPreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},e.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$mp3Form.hide(),e.find(i).show(),e.find(n).show(),e.find(i).append(t.generateUploadedPreview()))},e.prototype.parseForEditor=function(){var e=this,t="mp3";return e.model.url_path&&""!==e.model.url_path&&(t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1)),'<div class="audio-embed"><audio controls><source src="'+d(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio><div class="credit">Credit: '+e.model.credit+'</div><div class="link">Link: '+e.model.creditLink+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var o=this;o.parent.constructor(e,i,t,o)}var t="customText",o="custom-text-editor",i={viewPath:"modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=5,e.prototype.getModelFromForm=function(e){for(var t=this,i=e.find(".embed-modal-form-control"),a=0;a<i.length;a++){var n,l;i[a].id==o?(n=i[a].attributes.name.nodeValue,l=i[a].innerHTML):(n=i[a].name,l=i[a].value),n&&l&&(t.model[n]=l)}},e.prototype.cleanModel=function(){return{title:null,displayTitle:"",text:null}},e.prototype.clearForm=function(e,t){var t=this;t.parent.clearForm(e,t);for(var o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++)o[i].type&&-1!==o[i].type.indexOf("select")?o[i].selectedIndex=0:(o[i].value=null,o[i].innerHTML="");t.model=t.cleanModel()},e.prototype.populateFormWithModel=function(e){for(var t=this,i=e.find(".embed-modal-form-control"),a=0;a<i.length;a++)if(i.type&&-1!==i[a].type.indexOf("select")){var n=$(i[a]).find("option"),l=t.model[i[a].name],d=0;n.each(function(e){this.value===l&&(d=e)}),i[a].selectedIndex=d}else i[a].value=t.model[i[a].name],i[a].id==o&&(i[a].innerHTML=t.model[i[a].attributes.name.nodeValue])},e.prototype.initModal=function(e){new MediumEditor("#"+o,{placeholder:{text:"Type your text. Highlight words to trigger the styles editor"}})},e.prototype.parseForEditor=function(){var e=this;return'<div class="custom-text-embed"><div class="display-title">'+e.model.displayTitle+'</div><div class="custom-text">'+e.model.customText+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="externalLink",o={viewPath:"modal_externalLink.html",displayName:"External Link",object_type:"external-link",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",linkText:"required"}},httpPaths:{uploadFile:"admin/embed/file-upload"}},i=".uploaded-image-file",a=".cancel-upload-image-btn",n=".edit-chosen-file-btn",l=".embed-modal-file-input",d=function(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t):""};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=9,e.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null}},e.prototype.initModal=function(e){var t=this;t.$imageForm=e.find('input[name="upload"]'),e.find(n).on("click",function(){e.find(i).hide(),e.find(n).hide(),t.$imageForm.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$imageForm.hide(),e.find(a).hide(),t.$imageForm.parent().find("#upload-error").is(":visible")&&t.$imageForm.parent().find("#upload-error").hide(),e.find(i).show(),e.find(n).show()}),e.find(l).on("change",function(){var t=e.find(l)[0].files[0].name;e.find("[name=title]").val(t)})},e.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},e.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$imageForm.hide(),e.find(i).show(),e.find(n).show(),e.find(i).append(t.generateUploadedImgPreview()))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.imagePreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(n).hide(),t.$imageForm.show()},e.prototype.generateUploadedImgPreview=function(){var e=this;return e.model.object_id?'<img class="'+e.imagePreviewClass+'" src="'+d(e.options.imageLocation,e.model.url_path)+'">':'<div class="'+e.imagePreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},e.prototype.parseForEditor=function(){var e=this;return'<div class="external-link-embed entity-embed-secondary-toolbar-locator"><img src="'+d(e.options.imageLocation,e.model.url_path)+'"><div class="text-container"><div class="display-title">'+e.model.displayTitle+'</div><div class="teaser">'+e.model.teaser+'</div></div><a href="'+e.model.url+'">'+e.model.linkText+"</a></div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="facebook",i={viewPath:"modal_facebook.html",displayName:"Facebook",object_type:"facebook",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=7,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a=o[i].name,n=o[i].value;a&&n&&(t.model[a]=n)}var l="embedCode",d='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s);js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));</script><div class="fb-post" data-href="'+this.model.url+'" data-width="500"></div>';t.model[l]=d},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"},t.prototype.activateEmbed=function(){e.FB&&e.FB.XFBML.parse()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="globalBuzz",o={viewPath:"modal_globalBuzz.html",displayName:"Global Buzz",object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",url:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=13,e.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null}},e.prototype.parseForEditor=function(){var e=this;return'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><img class ="buzz-field-quote-png" src="http://www.pri.org/sites/all/themes/pri/images/icon-open-quote.png"><div class="buzz-quote-inner">'+e.model.quote+'</div></div><div class="buzz-field-quote-credit">'+e.model.credit+'</div><a class="btn btn-primary global-buzz-link" href="'+e.model.quoteUrl+'">'+e.model.quoteUrlText+"</a></div></article></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="iframe",o={viewPath:"modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required",height:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=11,e.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1,width:null,height:300}},e.prototype.parseForEditor=function(){var e=this.model.height,t=this.model.width||this.model.height,o=e/t*100,i=!!this.model.width,a=["<div",' class="iframe-embed'+(i?" iframe-embed-responsive":"")+'"',i?' style="padding-bottom: '+o+'%"':"",">",'<iframe src="'+this.model.url+'"',' frameborder="0"',' scrolling="'+this.model.allowsScroll+'"',' height="'+(this.model.height||300)+'"',' width="'+(this.model.width?this.model.width:"100%")+'"',"></iframe>","</div>"].join("");return i&&(a=['<div class="iframe-embed-responsive-wrapper" style="max-width:'+this.model.width+'px">',a,"</div>"].join("")),a}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="image",o={viewPath:"modal_image.html",displayName:"Image(s)",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"admin/image-license/list",uploadFile:"admin/embed/file-upload"}},i=".uploaded-image-file",a=".cancel-upload-image-btn",n=".edit-chosen-file-btn",l=".embed-modal-file-input",d=function(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t):""};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=1,e.prototype.imagePreviewClass="image-preview",e.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null}},e.prototype.loadLicenses=function(e){var t=this,o="<option disabled selected>-- select a license --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(t){if(t.response.data){var i=[];i.push(o);for(var a=0;a<t.response.data.length;a++)i.push('<option value="'+t.response.data[a].license+'">'+t.response.data[a].title+"</option>");e.find('[name="license"]').html(i)}}).fail(function(e){console.log("failed to find load image license options")})},e.prototype.initModal=function(e){var t=this;t.loadLicenses(e),t.$imageForm=e.find('input[name="upload"]'),e.find(n).on("click",function(){e.find(i).hide(),e.find(n).hide(),t.$imageForm.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$imageForm.hide(),e.find(a).hide(),t.$imageForm.parent().find("#upload-error").is(":visible")&&t.$imageForm.parent().find("#upload-error").hide(),e.find(i).show(),e.find(n).show()}),e.find(l).on("change",function(){var t=e.find(l)[0].files[0].name;e.find("[name=title]").val(t)})},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.imagePreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(n).hide(),t.$imageForm.show()},e.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},e.prototype.generateUploadedImgPreview=function(){var e=this;return e.model.object_id?'<img class="'+e.imagePreviewClass+'" src="'+d(e.options.imageLocation,e.model.url_path)+'">':'<div class="'+e.imagePreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},e.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$imageForm.hide(),e.find(i).show(),e.find(n).show(),e.find(i).append(t.generateUploadedImgPreview()))},e.prototype.parseForEditor=function(){var e=this;return'<div class="images-embed"><img class="entity-embed-secondary-toolbar-locator" src="'+d(e.options.imageLocation,e.model.url_path)+'" /><div class="images-embed-caption">'+e.model.caption+'</div><div class="images-embed-credit">Credit: '+e.model.credit+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="instagram",i={viewPath:"modal_instagram.html",displayName:"Instagram",object_type:"instagram",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=8,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a=o[i].name,n=o[i].value;a&&n&&(t.model[a]=n)}var l="embedCode",d='<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="6" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: auto; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px); "><a href="'+t.model.url+'" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank"></a></blockquote><script async defer src="//platform.instagram.com/en_US/embeds.js"></script>';t.model[l]=d},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"},t.prototype.activateEmbed=function(){e.instgrm&&e.instgrm.Embeds.process()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="newsletterSubscribe",o={viewPath:"modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",object_type:"newsletter",validationOptions:{rules:{title:"required",newsletter:"required"}},httpPaths:{getNewsletters:"admin/newsletter/list"}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=12,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletterId:null,teaser:null}},e.prototype.initModal=function(e){var t=this,o="<option disabled selected>-- select a newsletter --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getNewsletters}).done(function(t){if(t.response.data){var i=[];i.push(o);for(var a=0;a<t.response.data.length;a++)i.push('<option value="'+t.response.data[a].newsletter_id+'" >'+t.response.data[a].title+"</option>");e.find('[name="newsletter"]').html(i)}}).fail(function(){console.log("failed to load newsletter subscription options")})},e.prototype.parseForEditor=function(){var e=this;return'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="subscribe-form"><div class="teaser">'+e.model.teaser+'</div><div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}if(!EntityEmbed.embedTypes)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var t="relatedLink",o={viewPath:"modal_relatedLink.html",displayName:"Related Link",object_type:"related-link",validationOptions:{rules:{title:"required",linkInput:"atLeastOne"}},httpPaths:{getContentList:"admin/content/list",getContentItem:{story:"admin/story/fetch",episode:"admin/episode/fetch"}}},i="#related-link-list",a="#add-link-eac",n="drag-link-btn",l="related-link-placeholder",d="#related-links-progress",r="remove-link-btn",s="related-link-url",m=function(e,t){var o=c(e),i=$(o);return i.data("link-data",e),i.find("."+r).on("click",function(){var e=$(this),t=e.closest("."+s);t.remove()}),i},c=function(e){return'<div class="'+s+'"><div class="related-link-control"><span class="'+n+'"><i class="fa fa-bars"></i></span></div><div class="related-link-title">'+e.title+'</div><div class="related-link-control"><button class="'+r+'"><i class="fa fa-minus"></i></button></div></div>'},u=function(e,t,o){var a=/^[^.]*staging[^.]*\.|\.dev$/,n=a.test(window.location.host),l={auth_token:EntityEmbed.apiService.getAuthToken()},d=o.find(e);n&&(l.debug=1);var r={ajaxSettings:{dataType:"json",method:"POST",data:l},requestDelay:600,url:function(e){return l.title=e,EntityEmbed.apiService.getDomainName()+t.options.httpPaths.getContentList},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},preparePostData:function(e){return e.title=d.val(),JSON.stringify(e)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var e,t=d.getSelectedItemData(),a=(t.object_id,o.find(i));t.object_id&&(e=m(t),a.append(e)),d.val("")}}};d.easyAutocomplete(r),d.closest(".easy-autocomplete").removeAttr("style")};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=10,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[]}},e.prototype.initModal=function(e){var t=this,o=e.find(i),r=e.find(d);r.parent().hide(),u(a,t,e),o.sortable({axis:"y",handle:"."+n,items:"."+s,placeholder:l,start:function(e,t){t.placeholder.height(t.helper.outerHeight())}}),$.validator.addMethod("atLeastOne",function(e,t){return $(".related-link-url").length>0},$.validator.format("One link is required."))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).empty()},e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),delete t.model.linkInput,t.model.links=[],e.find("."+s).each(function(){var e=$(this),o=e.data("link-data");t.model.links.push({object_id:o.object_id,object_type:o.object_type})})},e.prototype.populateFormWithModel=function(e){var t,o,a,n=this,l=e.find(i),r=e.find(d),s=[],c=[],u=0,p=0,b=0;if(n.parent.populateFormWithModel(e,n),n.model.links.length){for(r.width(0),r.parent().slideDown(0),t=0,o=n.model.links.length;o>t;t++)n.model.links[t]&&(u++,a=EntityEmbed.apiService.get({path:n.options.httpPaths.getContentItem[n.model.links[t].object_type],data:{object_id:n.model.links[t].object_id}}),a.done(function(e){return function(t){p++,b=p/u*100,r.css({width:b+"%"}),"OK"===t.status&&(c[e]=t.response)}}(t)),s.push(a));$.when.apply($,s).done(function(){var e,t,o;for(r.parent().delay(400).slideUp(500),t=0,o=c.length;o>t;t++)c[t]||c.splice(t,1);for(t=0,o=c.length;o>t;t++)e=m(c[t]),l.append(e),e.hide().delay(1e3).slideDown(150)})}},e.prototype.parseForEditor=function(){var e=this;return'<div class="relatedLink-embed"><div class="relatedLink-embed-uiText"> <strong>Embed Type:</strong> Related Link </div><div class="relatedLink-embed-uiText"> <strong>Title:</strong> '+e.model.title+'</div><div class="relatedLink-embed-uiText"> <strong>Links:</strong> '+e.model.links.length+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=this;t.parent.constructor(e,i,o,t)}var t,o="slideshow",i={viewPath:"modal_slideshow.html",displayName:"Slideshow",object_type:"slideshow",validationOptions:{rules:{slideshowTitle:"required",title:"required",altText:"required",license:"required",radioOption:{slideshowImage:!0}},errorPlacement:function(e,t){"radioOption"===t.attr("name")&&e.css("float","right"),e.insertAfter(t)}}},a=function(){for(var e="",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e},n="#embed-modal-slideshow-image",l="#embed-modal-slideshow-image-select-existing",d="#btn-cancel-select-existing-simg",r=".embed-modal-slideshow-image-list",s="slideshow-radio-label-text",m=".radio-option-placeholder",c={},u=null,p=function(e,t){$(m).is(":visible")&&$(m).hide();var o=t||a(),i='<div class="slideshow-radio-container"><label class="slideshow-radio"><input type="radio" id="'+o+'" name="radioOption"><span class="'+s+'">'+e+'</span><label class="slideshow-image-error"></label></label><div class="remove-slideshow-image"><i class="fa fa-times"></i></div></div>';$(r).append(i);var n=$(r).children().last();return n.find(".remove-slideshow-image").on("click",function(){return function(e,t){delete c[e],t.remove()}}(o,n)),o},b=function(){t.getModelFromForm($(n)),c[u]=t.model},f=function(e){$("#"+e);if(u&&""!==u){if(u===e)return;b(),t.clearForm($(n)),t.model=c[e],t.populateFormWithModel($(n))}else $(n).show();u=e},v=function(){$(n).hide(),$(l).show()},h=function(){0!==$('[name="radioOption"]:checked').length&&$(n).show(),
$(l).hide(),$('input[name="simg-query"]').val("")},y=function(){var e=/^[^.]*staging[^.]*\.|\.dev$/,o=e.test(window.location.host),i={auth_token:EntityEmbed.apiService.getAuthToken(),object_type:t.options.object_type};o&&(i.debug=1);var a={ajaxSettings:{dataType:"json",method:"POST",data:i},requestDelay:600,url:function(e){return i.title=e,EntityEmbed.apiService.getDomainName()+t.options.httpPaths.getAll},listLocation:function(e){return e.response.data},getValue:function(e){return e.title},preparePostData:function(e){return JSON.stringify(e)},list:{maxNumberOfElements:20,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var e=$('input[name="simg-query"]').getSelectedItemData(),o=e.object_id;$('input[name="simg-query"]').val(""),EntityEmbed.apiService.get({path:t.options.httpPaths.get,data:{object_id:o}}).done(function(e){if("string"==typeof e.response)return void console.log("Failed to get list of current embed types for the Select Existing page: "+e.response);var t=jQuery.Event("existingImageSelected");t.imageModel=e.response,$('input[name="simg-query"]').trigger(t)}).fail(function(e){console.log("failed to get embed type!")})}}};$('input[name="simg-query"]').easyAutocomplete(a),$('input[name="simg-query"]').closest(".easy-autocomplete").removeAttr("style")};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=e,e.prototype.orderIndex=2,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,images:[]}},e.prototype.initModal=function(e){var o=this;return o.model=o.cleanModel(),"function"!=typeof EntityEmbed.embedTypes.image?void console.log("could not find image embed for use in slideshow embed"):(t=new EntityEmbed.embedTypes.image,t.initModal($(n)),$(n).hide(),$.validator.addMethod("slideshowImage",function(e,t,o){var i=t.id,a=!0;return(i||c[i])&&(a=!(!c[i].title||!c[i].license||!c[i].altText||!c[i].upload&&!c[i].url_path)),a},"missing required fields"),t.loadLicenses(e),$(".slideshow-image-select-existing").on("click",function(){v()}),$(".slideshow-image-add").on("click",function(){h();var e=1;for(var o in c)e+=1;var i=p("image "+e);c[i]=t.cleanModel()}),y(),e.find('input[name="simg-query"]').on("existingImageSelected",function(e){var o=1;for(var i in c)o+=1;c[e.imageModel.object_id]=e.imageModel,p(e.imageModel.title,e.imageModel.object_id),$("#"+e.imageModel.object_id).attr("checked",""),u&&""!==u&&(b(),t.clearForm($(n)),u=e.imageModel.object_id),t.model=e.imageModel,t.populateFormWithModel($(n)),h()}),$(d).on("click",function(){h()}),$(r).on("click",function(e){var t=$(r+" :checked");0!=t.length&&f(t.attr("id"))}),void $(n).find('input[name="title"]').on("blur",function(){var e=$(this).val();if(""!==e){var t=$("#"+u).parent();t.find("."+s).text(e)}}))},e.prototype.saveEmbed=function(e){var o=this,i=[];o.model.slideshowTitle&&delete o.model.slideshowTitle;for(var a=0;a<o.model.images.length;a++){t.model=o.model.images[a];var n=!t.model.object_id,l=t.saveEmbed(n);l.done(function(e){return function(t){return"ERROR"==t.status?void console.log("failed to put/post a slideshow image"):void(o.model.images[e]={object_id:t.response.object_id,order:e})}}(a)).fail(function(e){return function(){console.log("failed to save a slideshow image number "+e)}}(a)),i.push(l)}return $.when.apply($,i).then(function(){return o.parent.saveEmbed(e,o)})},e.prototype.getModelFromForm=function(e){var t=this;b(),t.model.title=e.find("input[name=slideshowTitle]").val(),t.model.displayTitle=e.find("input[name=displayTitle]").val(),t.model.images=[];for(var o in c)t.model.images.push(c[o])},e.prototype.populateFormWithModel=function(e){var o=this,i=[];o.model.slideshowTitle=o.model.title,o.parent.populateFormWithModel(e.find("form").first(),o),$(r).hide(),$(m).hide(),o.model.images.sort(function(e,t){return e.order-t.order});for(var a=0;a<o.model.images.length;a++)p("image "+(a+1),o.model.images[a].object_id),0===a&&($("#"+o.model.images[a].object_id).attr("checked",""),u=o.model.images[a].object_id);for(var a=0;a<o.model.images.length;a++){var l=EntityEmbed.apiService.get({path:t.options.httpPaths.get,data:{object_id:o.model.images[a].object_id,auth_token:EntityEmbed.apiService.getAuthToken}});l.done(function(e){return function(o){if("ERROR"===o.status||"string"==typeof o.response)return void console.log("could not load slideshow image number "+e);c[o.response.object_id]=o.response;var i=$("#"+o.response.object_id).parent();i.find("."+s).text(o.response.title),0==e&&(t.model=o.response)}}(o.model.images[a].order)).fail(function(e){return function(){console.log("could not load slideshow image number "+e)}}(o.model.images[a].order)),i.push(l)}$.when.apply($,i).done(function(){$(r).show(),$(n).show(),t.populateFormWithModel($(n))})},e.prototype.clearForm=function(e){var o=this;o.parent.clearForm(e,o),t&&t.clearForm($(n)),c={},u="",e.find(".slideshow-radio-container").remove(),$(n).hide(),$(m).show()}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="twitter",o={viewPath:"modal_twitter.html",displayName:"Twitter",object_type:"twitter",validationOptions:{rules:{title:"required",url:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=6,e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),t.model.embedCode='<blockquote class="twitter-tweet" data-lang="en"><a href="'+t.model.url+'"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>'},e.prototype.cleanModel=function(){return{title:null,url:null,embedCode:null}},e.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="video",o={viewPath:"modal_video.html",displayName:"Video",object_type:"video",validationOptions:{rules:{title:"required",url:{required:!0,validDomain:!0}}}},i=function(e){if(-1!==e.indexOf("vimeo.com")){var t="?"+["title=0","portrait=0","byline=0","color=dc5555"].join("&");return"//player.vimeo.com/video/"+a(e)+t}if(-1!==e.indexOf("youtube.com")){var t="?"+["showinfo=0","modestbranding=1","rel=0"].join("&");return"//www.youtube.com/embed/"+n(e)+t}return""},a=function(e){var t=e.indexOf("/")>-1?e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},n=function(e){var t=e.indexOf("/")>-1?e.indexOf("/watch")>-1?e.match(/v=([^&]+)(?:&|$)/i)[1]:e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=4,e.prototype.cleanModel=function(){return{title:null,url:null}},e.prototype.init=function(e){var t=this;t.parent.init(e,t),$.validator.addMethod("validDomain",function(e,t,o){var i=-1!=e.indexOf("youtube.com")||-1!=e.indexOf("vimeo.com");return this.optional(t)||i},"The video must be from YouTube or Vimeo")},e.prototype.parseForEditor=function(){var e=this;return'<div class="video-embed"><div class="overlay"><iframe src="'+i(e.model.url)+'"	frameborder="0"></iframe></div></div>'}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var t;t=e.id?EntityEmbed.embedModalTypes.edit:e.embedTypeStr?e.selectExisting?EntityEmbed.embedModalTypes.selectExistingSingle:EntityEmbed.embedModalTypes.addSingle:e.selectExisting?EntityEmbed.embedModalTypes.selectExisting:EntityEmbed.embedModalTypes.add;var o={$currentEditorLocation:e.$currentEditorLocation,modalType:t,embedId:e.id,embedType:e.embedTypeStr};return EntityEmbed.$embedModal.openModal(o)}$.embed_modal_create=function(e){function t(){var t;d.$embedTypeSelect&&d.$embedTypeSelect.length||(d.$embedTypeSelect=i.find(e.embedTypeSelect)),d.$modalBody&&d.$modalBody.length||(d.$modalBody=i.find(e.modalBody)),e.modalOptions.$abortEl&&e.modalOptions.$abortEl.length||(e.modalOptions.$abortEl=i.find(e.abortEl)),t=new EntityEmbed.embedModalDefaults,e.modalOptions=$.extend(!0,{},t,e.modalOptions),i.modal(e.modalOptions,d),i.hide(),r.resolve()}var o,i,a,n={modalOptions:{},modalScope:{$embedTypeSelect:null,$modalBody:null,$abortEl:null},$modalEl:null,modalHtmlLocation:"modal/",modalContainer:"body",modalFileName:"modal_main.html",modalElId:"embed-modal",modalBody:".embed-modal-body",abortEl:"#btn-abort-modal",embedTypeSelect:"#select-embed-type",authToken:null,domainName:null,embedTypes:{image:{},slideshow:{},video:{},audio:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},globalBuzz:{},newsletterSubscribe:{},iframe:{},customText:{}}},l=[],d={},r=$.Deferred();if(EntityEmbed.modalExists)return r.resolve(),r;e=$.extend(!0,{},n,e);for(var s in EntityEmbed.embedTypes)if(e.embedTypes[s]){var m=new EntityEmbed.embedTypes[s](e.embedTypes[s]);l.push(m)}return l.sort(function(e,t){return e.orderIndex-t.orderIndex}),d.embedTypes=l,EntityEmbed.currentEmbedTypes=l,d=$.extend(!0,{},e.modalScope,d),d.modalHtmlLocation=e.modalHtmlLocation,o=$(e.modalContainer),i=e.$modalEl&&e.$modalEl.length?e.$modalEl:o.find("#"+e.modalElId),i.length||(i=$('<div class="embed-modal" id="'+e.modalElId+'"></div>'),o.append(i)),EntityEmbed.$embedModal=i,EntityEmbed.modalExists=!0,e.authToken&&EntityEmbed.apiService.setAuthToken(e.authToken),e.domainName&&EntityEmbed.apiService.setDomainName(e.domainName),e.modalFileName?(a=e.modalHtmlLocation+e.modalFileName,EntityEmbed.templateCache&&EntityEmbed.templateCache[a]?(i.html(EntityEmbed.templateCache[a]),t()):i.load(a,function(e,o,i){return console.log("embed modal load completed with status: "+o),"error"===o?void r.reject():(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[a]=$(this).html(),void t())})):t(),r},$.embed_modal_open=function(t){var o={$currentEditorLocation:$(""),embedTypeStr:null,id:null,selectExisting:!1},i=$.Deferred();return $.embed_modal_create(t).always(function(){e($.extend(!0,{},o,t.modalOptions||{})).done(function(e){i.resolve(e)}).fail(function(){i.reject()})}),i}}();var EntityEmbed=EntityEmbed||{};!function(e,t,o,i){"use strict";function a(e){var t,o,i="[[",a="]]";return o=[m,e.index,e.id].join(":"),t=[i,o,a].join("")}function n(t){var o=e.grep(EntityEmbed.currentEmbedTypes,function(e){return e.options.object_type==t})[0];return o&&e.extend(!0,{},o)}function l(){var e;return t.getSelection?e=t.getSelection():o.getSelection?e=o.getSelection():o.selection&&(e=o.selection.createRange()),e}function d(e,i){var a,n;e.focus(),"undefined"!=typeof t.getSelection&&"undefined"!=typeof o.createRange?(a=o.createRange(),n=t.getSelection(),a.selectNodeContents(e),a.collapse(i),n.removeAllRanges(),n.addRange(a)):"undefined"!=typeof o.body.createTextRange&&(a=o.body.createTextRange(),a.moveToElementText(e),a.collapse(i),a.select())}function r(o,i){var a=this;a.el=o,a.$el=e(o),a.templates=t.MediumInsert.Templates,a.core=a.$el.data("plugin_"+s),a.options=e.extend(!0,{},b,i),a._defaults=b,a._name=s,a.toolbarManager=new EntityEmbed.toolbarManager(a,a.options.styles,a.options.actions,c),a.core.getEditor()&&(a.core.getEditor().get_content=function(){return a.getContent()},a.core.getEditor().load_content=function(e){a.loadContent(e)}),a.init()}var s="mediumInsert",m="EntityEmbeds",c="entity-embed-active",u=".medium-insert-active",c="entity-embed-active",p="entity-embed-container",b={label:'<span class="fa fa-code"></span>',authToken:null,domainName:null,styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}},newline:{label:'<span class="fa fa-i-cursor"></span>',clicked:function(e,t){e.addNewline(t)}}}};r.prototype.init=function(){var t=this;t.options.authToken&&EntityEmbed.apiService.setAuthToken(t.options.authToken),t.options.domainName&&EntityEmbed.apiService.setDomainName(t.options.domainName),t.toolbarManager.createActionToolbar(e("body")),t.$el.sortable({handle:".entity-embed-blocker",placeholder:"entity-embed-placeholder",start:function(e,o){var i=[o.placeholder.attr("class"),o.helper.attr("class")].join(" ");o.placeholder.attr("class",i),o.placeholder.height(o.helper.outerHeight()),o.placeholder.width(o.helper.width()),t.toolbarManager.hideToolbars()},stop:function(e,o){t.core.triggerInput()},change:function(){t.core.positionButtons(),t.core.getEditor().checkSelection()}}),t.events(),e.embed_modal_create().done(function(){for(var o=0,i=EntityEmbed.currentEmbedTypes.length;i>o;o++)t.toolbarManager.createStyleToolbar(e("body"),EntityEmbed.currentEmbedTypes[o])})},r.prototype.events=function(){function t(e){var o=e.parent();return o[0]!==i.el?t(o):e}var i=this,a=a=i.core.getEditor();a.subscribe("editableInput",function(t,o){var i=["p > ol","p > ul","p > p"].join(","),n=["li > span[style]"].join(","),l=e(o).find(i),d=e(o).find(n);l.each(function(){var t=e(this);t.unwrap(),a.selectElement(this)}),d.removeAttr("style")}),e(o).on("click",function(t){e(t.target).is(".medium-editor-action")||e(t.target.parentElement).is(".medium-editor-action")||0==i.$el.find("."+c).length||(e("."+c).removeClass(c),i.toolbarManager.hideToolbar())}),i.$el.on("click","."+p,function(t){i.toggleSelectEmbed(e(this)),t.stopPropagation()}).on("keydown",function(o){var n,r,s,m,c,u,b,f,v,h,y=[".entity-embed-container","[contenteditable]"].join(","),g=":not("+y+")";8!==o.which&&46!==o.which||(n=l(),n.rangeCount&&(r=n.getRangeAt(0),m=r.endOffset-r.startOffset,f=e(n.anchorNode),s=f.text().length,c=i.$el.children().not(".medium-insert-buttons").length,u=!1,b=!1,m>0||(3===f[0].nodeType&&(f=f.closest(g)),f=t(f),u=f.is(g)&&!f.text().length,8===o.which&&0===n.anchorOffset?v=f.prev():46===o.which&&n.anchorOffset===s&&(v=f.next()),v&&(b=v.is("."+p),v.children().length||v.text().length||v.append("<br>")),(u&&1>=c||b)&&o.preventDefault(),u&&c>1&&(o.preventDefault(),8===o.which?h=f.prevAll(g).first():46===o.which&&(h=f.nextAll(g).first()),h.children().length||h.text().length||h.append("<br>"),a.selectElement(h[0]),d(h[0],46===o.which),a.checkSelection(),f.remove(),i.core.triggerInput()))))}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=i.$el.find("."+c).length&&i.toolbarManager.hideToolbar()})},r.prototype.getCore=function(){return this.core},r.prototype.getContent=function(){var t=this,o=t.core.getEditor().serialize(),i={html:"",embeds:[]};return e.each(o,function(t){var n,l;n=e("<div />").html(o[t].value),l=n.find(".entity-embed-container",n),l.removeClass(c),l.each(function(t){var o,n,l,d;o=e(this),n=o.find("figure"),n?(l={index:t,id:n.attr("id"),type:n.attr("data-embed-type")},i.embeds.push(l),d=a(l),o.html(d)):o.remove()}),i.html+=n.html()}),i},r.prototype.loadContent=function(t){function o(t){var o;if(!t)return void i();if(l=t.html||"",!t.embeds)return void i();r=[],o=[];for(var m=0;m<t.embeds.length;m++)if(d=n(t.embeds[m].type)){d.model=d.cleanModel(),t.embeds[m].embedType=d;var c=EntityEmbed.apiService.get({path:t.embeds[m].embedType.options.httpPaths.get,data:{object_id:t.embeds[m].id}});c.done(function(e){return function(t){var o,i;return"ERROR"===t.status?(console.log("failed to get embed object!"),t):(e.embedType.model=t.response,r.push(e),i=a(e),o=EntityEmbed.embedModalDefaults.prototype.generateEmbedHtml(e.embedType,!1),void(l=l.split(i).join(o)))}}(t.embeds[m])),o.push(c)}e.when.apply(e,o).done(function(){var e,t,o,a={};i();for(var n=0;n<r.length;n++)e=r[n],a[e.id]||(a[e.id]=!0,t=s.$el.find('[id="'+e.id+'"]'),o=t.html(),t.html(o),s.addEmbed(t,e.embedType))})}function i(){s.core.getEditor().setContent(l),s.$el.sortable("refresh")}var l,d,r,s=this,m="string"==typeof t,c=m&&/<[^>]>/g.test(t);return t?(l=m?c?t:"":t.html,void(m&&!c?EntityEmbed.apiService.get({path:"admin/embed/edit",data:{object_id:t}}).done(function(e){return"ERROR"===e.status?void console.log("Failed to get story with id "+t):void o(e.repsonse)}).fail(function(e){console.log("Failed to get story with id "+t)}):o(t))):void console.log("Must provide either story id or serialized story data.")},r.prototype.add=function(){var t=this,o={modalOptions:{$currentEditorLocation:e(u)}};e.embed_modal_open(o).done(function(e){t.addEmbed(e.$embed,e.embedType)})},r.prototype.editEmbed=function(t){var o=this,i={modalOptions:{$currentEditorLocation:e("."+c),id:t.find("figure").attr("id"),embedTypeStr:t.find("[data-embed-type]").attr("data-embed-type")}};o.toolbarManager.hideToolbars(),e.embed_modal_open(i).done(function(e){o.addEmbed(e.$embed,e.embedType)})},r.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove(),t.core.triggerInput()},r.prototype.addNewline=function(e){var t=this,o="<p><br></p>";e.before(o),e.after(o),t.toolbarManager.positionToolbars(e)},r.prototype.toggleSelectEmbed=function(t){var o=this,i=e("."+c),a=t.find("[data-embed-type]").attr("data-embed-type"),l=n(a);o.toolbarManager.hideToolbar(),i.toggleClass(c),t.toggleClass(c),o.options.actions&&(t.hasClass(c)?o.toolbarManager.showToolbars(t,l.name):o.toolbarManager.hideToolbar())},r.prototype.addEmbed=function(e,t){var o=this,i=t.defaultStyle.replace("entity-embed-","");o.toolbarManager.addStyle(e,t.defaultStyle,i,!1),o.activateEmbed(t),o.$el.sortable("refresh"),o.core.triggerInput(),o.core.hideButtons()},r.prototype.activateEmbed=function(e){var t=e.embedType||e;"function"==typeof t.activateEmbed&&t.activateEmbed()},e.fn[s+m]=function(t){return this.each(function(){e.data(this,"plugin_"+s+m)||e.data(this,"plugin_"+s+m,new r(this,t))})}}(jQuery,window,document);var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),o>t?-1:t>o?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,i=e.categories.length;i>o;o+=1){var a=e.categories[o];for(var n in d.categories[0])void 0===a[n]&&(a[n]=d.categories[0][n]);t.push(a)}e.categories=t}}function o(){function t(e,o){var i=e||{};for(var a in e)void 0!==o[a]&&null!==o[a]&&("object"!=typeof o[a]||o[a]instanceof Array?i[a]=o[a]:t(e[a],o[a]));return void 0!==o.data&&null!==o.data&&"object"==typeof o.data&&(i.data=o.data),i}d=t(d,e)}function i(){if("list-required"!==d.url&&"function"!=typeof d.url){var t=d.url;d.url=function(){return t}}if(void 0!==d.ajaxSettings.url&&"function"!=typeof d.ajaxSettings.url){var t=d.ajaxSettings.url;d.ajaxSettings.url=function(){return t}}if("string"==typeof d.listLocation){var o=d.listLocation;"XML"===d.dataType.toUpperCase()?d.listLocation=function(e){return $(e).find(o)}:d.listLocation=function(e){return e[o]}}if("string"==typeof d.getValue){var i=d.getValue;d.getValue=function(e){return e[i]}}void 0!==e.categories&&(d.categoriesAssigned=!0)}function a(){void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?d.ajaxSettings=e.ajaxSettings:d.ajaxSettings={}}function n(e){return void 0!==d[e]&&null!==d[e]}function l(e,t){function o(t,i){for(var a in i)void 0===t[a]&&e.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"==typeof t[a]&&-1===$.inArray(a,r)&&o(t[a],i[a])}o(d,t)}var d={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=d.getValue(e),t=d.getValue(t),t>e?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e,t){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},r=["ajaxSettings","template"];this.get=function(e){return d[e]},this.equals=function(e,t){return!(!n(e)||d[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==d.url||"list-required"!==d.data},this.checkRequiredProperties=function(){for(var e in d)if("required"===d[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){l(e,t)},t(),o(),d.loggerEnabled===!0&&l(console,e),a(),i()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function o(t,o){function i(){var i,a={};return void 0!==t.xmlElementName&&(a.xmlElementName=t.xmlElementName),void 0!==t.listLocation?i=t.listLocation:void 0!==e.get("listLocation")&&(i=e.get("listLocation")),void 0!==i?"string"==typeof i?a.data=$(o).find(i):"function"==typeof i&&(a.data=i(o)):a.data=o,a}function a(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=o[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(o)):e.data=o,e}var n={};if(n="XML"===e.get("dataType").toUpperCase()?i():a(),void 0!==t.header&&(n.header=t.header),void 0!==t.maxNumberOfElements&&(n.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(n.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var l=t.getValue;n.getValue=function(e){return e[l]}}else"function"==typeof t.getValue&&(n.getValue=t.getValue);else n.getValue=e.get("getValue");return n}function i(t){var o=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){o.push(this)}),o}this.init=function(t){var o=[],i={};return i.data=e.get("listLocation")(t),i.getValue=e.get("getValue"),i.maxListSize=e.get("list").maxNumberOfElements,o.push(i),o},this.updateCategories=function(t,i){if(e.get("categoriesAssigned")){t=[];for(var a=0;a<e.get("categories").length;a+=1){var n=o(e.get("categories")[a],i);t.push(n)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var o=0;o<t.length;o+=1)t[o].data=i(t[o]);return t},this.processData=function(o,i){for(var a=0,n=o.length;n>a;a+=1)o[a].data=t(e,o[a],i);return o},this.checkIfDataExists=function(e){for(var t=0,o=e.length;o>t;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(t,o,i){function a(e,o){var i=[],a="";if(t.get("list").match.enabled)for(var l=0,d=e.length;d>l;l+=1)a=t.get("getValue")(e[l]),n(a,o)&&i.push(e[l]);else i=e;return i}function n(e,o){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),o=o.toLowerCase()),!!t.get("list").match.method(e,o)}function l(e){return void 0!==o.maxNumberOfElements&&e.length>o.maxNumberOfElements&&(e=e.slice(0,o.maxNumberOfElements)),e}function d(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}e.proccess.match=n;var r=o.data,s=i;return r=a(r,s),r=l(r),r=d(r)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},o=function(e){var o,i=e.fields;return"description"===e.type?(o=t.description.method,"string"==typeof i.description?o=function(e,t){return e+" - <span>"+t[i.description]+"</span>"}:"function"==typeof i.description&&(o=function(e,t){return e+" - <span>"+i.description(t)+"</span>"}),o):"iconRight"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return e+"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"}:"function"==typeof i.iconSrc&&(o=function(e,t){return e+"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"}),o):"iconLeft"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"+e}:"function"==typeof i.iconSrc&&(o=function(e,t){return"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"+e}),o):"links"===e.type?("string"==typeof i.link?o=function(e,t){return"<a href='"+t[i.link]+"' >"+e+"</a>"}:"function"==typeof i.link&&(o=function(e,t){return"<a href='"+i.link(t)+"' >"+e+"</a>"}),o):"custom"===e.type?e.method:t.basic.method},i=function(e){return e&&e.type&&e.type&&t[e.type]?o(e):t.basic.method},a=function(e){var o=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var o=t[e.type].cssClass;return function(){return o}}():o};this.getTemplateClass=a(e),this.build=i(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,o){function i(){return 0===g.length?void f.error("Input field doesn't exist."):b.checkDataUrlProperties()?b.checkRequiredProperties()?(a(),void l()):void f.error("Will not work without mentioned properties."):void f.error("One of options variables 'data' or 'url' must be defined.")}function a(){function e(){var e=$("<div>"),o=p.getValue("WRAPPER_CSS_CLASS");b.get("theme")&&""!==b.get("theme")&&(o+=" eac-"+b.get("theme")),b.get("cssClasses")&&""!==b.get("cssClasses")&&(o+=" "+b.get("cssClasses")),""!==v.getTemplateClass()&&(o+=" "+v.getTemplateClass()),e.addClass(o),g.wrap(e),b.get("adjustWidth")===!0&&t()}function t(){var e=g.outerWidth();g.parent().css("width",e)}function o(){g.unwrap()}function i(){var e=$("<div>").addClass(p.getValue("CONTAINER_CLASS"));e.attr("id",n()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(b.get("list").showAnimation.type){case"slide":var t=b.get("list").showAnimation.time,o=b.get("list").showAnimation.callback;e.find("ul").slideDown(t,o);break;case"fade":var t=b.get("list").showAnimation.time,o=b.get("list").showAnimation.callback;e.find("ul").fadeIn(t),o;break;default:e.find("ul").show()}b.get("list").onShowListEvent()}).on("hide.eac",function(){switch(b.get("list").hideAnimation.type){case"slide":var t=b.get("list").hideAnimation.time,o=b.get("list").hideAnimation.callback;e.find("ul").slideUp(t,o);break;case"fade":var t=b.get("list").hideAnimation.time,o=b.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,o);break;default:e.find("ul").hide()}b.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(T).addClass("selected"),b.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,o,i){var a="",n=e.find("ul");n.empty().detach(),w=[];for(var d=0,r=0,m=o.length;m>r;r+=1){var c=o[r].data;if(0!==c.length){void 0!==o[r].header&&o[r].header.length>0&&n.append("<div class='eac-category' >"+o[r].header+"</div>");for(var u=0,p=c.length;p>u&&d<o[r].maxListSize;u+=1)a=$("<li><div class='eac-item'></div></li>"),function(){var e=u,t=d,n=o[r].getValue(c[e]);a.find(" > div").on("click",function(){g.val(n).trigger("change"),T=t,s(t),b.get("list").onClickEvent(),b.get("list").onChooseEvent()}).mouseover(function(){T=t,s(t),b.get("list").onMouseOverEvent()}).mouseout(function(){b.get("list").onMouseOutEvent()}).html(v.build(l(n,i),c[e]))}(),n.append(a),w.push(c[u]),d+=1}}e.append(n),b.get("list").onLoadEvent()})}(),g.after(e)}function a(){g.next("."+p.getValue("CONTAINER_CLASS")).remove()}function l(e,t){return b.get("highlightPhrase")&&""!==t?r(e,t):e}function d(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function r(e,t){var o=d(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}g.parent().hasClass(p.getValue("WRAPPER_CSS_CLASS"))&&(a(),o()),e(),i(),E=$("#"+n()),b.get("placeholder")&&g.attr("placeholder",b.get("placeholder"))}function n(){var e=g.attr("id");return e=p.getValue("CONTAINER_ID")+e}function l(){function e(){y("autocompleteOff",!0)&&p(),t(),o(),i(),a(),n(),l()}function t(){g.focusout(function(){var e,t=g.val();b.get("list").match.caseSensitive||(t=t.toLowerCase());for(var o=0,i=w.length;i>o;o+=1)if(e=b.get("getValue")(w[o]),b.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return T=o,void s(T)})}function o(){g.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=b.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];return e}function o(e,t){return b.get("matchResponseProperty")!==!1?"string"==typeof b.get("matchResponseProperty")?t[b.get("matchResponseProperty")]===e:"function"==typeof b.get("matchResponseProperty")?b.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<b.get("minCharNumber"))){if("list-required"!==b.get("data")){var i=b.get("data"),a=h.init(i);a=h.updateCategories(a,i),a=h.processData(a,e),m(a,e),g.parent().find("li").length>0?d():r()}var n=t();void 0!==n.url&&""!==n.url||(n.url=b.get("url")),void 0!==n.dataType&&""!==n.dataType||(n.dataType=b.get("dataType")),void 0!==n.url&&"list-required"!==n.url&&(n.url=n.url(e),n.data=b.get("preparePostData")(n.data,e),$.ajax(n).done(function(t){var i=h.init(t);i=h.updateCategories(i,t),i=h.convertXml(i),o(e,t)&&(i=h.processData(i,e),m(i,e)),h.checkIfDataExists(i)&&g.parent().find("li").length>0?d():r(),b.get("ajaxCallback")()}).fail(function(){f.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:r(),c();break;case 38:e.preventDefault(),w.length>0&&T>0&&(T-=1,g.val(b.get("getValue")(w[T])),s(T));break;case 40:e.preventDefault(),w.length>0&&T<w.length-1&&(T+=1,g.val(b.get("getValue")(w[T])),s(T));break;default:if(e.keyCode>40||8===e.keyCode){var o=g.val();b.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?b.get("requestDelay")>0?(void 0!==u&&clearTimeout(u),u=setTimeout(function(){t(o)},b.get("requestDelay"))):t(o):r()}}})}function i(){g.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&T>-1&&(g.val(b.get("getValue")(w[T])),b.get("list").onKeyEnterEvent(),b.get("list").onChooseEvent(),T=-1,r(),e.preventDefault())})}function a(){g.off("keypress")}function n(){g.focus(function(){""!==g.val()&&w.length>0&&(T=-1,d())})}function l(){g.blur(function(){setTimeout(function(){T=-1,r()},250)})}function p(){g.attr("autocomplete","off")}e()}function d(){E.trigger("show.eac")}function r(){E.trigger("hide.eac")}function s(e){E.trigger("selectElement.eac",e)}function m(e,t){E.trigger("loadElements.eac",[e,t])}function c(){g.trigger("blur")}var u,p=new e.Constans,b=new e.Configuration(o),f=new e.Logger,v=new e.Template(o.template),h=new e.ListBuilderService(b,e.proccess),y=b.equals,g=t,E="",w=[],T=-1;
e.consts=p,this.getConstants=function(){return p},this.getConfiguration=function(){return b},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return T},this.getItems=function(){return w},this.getItemData=function(e){return w.length<e||void 0===w[e]?-1:w[e]},this.getSelectedItemData=function(){return this.getItemData(T)},this.build=function(){a()},this.init=function(){i()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e.setHandle=function(t,o){e.eacHandles[o]=t},e}(EasyAutocomplete||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each(function(){var o=e(this),i=new EasyAutocomplete.main(o,t);EasyAutocomplete.inputHasId(o)||EasyAutocomplete.assignRandomId(o),i.init(),EasyAutocomplete.setHandle(i,o.attr("id"))})},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var o=e(this).attr("id");return void 0!==o&&t>-1?EasyAutocomplete.getHandle(o).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery);