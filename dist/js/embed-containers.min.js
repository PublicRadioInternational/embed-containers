!function(){EntityEmbed=EntityEmbed||{};var e={};e.modal="null",e["modal/modal_audio.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">MP3 File</label><div class="audio_editor"><div class="audio_editor-intro"><div class="audio_editor-intro_inner"><div><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="audio/mpeg, audio/mp3"></div><div><hr></div><div><div class="input-group"><input type="url" name="url_external" placeholder="http://www.example.com/path/to/audio.mp3" class="embed-modal-input embed-modal-url-external embed-modal-form-control form-control"> <span class="input-group-btn"><a class="btn btn-primary js-set-url">Listen</a></span></div></div></div></div><div class="audio_editor-preview"><div class="audio_editor-preview_inner"><audio class="audio_editor-preview_audio" controls></audio></div></div><div class="audio_editor-toolbar"><ul class="audio_editor-toolbar_list"><li class="audio_editor-toolbar_item js-edit-file"><a class="audio_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Select Another Image"></span></a></li><li class="audio_editor-toolbar_item js-upload-undo"><a class="audio_editor-tollbar_btn"><span class="fa fa-undo" aria-label="Revert Selected Image"></span></a></li><li class="audio_editor-toolbar_item js-upload-cancel"><a class="audio_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel Image Select"></span></a></li></ul></div></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div id="audio-credits" class="embed-modal-form"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="credit" class="embed-modal-label">Credit</label><input id="credit" class="embed-modal-form-control embed-modal-input" type="text" name="credit"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="creditLink" class="embed-modal-label">Credit Link</label><input id="creditLink" class="embed-modal-form-control embed-modal-input" type="url" name="creditLink"></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="explicit_content">Is the content explicit?</label><div><label class="radio-inline"><input type="radio" name="explicit_content" class="embed-modal-form-control" value="0" checked="checked">Non-explicit</label><label class="radio-inline"><input type="radio" name="explicit_content" class="embed-modal-form-control" value="1">Explicit</label></div></div></div></div></form>',e["modal/modal_audioProgram.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">MP3 File</label><div class="audio_editor"><div class="audio_editor-intro"><div class="audio_editor-intro_inner"><div><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="audio/mpeg, audio/mp3"></div><div><hr></div><div><div class="input-group"><input type="url" name="url_external" placeholder="http://www.example.com/path/to/audio.mp3" class="embed-modal-input embed-modal-url-external embed-modal-form-control form-control"> <span class="input-group-btn"><a class="btn btn-primary js-set-url">Listen</a></span></div></div></div></div><div class="audio_editor-preview"><div class="audio_editor-preview_inner"><audio class="audio_editor-preview_audio" controls></audio></div></div><div class="audio_editor-toolbar"><ul class="audio_editor-toolbar_list"><li class="audio_editor-toolbar_item js-edit-file"><a class="audio_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Select Another Image"></span></a></li><li class="audio_editor-toolbar_item js-upload-undo"><a class="audio_editor-tollbar_btn"><span class="fa fa-undo" aria-label="Revert Selected Image"></span></a></li><li class="audio_editor-toolbar_item js-upload-cancel"><a class="audio_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel Image Select"></span></a></li></ul></div></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="organization_program" class="embed-modal-label">Program</label><input id="organization_program" name="organization_program" class="embed-modal-form-control embed-modal-input js-program" type="text" placeholder="Begin typing a Program title..."></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="audio_type" class="embed-modal-label">Audio Type</label><select id="audio_type" class="embed-modal-form-control embed-modal-input" name="audio_type"><option value="">-- Select Type --</option><option value="episode">Episode</option><option value="segment">Segment</option></select></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="explicit_content">Is the content explicit?</label><div><label class="radio-inline"><input type="radio" name="explicit_content" class="embed-modal-form-control" value="0" checked="checked">Non-explicit</label><label class="radio-inline"><input type="radio" name="explicit_content" class="embed-modal-form-control" value="1">Explicit</label></div></div></div></div></form>',e["modal/modal_confirmation.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header"><h3>Are you sure you want to leave?</h3></div><div class="embed-modal-body"><h4>All your changes will be lost if you leave this window!</h4></div><div class="embed-modal-footer"><button id="btn-confirm-leave">Yes - Leave</button> <button id="btn-cancel-leave">No - Stay</button></div></div></div>',e["modal/modal_customText.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control embed-modal-input"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="control-label" for="customText">Text</label><div name="customText" type="text" placeholder="Type your text. Highlight words to trigger the styles editor" class="embed-modal-form-control" id="custom-text-editor"></div></div></div></div></form>',e["modal/modal_externalLink.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="linkText">External Link Text</label><input name="linkText" type="text" placeholder="Enter link text" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">External Link Url</label><input name="url" type="url" placeholder="Enter URL" class="embed-modal-form-control"></div></div></div><hr><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">Teaser Image</label><div class="image_editor"><div class="image_editor-intro"><div class="image_editor-intro_inner"><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"></div></div><div class="image_editor-preview"><img class="image_editor-preview_image"></div><div class="image_editor-toolbar"><ul class="image_editor-toolbar_list"><li class="image_editor-toolbar_item js-upload"><a class="image_editor-tollbar_btn"><span class="fa fa-upload" aria-label="Select Another Image"></span></a></li><li class="image_editor-toolbar_item js-upload-undo"><a class="image_editor-tollbar_btn"><span class="fa fa-undo" aria-label="Revert Selected Image"></span></a></li><li class="image_editor-toolbar_item js-upload-cancel"><a class="image_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel Image Select"></span></a></li><li class="image_editor-toolbar_item js-upload-remove"><a class="image_editor-tollbar_btn"><span class="fa fa-close" aria-label="Remove Image"></span></a></li></ul></div></div></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="display title">Teaser Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control js-input-teaser_title"></div><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="5" class="embed-modal-form-control"></textarea></div></div></div></form>',e["modal/modal_facebook.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control js-input-title"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Facebook Status</label><div class="social_editor"><div class="social_editor-intro"><div class="social_editor-intro_inner"><div><div class="input-group"><input name="url" type="url" placeholder="Enter URL, or drop link..." class="embed-modal-input embed-modal-form-control js-input-url"> <span class="input-group-btn"><button class="btn btn-primary js-btn-preview" type="button">Preview</button></span></div></div></div></div><div class="social_editor-preview"><div class="social_editor-preview_inner"><div class="social_editor-preview_post"></div></div></div><div class="social_editor-toolbar"><ul class="social_editor-toolbar_list"><li class="social_editor-toolbar_item js-btn-edit"><a class="social_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Enter Another URL"></span></a></li><li class="social_editor-toolbar_item js-btn-cancel"><a class="social_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel URL Editing"></span></a></li></ul></div></div></div></div></div></form>',e["modal/modal_iframe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Source</label><input name="url" type="url" placeholder="Enter URL or iframe source code" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Height</label><div class="embed-modal-input-group"><input name="height" type="number" placeholder="" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Width</label><div class="embed-modal-input-group"><input name="width" type="number" placeholder="Full Width" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="allowsScroll">Scroll</label><select name="allowsScroll" class="embed-modal-form-control"><option>No</option><option>Yes</option></select></div></div></div></form>',e["modal/modal_image.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">Image File</label><div class="image_editor"><div class="image_editor-intro"><div class="image_editor-intro_inner"><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"></div></div><div class="image_editor-preview"><img class="image_editor-preview_image"></div><div class="image_editor-toolbar"><ul class="image_editor-toolbar_list"><li class="image_editor-toolbar_item js-upload"><a class="image_editor-tollbar_btn"><span class="fa fa-upload" aria-label="Select Another Image"></span></a></li><li class="image_editor-toolbar_item js-upload-undo"><a class="image_editor-tollbar_btn"><span class="fa fa-undo" aria-label="Revert Selected Image"></span></a></li><li class="image_editor-toolbar_item js-upload-cancel"><a class="image_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel Image Select"></span></a></li></ul></div></div></div><div class="embed-modal-form"><label for="title" class="embed-modal-label">Title</label><input class="embed-modal-input embed-modal-form-control" type="text" name="title"></div><div class="embed-modal-form"><label for="altText" class="embed-modal-label">Alt Text</label><input class="embed-modal-input embed-modal-form-control" type="text" name="altText"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="caption" class="embed-modal-label">Caption</label><textarea class="embed-modal-input embed-modal-form-control" name="caption" rows="5"></textarea></div><div class="embed-modal-form"><label for="credit" class="embed-modal-label">Credit</label><input class="embed-modal-input embed-modal-form-control" type="text" name="credit"></div><div class="embed-modal-form"><label for="creditLink" class="embed-modal-label">Credit Link</label><input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink"></div><div class="embed-modal-form"><label for="license" class="embed-modal-label">License</label><select class="embed-modal-form-control" type="text" name="license"><option value="" disabled="disabled" selected="selected">-- Select A License --</option></select></div></div><!-- <div class="embed-modal-full-column">\r\n			<label class="embed-modal-label" for="upload">Image File</label>\r\n			<input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*" />\r\n			<span class="fa fa-times cancel-upload-image-btn"></span>\r\n			<span class="fa fa-cog edit-chosen-file-btn"></span>\r\n			<div class="uploaded-image-file">\r\n				<img class="image-preview">\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="title" class="embed-modal-label">Title</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="title" />\r\n			</div>\r\n		</div>\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="altText" class="embed-modal-label">Alt Text</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="altText" />\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-form">\r\n			<div class="embed-modal-half-column">\r\n				<label for="credit" class="embed-modal-label">Credit</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="credit" />\r\n			</div>\r\n			<div class="embed-modal-half-column">\r\n				<label for="creditLink" class="embed-modal-label">Credit Link</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink" />\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="caption" class="embed-modal-label">Caption</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="caption" />\r\n			</div>\r\n		</div>\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="license" class="embed-modal-label">License</label>\r\n				<select class="embed-modal-form-control" type="text" name="license">\r\n					<option disabled selected>-- Select A License --</option>\r\n				</select>\r\n			</div>\r\n		</div>\r\n	</div> --></div></form>',e["modal/modal_instagram.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control js-input-title"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Instagram Post</label><div class="social_editor"><div class="social_editor-intro"><div class="social_editor-intro_inner"><div><div class="input-group"><input name="url" type="url" placeholder="Enter URL, or drop link..." class="embed-modal-input embed-modal-form-control js-input-url"> <span class="input-group-btn"><button class="btn btn-primary js-btn-preview" type="button">Preview</button></span></div></div></div></div><div class="social_editor-preview"><div class="social_editor-preview_inner"><div class="social_editor-preview_post"></div></div></div><div class="social_editor-toolbar"><ul class="social_editor-toolbar_list"><li class="social_editor-toolbar_item js-btn-edit"><a class="social_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Enter Another URL"></span></a></li><li class="social_editor-toolbar_item js-btn-cancel"><a class="social_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel URL Editing"></span></a></li></ul></div></div></div></div></div></form>',e["modal/modal_main.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header stick-in-parent"><button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="embed-modal-half-column"><h3 class="header-title"></h3></div><div class="embed-modal-half-column"><select class="embed-modal-form-control" id="select-embed-type"></select></div></div><div class="embed-modal-body"><div id="embed-modal-create-new"></div><div id="embed-modal-select-existing"></div></div><div class="embed-modal-footer stick-in-parent stick-bottom"><div id="embed-modal-buttons-create"><button id="btn-show-select-existing">Select Existing Embed</button><!-- TODO : add publishing state dropdown --><!-- TODO : publishing state dropdown affects Save button text --> <i class="fa fa-spinner fa-spin" id="embed-modal-spinner"></i> <button id="btn-save-modal">Save</button> <button id="btn-abort-modal">Cancel</button></div><div id="embed-modal-buttons-select"><button id="btn-cancel-select-existing">Create New Embed</button></div></div><!-- the leave confirmation modal will be loaded here --><div class="embed-modal" id="leave-confirmation-modal"><div></div></div></div></div>',e["modal/modal_newsletterSubscribe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="newsletter">Select Newsletter</label><select name="newsletter" class="embed-modal-form-control"></select></div></div></div><hr><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Teaser Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="3" class="embed-modal-form-control"></textarea></div></div></div></form>',e["modal/modal_relatedLink.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title to display" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><label class="embed-modal-label">Links</label><div class="progress"><div id="related-links-progress" class="progress-bar progress-bar-info"></div></div><ul id="related-link-list"></ul></div></div><hr><div class="embed-modal-row"><div class="related-link-add"><input name="linkInput" type="text" id="add-link-eac" placeholder="Begin typing a title. Select one to add link." class="embed-modal-form-control"></div></div></form>',e["modal/modal_slideshow.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="slideshowTitle" class="embed-modal-label">Slideshow Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title for internal use" type="text" name="title"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="displayTitle" class="embed-modal-label">Display Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title to display" type="text" name="displayTitle"></div></div></div><hr><div class="embed-modal-row"><div class="embed-modal-full-column slideshow_drop_files"><div class="slideshow_intro"><a class="btn btn-lg btn-primary js-add_slide"><span class="fa fa-plus" aria-hidden="true"></span> Add First Image</a></div><div class="slideshow_editor"><div class="slideshow_editor-slide"><div class="slideshow_editor-slide_image-container"><div class="slideshow_editor-slide_image js-slide_image"><img></div></div><div class="slideshow_editor-slide_text js-slide_text"><div class="slideshow_editor-slide_caption js-slide_caption"></div><div class="slideshow_editor-slide_credit-container"><span class="slideshow_editor-slide_label">Credit</span> <span class="slideshow_editor-slide_credit_text js-slide_credit"></span> <a class="slideshow_editor-slide_credit_link js-slide_credit" href="" target="_blank"></a></div></div></div><div class="slideshow_editor-nav"><ul class="slideshow_editor-nav_list js-slides"><li class="slideshow_editor-nav_item js-slide_template"><a class="slideshow_editor-nav_btn"><span class="slideshow_editor-nav_ind fa" aria-hidden="true"></span><span class="slideshow_editor-nav_handle" aria-hidden="true"></span></a></li></ul><div class="slideshow_editor-add_item"><a class="slideshow_editor-add_btn js-add_slide"><span class="fa fa-plus" aria-label="Add Slide"></span></a></div></div><div class="slideshow_editor-toolbar"><ul class="slideshow_editor-toolbar_list"><li class="slideshow_editor-toolbar_item"><a class="slideshow_editor-toolbar_btn js-remove_slide"><span class="fa fa-remove" aria-label="Remove Slide"></span></a></li><li class="slideshow_editor-toolbar_item"><a class="slideshow_editor-toolbar_btn js-edit_slide"><span class="fa fa-cog" aria-label="Edit Slide"></span></a></li></ul></div></div></div></div></form><div class="embed-modal" id="embed-modal-slideshow-image"></div>',e["modal/modal_twitter.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control js-input-title"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Twitter Status (Tweet)</label><div class="social_editor"><div class="social_editor-intro"><div class="social_editor-intro_inner"><div><div class="input-group"><input name="url" type="url" placeholder="Enter URL, or drop link..." class="embed-modal-input embed-modal-form-control js-input-url"> <span class="input-group-btn"><button class="btn btn-primary js-btn-preview" type="button">Preview</button></span></div></div></div></div><div class="social_editor-preview"><div class="social_editor-preview_inner"><div class="social_editor-preview_post"></div></div></div><div class="social_editor-toolbar"><ul class="social_editor-toolbar_list"><li class="social_editor-toolbar_item js-btn-edit"><a class="social_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Enter Another URL"></span></a></li><li class="social_editor-toolbar_item js-btn-cancel"><a class="social_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel URL Editing"></span></a></li></ul></div></div></div></div></div></form>',e["modal/modal_video.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Video URL Preview</label><div class="video_editor"><div class="video_editor-intro"><div class="video_editor-intro_inner"><div><div class="input-group"><input name="url" type="url" placeholder="Enter URL to video" class="embed-modal-input embed-modal-form-control js-input-url"> <span class="input-group-btn"><button class="btn btn-primary js-btn-preview" type="button">Preview</button></span></div></div></div></div><div class="video_editor-preview"><div class="video_editor-preview_inner"><div class="video_editor-preview_video"><div class="video-embed"><div class="overlay js-preview-wrapper"><iframe class="js-preview-iframe" src="" frameborder="0"></iframe></div></div></div><div class="video_editor-preview_info"><h4 class="video_editor-preview_title">Here is a title to test the video editor layout with</h4><div class="video_editor-preview_credits"><a class="video_editor-preview_author" target="_blank"></a> / <a class="video_editor-preview_provider" target="_blank"></a></div></div></div></div><div class="video_editor-toolbar"><ul class="video_editor-toolbar_list"><li class="video_editor-toolbar_item js-btn-edit"><a class="video_editor-tollbar_btn"><span class="fa fa-pencil" aria-label="Enter Another URL"></span></a></li><li class="video_editor-toolbar_item js-btn-cancel"><a class="video_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel URL Editing"></span></a></li></ul></div></div></div></div></div></form>',EntityEmbed.templateCache=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){e=$.extend(!0,{},d,e);var t={timeout:e.timeout,crossDomain:!0,type:e.methodType,dataType:"json",jsonp:!1,url:e.domainName+e.path};return e.headers?(e.headers["x-auth-token"]=e.auth_token,e.headers["x-debug"]=e.debug,t.headers=e.headers,t.processData=!1,t.contentType=!1,t.data=e.data,"function"==typeof e.xhr&&(t.xhr=e.xhr)):(e.data.debug=e.debug,e.data.auth_token=e.auth_token,t.data=JSON.stringify(e.data)),$.ajax(t)}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function i(t){return t.methodType="POST",t.timeout=0,e(t)}function a(){return d.auth_token}function n(){return d.domainName}function l(e){d.auth_token=e}function r(e){d.domainName=e,d.domainName.endsWith("/")||(d.domainName+="/")}var d={data:{},debug:0,auth_token:"",domainName:"",path:"",timeout:15e3},s=/^[^.]*staging[^.]*\.|\.dev$/,c=s.test(window.location.host);c&&(d.auth_token="abc123",d.debug=1),EntityEmbed.apiService={set:t,get:o,uploadFile:i,setAuthToken:l,getAuthToken:a,getDomainName:n,setDomainName:r}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+i);return o}function t(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+i+a);return o}var o={},i="mediumInsert",a="EntityEmbeds",n="entity-embed-active",l="medium-editor-button-active",r="medium-insert-images-toolbar",d="medium-insert-images-toolbar2",s=".entity-embed-secondary-toolbar-locator",c="entityEmbedToolbarEventsReady",m="entity-embed-toolbar",u=function(e,t){var o=m;t?(o+=" medium-insert-images-toolbar medium-editor-toolbar medium-editor-stalker-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o+=" medium-insert-images-toolbar2 medium-editor-toolbar medium-toolbar-arrow-after medium-editor-toolbar-active";var i='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var a in e){var n=e[a];n.label&&(i+='<li><button class="medium-editor-action" data-action="'+a+'">'+n.label+"</button></li>")}return i+="</ul></div>"};toolbarManager=function(e,t,o,i){var a=this;a.mediumEditorAddon=e,a.styles=t,a.actions=o,a.embedTypes=[],i&&(n=i),a.events()},toolbarManager.prototype.events=function(){var e=this,t=$(document);t.data(c)||t.data(c,!0).on("click","."+r+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+d+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this,o=e.find("."+d);o.length||(o=$(u(t.actions)),e.append(o)),t.$actionToolbar=o,t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(e,t){var i=this,a=$.extend(i.styles,{}),n=!0,l=e.find("."+r+"."+t.name+"StyleToolbar");if(i.embedTypes[t.name]=t,t.options.styles){for(var d in t.options.styles)t.options.styles[d]?n=!1:delete a[d];n||(l.length||(l=$(u(a,t.name)),e.append(l)),o[t.name]=l,o[t.name].hide())}},toolbarManager.prototype.showToolbars=function(e,t){var i,a=this,r=$("."+n);a.currentToolbarEmbedType=t,a.$actionToolbar.show(),o[a.currentToolbarEmbedType]&&(o[a.currentToolbarEmbedType].find("button").each(function(){r.hasClass("entity-embed-"+$(this).data("action"))&&(i=$(this),i.addClass(l))}),o[a.currentToolbarEmbedType].show(),i&&i.addClass(l)),a.positionToolbars(e)},toolbarManager.prototype.styleToolbarDo=function(t){var o=this,i=t.closest("li").closest("ul"),a=$("."+n),r=e(a);i.find("."+l).removeClass(l),t.addClass(l),i.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(l)?o.addStyle(a,t,e.data("action"),!0):(a.removeClass(t),
o.styles[e.data("action")].removed&&o.styles[e.data("action")].removed(a))}),o.mediumEditorAddon.renderEmbed(a,!0),r.triggerInput()},toolbarManager.prototype.addStyle=function(e,t,o,i){function a(){var t=e.width(),o=e.height(),i=e.position();u&&i.top===d.top&&i.left===d.left&&t===l&&o===r||(c=0,u=!0,l=t,r=o,d=i,n.positionToolbars(e)),m>c?(c++,n.positionToolbarsTimeout=window.setTimeout(function(){a()},s)):delete n.positionToolbarsTimeout}var n=this,l=e.width(),r=e.height(),d=e.position(),s=100,c=0,m=20,u=!1;window.clearTimeout(n.positionToolbarsTimeout),e.addClass(t),"function"==typeof n.styles[o].added&&n.styles[o].added(e),i&&a()},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,i=$("."+n),a=o.actions[e.data("action")].clicked,l=t(i);a(l,i)},toolbarManager.prototype.hideToolbar=function(){var e=this,t=$("."+m);t.hide(),t.find("button").removeClass(l),e.currentToolbarEmbedType=null,e.positionToolbarsTimeout&&(window.clearTimeout(e.positionToolbarsTimeout),delete e.positionToolbarsTimeout)},toolbarManager.prototype.positionToolbars=function(e){var t=this,i=e.find("> figure"),a=i.data("embed"),n=a.options.actionToolbarLocatorClass||s;if(e.length){var l=e.find(n);0===l.length&&(l=e),c=e.offset().top+e.height()/2-t.$actionToolbar.height()/2;var r=l.offset().left+l.outerWidth()+8+4;r>$(window).width()-t.$actionToolbar.width()&&(r=$(window).width()-t.$actionToolbar.width()-50),t.$actionToolbar.css({top:Math.min(c,e.offset().top),left:r});var d=o[t.currentToolbarEmbedType];if(d){var c=e.offset().top-d.height()-8-2-5;0>c&&(c=0),d.css({top:c,left:e.offset().left+e.width()/2-d.width()/2})}}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,i){var a=i||this;a.name=o,t=$.extend(!0,{},a.defaultOptions,t),a.options=$.extend(!0,{},t,e),a.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{set:"admin/embed/edit",get:"admin/embed/fetch",getAll:"admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{focusCleanup:!0,errorPlacement:function(e,t){var o=t.parent();o.is(".embed-modal-input-group, .input-group")?e.insertAfter(o):e.insertAfter(t)}}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e,t,o){var i=o||this;i.modalCtrl=t,i.$el=e},e.prototype.getModelFromForm=function(e,t){var o=t||this,i=e.find(".embed-modal-form-control, .embed-modal-file-input"),a={};i.each(function(){var e,t=$(this),o=t.attr("name"),n=t.attr("type"),l=null;if(!o)return void console.warning('Form input missing "name" attribute. Value not added to model.',t[0]);switch(n){case"file":l=t[0].files[0];break;case"radio":if("undefined"!=typeof a[o])return;e=i.filter("[type=radio][name="+o+"]"),e.each(function(){var e=$(this);return e.is(":checked")?(l=e.val(),!1):void 0});break;case"checkbox":if("undefined"!=typeof a[o])return;e=i.filter("[type=checkbox][name="+o+"]"),e.length>1?(l=[],e.each(function(){var e=$(this);e.is(":checked")&&l.push(e.val())}),l.length||(l=null)):l=e.is(":checked")?1:0;break;default:l=t.val()||null}"string"==typeof l&&(l=l.length?+l===+l?+l:l:null),a[o]=l}),$.extend(o.model,a)},e.prototype.populateFormWithModel=function(e,t){var o=t||this,i=e.find(".embed-modal-form-control");i.each(function(){var e,t=$(this),a=t.attr("name"),n=t.is("input")?t.attr("type"):t.prop("tagName").toLowerCase();if(!a)return void console.warning('Form input missing "name" attribute. Value not set to input.',t[0]);switch(e=o.model[a],n){case"file":return;case"checkbox":case"radio":t=i.filter("[type="+n+"][name="+a+"]");case"select":"undefined"!=typeof e&&e.constructor===Array||(e=[e])}t.val(e)})},e.prototype.clearForm=function(e,t){var o=t||this,i=e;i.is("form")||(i=e.find("form")),i.each(function(){$(this).validate(o.options.validationOptions).resetForm()});for(var a=e.find("form"),n=0;n<a.length;n++)a[n].reset();o.model=o.cleanModel()},e.prototype.parseForEditor=function(){var e=this;return'<div class="embedded-content"><div class="ui-text"> <strong>Embed Type: </strong>'+e.options.object_type+'</div><div class="ui-text"> <strong>Title: </strong> '+e.model.title+"</div></div>"},e.prototype.validate=function(e,t,o){var i=o||this,a=e;return a.is("form")||(a=e.find("form")),i.$validator=a.each(function(){$(this).validate(i.options.validationOptions)}),i.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return o.model.object_type||(o.model.object_type=o.options.object_type),EntityEmbed.apiService.set({path:o.options.httpPaths.set,data:o.model}).done(function(e){o.staleModel=$.extend(!0,{},o.model)})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,i){var a=this;a.$el=$(e),a.options=$.extend(!0,{},t,o),a.scope={},i&&(a.scope=i),a.scope.modalCtrl=a,a.$el.data("scope",a.scope),a.options.functions.init.before(a.scope),a.init(),a.options.functions.init.after(a.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e,t){var o=e.$el.data("scope");e.isActive=t,e.$el.toggle(e.isActive).toggleClass("in",e.isActive),e.$backdrop.toggle(e.isActive).toggleClass("in",e.isActive),o.parentModal||$("body").toggleClass("embed-modal-open",e.isActive)},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$el.click(function(t){t.target===e.$el[0]&&e.$el.abortModal()}),e.options.showCloseBtn&&(e.$closeBtn=e.$el.find(".close"),e.$closeBtn.click(function(){e.$el.abortModal()})),e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,i){var a=this;a.$el.find(e).on(t,function(e){o(e,a.$el.data("scope"),i)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t,o=$.data(this[0],"ctrl");if(o){if(e){var i=o.$el.data("scope");t=$.extend(!0,{},i,e),o.$el.data("scope",t)}else t=o.$el.data("scope");return o.promise=$.Deferred(),o.options.functions.open.before(t),o.toggle(o,!0),o.options.functions.open.after(t),o.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");t.options.functions.abort.before(a)&&(t.toggle(t,!1),t.options.functions.abort.after(a),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t,o,i,a,n,l=$.data(this,"ctrl");l&&l.isActive&&(e&&(t=l.$el.data("scope"),o=$.extend(!0,{},t,e),l.$el.data("scope",o)),i=l.$el.data("scope"),a=l.options.functions.complete.before(i),"function"==typeof a.state?n=a:(n=$.Deferred(),a?n.resolve():n.reject()),n.done(function(e){e&&(i.currentEmbedType.model=e),l.toggle(l,!1),l.options.functions.complete.after(i),"pending"===l.promise.state()&&l.promise.resolve()}))})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e)}var t={modalId:"leave-confirmation-modal",viewPath:"modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(e){var t=this;t.$abortEl=$("#"+t.options.abortElId,e.$modalEl),t.$completeEl=$("#"+t.options.completeElId,e.$modalEl)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3,selectExistingSingle:4};var t=void 0,o=!1,i={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{saveSpinner:"#embed-modal-spinner",headerText:".header-title"}},a=function(e,t){function o(o){e[o]=e[o]||{};for(key in i[o])i[o].hasOwnProperty(key)&&(e[o][key]=$(i[o][key],t))}for(groupKey in i)i.hasOwnProperty(groupKey)&&o(groupKey)},n=function(e,t){$(".editable").attr("contenteditable",t)},l=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},r=function(e,t){function o(t){e.$embedTypeSelect.append('<option value="'+t.options.object_type+'">'+t.options.displayName+"</option>")}var i,a,n,l,r="string"!=typeof t,d=r?t[0]:t;if(t){for(e.isAdd=e.modalCtrl.isAdd=e.modalType===EntityEmbed.embedModalTypes.add||e.modalType===EntityEmbed.embedModalTypes.addSingle,e.isSingle=e.modalCtrl.isSingle=e.modalType===EntityEmbed.embedModalTypes.addSingle||e.modalType===EntityEmbed.embedModalTypes.selectExistingSingle,e.currentEmbedType&&(delete e.currentEmbedType.model,e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.$embedTypeSelect.empty(),n=0,l=e.embedTypes.length;l>n;n++)a=e.embedTypes[n],e.selectableEMbedTypes?-1!==e.selectableEMbedTypes.indexOf(a.options.object_type)&&o(a):o(a);e.currentEmbedType=e.modalCtrl.scope.currentEmbedType=p(d,e.embedTypes),e.currentEmbedType.clearForm(e.currentEmbedType.$view),e.currentEmbedType.$view.show(),e.$embedTypeSelect.val(d),i=e.headerText,i||(i="Add ",e.modalType===EntityEmbed.embedModalTypes.edit&&(i="Edit "),e.embedId||(i+="New "),i+=e.currentEmbedType.options.displayName),e.elements.headerText.text(i)}},d=function(e){var t=e.embedTypes[0].options.object_type;r(e,t),e.$embedTypeSelect.show()},s=function(e){function t(){e.buffered?(m.response=$.extend(!0,{},e.currentEmbedType.model),i(m),n(m)):e.currentEmbedType.saveEmbed(r,e.currentEmbedType).done(i).fail(a).always(n)}function i(t){return"ERROR"===t.status?(console.log("POST failed (API)"),void c.reject()):"string"==typeof t.response?(console.log("Failed to POST embed type: "+t.response),void c.reject()):(e.currentEmbedType.model=t.response,r&&(e.currentEmbedType.model.object_id=t.response.object_id),console.log("POST succeeded",t),e.successCallback&&e.successCallback(t.response),void c.resolve(t.response))}function a(t,o,i){console.log("POST failed (XHR)",i),e.failCallback&&e.failCallback(),c.reject()}function n(t){o=!1,e.elements.saveSpinner.hide(),e.alwaysCallback&&e.alwaysCallback()}for(var l,r=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,d=e.currentEmbedType.validate(e.currentEmbedType.$view,r),s=!0,c=$.Deferred(),m={},u=0;u<d.length;u++)s=$(e.currentEmbedType.$validator[u]).valid()&&s;return o||!s?(c.reject(),c):(o=!0,e.elements.saveSpinner.show(),l=e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),"object"==typeof l&&"function"==typeof l.then?l.always(function(){t()}):t(),c)},c=function(e){e.skipSave=!1,e.buttons.showSelectExisting.toggle(!e.addOnly),e.isSingle?e.modalType=EntityEmbed.embedModalTypes.addSingle:(e.modalType=EntityEmbed.embedModalTypes.add,e.$embedTypeSelect.show()),e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown(),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.containers.selectExistingEmbed.find(".query-container").hide()},m=function(e){e.skipSave=!1,e.buttons.showSelectExisting.hide(),e.$embedTypeSelect.hide(),e.containers.selectExistingEmbed.is(":visible")&&(e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown()),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.buttons.showSelectExisting.hide()},u=function(e){e.skipSave=!0,e.containers.createNewEmbed.slideUp(),e.containers.selectExistingEmbed.slideDown(),e.containers.createButtons.hide(),e.containers.selectButtons.show(),e.containers.selectExistingEmbed.find("."+e.currentEmbedType.options.object_type+"-query-container").show(),e.isSingle?(e.modalType=EntityEmbed.embedModalTypes.selectExistingSingle,e.$embedTypeSelect.hide()):(e.modalType=EntityEmbed.embedModalTypes.selectExisting,e.$embedTypeSelect.show())},p=function(e,t){var o=$.grep(t,function(t){return t.options.object_type==e})[0];return o&&$.extend(!0,{},o)},f=function(e,t){var o=(t.modalCtrl,/^[^.]*staging[^.]*\.|\.dev$/),i=o.test(window.location.host),a={auth_token:EntityEmbed.apiService.getAuthToken(),object_type:e.options.object_type};i&&(a.debug=1);var n={ajaxSettings:{dataType:"json",method:"POST",data:a},requestDelay:600,url:function(t){return a.title=t,EntityEmbed.apiService.getDomainName()+e.options.httpPaths.getAll},listLocation:function(e){return e.response.data},getValue:function(e){return e.title},preparePostData:function(o){return o.title=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(),JSON.stringify(o)},list:{maxNumberOfElements:20,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var o=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').getSelectedItemData(),i=o.object_id;t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(""),EntityEmbed.apiService.get({path:e.options.httpPaths.get,data:{object_id:i}}).done(function(o){if("string"==typeof o.response)return void console.log("Failed to get list of current embed types for the Select Existing page: "+o.response);var i=jQuery.Event("existingItemSelected");i.embedModel=o.response,t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').trigger(i)}).fail(function(e){console.log("failed to get embed type!")})}}};t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').easyAutocomplete(n),t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').closest(".easy-autocomplete").removeAttr("style")},b=function(e){return'<div class="embed-modal-row '+e.options.object_type+'-query-container query-container"><div class="embed-modal-full-column"><label class="embed-modal-label" for="query">Search for '+e.options.displayName+'</label><input type="text" class="embed-modal-form-control" name="'+e.options.object_type+'-query" placeholder="begin typing '+e.options.displayName+' title "></div></div>'};e.prototype.functions={init:{before:function(e){a(e,e.modalCtrl.$el),t=e.embedTypes,e.elements.saveSpinner.hide()},after:function(e){function t(t,o){t.initModal(o,e.modalCtrl)}var o,a,n,l,d,s,m,p;for(e.modalCtrl.registerEvent(e.buttons.showSelectExisting,"click",function(e,t){u(t)}),e.modalCtrl.registerEvent(e.buttons.cancelSelectExisting,"click",function(e,t){c(t)}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(t,o){var i=t.currentTarget.options[t.currentTarget.selectedIndex].value;o.currentEmbedType.clearForm(o.currentEmbedType.$view),r(o,i),o.modalType===EntityEmbed.embedModalTypes.selectExisting&&(e.containers.selectExistingEmbed.find(".query-container").hide(),e.containers.selectExistingEmbed.find("."+o.currentEmbedType.options.object_type+"-query-container").show())}),p=0;p<e.embedTypes.length;p++)s=e.embedTypes[p],e.containers.selectExistingEmbed.append(b(s)),o=e.containers.selectExistingEmbed.find('input[name="'+s.options.object_type+'-query"]'),f(s,e),e.containers.selectExistingEmbed.find("."+s.options.object_type+"-query-container").hide(),e.modalCtrl.registerEvent(o,"existingItemSelected",function(e,t){t.currentEmbedType.model=e.embedModel,t.modalCtrl.$el.completeModal()}),a=$('<div id="'+s.name+'"></div>'),e.containers.createNewEmbed.append(a),m=e.modalHtmlLocation+s.options.viewPath,EntityEmbed.templateCache&&EntityEmbed.templateCache[m]?(a.html(EntityEmbed.templateCache[m]),t(s,a)):a.load(m,function(e,o){return function(i,a,n){console.log(e.options.viewPath+" load completed with status: "+a),EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[o]=$(this).html(),t(e,$(this))}}(s,m)),s.$view=a,s.optionIndex=p,a.hide();d=new EntityEmbed.confirmModalDefaults,i.elements.confirmModal="#"+d.options.modalId,n=e.elements.confirmModal=$(i.elements.confirmModal,e.$modalEl),m=e.modalHtmlLocation+d.options.viewPath,l={parentModalCtrl:e.modalCtrl,$modalEl:n},EntityEmbed.templateCache&&EntityEmbed.templateCache[m]?(n.html(EntityEmbed.templateCache[m]),d.init(l),n.modal(d,l)):n.load(m,function(e,t,o){console.log("leave confirmation modal load completed with status: "+t),"error"!==t&&(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[m]=n.html(),d.init(l),n.modal(d,l))})}},open:{before:function(e){n(e,"false"),delete e.selectableEMbedTypes,e.embedType?("string"!=typeof e.embedType&&(e.selectableEMbedTypes=e.embedType),r(e,e.embedType),delete e.embedType):d(e)},after:function(e){function t(t){t=t||{},t.html_rendered&&(t.html_rendered=null),r(e,t.object_type),e.currentEmbedType.model=t,e.currentEmbedType.staleModel=$.extend(!0,{},t),e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view)}switch(e.modalType){case EntityEmbed.embedModalTypes.edit:if(m(e),e.buffered){t(e.embedData),delete e.embedData;break}EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(e){return"string"==typeof e.response?void console.log("Failed to get embed type: "+e.response):void t(e.response)}).fail(function(e){console.log("failed to get embed type!")});break;case EntityEmbed.embedModalTypes.add:c(e);break;case EntityEmbed.embedModalTypes.addSingle:c(e),e.$embedTypeSelect.hide();break;case EntityEmbed.embedModalTypes.selectExisting:u(e);break;case EntityEmbed.embedModalTypes.selectExistingSingle:u(e,!0)}}},abort:{before:function(e){function t(e){var t;if(e)switch(typeof e){case"array":case"object":t=JSON.stringify(e);break;default:t=e}return t||null}var o,i,a=this;if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.currentEmbedType.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var n in e.currentEmbedType.model)if(o=t(e.currentEmbedType.staleModel[n]),i=t(e.currentEmbedType.model[n]),o!==i)return e.elements.confirmModal.openModal({parentModal:a}),!1}else if(l(e.currentEmbedType.$view))return e.elements.confirmModal.openModal({parentModal:a}),!1;return e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view),delete e.confirmedLeave,!0},after:function(e){n(e,"true")}},complete:{before:function(e){return!!e.skipSave||s(e)},after:function(e){n(e,"true"),e.modalCtrl.promise.resolve({data:$.extend(!0,{},e.currentEmbedType.model),embedType:e.currentEmbedType}),e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={};return o.title=t.name,o.credit=e.artist,o}function t(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function o(e,t){e.$ui=e.$ui||{form:t};for(key in s)s.hasOwnProperty(key)&&(e.$ui[key]=$(s[key],t));return e.$ui}function i(e){var t=e.$ui,o=$.Deferred(),i=e.getAudioUrl();return t.previewAudio.attr("src",i),o.resolve(),o}function a(e,t){var o=e.$ui,i=$.Deferred();return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(o.form).done(function(){i.resolve()})}),i}function n(e){var t=e.$ui;return i(e).done(function(){t.uploadFileInputContainer.hide(),t.cancelUploadBtn.hide(),t.previewContainer.show(),t.editFileBtn.show(),t.undoUploadBtn.toggle(!!e.model.url_path&&!!e.model.upload)})}function l(e){var t=e.$ui;t.uploadFileInput.val(""),t.previewContainer.hide(),t.editFileBtn.hide(),t.undoUploadBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadBtn.toggle(!!(e.model.url_path||e.model.upload||e.model.url_external))}function r(e){var t=this;t.parent.constructor(e,c,d,t)}var d="audio",s={audioEditor:".audio_editor",previewContainer:".audio_editor-preview",previewAudio:".audio_editor-preview_audio",editFileBtn:".js-edit-file",cancelUploadBtn:".js-upload-cancel",undoUploadBtn:".js-upload-undo",uploadFileInputContainer:".audio_editor-intro",uploadFileInput:".embed-modal-file-input",urlExternalInput:".embed-modal-url-external",setUrlBtn:".js-set-url"},c={viewPath:"modal_audio.html",displayName:"Audio",object_type:"audio",validationOptions:{rules:{title:"required",url:"required",upload:{required:{depends:function(e){return!$(s.urlExternalInput,$(e).closest("form")).val()}},extension:"mp3"},url_external:{required:{depends:function(e){return!$(s.uploadFileInput,$(e).closest("form")).val()}}},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"admin/embed/file-upload"}};r.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[d]=r,r.prototype.orderIndex=3,r.prototype.audioPreviewClass="audio-preview",r.prototype.cleanModel=function(){return{title:null,duration:null,url_path:null,url_external:null,credit:null,creditLink:null,object_type:c.object_type,explicit_content:0}},r.prototype.getAudioUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):this.model.url_external?this.model.url_external:t(this.model.url_path)},r.prototype.initModal=function(e,t){var i,r=this;r.parent.initModal(e,t,r),i=o(r,e),i.editFileBtn.on("click","a",function(){l(t.scope.currentEmbedType)}),i.cancelUploadBtn.on("click","a",function(){n(t.scope.currentEmbedType)}),i.undoUploadBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,i.uploadFileInput.val(""),n(t.scope.currentEmbedType)}),i.uploadFileInput.on("change",function(e){var o=e.target.files[0];i.urlExternalInput.val(""),a(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),i.audioEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,i=$(this),n=e.originalEvent.dataTransfer.files;if(n&&n.length){if(o=n[0],console.log("dropped file",o),!/(?:mpeg|mp3)/.test(o.type))return;i.addClass("js-dropped"),setTimeout(function(){a(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){i.removeClass("js-dropped")},300)})},300)}}),i.setUrlBtn.on("click",function(e){var o=$(this),a=o.html();e.preventDefault(),t.scope.currentEmbedType.getModelFromForm(i.form),console.log("Set URL",t.scope.currentEmbedType.model),t.scope.currentEmbedType.model.url_external&&(i.uploadFileInput.val(""),delete t.scope.currentEmbedType.model.upload,delete t.scope.currentEmbedType.model.url_path,o.html("Loading..."),n(t.scope.currentEmbedType).done(function(){o.html(a)}))})},r.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),t.$ui.previewAudio.removeAttr("src").removeAttr("type"),l(t)},r.prototype.saveEmbed=function(e){var t=this,o=t.model.upload,i=$.Deferred();delete t.model.upload;var a=t.parent.saveEmbed(e,t);return o?a.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path,i.resolve(e)}).fail(function(e,t,o){console.error(t,o),i.reject(t)}):a.then(function(e){i.resolve(e)}),i},r.prototype.getModelFromForm=function(e){function t(){a.previewAudio.off("loadedmetadata",t),o.model.duration=this.duration,r.resolve()}var o=this,a=o.$ui,n=a.previewAudio[0].duration,l=$.extend(!0,{},o.model),r=$.Deferred();return o.parent.getModelFromForm(e,o),l.upload&&!o.model.upload&&(o.model.upload=l.upload),o.model.url_external&&(o.$ui.uploadFileInput.val(""),delete o.model.upload,delete o.model.url_path),n?(o.model.duration=n,r.resolve()):(a.previewAudio.on("loadedmetadata",t),i(o)),r},r.prototype.getModelFromFile=function(t){function o(e){var o,a;o=$.extend(!0,{},i.model);for(a in o)o.hasOwnProperty(a)&&null===o[a]&&delete o[a];i.model=$.extend(!0,{},e,o),i.model.upload=t,n.resolve(i.model)}var i=this,a=i.$ui,n=$.Deferred(),l="function"==typeof define&&define.amd?require("musicmetadata"):window.musicmetadata;return console.log("musicmetadata: ",l),t||(t=i.model.upload),a&&i.getModelFromForm(a.form),l?l(t,function(i,a){console.log("file tags",a),o(e(a,t))}):o(e({},t)),n},r.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.parent.populateFormWithModel(e,t),t.model.upload||t.model.url_path||t.model.url_external?n(t).done(function(){o.resolve()}):o.resolve(),o},r.prototype.parseForEditor=function(){var e=this,o=e.model.url_external||t(e.model.url_path),i=['<audio controls class="entity-embed-secondary-toolbar-locator" src="'+o+'"></audio>'];return e.model.credit&&i.push('<div class="credit">Credit: '+e.model.credit+"</div>"),e.model.creditLink&&i.push('<div class="link">Link: '+e.model.creditLink+"</div>"),'<div class="audio-embed">'+i.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={};return o.title=t.name,o}function t(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(e="/"+t),e+t):e||""}function o(e,t){var o=/^[^.]*staging[^.]*\.|\.dev$/,i=o.test(window.location.host),a={auth_token:EntityEmbed.apiService.getAuthToken(),organization_type:"program",published:!0},n=e.$ui.programInput;i&&(a.debug=1);var l={ajaxSettings:{dataType:"json",method:"POST",data:a},requestDelay:600,url:function(t){return a.title=t,EntityEmbed.apiService.getDomainName()+e.options.httpPaths.getOrganizationList},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},preparePostData:function(e){return e.title=n.val(),JSON.stringify(e)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var t,o=n.getSelectedItemData();o.object_id?(t={object_id:o.object_id,object_type:o.object_type},n.data("organization_program",t)):n.removeData("organization_program"),e.model.organization_program=n.data("organization_program")||null,n.focus(),console.log("Program Change: ",n.data("organization_program"),n.val())}}};n.easyAutocomplete(l),n.on("keypress keydown",function(){var t=$(this),o=t.val();o.replace(/^\s+|\s+$/,"")||(e.model.organization_program=null,t.removeData("organization_program"),console.log("Program Removed: ",t.data("organization_program"),o))}),n.closest(".easy-autocomplete").removeAttr("style")}function i(e,t){e.$ui=e.$ui||{form:t};for(key in c)c.hasOwnProperty(key)&&(e.$ui[key]=$(c[key],t));return e.$ui}function a(e){var t=e.$ui,o=$.Deferred(),i=e.getAudioUrl();return t.previewAudio.attr("src",i),l(e),o.resolve(),o}function n(e,t){var o=e.$ui,i=$.Deferred();return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(o.form).done(function(){i.resolve()})}),i}function l(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadBtn.hide(),t.previewContainer.show(),t.editFileBtn.show(),t.undoUploadBtn.toggle(!!e.model.url_path&&!!e.model.upload)}function r(e){var t=e.$ui;t.uploadFileInput.val(""),t.previewContainer.hide(),t.editFileBtn.hide(),t.undoUploadBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadBtn.toggle(!!(e.model.url_path||e.model.upload||e.model.url_external))}function d(e){var t=this;t.parent.constructor(e,m,s,t)}var s="audioProgram",c={programInput:".js-program",audioEditor:".audio_editor",previewContainer:".audio_editor-preview",previewAudio:".audio_editor-preview_audio",editFileBtn:".js-edit-file",cancelUploadBtn:".js-upload-cancel",undoUploadBtn:".js-upload-undo",uploadFileInputContainer:".audio_editor-intro",uploadFileInput:".embed-modal-file-input",urlExternalInput:".embed-modal-url-external",setUrlBtn:".js-set-url"},m={viewPath:"modal_audioProgram.html",displayName:"Program Audio",object_type:"audio-program",audioLocation:"https://test-services.pri.org",validationOptions:{onfocusout:function(e,t){return"organization_program"!==$(e).attr(name)},onkeyup:function(e,t){return"organization_program"!==$(e).attr(name)},rules:{title:"required",organization_program:"hasProgramData",audio_type:"required",upload:{required:{depends:function(e){return!$(c.urlExternalInput).val()}},extension:"mp3"},url_external:{required:{depends:function(e){return!$(c.uploadFileInput).val()}}},wavFile:{extension:"wav"}}},httpPaths:{getOrganizationFetch:"admin/organization/fetch",getOrganizationList:"admin/organization/list",uploadFile:"admin/embed/file-upload"}};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[s]=d,d.prototype.orderIndex=3,d.prototype.audioPreviewClass="audio-preview",d.prototype.cleanModel=function(){return{title:null,url_path:null,url_external:null,organization_program:null,audio_type:null,object_type:m.object_type,explicit_content:0}},d.prototype.getAudioUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):this.model.url_external?this.model.url_external:t(this.options.audioLocation,this.model.url_path)},d.prototype.initModal=function(e,t){var d=this,s=i(d,e);s.editFileBtn.on("click","a",function(){r(t.scope.currentEmbedType)}),s.cancelUploadBtn.on("click","a",function(){l(t.scope.currentEmbedType)}),s.undoUploadBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,s.uploadFileInput.val(""),a(t.scope.currentEmbedType)}),s.uploadFileInput.on("change",function(e){var o=e.target.files[0];s.urlExternalInput.val(""),n(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),s.audioEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,i=$(this),a=e.originalEvent.dataTransfer.files;if(a&&a.length){if(o=a[0],console.log("dropped file",o),!/(?:mpeg|mp3)/.test(o.type))return;i.addClass("js-dropped"),setTimeout(function(){n(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){i.removeClass("js-dropped")},300);
})},300)}}),s.setUrlBtn.on("click",function(e){var o=$(this),i=o.html();e.preventDefault(),t.scope.currentEmbedType.getModelFromForm(s.form),console.log("Set URL",t.scope.currentEmbedType.model),t.scope.currentEmbedType.model.url_external&&(s.uploadFileInput.val(""),delete t.scope.currentEmbedType.model.upload,delete t.scope.currentEmbedType.model.url_path,o.html("Loading..."),a(t.scope.currentEmbedType).done(function(){o.html(i)}))}),o(d,e),$.validator.addMethod("hasProgramData",function(e,t){return!!$(t).data("organization_program")},$.validator.format("Valid Program must be selected."))},d.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),t.$ui.previewAudio.removeAttr("src").removeAttr("type"),t.$ui.programInput.removeData("organization_program").val(""),r(t)},d.prototype.saveEmbed=function(e){var t=this,o=t.model.upload,i=$.Deferred();delete t.model.upload;var a=t.parent.saveEmbed(e,t);return o?a.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path,i.resolve(e)}).fail(function(e,t,o){console.error(t,o),i.reject(t)}):a.then(function(e){i.resolve(e)}),i},d.prototype.getModelFromForm=function(e){function t(){i.previewAudio.off("loadedmetadata",t),o.model.duration=this.duration,r.resolve()}var o=this,i=o.$ui,n=i.previewAudio[0].duration,l=$.extend(!0,{},o.model),r=$.Deferred();return o.parent.getModelFromForm(e,o),o.model.organization_program=o.$ui.programInput.data("organization_program"),l.upload&&!o.model.upload&&(o.model.upload=l.upload),o.model.url_external&&(o.$ui.uploadFileInput.val(""),delete o.model.upload,delete o.model.url_path),n?(o.model.duration=n,r.resolve()):(i.previewAudio.on("loadedmetadata",t),a(o)),r},d.prototype.getModelFromFile=function(t){function o(e){var o,a;o=$.extend(!0,{},i.model);for(a in o)o.hasOwnProperty(a)&&null===o[a]&&delete o[a];i.model=$.extend(!0,{},e,o),i.model.upload=t,n.resolve(i.model)}var i=this,a=i.$ui,n=$.Deferred(),l="function"==typeof define&&define.amd?require("musicmetadata"):window.musicmetadata;return console.log("musicmetadata: ",l),t||(t=i.model.upload),a&&i.getModelFromForm(a.form),l?l(t,function(i,a){console.log("file tags",a),o(e(a,t))}):o(e({},t)),n},d.prototype.populateFormWithModel=function(e){var t,o,i=this,n=$.Deferred(),l=[];return i.parent.populateFormWithModel(e,i),i.model.organization_program?(i.$ui.programInput.data("organization_program",i.model.organization_program),t=EntityEmbed.apiService.get({path:i.options.httpPaths.getOrganizationFetch,data:{object_id:i.model.organization_program.object_id}}),t.done(function(e){i.$ui.programInput.val(e.response.title)}),l.push(t)):i.$ui.programInput.data("organization_program",null),(i.model.upload||i.model.url_path||i.model.url_external)&&(o=a(i).done(function(){n.resolve()}),l.push(o)),l.length?$.when.apply($,l).always(function(){n.resolve()}):n.resolve(),n},d.prototype.parseForEditor=function(){var e=this,o=["program_title",e.model.organization_program.object_id,(new Date).getTime()].join("_"),i=e.model.url_external||t(e.options.audioLocation,e.model.url_path),a=['<audio controls class="entity-embed-secondary-toolbar-locator" src="'+i+'"></audio>','<div class="program">Program: <span id="'+o+'"></span></div>','<div class="link">Type: '+e.model.audio_type+"</div>"];return EntityEmbed.apiService.get({path:e.options.httpPaths.getOrganizationFetch,data:{object_id:e.model.organization_program.object_id}}).done(function(e){var t=e.response,i=$("#"+o);i.text(t.title)}),'<div class="audio-embed">'+a.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var o=this;o.parent.constructor(e,i,t,o)}var t="customText",o="custom-text-editor",i={viewPath:"modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=5,e.prototype.getModelFromForm=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e,o=$(this),i=o.attr("name"),a=o.data("editor");e=a?a.getContent():o.val(),e=e.replace(/^\s+|\s+$/,""),t.model[i]=e||null})},e.prototype.cleanModel=function(){return{title:null,displayTitle:"",text:null,object_type:i.object_type}},e.prototype.clearForm=function(e,t){var o=t||this,i=e.find(".embed-modal-form-control");o.parent.clearForm(e,o),i.each(function(){var e=$(this),t=e.data("editor");t?t.setContent(""):e.val(null)}),o.model=o.cleanModel()},e.prototype.populateFormWithModel=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e=$(this),o=e.attr("name"),i=t.model[o],a=e.data("editor");a?a.setContent(i):e.val(i)})},e.prototype.initModal=function(e,t){var i=this,a=$("#"+o),n=new MediumEditor(a[0],{placeholder:{text:"Type your text. Highlight words to trigger the styles editor"}});i.parent.initModal(e,t,i),a.data("editor",n)},e.prototype.parseForEditor=function(){var e=this,t=['<div class="custom-text">'+e.model.customText+"</div>"];return e.model.displayTitle&&t.unshift('<div class="display-title">'+e.model.displayTitle+"</div>"),'<div class="custom-text-embed entity-embed-secondary-toolbar-locator">'+t.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function t(e,t){var o={};return o}function o(e,t){e.$ui=e.$ui||{form:t};for(key in m)m.hasOwnProperty(key)&&(e.$ui[key]=$(m[key],t));return e.$ui}function i(e,t){function o(){r(e),n.resolve(),$(this).off("load",o)}var i,a=e.$ui,n=(new Image,$.Deferred());return a.imageEditorPreviewImage.on("load",o),t&&(e.model.upload=t),i=e.getImageUrl(),a.imageEditorPreview.css("background-image",'url("'+i+'")'),a.imageEditorPreviewImage.attr("src",i),n}function a(e,t){var o=(e.$ui,$.Deferred());return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(e.$el).done(function(){o.resolve()})}),o}function n(e){var t=e.$ui;e.model.upload=null,e.model.url_path=null,l(t.uploadFileInput)}function l(e){e.attr("type","").attr("type","file")}function r(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadImageBtn.hide(),t.imageEditorPreview.show(),t.editImageFileBtn.show(),t.undoUploadImageBtn.toggle(!!e.model.url_path&&!!e.model.upload),t.removeUploadImageBtn.toggle(!!e.model.url_path||!!e.model.upload)}function d(e){var t=e.$ui;t.imageEditorPreview.hide(),t.editImageFileBtn.hide(),t.removeUploadImageBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadImageBtn.toggle(!(!e.model.url_path&&!e.model.upload)),t.undoUploadImageBtn.toggle(!!e.staleModel&&!!e.staleModel.url_path&&!(e.model.url_path||e.model.upload))}function s(e){var t=this;t.parent.constructor(e,u,c,t)}var c="externalLink",m={imageEditor:".image_editor",imageEditorPreview:".image_editor-preview",imageEditorPreviewImage:".image_editor-preview_image",editImageFileBtn:".js-upload",cancelUploadImageBtn:".js-upload-cancel",removeUploadImageBtn:".js-upload-remove",undoUploadImageBtn:".js-upload-undo",uploadFileInputContainer:".image_editor-intro",uploadFileInput:".embed-modal-file-input",teaserTitleInput:".js-input-displayTitle"},u={viewPath:"modal_externalLink.html",displayName:"External Link",object_type:"external-link",validationOptions:{rules:{title:"required",url:"required",linkText:"required",teaser:{required:{depends:function(e){return!!$(m.teaserTitleInput,$(e).closest("form")).val()}}}},messages:{teaser:{required:"Teaser required when Teaser Title is set."}}},httpPaths:{uploadFile:"admin/embed/file-upload"}};s.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[c]=s,s.prototype.orderIndex=9,s.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null,object_type:u.object_type}},s.prototype.getImageUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):e(this.model.url_path)},s.prototype.initModal=function(e,t){var s,c=this;c.parent.initModal(e,t,c),s=o(c,e),s.editImageFileBtn.on("click","a",function(){s.uploadFileInput.click()}),s.cancelUploadImageBtn.on("click","a",function(){r(t.scope.currentEmbedType)}),s.removeUploadImageBtn.on("click","a",function(){n(t.scope.currentEmbedType),d(t.scope.currentEmbedType)}),s.undoUploadImageBtn.on("click","a",function(){t.scope.currentEmbedType.model;delete t.scope.currentEmbedType.model.upload,l(s.uploadFileInput),t.scope.currentEmbedType.model.url_path=t.scope.currentEmbedType.model.url_path||t.scope.currentEmbedType.staleModel.url_path,i(t.scope.currentEmbedType)}),s.uploadFileInput.on("change",function(e){var o=e.target.files[0];a(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),s.imageEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,i=$(this),n=e.originalEvent.dataTransfer.files;if(n&&n.length){if(o=n[0],-1===o.type.indexOf("image"))return;i.addClass("js-dropped"),setTimeout(function(){a(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){i.removeClass("js-dropped")},300)})},300)}})},s.prototype.saveEmbed=function(e){var t=this,o=t.model.upload,i=$.Deferred();delete t.model.upload;var a=t.parent.saveEmbed(e,t);return o?a.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path,i.resolve(e)}).fail(function(e,t,o){console.error(t,o),i.reject(t)}):a.then(function(e){i.resolve(e)}),i},s.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},s.prototype.getModelFromFile=function(e){var o=this,i=(o.$ui,$.Deferred());return e||(e=o.model.upload),EXIF.getData(e,function(){var a,n,l,r=this.iptcdata;n=t(r,this),o.getModelFromForm(o.$el),a=$.extend(!0,{},o.model);for(l in a)a.hasOwnProperty(l)&&null===a[l]&&delete a[l];o.model=$.extend(!0,{},n,a),o.model.upload=e,i.resolve(o.model)}),i},s.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.model.linkText=t.model.linkText||t.model.linkText,t.model.url=t.model.url||t.model.url,t.model.displayTitle=t.model.displayTitle||t.model.displayTitle,t.parent.populateFormWithModel(e,t),t.model.upload||t.model.url_path?i(t).done(function(){o.resolve()}):o.resolve(),o},s.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),o.imageEditorPreviewImage.removeAttr("src"),d(t)},s.prototype.parseForEditor=function(){var t=this,o=[],i=[],a=[];return t.model.url_path&&i.push('<div class="external_link-teaser-image"><img src="'+e(t.model.url_path)+'"></div>'),t.model.teaser&&(t.model.displayTitle&&a.push('<div class="external_link-teaser-title">'+t.model.displayTitle+"</div>"),a.push('<div class="external_link-teaser-teaser">'+t.model.teaser+"</div>"),i.push('<div class="external_link-teaser-text">'+a.join("")+"</div>")),i.length&&o.push('<div class="external_link-teaser">'+i.join("")+"</div>"),o.push('<a class="external_link-link" href="'+t.model.url+'">'+t.model.linkText+"</a>"),'<div class="external_link">'+o.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(){var e="fb-root",t="facebook-jssdk",o="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3",i=$("body"),a=$("#"+e),n=$("#"+t),l=$("script");a.length||(a=$("<div>").attr("id",e),i.prepend(a)),n.length||(n=$("<script>").attr("id",t).attr("src",o),l.eq(0).before(n))}function o(e){var t=($.Deferred(),"video"===n(e)?"https://www.facebook.com/plugins/video/oembed.json/":"https://www.facebook.com/plugins/post/oembed.json/"),o={timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:t,data:{url:e}};return $.ajax(o).done(function(e){console.log("facebookEmbed > getOembedData",e)})}function i(e){var t,o,i,a,l,r,d,s="video"===n(e.url),c=s?"blockquote":'a[href="'+e.url+'"]',m=s?'a[href="'+e.url+'"]':"blockquote",u=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),i=t.find(c),a=i.text().match(u)[0],r=e.title,r||(t=$("<div>").html(e.html),o=t.find(m),r=o.text()),d=r.split(" ").slice(0,10).join(" "),d!==r&&(d+="..."),l=[e.author_name,a,d].join(" - ")}function a(e){var t=$("<div>").html(e).find(".fb-post, .fb-video"),o=$("<div>").html(t);return o.html()}function n(e){return/\/video(?:s\/|\.php)/i.test(e)?"video":"post"}function l(e,t){e.$ui=e.$ui||{};for(var o in f)f.hasOwnProperty(o)&&(e.$ui[o]=$(f[o],t));return e.$ui}function r(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function d(e){var t=e.$ui;$("<div>").html(e.model.embedCode).find(".fb-post, .fb-video");t.previewPost.html(a(e.model.embedCode)),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),e.activateEmbed(),t.intro.hide(),t.cancelBtn.hide()}function s(e,t){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=i(t)),e.model.embedCode=t.html,e.model.oembed=t}function c(e){var t=/^(?:https:)?\/\/www\.facebook\.com\/(?:[^\/]+\/)?(?:activity|media|notes|permalink|photos?|posts|questions|videos?)/i;return t.test(e)}function m(e){var t=this;t.parent.constructor(e,p,u,t)}var u="facebook",p={viewPath:"modal_facebook.html",displayName:"Facebook",object_type:"facebook",actionToolbarLocatorClass:".fb-post, .fb-video",validationOptions:{rules:{title:"required",url:{required:!0,validFacebookUrl:!0}}}},f={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};m.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[u]=m,m.prototype.orderIndex=7,m.prototype.initModal=function(e,t){var o,i=this;i.parent.initModal(e,t,i),o=l(i,e),$.validator.addMethod("validFacebookUrl",function(e,t,o){var i=c(e);return this.optional(t)||i},"The URL must be to a valid Facebook post or video."),o.previewBtn.on("click",function(t){t.preventDefault(),i.getModelFromForm(e).done(function(){c(i.model.url)&&d(i)})}),o.editBtn.on("click",function(e){e.preventDefault(),r(i)}),o.cancelBtn.on("click",function(e){e.preventDefault(),d(i)}),o.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,i=e.originalEvent.dataTransfer.getData("text/plain"),a=e.originalEvent.dataTransfer.getData("text/html"),n=$(a),l=$("<div>");i?t=i:n.length&&(l.append(n),t=l.find("[href]").attr("href")),t&&c(t)&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},m.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:p.object_type}},m.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),r(t),t.$ui.previewPost.empty()},m.prototype.getModelFromForm=function(e){var t=this,i=$.Deferred();return t.parent.getModelFromForm(e.find("form").first(),t),o(t.model.url).done(function(e){s(t,e),t.model.object_id?i.resolve(t.model):EntityEmbed.apiService.get({path:t.options.httpPaths.getAll,data:{url:t.model.url,object_type:t.options.object_type}}).done(function(e){var o=e.response&&e.response.data||[];o.length&&o[0].url===t.model.url&&(t.model.object_id=o[0].object_id,t.model.title=o[0].title,t.$ui.titleInput.val(t.model.title))}).always(function(){i.resolve(t.model)})}).fail(function(){i.resolve(t.model)}),i},m.prototype.populateFormWithModel=function(e){function t(){i.model.object_id?d(i):r(i)}var i=this;i.$ui;i.parent.populateFormWithModel(e.find("form").first(),i),i.model.object_id&&!i.model.oembed?o(i.model.url).done(function(e){return s(i,e),i.saveEmbed()}).always(function(){t()}):t()},m.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed">'+a(e.model.embedCode)+"</div>"},m.prototype.activateEmbed=function(){e.FB?e.FB.XFBML.parse():t()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="iframe",o={viewPath:"modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required",height:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=11,e.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1,width:null,height:300,object_type:o.object_type}},e.prototype.parseForEditor=function(){var e=this.model.height,t=this.model.width||this.model.height,o=e/t*100,i=!!this.model.width,a=["<div",' class="iframe-embed'+(i?" iframe-embed-responsive":"")+'"',i?' style="padding-bottom: '+o+'%"':"",">",'<iframe src="'+this.model.url+'"',' frameborder="0"',' scrolling="'+this.model.allowsScroll+'"',' height="'+(this.model.height||300)+'"',' width="'+(this.model.width?this.model.width:"100%")+'"',"></iframe>","</div>"].join("");return i&&(a=['<div class="iframe-embed-responsive-wrapper" style="max-width:'+this.model.width+'px">',a,"</div>"].join("")),a}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={},i=[];return o.title=t.name,e.byline&&i.push(e.byline),e.credit&&i.push(e.credit),e.copyright&&i.push(e.copyright),o.credit=i.join(" / "),o.caption=e.caption&&e.caption.replace(/\s*\([^\)]+\)\s*$/,""),o.altText=e.headline,o}function t(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function o(e,t){e.$ui=e.$ui||{form:t};for(key in c)c.hasOwnProperty(key)&&(e.$ui[key]=$(c[key],t));return e.$ui}function i(e,t){function o(){n(e),l.resolve(),$(this).off("load",o)}var i,a=e.$ui,l=(new Image,$.Deferred());return a.imageEditorPreviewImage.on("load",o),t&&(e.model.upload=t),i=e.getImageUrl(),a.imageEditorPreview.css("background-image",'url("'+i+'")'),a.imageEditorPreviewImage.attr("src",i),l}function a(e,t){var o=e.$ui,i=$.Deferred();return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(o.form).done(function(){i.resolve()})}),i}function n(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadImageBtn.hide(),t.imageEditorPreview.show(),t.editImageFileBtn.show(),t.undoUploadImageBtn.toggle(!!e.model.url_path&&!!e.model.upload)}function l(e){var t=e.$ui;t.imageEditorPreview.hide(),t.editImageFileBtn.hide(),t.undoUploadImageBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadImageBtn.toggle(!(!e.model.url_path&&!e.model.upload))}function r(e,t){var o=this;o.parent.constructor(e,s,d,o),t&&o.getModelFromFile(t)}var d="image",s={viewPath:"modal_image.html",displayName:"Image",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"admin/image-license/list",uploadFile:"admin/embed/file-upload"}},c={imageEditorPreview:".image_editor-preview",imageEditorPreviewImage:".image_editor-preview_image",editImageFileBtn:".js-upload",cancelUploadImageBtn:".js-upload-cancel",undoUploadImageBtn:".js-upload-undo",uploadFileInputContainer:".image_editor-intro",uploadFileInput:".embed-modal-file-input",imageEditor:".image_editor"},m={ap:{claimData:function(e){var t=/(AP Images|Associated Press)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},getty:{claimData:function(e){var t=/(Getty ?Images)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},reuters:{claimData:function(e){return!!e.credit&&"reuters"===e.credit.toLowerCase()},getModelFromData:function(e,t){var o={},i=[];return e.byline&&i.push(e.byline.replace(/^\W*\u00A9\s*/,"")),e.copyright&&i.push(e.copyright),o.credit=i.length?i.join(" / "):void 0,o.caption=e.caption.replace(/\s+REUTERS\/.+$/gm,""),o}}};r.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[d]=r,r.prototype.orderIndex=1,r.prototype.imageEditorPreviewImageClass="image-preview",r.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null,object_type:s.object_type}},r.prototype.getImageUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):t(this.model.url_path)},r.prototype.loadLicenses=function(e){var t=this,o=e.find('[name="license"]');return o.children().length>1?void o.val(t.model.license):void EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(e){var i;if(e.response.data){if(o.children().length>1)return void o.val(t.model.license);t.licenses=e.response.data;for(var a=0;a<e.response.data.length;a++)i=$("<option>"),i.attr("value",e.response.data[a].license).text(e.response.data[a].title),o.append(i);o.val(t.model.license)}}).fail(function(e){console.log("failed to find load image license options")})},r.prototype.initModal=function(e,t){var l,r=this;r.parent.initModal(e,t,r),l=o(r,e),r.loadLicenses(e),l.editImageFileBtn.on("click","a",function(){l.uploadFileInput.click()}),l.cancelUploadImageBtn.on("click","a",function(){n(t.scope.currentEmbedType)}),l.undoUploadImageBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,l.uploadFileInput.val(""),i(t.scope.currentEmbedType)}),l.uploadFileInput.on("change",function(e){var o=e.target.files[0];a(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),l.imageEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,i=$(this),n=e.originalEvent.dataTransfer.files;if(n&&n.length){if(o=n[0],-1===o.type.indexOf("image"))return;i.addClass("js-dropped"),setTimeout(function(){a(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){i.removeClass("js-dropped")},300)})},300)}})},r.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),o.imageEditorPreviewImage.removeAttr("src"),l(t)},r.prototype.saveEmbed=function(e){var t=this,o=t.model.upload,i=$.Deferred();delete t.model.upload;var a=t.parent.saveEmbed(e,t);return o?a.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path,i.resolve(e)}).fail(function(e,t,o){console.error(t,o),i.reject(t)}):a.then(function(e){i.resolve(e)}),i},r.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},r.prototype.getModelFromFile=function(t){var o=this,i=(o.$ui,$.Deferred());return t||(t=o.model.upload),EXIF.getData(t,function(){var a,n,l,r,d,s=this.iptcdata;for(r in m)m.hasOwnProperty(r)&&(d=m[r],"function"==typeof d.claimData&&d.claimData(s)&&(l="function"==typeof d.getModelFromData?d.getModelFromData(s,this):{},l.license=r));n=e(s,this),o.$el&&o.getModelFromForm(o.$el),a=$.extend(!0,{},o.model);for(r in a)a.hasOwnProperty(r)&&null===a[r]&&delete a[r];o.model=$.extend(!0,{},n,l||{},a),o.model.upload=t,i.resolve(o.model)}),i},r.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.parent.populateFormWithModel(e,t),t.loadLicenses(e),t.model.upload||t.model.url_path?i(t).done(function(){o.resolve()}):o.resolve(),o},r.prototype.parseForEditor=function(){var e=this,o=['<img class="entity-embed-secondary-toolbar-locator" src="'+t(e.model.url_path)+'" />'];return e.model.caption&&o.push('<div class="images-embed-caption">'+e.model.caption+"</div>"),e.model.credit&&o.push('<div class="images-embed-credit">Credit: '+e.model.credit+"</div>"),'<div class="images-embed">'+o.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=($.Deferred(),{timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:"https://api.instagram.com/oembed",data:{url:e}});return $.ajax(t).done(function(t){return console.log("instagramEmbed > getOembedData",t),t.url=t.url||e,t})}function o(e){var t,o,i,a,n,l,r,d="time",s='a[href="'+e.url+'"]',c=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),i=t.find(d),a=i.text().match(c)[0],l=e.title,l||(o=t.find(s),l=o.text()),r=l.split(" ").slice(0,10).join(" "),r!==l&&(r+="..."),n=[e.author_name,a,r].join(" - ")}function i(e,t){e.$ui=e.$ui||{};for(var o in m)m.hasOwnProperty(o)&&(e.$ui[o]=$(m[o],t));return e.$ui}function a(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function n(e){var t=e.$ui;t.previewPost.html(e.model.embedCode),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),e.activateEmbed(),t.intro.hide(),t.cancelBtn.hide()}function l(e,t){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=o(t)),e.model.embedCode=t.html,e.model.oembed=t}function r(e){var t=/^(?:https?:)?\/\/(?:www\.)?(?:instagr\.am|instagram\.com)\/p\/([^\/]+)\/?/i;return t.test(e)}function d(e){var t=this;t.parent.constructor(e,c,s,t)}var s="instagram",c={viewPath:"modal_instagram.html",displayName:"Instagram",object_type:"instagram",actionToolbarLocatorClass:".instagram-media",validationOptions:{rules:{title:"required",url:{required:!0,validInstagramUrl:!0}}}},m={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[s]=d,d.prototype.orderIndex=8,d.prototype.initModal=function(e,t){var o,l=this;l.parent.initModal(e,t,l),o=i(l,e),$.validator.addMethod("validInstagramUrl",function(e,t,o){var i=r(e);return this.optional(t)||i},"The URL must be to a valid Facebook post or video."),o.previewBtn.on("click",function(e){e.preventDefault(),l.getModelFromForm(l.$el).done(function(){console.log("Instagram Embed Model:",l.model),r(l.model.url)&&n(l)})}),o.editBtn.on("click",function(e){e.preventDefault(),a(l)}),o.cancelBtn.on("click",function(e){e.preventDefault(),n(l)}),o.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,i=e.originalEvent.dataTransfer.getData("text/plain"),a=e.originalEvent.dataTransfer.getData("text/html"),n=$(a),l=$("<div>");i?t=i:n.length&&(l.append(n),t=l.find("[href]").attr("href")),console.log("dropped",t,i,a),t&&r(t)&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},d.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:c.object_type}},d.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),a(t),t.$ui.previewPost.empty()},d.prototype.getModelFromForm=function(e){var o=this,i=$.Deferred();return o.parent.getModelFromForm(e.find("form").first(),o),t(o.model.url).done(function(e){l(o,e),o.model.object_id?i.resolve(o.model):EntityEmbed.apiService.get({path:o.options.httpPaths.getAll,data:{url:o.model.url,object_type:o.options.object_type}}).done(function(e){var t=e.response&&e.response.data||[];t.length&&t[0].url===o.model.url&&(o.model.object_id=t[0].object_id,o.model.title=t[0].title,o.$ui.titleInput.val(o.model.title))}).always(function(){i.resolve(o.model)})}).fail(function(){i.resolve(o.model)}),i},d.prototype.populateFormWithModel=function(e){function o(){i.model.object_id?n(i):a(i)}var i=this;i.$ui;i.parent.populateFormWithModel(e.find("form").first(),i),i.model.object_id&&!i.model.oembed?t(i.model.url).done(function(e){return l(i,e),i.saveEmbed()}).always(function(){o()}):o()},d.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed">'+e.model.embedCode+"</div>"},d.prototype.activateEmbed=function(){e.instgrm&&e.instgrm.Embeds.process()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="newsletterSubscribe",o={viewPath:"modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",object_type:"newsletter",validationOptions:{rules:{title:"required",newsletter:"required"}},httpPaths:{getNewsletters:"admin/newsletter/list"}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=12,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletter:null,teaser:null,object_type:o.object_type}},e.prototype.initModal=function(e,t){var o=this,i="<option disabled selected>-- select a newsletter --</option>";o.parent.initModal(e,t,o),EntityEmbed.apiService.get({path:o.options.httpPaths.getNewsletters}).done(function(t){if(t.response.data){var o=[];o.push(i);for(var a=0;a<t.response.data.length;a++)o.push('<option value="'+t.response.data[a].newsletter_id+'" >'+t.response.data[a].title+"</option>");e.find('[name="newsletter"]').html(o)}}).fail(function(){console.log("failed to load newsletter subscription options")})},e.prototype.parseForEditor=function(){var e,t,o=this;return e=o.model.displayTitle?'<div class="display-title">'+o.model.displayTitle+"</div>":"",t=o.model.teaser?'<div class="teaser">'+o.model.teaser+"</div>":"",'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator">'+e+'<div class="subscribe-form">'+t+'<div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control subscribe-input"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}if(!EntityEmbed.embedTypes)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var t="relatedLink",o={viewPath:"modal_relatedLink.html",displayName:"Related Link",object_type:"related-link",validationOptions:{rules:{title:"required",linkInput:"atLeastOne"}},httpPaths:{getContentList:"admin/content/list",getContentItem:{story:"admin/story/fetch",episode:"admin/episode/fetch"}}},i="#related-link-list",a="#add-link-eac",n="drag-link-btn",l="related-link-placeholder",r="#related-links-progress",d="remove-link-btn",s="related-link-url",c=function(e,t){
var o=m(e),i=$(o);return i.data("link-data",e),i.find("."+d).on("click",function(){var e=$(this),t=e.closest("."+s);t.remove()}),i},m=function(e){return'<div class="'+s+'"><div class="related-link-control"><span class="'+n+'"><i class="fa fa-bars"></i></span></div><div class="related-link-title">'+e.title+'</div><div class="related-link-control"><button class="'+d+'"><i class="fa fa-minus"></i></button></div></div>'},u=function(e,t,o){var a=/^[^.]*staging[^.]*\.|\.dev$/,n=a.test(window.location.host),l={auth_token:EntityEmbed.apiService.getAuthToken()},r=o.find(e);n&&(l.debug=1);var d={ajaxSettings:{dataType:"json",method:"POST",data:l},requestDelay:600,url:function(e){return l.title=e,EntityEmbed.apiService.getDomainName()+t.options.httpPaths.getContentList},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},preparePostData:function(e){return e.title=r.val(),JSON.stringify(e)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var e,t=r.getSelectedItemData(),a=(t.object_id,o.find(i));t.object_id&&(e=c(t),a.append(e)),r.val("")}}};r.easyAutocomplete(d),r.closest(".easy-autocomplete").removeAttr("style")};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=10,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[],object_type:o.object_type}},e.prototype.initModal=function(e,t){var o=this,d=e.find(i),c=e.find(r);o.parent.initModal(e,t,o),c.parent().hide(),u(a,o,e),d.sortable({axis:"y",handle:"."+n,items:"."+s,placeholder:l,start:function(e,t){t.placeholder.height(t.helper.outerHeight())}}),$.validator.addMethod("atLeastOne",function(e,t){return $(".related-link-url").length>0},$.validator.format("One link is required."))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).empty()},e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),delete t.model.linkInput,t.model.links=[],e.find("."+s).each(function(){var e=$(this),o=e.data("link-data");t.model.links.push({object_id:o.object_id,object_type:o.object_type})})},e.prototype.populateFormWithModel=function(e){var t,o,a,n=this,l=e.find(i),d=e.find(r),s=[],m=[],u=0,p=0,f=0;if(n.parent.populateFormWithModel(e,n),n.model.links.length){for(d.width(0),d.parent().slideDown(0),t=0,o=n.model.links.length;o>t;t++)n.model.links[t]&&(u++,a=EntityEmbed.apiService.get({path:n.options.httpPaths.getContentItem[n.model.links[t].object_type],data:{object_id:n.model.links[t].object_id}}),a.done(function(e){return function(t){p++,f=p/u*100,d.css({width:f+"%"}),"OK"===t.status&&(m[e]=t.response)}}(t)),s.push(a));$.when.apply($,s).done(function(){var e,t,o;for(d.parent().delay(400).slideUp(500),t=0,o=m.length;o>t;t++)m[t]||m.splice(t,1);for(t=0,o=m.length;o>t;t++)e=c(m[t]),l.append(e),e.hide().delay(1e3).slideDown(150)})}},e.prototype.parseForEditor=function(){var e,t,o,i,a=this,n=[],l=[],r=[],d=["related_link",a.model.object_id,(new Date).getTime()].join("_");for(console.log(a.model.links),t=0,o=a.model.links.length;o>t;t++)i=EntityEmbed.apiService.get({path:a.options.httpPaths.getContentItem[a.model.links[t].object_type],data:{object_id:a.model.links[t].object_id}}),i.done(function(e){return function(t){"OK"===t.status&&(l[e]=t.response)}}(t)),n.push(i);return $.when.apply($,n).done(function(){var t,o,i=$("#"+d);for(a.model.displayTitle&&r.push(a.model.displayTitle+": "),t=0,o=l.length;o>t;t++)l[t]||l.splice(t,1);for(t=0,o=l.length;o>t;t++)e='<a href="'+l[t].url_path+'">'+l[t].title+"</a>",r.push(e);i.html(r.join(""))}),'<div id="'+d+'" class="relatedLink-embed"></div>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,o){var a=o.$ui;o.$currentSlide=e,a.slides.find("."+c).removeClass(c),e.addClass(c),a.slides.sortable("refresh"),t(o),i(o)}function t(e){var t,o=new EntityEmbed.embedTypes.image,i=e.$ui,a=e.$currentSlide.data("model"),n=a.creditLink?"a":"span",l=!!a.caption,r=!!a.credit,d=l||r;o.model=a,t=o.getImageUrl(),i.slideText.toggle(d),i.slideImage.css("background-image",'url("'+t+'")').find("img").attr("src",t),i.slideCaption.toggle(l).text(a.caption),i.slideCreditBlock.toggle(r),i.slideCredit.text(a.credit).hide().filter(n).show(),i.slideCreditBlock.find("a:visible").attr("href",a.creditLink)}function o(e){var t=e.$ui;t.intro.show(),t.editor.hide(),t.slides.empty(),t.slideImage.css("background-image","none").find("img").removeAttr("src"),t.slideText.hide(),t.slideCaption.empty(),t.slideCreditBlock.hide(),t.slideCredit.empty().filter("a").removeAttr("href")}function i(e){var t=e.$ui;t.intro.hide(),t.editor.show()}function a(e,t){e.$ui=e.$ui||{};for(var o in E)E.hasOwnProperty(o)&&(e.$ui[o]=$(E[o],t));return e.$ui}function n(e){var t=this;t.parent.constructor(e,r,l,t)}var l="slideshow",r={viewPath:"modal_slideshow.html",displayName:"Slideshow",object_type:"slideshow",validationOptions:{rules:{title:"required"}}},d={modalElId:"embed-modal-slideshow-image",embedTypes:{image:{}},modalOptions:{embedTypeStr:"image",bufferData:!0}},s="slideshow_editor-nav_item",c="active",m="slideshow_editor-nav_handle",u="slideshow_editor-nav_ind",p="fa-circle-o",f="fa-star",b="fa-star-o",v="fa-circle-o-notch fa-spin",h="fa-check",g="fa-exclamation",y="slideshow_editor-slide_placholder",E={addSlide:".js-add_slide",intro:".slideshow_intro",editor:".slideshow_editor",slideImage:".js-slide_image",slideCaption:".js-slide_caption",slideCreditBlock:".slideshow_editor-slide_credit-container",slideCredit:".js-slide_credit",slideText:".js-slide_text",slides:".js-slides",slideTemplate:".js-slide_template",removeSlide:".js-remove_slide",editSlide:".js-edit_slide",dropFiles:".slideshow_drop_files"};n.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=n,n.prototype.orderIndex=2,n.prototype.cleanModel=function(){return{title:null,displayTitle:null,images:[]}},n.prototype.initModal=function(n,l){var r,v=this;v.parent.initModal(n,l,v),v.model=v.cleanModel(),d.modalContainer=n,d.modalOptions.parentModal=l,r=a(v,n),r.slideTemplate.removeClass("js-slide_template").detach(),r.slideTemplate.on("click","a",function(){var t=$(this),o=t.closest("."+s);e(o,v)}),r.slides.sortable({axis:"x",handle:"."+m,placeholder:y}),r.addSlide.on("click",function(){delete d.modalOptions.id,delete d.modalOptions.embedData,$.embed_modal_open(d).done(function(t){var o=r.slideTemplate.clone(!0),a=t.data.object_id?p:f;o.data("model",t.data),o.find("."+u).addClass(a),r.slides.append(o),e(o,v),i(v)})}),r.editSlide.on("click",function(){var e=v.$ui.slides.find("."+c),o=e.data("model");v.$currentSlide=e,d.modalOptions.id=o.object_id,d.modalOptions.embedData=o,$.embed_modal_open(d).done(function(i){e.data("model",i.data),o.object_id&&e.find("."+u).removeClass(p).addClass(b),t(v)})}),r.removeSlide.on("click",function(){var t,i=v.$ui.slides.find("."+c),a=i.prev(),n=i.next();switch(i.remove(),!0){case!!n.length:t=n;break;case!!a.length:t=a}t?e(t,v):(v.$currentSlide=void 0,o(v))}),r.dropFiles.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(t){function o(t){var c,m=n.length-l.length;-1!==t.type.indexOf("image")&&(c=new EntityEmbed.embedTypes.image,c.getModelFromFile(t).done(function(t){delete d.modalOptions.id,d.modalOptions.headerText=["Add Image",m,"of",n.length].join(" "),d.modalOptions.embedData=t,$.embed_modal_open(d).done(function(e){var t=r.slideTemplate.clone(!0),o=e.data.object_id?p:f;t.data("model",e.data),t.find("."+u).addClass(o),s.push(t)}).always(function(){if(delete d.modalOptions.headerText,l.length)o(l.shift());else for(i=0,a=s.length;a>i;i++)r.slides.append(s[i]),0===i&&e(s[i],v)})}))}var i,a,n=t.originalEvent.dataTransfer.files,l=[],s=[];if(t.preventDefault(),n.length){for(i=0,a=n.length;a>i;i++)l[i]=n[i];o(l.shift())}})},n.prototype.saveEmbed=function(e){var t=this,o=[],i=new EntityEmbed.embedTypes.image,a=t.$ui.slides.children();return t.model.images=[],a.removeClass(c).each(function(e){var a,n=$(this),l=n.data("model"),r=!l.object_id;n.addClass("saving").find("."+u).removeClass([f,p].join(" ")).addClass(v),i.model=l,a=i.saveEmbed(r),a.done(function(e,o){return function(i){return"ERROR"==i.status?void console.log("failed to put/post a slideshow image"):(o.removeClass("saving").addClass("complete").find("."+u).removeClass(v).addClass(h),void(t.model.images[e]={object_id:i.response.object_id,order:e}))}}(e,n)).fail(function(e,t){return function(o,i,a){console.log("failed to save a slideshow image number "+e,a),t.removeClass("saving").addClass("error").find("."+u).removeClass(v).addClass(g)}}(e,n)),o.push(a)}),$.when.apply($,o).then(function(){return console.log("all images saved.",t.model.images),t.parent.saveEmbed(e,t)})},n.prototype.getModelFromForm=function(e){var t=this,o=t.$ui.slides.children();t.parent.getModelFromForm(e.find("form").first(),t),t.model.images=[],o.each(function(e){var o=$(this),i=o.data("model");t.model.images[e]={object_id:i.object_id,order:e}})},n.prototype.populateFormWithModel=function(t){var a=this,n=a.$ui,l=new EntityEmbed.embedTypes.image,r=[];if(a.parent.populateFormWithModel(t.find("form").first(),a),!a.model.images.length)return void o(a);a.model.images.sort(function(e,t){return!!e&&!!t&&e.order-t.order});for(var d=0;d<a.model.images.length;d++)if(a.model.images[d]){var s=EntityEmbed.apiService.get({path:l.options.httpPaths.get,data:{object_id:a.model.images[d].object_id}});s.done(function(e){return function(t){return"ERROR"===t.status||"string"==typeof t.response?void console.log("Could not load slideshow image number "+e.order,e,t):void $.extend(!0,e,t.response)}}(a.model.images[d])).fail(function(e){return function(t,o,i){console.log("Could not load slideshow image number "+e.order,e,i)}}(a.model.images[d])),r.push(s)}$.when.apply($,r).done(function(){var t,o,l,r;for(t=0,o=a.model.images.length;o>t;t++)l=n.slideTemplate.clone(!0),l.data("model",a.model.images[t]),n.slides.append(l),0===t&&(r=l);e(r,a),i(a)})},n.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),o(t)},n.prototype.parseForEditor=function(){var e,t,o,i=new EntityEmbed.embedTypes.image,a=this,n=["img",a.model.images[0].object_id,(new Date).getTime()].join("_"),l=['<img id="'+n+'" />'],r=[];for(EntityEmbed.apiService.get({path:i.options.httpPaths.get,data:{object_id:a.model.images[0].object_id}}).done(function(e){var t=e.response,o=$("#"+n),a=o.parent();i.model=t,o.attr("src",i.getImageUrl(t.url_path)),t.caption&&a.append('<div class="slideshow-embed-caption">'+t.caption+"</div>"),t.credit&&a.append('<div class="slideshow-embed-credit">Credit :'+t.credit+"</div>")}),e='<div class="slideshow-embed-slides"><div class="slideshow-embed-slide">'+l.join("")+"</div></div>",t=0,o=a.model.images.length;o>t;t++)r.push('<li class="slideshow-embed-dot"></li>');return'<div class="slideshow-embed">'+e+'<ul class="slideshow-embed-dots">'+r.join("")+"</ul></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=($.Deferred(),{timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:"https://api.twitter.com/1.1/statuses/oembed.json",data:{url:e}});return $.ajax(t).done(function(e){console.log("twitterEmbed > getOembedData",e)})}function t(e){var t,o,i,a,n,l,r,d='a[href="'+e.url+'"]',s="blockquote",c=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),i=t.find(d),a=i.text().match(c)[0],l=e.title,l||(o=t.find(s),l=o.text()),r=l.split(" ").slice(0,10).join(" "),r!==l&&(r+="..."),n=[e.author_name,a,r].join(" - ")}function o(e,t){e.$ui=e.$ui||{};for(var o in c)c.hasOwnProperty(o)&&(e.$ui[o]=$(c[o],t));return e.$ui}function i(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function a(e){var t=e.$ui;t.previewPost.html(e.model.embedCode),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),t.intro.hide(),t.cancelBtn.hide()}function n(e,o){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=t(o)),e.model.embedCode=o.html,e.model.oembed=o}function l(e){var t=/^(?:https:)?\/\/(?:www\.)?twitter\.com\/(?:[^\/]+\/)?(?:status)/i;return t.test(e)}function r(e){var t=this;t.parent.constructor(e,s,d,t)}var d="twitter",s={viewPath:"modal_twitter.html",displayName:"Twitter",object_type:"twitter",actionToolbarLocatorClass:".twitter-tweet",validationOptions:{rules:{title:"required",url:{required:!0,validTwitterUrl:!0}}}},c={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};r.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[d]=r,r.prototype.orderIndex=6,r.prototype.initModal=function(e,t){var n,r=this;r.parent.initModal(e,t,r),n=o(r,e),$.validator.addMethod("validTwitterUrl",function(e,t,o){var i=l(e);return this.optional(t)||i},"The URL must be to a valid Facebook post or video."),n.previewBtn.on("click",function(t){t.preventDefault(),r.getModelFromForm(e).done(function(){l(r.model.url)&&a(r)})}),n.editBtn.on("click",function(e){e.preventDefault(),i(r)}),n.cancelBtn.on("click",function(e){e.preventDefault(),a(r)}),n.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,o=e.originalEvent.dataTransfer.getData("text/plain"),i=e.originalEvent.dataTransfer.getData("text/html"),a=$(i),r=$("<div>");o?t=o:a.length&&(r.append(a),t=r.find("[href]").attr("href")),t&&l(t)&&(n.urlInput.val(t),n.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},r.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:s.object_type}},r.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),i(t),t.$ui.previewPost.empty()},r.prototype.getModelFromForm=function(t){var o=this,i=$.Deferred();return o.parent.getModelFromForm(t.find("form").first(),o),e(o.model.url).done(function(e){n(o,e),o.model.object_id?i.resolve(o.model):EntityEmbed.apiService.get({path:o.options.httpPaths.getAll,data:{url:o.model.url,object_type:o.options.object_type}}).done(function(e){var t=e.response&&e.response.data||[];t.length&&t[0].url===o.model.url&&(o.model.object_id=t[0].object_id,o.model.title=t[0].title,o.$ui.titleInput.val(o.model.title))}).always(function(){i.resolve(o.model)})}).fail(function(){i.resolve(o.model)}),i},r.prototype.populateFormWithModel=function(t){function o(){l.model.object_id?a(l):i(l)}var l=this;l.$ui;l.parent.populateFormWithModel(t.find("form").first(),l),l.model.object_id&&!l.model.oembed?e(l.model.url).done(function(e){return n(l,e),l.saveEmbed()}).always(function(){o()}):o()},r.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed">'+e.model.embedCode+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push([o,e[o]].join("="));return t.join("&")}function t(t){var o="";if(-1!==t.indexOf("vimeo.com")){var i="?"+e(u);o="//player.vimeo.com/video/"+p(t)+i}else if(-1!==t.indexOf("youtube.com")){var i="?"+e(m);o="//www.youtube.com/embed/"+f(t)+i}return o}function o(e){var t="";return-1!==e.indexOf("vimeo.com")?t="https://vimeo.com/"+p(e):-1!==e.indexOf("youtube.com")&&(t="https://www.youtube.com/watch?v="+f(e)),t}function i(e,t){e.$ui=e.$ui||{};for(var o in c)c.hasOwnProperty(o)&&(e.$ui[o]=$(c[o],t));return e.$ui}function a(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function n(e){var o=e.$ui,i=e.model.oembed.height/e.model.oembed.width*100,a=t(e.model.url);o.previewWrapper.css({paddingTop:i+"%"}),o.previewIframe.attr("src")!==a&&o.previewIframe.attr("src",a),o.previewTitle.text(e.model.title),o.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),o.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),o.editBtn.toggle(!!e.modalCtrl.isAdd),o.preview.show(),o.intro.hide(),o.cancelBtn.hide()}function l(e,t){e.model.title=t.title,e.model.embedCode=t.html,e.model.oembed=t}function r(e){var t=this;t.parent.constructor(e,s,d,t)}var d="video",s={viewPath:"modal_video.html",displayName:"Video",object_type:"video",validationOptions:{rules:{title:"required",url:{required:!0,validVideoDomain:!0}}}},c={intro:".video_editor-intro",previewBtn:".js-btn-preview",preview:".video_editor-preview",previewIframe:".js-preview-iframe",previewTitle:".video_editor-preview_title",previewAuthor:".video_editor-preview_author",previewProvider:".video_editor-preview_provider",previewWrapper:".js-preview-wrapper",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",videoDropTarget:".video_editor-intro_inner"},m={showinfo:0,modestbranding:1,rel:0},u={title:0,portrait:0,byline:0,color:"dc5555"},p=function(e){var t=e.indexOf("/")>-1?e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},f=function(e){var t=e.indexOf("/")>-1?e.indexOf("/watch")>-1?e.match(/v=([^&]+)(?:&|$)/i)[1]:e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},b=function(e){var t,o;$.Deferred();switch(!0){case-1!==e.indexOf("vimeo.com"):t="https://vimeo.com/api/oembed.json",o=$.extend(!0,{},u);break;case-1!==e.indexOf("youtube.com"):t="https://noembed.com/embed",o={}}o.url=e;var i={timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:t,data:o,success:function(e){console.log(e)}};return $.ajax(i)};r.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[d]=r,r.prototype.orderIndex=4,r.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,object_type:s.object_type}},r.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),a(t),o.previewIframe.removeAttr("src"),o.previewTitle.empty(),o.previewAuthor.removeAttr("href").empty(),o.previewProvider.removeAttr("href").empty()},r.prototype.initModal=function(e,t){var o,l=this;l.parent.initModal(e,t,l),o=i(l,e),$.validator.addMethod("validVideoDomain",function(e,t,o){var i=-1!=e.indexOf("youtube.com")||-1!=e.indexOf("vimeo.com");return this.optional(t)||i},"The video must be from YouTube or Vimeo"),o.previewBtn.on("click",function(t){t.preventDefault(),l.getModelFromForm(e).done(function(){n(l)})}),o.editBtn.on("click",function(e){e.preventDefault(),a(l)}),o.cancelBtn.on("click",function(e){e.preventDefault(),n(l)}),o.videoDropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,i=e.originalEvent.dataTransfer.getData("text/plain"),a=e.originalEvent.dataTransfer.getData("text/html"),n=$(a),l=$("<div>");i?t=i:n.length&&(l.append(n),t=l.find("[href]").attr("href")),t&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},r.prototype.parseForEditor=function(){var e=this;return'<div class="video-embed"><div class="video-embed-inner"><iframe src="'+t(e.model.url)+'"	frameborder="0"></iframe></div></div>'},r.prototype.getModelFromForm=function(e){var t=this,i=$.Deferred();return t.parent.getModelFromForm(e.find("form").first(),t),t.model.url=o(t.model.url),b(t.model.url).done(function(e){e.error?i.resolve(t.model):(l(t,e),t.model.object_id?i.resolve(t.model):EntityEmbed.apiService.get({path:t.options.httpPaths.getAll,data:{url:t.model.url,object_type:t.options.object_type}}).done(function(e){var o=e.response&&e.response.data||[];o.length&&o[0].url===t.model.url&&(t.model.object_id=o[0].object_id)}).always(function(){i.resolve(t.model)}))}),i},r.prototype.populateFormWithModel=function(e){function t(){o.model.object_id?n(o):a(o)}var o=this;o.$ui;o.parent.populateFormWithModel(e.find("form").first(),o),o.model.url&&!o.model.oembed?b(o.model.url).done(function(e){return e.error||(o.model.oembed=e,e.title===o.model.title)?void 0:(o.model.title=e.title,o.saveEmbed())}).always(function(){t()}):t()}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e,t){var o;o=t.id||t.embedData?EntityEmbed.embedModalTypes.edit:!t.embedTypeStr||"string"!=typeof t.embedTypeStr&&1!==t.embedTypeStr.length?t.selectExisting?EntityEmbed.embedModalTypes.selectExisting:EntityEmbed.embedModalTypes.add:t.selectExisting?EntityEmbed.embedModalTypes.selectExistingSingle:EntityEmbed.embedModalTypes.addSingle;var i={$currentEditorLocation:t.$currentEditorLocation,modalType:o,addOnly:t.addOnly,embedId:t.id,embedType:t.embedTypeStr,parentModal:t.parentModal,buffered:t.bufferData,embedData:t.embedData,headerText:t.headerText};return e.openModal(i)}$.embed_modal_create=function(e){function t(){var t;o.$embedTypeSelect&&o.$embedTypeSelect.length||(o.$embedTypeSelect=a.find(e.embedTypeSelect)),o.$modalBody&&o.$modalBody.length||(o.$modalBody=a.find(e.modalBody)),e.modalOptions.$abortEl&&e.modalOptions.$abortEl.length||(e.modalOptions.$abortEl=a.find(e.abortEl)),e.modalOptions.$completeEl&&e.modalOptions.$completeEl.length||(e.modalOptions.$completeEl=a.find(e.completeEl)),t=new EntityEmbed.embedModalDefaults,e.modalOptions=$.extend(!0,{},t,e.modalOptions),a.modal(e.modalOptions,o),a.hide(),c.resolve(a)}var o,i,a,n,l,r,d={modalOptions:{},modalScope:{$embedTypeSelect:null,$modalBody:null,$abortEl:null},$modalEl:null,modalHtmlLocation:"modal/",modalContainer:"body",modalFileName:"modal_main.html",modalElId:"embed-modal",modalBody:".embed-modal-body",abortEl:"#btn-abort-modal",completeEl:"#btn-save-modal",embedTypeSelect:"#select-embed-type",authToken:null,domainName:null,embedTypes:{image:{},slideshow:{},video:{},audio:{},audioProgram:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},newsletterSubscribe:{},iframe:{},customText:{}}},s=[],c=$.Deferred();if(l=$.extend(!0,{},d,e),l.modalOptions&&l.modalOptions.parentModal&&(r=l.modalOptions.parentModal.scope.currentEmbedType),l.embedTypes=!!e&&e.embedTypes,l.embedTypes||(l.embedTypes=d.embedTypes),r&&delete l.embedTypes[r.name],e=l,i=$(e.modalContainer),a=e.$modalEl&&e.$modalEl.length?e.$modalEl:i.find("#"+e.modalElId),a.length||(a=$('<div class="embed-modal" id="'+e.modalElId+'"></div>'),i.append(a)),o=a.data("scope"))return c.resolve(a),c;o={$modalEl:a};for(var m in EntityEmbed.embedTypes)if(e.embedTypes[m]){var u=new EntityEmbed.embedTypes[m](e.embedTypes[m]);s.push(u),e.modalOptions.embedTypeStr&&e.modalOptions.embedTypeStr===m&&(o.currentEmbedType=u)}return s.sort(function(e,t){return e.orderIndex-t.orderIndex}),o.embedTypes=s,o=$.extend(!0,{},e.modalScope,o),o.modalHtmlLocation=e.modalHtmlLocation,EntityEmbed.$embedModal=a,EntityEmbed.modalExists=!0,e.authToken&&EntityEmbed.apiService.setAuthToken(e.authToken),e.domainName&&EntityEmbed.apiService.setDomainName(e.domainName),e.modalFileName?(n=e.modalHtmlLocation+e.modalFileName,EntityEmbed.templateCache&&EntityEmbed.templateCache[n]?(a.html(EntityEmbed.templateCache[n]),t()):a.load(n,function(e,o,i){return console.log("embed modal load completed with status: "+o),"error"===o?void c.reject():(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[n]=$(this).html(),void t())})):t(),c},$.embed_modal_open=function(t){var o={$currentEditorLocation:$(""),embedTypeStr:null,id:null,selectExisting:!1,addOnly:!1,embedTypeSelectOptions:null},i=$.Deferred();return $.embed_modal_create(t).done(function(a){e(a,$.extend(!0,{},o,t.modalOptions||{})).done(function(e){i.resolve(e)}).fail(function(){i.reject()})}),i}}();var EntityEmbed=EntityEmbed||{};!function(e,t,o,i){"use strict";function a(e){var t,o,i="[[",a="]]";return o=[c,e.index,e.id].join(":"),t=[i,o,a].join("")}function n(t,o){var i=e.grep(o,function(e){return e.options.object_type==t})[0];return i&&e.extend(!0,{},i)}function l(){var e;return t.getSelection?e=t.getSelection():o.getSelection?e=o.getSelection():o.selection&&(e=o.selection.createRange()),e}function r(e,i){var a,n;e.focus(),"undefined"!=typeof t.getSelection&&"undefined"!=typeof o.createRange?(a=o.createRange(),n=t.getSelection(),a.selectNodeContents(e),a.collapse(i),n.removeAllRanges(),n.addRange(a)):"undefined"!=typeof o.body.createTextRange&&(a=o.body.createTextRange(),a.moveToElementText(e),a.collapse(i),a.select())}function d(o,a){var n=this;n.el=o,n.$el=e(o),n.templates=t.MediumInsert.Templates,n.core=n.$el.data("plugin_"+s),n.options=e.extend(!0,{},b,a),n._defaults=b,n._name=s,n.$el.attr("readonly")!==i&&(n.options.readonly=!0),n.toolbarManager=new EntityEmbed.toolbarManager(n,n.options.styles,n.options.actions,m),n.core.getEditor()&&(n.core.getEditor().get_content=function(){return n.getContent()},n.core.getEditor().load_content=function(e){n.loadContent(e)}),n.init()}var s="mediumInsert",c="EntityEmbeds",m="entity-embed-active",u="entity-embed-",p=".medium-insert-active",m="entity-embed-active",f="entity-embed-container",b={label:'<span class="fa fa-code"></span>',authToken:null,domainName:null,styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}},newline:{label:'<span class="fa fa-i-cursor"></span>',clicked:function(e,t){e.addNewline(t)}}}};d.prototype.init=function(){var o=this;o.options.authToken&&EntityEmbed.apiService.setAuthToken(o.options.authToken),o.options.domainName&&EntityEmbed.apiService.setDomainName(o.options.domainName),o.toolbarManager.createActionToolbar(e("body")),o.options.readonly?(o.core.getEditor().stopSelectionUpdates(),o.$el.attr("contenteditable",!1).attr("readonly","")):o.$el.sortable({handle:".entity-embed-blocker",placeholder:"entity-embed-placeholder",distance:5,start:function(e,t){var i=[t.placeholder.attr("class"),t.helper.attr("class")].join(" ");t.placeholder.attr("class",i),t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.width()),o.toolbarManager.hideToolbar()},stop:function(e,i){i.item.height(i.placeholder.height()),o.renderEmbed(i.item,!0),o.core.triggerInput(),t.setTimeout(function(){i.item.removeAttr("style")},2e3)},change:function(){o.core.positionButtons(),o.core.getEditor().checkSelection()}}),o.events(),e.embed_modal_create().done(function(t){var i=t.data("scope");o.$embedModal=t,o.embedTypes=i.embedTypes;for(var a=0,n=o.embedTypes.length;n>a;a++)o.toolbarManager.createStyleToolbar(e("body"),o.embedTypes[a])})},d.prototype.events=function(){function i(e){var t=e.parent();return t[0]!==a.el?i(t):e}var a=this,n=n=a.core.getEditor();n.subscribe("editableInput",function(t,o){var i=["p > ol","p > ul","p > p","p > div"].join(","),a=["li > span[style]"].join(","),l="<p><br></p>",r=e(o),d=r.find(i),s=r.find(a);d.each(function(){var t=e(this);t.unwrap(),n.selectElement(this)}),s.removeAttr("style"),r.find("div > br:only-child").parent().replaceWith(l),r.children().not(".medium-insert-buttons").length||r.prepend(l)}),e(t).on("resize",function(){var t=e("."+m);t.length&&a.toolbarManager.positionToolbars(t)}),e(o).on("click",function(t){e(t.target).is(".medium-editor-action")||e(t.target.parentElement).is(".medium-editor-action")||0==a.$el.find("."+m).length||(e("."+m).removeClass(m),a.toolbarManager.hideToolbar())}),a.$el.on("click","."+f,function(t){a.options.readonly||a.toggleSelectEmbed(e(this)),t.stopPropagation()}).on("keydown",function(t){var o,d,s,c,m,u,p,b,v,h,g=[".entity-embed-container","[contenteditable]"].join(","),y=":not("+g+")";8!==t.which&&46!==t.which||(o=l(),o.rangeCount&&(d=o.getRangeAt(0),c=d.endOffset-d.startOffset,b=e(o.anchorNode),s=b.text().length,m=a.$el.children().not(".medium-insert-buttons").length,u=!1,p=!1,c>0||(3===b[0].nodeType&&(b=b.closest(y)),b=i(b),u=b.is(y)&&!b.text().length,8===t.which&&0===o.anchorOffset?v=b.prev():46===t.which&&o.anchorOffset===s&&(v=b.next()),v&&(p=v.is("."+f),v.children().length||v.text().length||v.append("<br>")),(u&&1>=m||p)&&t.preventDefault(),u&&m>1&&(t.preventDefault(),8===t.which?h=b.prevAll(y).first():46===t.which&&(h=b.nextAll(y).first()),h.children().length||h.text().length||h.append("<br>"),n.selectElement(h[0]),r(h[0],46===t.which),n.checkSelection(),b.remove(),a.core.triggerInput()))))}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=a.$el.find("."+m).length&&a.toolbarManager.hideToolbar()})},d.prototype.getCore=function(){return this.core},d.prototype.getContent=function(){var t=this,o=t.core.getEditor().serialize(),i={html:"",embeds:[]};return e.each(o,function(t){var n,l;n=e("<div />").html(o[t].value),l=n.find(".entity-embed-container",n),l.removeClass(m),l.each(function(t){var o,n,l,r;o=e(this),n=o.find("figure"),n?(l={index:t,id:n.attr("id"),type:n.attr("data-embed-type")},i.embeds.push(l),r=a(l),o.html(r)):o.remove()}),i.html+=n.html()}),i},d.prototype.loadContent=function(t){function o(t){var o;if(!t)return void i();if(l=t.html||"",!t.embeds)return void i();d=[],o=[];for(var c=0;c<t.embeds.length;c++)if(r=n(t.embeds[c].type,s.embedTypes)){r.model=r.cleanModel(),t.embeds[c].embedType=r;var m=EntityEmbed.apiService.get({path:t.embeds[c].embedType.options.httpPaths.get,data:{object_id:t.embeds[c].id}});m.done(function(e){return function(t){var o,i;return"ERROR"===t.status?(console.log("failed to get embed object!"),t):(e.embedType.model=t.response,d.push(e),i=a(e),o=s.generateEmbedHtml(e.embedType),void(l=l.split(i).join(o)))}}(t.embeds[c])),o.push(m)}e.when.apply(e,o).done(function(){var e,t,o,a={};i();for(var n=0;n<d.length;n++)e=d[n],a[e.id]||(a[e.id]=!0,t=s.$el.find('[id="'+e.id+'"]'),o=t.html(),t.html(o),s.addEmbed(t,e.embedType,!0))})}function i(){s.core.getEditor().setContent(l),s.options.readonly||s.$el.sortable("refresh")}var l,r,d,s=this,c="string"==typeof t,m=c&&/<[^>]>/g.test(t);return t?(l=c?m?t:"":t.html,void(c&&!m?EntityEmbed.apiService.get({path:"admin/embed/edit",data:{object_id:t}}).done(function(e){return"ERROR"===e.status?void console.log("Failed to get story with id "+t):void o(e.repsonse)}).fail(function(e){console.log("Failed to get story with id "+t)}):o(t))):void console.log("Must provide either story id or serialized story data.")},d.prototype.add=function(){var t=this,o={modalOptions:{}};e.embed_modal_open(o).done(function(e){t.addEmbed(null,e.embedType)})},d.prototype.editEmbed=function(t){var o=this,i=t.find("figure"),a=i.data("embed"),n={modalOptions:{id:a.model.object_id,embedTypeStr:t.find("[data-embed-type]").attr("data-embed-type")}};o.toolbarManager.hideToolbar(),e.embed_modal_open(n).done(function(t){var i=e.extend(!0,{},t.embedType),a=e("[id="+i.model.object_id+"]",o.$el);a.each(function(){var t=e(this);t.data("embed",i),o.renderEmbed(t.closest("."+f))}),o.activateEmbed(i),o.core.triggerInput()})},d.prototype.renderEmbed=function(t,o){var i=this,a=t.find("> figure"),n=a.data("embed"),l=i.generateEmbedHtml(n),r=e(l);t.addClass(u+n.options.object_type),a.html(r.html()),o&&i.activateEmbed(n)},d.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove(),t.core.triggerInput()},d.prototype.addNewline=function(e){
var t=this,o="<p><br></p>";e.before(o),e.after(o),t.toolbarManager.positionToolbars(e)},d.prototype.toggleSelectEmbed=function(t){var o=this,i=e("."+m),a=t.find("[data-embed-type]").attr("data-embed-type"),l=n(a,o.embedTypes);o.toolbarManager.hideToolbar(),i.toggleClass(m),t.toggleClass(m),o.options.actions&&(t.hasClass(m)?o.toolbarManager.showToolbars(t,l.name):o.toolbarManager.hideToolbar())},d.prototype.generateEmbedHtml=function(t){var o=e("<div>").html(t.parseForEditor());o.children().first().addClass("entity-embed");var i='<figure contenteditable="false" id="'+t.model.object_id+'" data-embed-type="'+t.options.object_type+'" >'+o.html()+'<div class="entity-embed-blocker"></div></figure>';return i},d.prototype.addEmbed=function(t,o,i){var a,n,l=this,r=o.defaultStyle.replace("entity-embed-","");t||(n=e(p,l.$el),t=e("<div>").addClass(f),t.html(l.generateEmbedHtml(o)),n.replaceWith(t)),t.is("figure")&&(t=t.closest("."+f)),t.addClass(u+o.options.object_type),l.toolbarManager.addStyle(t,o.defaultStyle,r,!1),a=t.find("figure"),a.data("embed",e.extend(!0,{},o)),l.renderEmbed(t,!0),l.options.readonly||l.$el.sortable("refresh"),l.core.hideButtons(),i||l.core.triggerInput()},d.prototype.activateEmbed=function(e){var t=e.embedType||e;"function"==typeof t.activateEmbed&&t.activateEmbed()},e.fn[s+c]=function(t){return this.each(function(){e.data(this,"plugin_"+s+c)||e.data(this,"plugin_"+s+c,new d(this,t))})}}(jQuery,window,document);var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),o>t?-1:t>o?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,i=e.categories.length;i>o;o+=1){var a=e.categories[o];for(var n in r.categories[0])void 0===a[n]&&(a[n]=r.categories[0][n]);t.push(a)}e.categories=t}}function o(){function t(e,o){var i=e||{};for(var a in e)void 0!==o[a]&&null!==o[a]&&("object"!=typeof o[a]||o[a]instanceof Array?i[a]=o[a]:t(e[a],o[a]));return void 0!==o.data&&null!==o.data&&"object"==typeof o.data&&(i.data=o.data),i}r=t(r,e)}function i(){if("list-required"!==r.url&&"function"!=typeof r.url){var t=r.url;r.url=function(){return t}}if(void 0!==r.ajaxSettings.url&&"function"!=typeof r.ajaxSettings.url){var t=r.ajaxSettings.url;r.ajaxSettings.url=function(){return t}}if("string"==typeof r.listLocation){var o=r.listLocation;"XML"===r.dataType.toUpperCase()?r.listLocation=function(e){return $(e).find(o)}:r.listLocation=function(e){return e[o]}}if("string"==typeof r.getValue){var i=r.getValue;r.getValue=function(e){return e[i]}}void 0!==e.categories&&(r.categoriesAssigned=!0)}function a(){void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?r.ajaxSettings=e.ajaxSettings:r.ajaxSettings={}}function n(e){return void 0!==r[e]&&null!==r[e]}function l(e,t){function o(t,i){for(var a in i)void 0===t[a]&&e.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"==typeof t[a]&&-1===$.inArray(a,d)&&o(t[a],i[a])}o(r,t)}var r={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=r.getValue(e),t=r.getValue(t),t>e?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e,t){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},d=["ajaxSettings","template"];this.get=function(e){return r[e]},this.equals=function(e,t){return!(!n(e)||r[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==r.url||"list-required"!==r.data},this.checkRequiredProperties=function(){for(var e in r)if("required"===r[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){l(e,t)},t(),o(),r.loggerEnabled===!0&&l(console,e),a(),i()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function o(t,o){function i(){var i,a={};return void 0!==t.xmlElementName&&(a.xmlElementName=t.xmlElementName),void 0!==t.listLocation?i=t.listLocation:void 0!==e.get("listLocation")&&(i=e.get("listLocation")),void 0!==i?"string"==typeof i?a.data=$(o).find(i):"function"==typeof i&&(a.data=i(o)):a.data=o,a}function a(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=o[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(o)):e.data=o,e}var n={};if(n="XML"===e.get("dataType").toUpperCase()?i():a(),void 0!==t.header&&(n.header=t.header),void 0!==t.maxNumberOfElements&&(n.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(n.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var l=t.getValue;n.getValue=function(e){return e[l]}}else"function"==typeof t.getValue&&(n.getValue=t.getValue);else n.getValue=e.get("getValue");return n}function i(t){var o=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){o.push(this)}),o}this.init=function(t){var o=[],i={};return i.data=e.get("listLocation")(t),i.getValue=e.get("getValue"),i.maxListSize=e.get("list").maxNumberOfElements,o.push(i),o},this.updateCategories=function(t,i){if(e.get("categoriesAssigned")){t=[];for(var a=0;a<e.get("categories").length;a+=1){var n=o(e.get("categories")[a],i);t.push(n)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var o=0;o<t.length;o+=1)t[o].data=i(t[o]);return t},this.processData=function(o,i){for(var a=0,n=o.length;n>a;a+=1)o[a].data=t(e,o[a],i);return o},this.checkIfDataExists=function(e){for(var t=0,o=e.length;o>t;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(t,o,i){function a(e,o){var i=[],a="";if(t.get("list").match.enabled)for(var l=0,r=e.length;r>l;l+=1)a=t.get("getValue")(e[l]),n(a,o)&&i.push(e[l]);else i=e;return i}function n(e,o){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),o=o.toLowerCase()),!!t.get("list").match.method(e,o)}function l(e){return void 0!==o.maxNumberOfElements&&e.length>o.maxNumberOfElements&&(e=e.slice(0,o.maxNumberOfElements)),e}function r(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}e.proccess.match=n;var d=o.data,s=i;return d=a(d,s),d=l(d),d=r(d)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},o=function(e){var o,i=e.fields;return"description"===e.type?(o=t.description.method,"string"==typeof i.description?o=function(e,t){return e+" - <span>"+t[i.description]+"</span>"}:"function"==typeof i.description&&(o=function(e,t){return e+" - <span>"+i.description(t)+"</span>"}),o):"iconRight"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return e+"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"}:"function"==typeof i.iconSrc&&(o=function(e,t){return e+"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"}),o):"iconLeft"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"+e}:"function"==typeof i.iconSrc&&(o=function(e,t){return"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"+e}),o):"links"===e.type?("string"==typeof i.link?o=function(e,t){return"<a href='"+t[i.link]+"' >"+e+"</a>"}:"function"==typeof i.link&&(o=function(e,t){return"<a href='"+i.link(t)+"' >"+e+"</a>"}),o):"custom"===e.type?e.method:t.basic.method},i=function(e){return e&&e.type&&e.type&&t[e.type]?o(e):t.basic.method},a=function(e){var o=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var o=t[e.type].cssClass;return function(){return o}}():o};this.getTemplateClass=a(e),this.build=i(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,o){function i(){return 0===y.length?void b.error("Input field doesn't exist."):f.checkDataUrlProperties()?f.checkRequiredProperties()?(a(),void l()):void b.error("Will not work without mentioned properties."):void b.error("One of options variables 'data' or 'url' must be defined.")}function a(){function e(){var e=$("<div>"),o=p.getValue("WRAPPER_CSS_CLASS");f.get("theme")&&""!==f.get("theme")&&(o+=" eac-"+f.get("theme")),f.get("cssClasses")&&""!==f.get("cssClasses")&&(o+=" "+f.get("cssClasses")),""!==v.getTemplateClass()&&(o+=" "+v.getTemplateClass()),e.addClass(o),y.wrap(e),f.get("adjustWidth")===!0&&t()}function t(){var e=y.outerWidth();y.parent().css("width",e)}function o(){y.unwrap()}function i(){var e=$("<div>").addClass(p.getValue("CONTAINER_CLASS"));e.attr("id",n()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(f.get("list").showAnimation.type){case"slide":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").slideDown(t,o);break;case"fade":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").fadeIn(t),o;break;default:e.find("ul").show()}f.get("list").onShowListEvent()}).on("hide.eac",function(){switch(f.get("list").hideAnimation.type){case"slide":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").slideUp(t,o);break;case"fade":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,o);break;default:e.find("ul").hide()}f.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(w).addClass("selected"),f.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,o,i){var a="",n=e.find("ul");n.empty().detach(),_=[];for(var r=0,d=0,c=o.length;c>d;d+=1){var m=o[d].data;if(0!==m.length){void 0!==o[d].header&&o[d].header.length>0&&n.append("<div class='eac-category' >"+o[d].header+"</div>");for(var u=0,p=m.length;p>u&&r<o[d].maxListSize;u+=1)a=$("<li><div class='eac-item'></div></li>"),function(){var e=u,t=r,n=o[d].getValue(m[e]);a.find(" > div").on("click",function(){y.val(n).trigger("change"),w=t,s(t),f.get("list").onClickEvent(),f.get("list").onChooseEvent()}).mouseover(function(){w=t,s(t),f.get("list").onMouseOverEvent()}).mouseout(function(){f.get("list").onMouseOutEvent()}).html(v.build(l(n,i),m[e]))}(),n.append(a),_.push(m[u]),r+=1}}e.append(n),f.get("list").onLoadEvent()})}(),y.after(e)}function a(){y.next("."+p.getValue("CONTAINER_CLASS")).remove()}function l(e,t){return f.get("highlightPhrase")&&""!==t?d(e,t):e}function r(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function d(e,t){var o=r(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}y.parent().hasClass(p.getValue("WRAPPER_CSS_CLASS"))&&(a(),o()),e(),i(),E=$("#"+n()),f.get("placeholder")&&y.attr("placeholder",f.get("placeholder"))}function n(){var e=y.attr("id");return e=p.getValue("CONTAINER_ID")+e}function l(){function e(){g("autocompleteOff",!0)&&p(),t(),o(),i(),a(),n(),l()}function t(){y.focusout(function(){var e,t=y.val();f.get("list").match.caseSensitive||(t=t.toLowerCase());for(var o=0,i=_.length;i>o;o+=1)if(e=f.get("getValue")(_[o]),f.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return w=o,void s(w)})}function o(){y.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=f.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];return e}function o(e,t){return f.get("matchResponseProperty")!==!1?"string"==typeof f.get("matchResponseProperty")?t[f.get("matchResponseProperty")]===e:"function"==typeof f.get("matchResponseProperty")?f.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<f.get("minCharNumber"))){if("list-required"!==f.get("data")){var i=f.get("data"),a=h.init(i);a=h.updateCategories(a,i),a=h.processData(a,e),c(a,e),y.parent().find("li").length>0?r():d()}var n=t();void 0!==n.url&&""!==n.url||(n.url=f.get("url")),void 0!==n.dataType&&""!==n.dataType||(n.dataType=f.get("dataType")),void 0!==n.url&&"list-required"!==n.url&&(n.url=n.url(e),n.data=f.get("preparePostData")(n.data,e),$.ajax(n).done(function(t){var i=h.init(t);i=h.updateCategories(i,t),i=h.convertXml(i),o(e,t)&&(i=h.processData(i,e),c(i,e)),h.checkIfDataExists(i)&&y.parent().find("li").length>0?r():d(),f.get("ajaxCallback")()}).fail(function(){b.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:d(),m();break;case 38:e.preventDefault(),_.length>0&&w>0&&(w-=1,y.val(f.get("getValue")(_[w])),s(w));break;case 40:e.preventDefault(),_.length>0&&w<_.length-1&&(w+=1,y.val(f.get("getValue")(_[w])),s(w));break;default:if(e.keyCode>40||8===e.keyCode){var o=y.val();f.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?f.get("requestDelay")>0?(void 0!==u&&clearTimeout(u),u=setTimeout(function(){t(o)},f.get("requestDelay"))):t(o):d()}}})}function i(){y.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&w>-1&&(y.val(f.get("getValue")(_[w])),f.get("list").onKeyEnterEvent(),f.get("list").onChooseEvent(),w=-1,d(),e.preventDefault())})}function a(){y.off("keypress")}function n(){y.focus(function(){""!==y.val()&&_.length>0&&(w=-1,r())})}function l(){y.blur(function(){setTimeout(function(){w=-1,d()},250)})}function p(){y.attr("autocomplete","off")}e()}function r(){E.trigger("show.eac")}function d(){E.trigger("hide.eac")}function s(e){E.trigger("selectElement.eac",e)}function c(e,t){E.trigger("loadElements.eac",[e,t])}function m(){y.trigger("blur")}var u,p=new e.Constans,f=new e.Configuration(o),b=new e.Logger,v=new e.Template(o.template),h=new e.ListBuilderService(f,e.proccess),g=f.equals,y=t,E="",_=[],w=-1;e.consts=p,this.getConstants=function(){return p},this.getConfiguration=function(){return f},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return w},this.getItems=function(){return _},this.getItemData=function(e){return _.length<e||void 0===_[e]?-1:_[e]},this.getSelectedItemData=function(){return this.getItemData(w)},this.build=function(){a()},this.init=function(){i()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e.setHandle=function(t,o){e.eacHandles[o]=t},e}(EasyAutocomplete||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each(function(){var o=e(this),i=new EasyAutocomplete.main(o,t);EasyAutocomplete.inputHasId(o)||EasyAutocomplete.assignRandomId(o),i.init(),EasyAutocomplete.setHandle(i,o.attr("id"))})},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var o=e(this).attr("id");return void 0!==o&&t>-1?EasyAutocomplete.getHandle(o).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery);