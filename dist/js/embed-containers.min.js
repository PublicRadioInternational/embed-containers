!function(){EntityEmbed=EntityEmbed||{};var e={};e.modal="null",e["modal/modal_audio.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">MP3 File</label><input class="embed-modal-input embed-modal-file-input" type="file" name="upload"> <span class="fa fa-times cancel-upload-file-btn"></span> <span class="fa fa-cog edit-chosen-file-btn"></span> <span class="uploaded-audio-file"></span></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div id="audio-credits" class="embed-modal-form"><div class="embed-modal-half-column"><label for="credit" class="embed-modal-label">Credit</label><input id="credit" class="embed-modal-form-control embed-modal-input" type="text" name="credit"></div><div class="embed-modal-half-column"><label for="creditLink" class="embed-modal-label">Credit Link</label><input id="creditLink" class="embed-modal-form-control embed-modal-input" type="url" name="creditLink"></div></div></div></form>',e["modal/modal_confirmation.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header"><h3>Are you sure you want to leave?</h3></div><div class="embed-modal-body"><h4>All your changes will be lost if you leave this window!</h4></div><div class="embed-modal-footer"><button id="btn-confirm-leave">Yes - Leave</button> <button id="btn-cancel-leave">No - Stay</button></div></div></div>',e["modal/modal_customText.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="control-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control embed-modal-input"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="control-label" for="customText">Text</label><div name="customText" type="text" placeholder="Type your text. Highlight words to trigger the styles editor" class="embed-modal-form-control" id="custom-text-editor"></div></div></div></div></form>',e["modal/modal_externalLink.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">Image Thumbnail File</label><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"> <span class="fa fa-times cancel-upload-image-btn"></span> <span class="fa fa-cog edit-chosen-file-btn"></span><div class="uploaded-image-file"></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="linkText">External Link Text</label><input name="linkText" type="text" placeholder="Enter link text" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">External Link Url</label><input name="url" type="url" placeholder="Enter URL" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="3" class="embed-modal-form-control"></textarea></div></div></div></form>',e["modal/modal_facebook.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form has-error"><label class="embed-modal-label" for="url">Facebook Status</label><input name="url" type="url" placeholder="Enter URL to status" class="embed-modal-form-control"></div></div></div></form>',e["modal/modal_globalBuzz.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="quote">Quote</label><textarea name="quote" type="text" placeholder="Enter quote" rows="5" class="embed-modal-form-control"></textarea></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label clas="embed-modal-label" for="quoteText">Quote Url Text</label><input name="quoteUrlText" type="text" placeholder="Enter URL label" class="embed-modal-form-control"></div><div class="embed-modal-form"><label clas="embed-modal-label" for="quoteUrl">Quote Url</label><input name="quoteUrl" type="url" placeholder="Enter URL" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="credit">Credit</label><input name="credit" type="text" placeholder="Attribute the source" class="embed-modal-form-control"></div></div></div></form>',e["modal/modal_iframe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Source</label><input name="url" type="url" placeholder="Enter URL or iframe source code" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Height</label><div class="embed-modal-input-group"><input name="height" type="number" placeholder="" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Width</label><div class="embed-modal-input-group"><input name="width" type="number" placeholder="Full Width" class="embed-modal-form-control"> <span class="embed-modal-input-group-addon">px</span></div></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="allowsScroll">Scroll</label><select name="allowsScroll" class="embed-modal-form-control"><option>No</option><option>Yes</option></select></div></div></div></form>',e["modal/modal_image.html"]='<form method="post" enctype="multipart/form-data"><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="upload">Image File</label><div class="image_editor"><div class="image_editor-intro"><div class="image_editor-intro_inner"><input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*"></div></div><div class="image_editor-preview"><img class="image_editor-preview_image"></div><div class="image_editor-toolbar"><ul class="image_editor-toolbar_list"><li class="image_editor-toolbar_item js-upload"><a class="image_editor-tollbar_btn"><span class="fa fa-upload" aria-label="Select Another Image"></span></a></li><li class="image_editor-toolbar_item js-upload-undo"><a class="image_editor-tollbar_btn"><span class="fa fa-undo" aria-label="Revert Selected Image"></span></a></li><li class="image_editor-toolbar_item js-upload-cancel"><a class="image_editor-tollbar_btn"><span class="fa fa-arrow-left" aria-label="Cancel Image Select"></span></a></li></ul></div></div></div><div class="embed-modal-form"><label for="title" class="embed-modal-label">Title</label><input class="embed-modal-input embed-modal-form-control" type="text" name="title"></div><div class="embed-modal-form"><label for="altText" class="embed-modal-label">Alt Text</label><input class="embed-modal-input embed-modal-form-control" type="text" name="altText"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="caption" class="embed-modal-label">Caption</label><textarea class="embed-modal-input embed-modal-form-control" name="caption" rows="5"></textarea></div><div class="embed-modal-form"><label for="credit" class="embed-modal-label">Credit</label><input class="embed-modal-input embed-modal-form-control" type="text" name="credit"></div><div class="embed-modal-form"><label for="creditLink" class="embed-modal-label">Credit Link</label><input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink"></div><div class="embed-modal-form"><label for="license" class="embed-modal-label">License</label><select class="embed-modal-form-control" type="text" name="license"><option value="" disabled="disabled" selected="selected">-- Select A License --</option></select></div></div><!-- <div class="embed-modal-full-column">\r\n			<label class="embed-modal-label" for="upload">Image File</label>\r\n			<input class="embed-modal-input embed-modal-file-input" type="file" name="upload" accept="image/*" />\r\n			<span class="fa fa-times cancel-upload-image-btn"></span>\r\n			<span class="fa fa-cog edit-chosen-file-btn"></span>\r\n			<div class="uploaded-image-file">\r\n				<img class="image-preview">\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="title" class="embed-modal-label">Title</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="title" />\r\n			</div>\r\n		</div>\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="altText" class="embed-modal-label">Alt Text</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="altText" />\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-form">\r\n			<div class="embed-modal-half-column">\r\n				<label for="credit" class="embed-modal-label">Credit</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="credit" />\r\n			</div>\r\n			<div class="embed-modal-half-column">\r\n				<label for="creditLink" class="embed-modal-label">Credit Link</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="url" name="creditLink" />\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="embed-modal-row">\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="caption" class="embed-modal-label">Caption</label>\r\n				<input class="embed-modal-input embed-modal-form-control" type="text" name="caption" />\r\n			</div>\r\n		</div>\r\n		<div class="embed-modal-half-column">\r\n			<div class="embed-modal-form">\r\n				<label for="license" class="embed-modal-label">License</label>\r\n				<select class="embed-modal-form-control" type="text" name="license">\r\n					<option disabled selected>-- Select A License --</option>\r\n				</select>\r\n			</div>\r\n		</div>\r\n	</div> --></div></form>',e["modal/modal_instagram.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Insert Instagram URL</label><input name="url" type="url" placeholder="Enter URL to instagram post" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',e["modal/modal_main.html"]='<div class="embed-modal-dialog"><div class="embed-modal-content"><div class="embed-modal-header"><button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="embed-modal-half-column"><h3 class="header-title"></h3></div><div class="embed-modal-half-column"><select class="embed-modal-form-control" id="select-embed-type"></select></div></div><div class="embed-modal-body"><div id="embed-modal-create-new"></div><div id="embed-modal-select-existing"></div></div><div class="embed-modal-footer"><div id="embed-modal-buttons-create"><button id="btn-show-select-existing">Select Existing Embed</button><!-- TODO : add publishing state dropdown --><!-- TODO : publishing state dropdown affects Save button text --> <i class="fa fa-spinner fa-spin" id="embed-modal-spinner"></i> <button id="btn-save-modal">Save</button> <button id="btn-abort-modal">Close</button></div><div id="embed-modal-buttons-select"><button id="btn-cancel-select-existing">Cancel</button></div></div><!-- the leave confirmation modal will be loaded here --><div class="embed-modal" id="leave-confirmation-modal"><div></div></div></div></div>',e["modal/modal_newsletterSubscribe.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control embed-modal-input"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title for display purposes" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="teaser">Teaser</label><textarea name="teaser" type="text" placeholder="Enter teaser" rows="3" class="embed-modal-form-control"></textarea></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="newsletter">Select Newsletter</label><select name="newsletter" class="embed-modal-form-control"></select></div></div></div></form>',e["modal/modal_relatedLink.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title for internal use" class="embed-modal-form-control"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label class="embed-modal-label" for="displayTitle">Display Title</label><input name="displayTitle" type="text" placeholder="Enter a title to display" class="embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><label class="embed-modal-label">Links</label><div class="progress"><div id="related-links-progress" class="progress-bar progress-bar-info"></div></div><ul id="related-link-list"></ul></div></div><hr><div class="embed-modal-row"><div class="related-link-add"><input name="linkInput" type="text" id="add-link-eac" placeholder="Begin typing a title. Select one to add link." class="embed-modal-form-control"></div></div></form>',e["modal/modal_slideshow.html"]='<form><div class="embed-modal-row"><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="slideshowTitle" class="embed-modal-label">Slideshow Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title for internal use" type="text" name="title"></div></div><div class="embed-modal-half-column"><div class="embed-modal-form"><label for="displayTitle" class="embed-modal-label">Display Title</label><input class="embed-modal-input embed-modal-form-control" placeholder="Enter a title to display" type="text" name="displayTitle"></div></div></div><hr><div class="embed-modal-row"><div class="embed-modal-full-column image-list-container"><div class="slideshow_intro"><a class="btn btn-lg btn-primary js-add_slide"><span class="fa fa-plus" aria-hidden="true"></span> Add First Image</a></div><div class="slideshow_editor"><div class="slideshow_editor-slide"><div class="slideshow_editor-slide_image-container"><div class="slideshow_editor-slide_image js-slide_image" style="background-image:url(https://test-services.pri.org/image/2016/05/13/b2e0f83b63414f74a21d8a4fdb9d5328/Prince_We_World_web.jpg)"><img src="https://test-services.pri.org/image/2016/05/13/b2e0f83b63414f74a21d8a4fdb9d5328/Prince_We_World_web.jpg"></div></div><div class="slideshow_editor-slide_text js-slide_text"><div class="slideshow_editor-slide_caption js-slide_caption">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam feugiat ac nulla in tincidunt. Curabitur pellentesque, justo at sagittis gravida, nunc eros blandit dolor, a scelerisque eros mauris in tellus.</div><div class="slideshow_editor-slide_credit-container"><span class="slideshow_editor-slide_label">Credit</span> <span class="slideshow_editor-slide_credit_text js-slide_credit">John A. Doe / Unknown News</span> <a class="slideshow_editor-slide_credit_link js-slide_credit" href="" target="_blank">John A. Doe / Unknown News</a></div></div></div><div class="slideshow_editor-nav"><ul class="slideshow_editor-nav_list js-slides"><li class="slideshow_editor-nav_item js-slide_template"><a class="slideshow_editor-nav_btn"><span class="slideshow_editor-nav_ind fa" aria-hidden="true"></span><span class="slideshow_editor-nav_handle" aria-hidden="true"></span></a></li></ul><div class="slideshow_editor-add_item"><a class="slideshow_editor-add_btn js-add_slide"><span class="fa fa-plus" aria-label="Add Slide"></span></a></div></div><div class="slideshow_editor-toolbar"><ul class="slideshow_editor-toolbar_list"><li class="slideshow_editor-toolbar_item"><a class="slideshow_editor-toolbar_btn js-remove_slide"><span class="fa fa-remove" aria-label="Remove Slide"></span></a></li><li class="slideshow_editor-toolbar_item"><a class="slideshow_editor-toolbar_btn js-edit_slide"><span class="fa fa-cog" aria-label="Edit Slide"></span></a></li></ul></div></div></div></div></form><div class="embed-modal" id="embed-modal-slideshow-image"></div>',e["modal/modal_twitter.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="tweetUrl">Tweet URL</label><input name="url" type="url" placeholder="Enter URL to tweet" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',e["modal/modal_video.html"]='<form><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="title">Title</label><input name="title" type="text" placeholder="Enter a title" class="embed-modal-input embed-modal-form-control"></div></div></div><div class="embed-modal-row"><div class="embed-modal-full-column"><div class="embed-modal-form"><label class="embed-modal-label" for="url">Video URL</label><input name="url" type="url" placeholder="Enter URL to video" class="embed-modal-input embed-modal-form-control"></div></div></div></form>',EntityEmbed.templateCache=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){e=$.extend(!0,{},r,e);var t={timeout:15e3,crossDomain:!0,type:e.methodType,dataType:"json",jsonp:!1,url:e.domainName+e.path};return e.headers?(e.headers["x-auth-token"]=e.auth_token,e.headers["x-debug"]=e.debug,t.headers=e.headers,t.processData=!1,t.contentType=!1,t.data=e.data,"function"==typeof e.xhr&&(t.xhr=e.xhr)):(e.data.debug=e.debug,e.data.auth_token=e.auth_token,t.data=JSON.stringify(e.data)),$.ajax(t)}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function i(t){return t.methodType="POST",e(t)}function a(e){r.auth_token=e}function n(e){return r.auth_token}function l(e){return r.domainName}function d(e){r.domainName=e,r.domainName.endsWith("/")||(r.domainName+="/")}var r={data:{},debug:0,auth_token:"",domainName:"",path:""},s=/^[^.]*staging[^.]*\.|\.dev$/,m=s.test(window.location.host);m&&(r.auth_token="abc123",r.debug=1),EntityEmbed.apiService={set:t,get:o,uploadFile:i,setAuthToken:a,getAuthToken:n,getDomainName:l,setDomainName:d}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+i);return o}function t(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+i+a);return o}var o={},i="mediumInsert",a="EntityEmbeds",n="entity-embed-active",l="medium-editor-button-active",d="medium-insert-images-toolbar",r="medium-insert-images-toolbar2",s="entity-embed-secondary-toolbar-locator",m="entityEmbedToolbarEventsReady",c="entity-embed-toolbar",u=function(e,t){var o=c;t?(o+=" medium-insert-images-toolbar medium-editor-toolbar medium-editor-stalker-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o+=" medium-insert-images-toolbar2 medium-editor-toolbar medium-toolbar-arrow-after medium-editor-toolbar-active";var i='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var a in e){var n=e[a];n.label&&(i+='<li><button class="medium-editor-action" data-action="'+a+'">'+n.label+"</button></li>")}return i+="</ul></div>"};toolbarManager=function(e,t,o,i){var a=this;a.mediumEditorAddon=e,a.styles=t,a.actions=o,i&&(n=i),a.events()},toolbarManager.prototype.events=function(){var e=this,t=$(document);t.data(m)||t.data(m,!0).on("click","."+d+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+r+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this,o=e.find("."+r);o.length||(o=$(u(t.actions)),e.append(o)),t.$actionToolbar=o,t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(e,t){var i=this,a=$.extend(i.styles,{}),n=!0,l=e.find("."+d+"."+t.name+"StyleToolbar");if(t.options.styles){for(var r in t.options.styles)t.options.styles[r]?n=!1:delete a[r];n||(l.length||(l=$(u(a,t.name)),e.append(l)),o[t.name]=l,o[t.name].hide())}},toolbarManager.prototype.showToolbars=function(e,t){var i,a=this,d=$("."+n);a.currentToolbarEmbedType=t,a.$actionToolbar.show(),o[a.currentToolbarEmbedType]&&(o[a.currentToolbarEmbedType].find("button").each(function(){d.hasClass("entity-embed-"+$(this).data("action"))&&(i=$(this),i.addClass(l))}),o[a.currentToolbarEmbedType].show(),i&&i.addClass(l)),a.positionToolbars(e)},toolbarManager.prototype.styleToolbarDo=function(t){var o=this,i=t.closest("li").closest("ul"),a=$("."+n),d=e(a);i.find("."+l).removeClass(l),t.addClass(l),i.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(l)?o.addStyle(a,t,e.data("action"),!0):(a.removeClass(t),o.styles[e.data("action")].removed&&o.styles[e.data("action")].removed(a))}),d.triggerInput()},toolbarManager.prototype.addStyle=function(e,t,o,i){var a=this;e.addClass(t),a.styles[o].added&&a.styles[o].added(e),i&&setTimeout(function(){a.positionToolbars($("."+n))},50)},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,i=$("."+n),a=o.actions[e.data("action")].clicked,l=t(i);a(l,i)},toolbarManager.prototype.hideToolbar=function(){var e=this,t=$("."+c);t.hide(),t.find("button").removeClass(l),e.currentToolbarEmbedType=null},toolbarManager.prototype.positionToolbars=function(e){var t=this;if(e.length){var i=e.find("."+s);0===i.length&&(i=e),l=e.offset().top+e.height()/2-t.$actionToolbar.height()/2;var a=i.offset().left+i.outerWidth()+8+4;a>$(window).width()-t.$actionToolbar.width()&&(a=$(window).width()-t.$actionToolbar.width()-50),t.$actionToolbar.css({top:Math.min(l,e.offset().top),left:a});var n=o[t.currentToolbarEmbedType];if(n){var l=e.offset().top-n.height()-8-2-5;0>l&&(l=0),n.css({top:l,left:e.offset().left+e.width()/2-n.width()/2})}}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,i){var a=i||this;a.name=o,t=$.extend(!0,{},a.defaultOptions,t),a.options=$.extend(!0,{},t,e),a.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{set:"admin/embed/edit",get:"admin/embed/fetch",getAll:"admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{focusCleanup:!0,errorPlacement:function(e,t){var o=t.parent();o.is(".embed-modal-input-group")?e.insertAfter(o):e.insertAfter(t)}}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e){},e.prototype.getModelFromForm=function(e,t){for(var o=t||this,i=e.find(".embed-modal-form-control, .embed-modal-file-input"),a=0;a<i.length;a++){var n=i[a].name,l=i[a].type,d=null;"file"===l?d=i[a].files[0]:i[a].value.length&&(d=i[a].value),n&&(o.model[n]=d)}o.model.html_rendered=null},e.prototype.populateFormWithModel=function(e,t){for(var o=t||this,i=e.find(".embed-modal-form-control"),a=0;a<i.length;a++)if(!i[a].type||-1===i[a].type.indexOf("file"))if(i[a].type&&-1!==i[a].type.indexOf("select")){var n=$(i[a]).find("option"),l=o.model[i[a].name],d=0;n.each(function(e){this.value===l&&(d=e)}),i[a].selectedIndex=d}else o.model[i[a].name]&&(i[a].value=o.model[i[a].name])},e.prototype.clearForm=function(e,t){var o=t||this,i=e;i.is("form")||(i=e.find("form")),i.each(function(){$(this).validate(o.options.validationOptions).resetForm()});for(var a=e.find("form"),n=0;n<a.length;n++)a[n].reset();o.model=o.cleanModel()},e.prototype.parseForEditor=function(){var e=this;return'<div class="embedded-content"><div class="ui-text"> <strong>Embed Type: </strong>'+e.options.object_type+'</div><div class="ui-text"> <strong>Title: </strong> '+e.model.title+"</div></div>"},e.prototype.validate=function(e,t,o){var i=o||this,a=e;return a.is("form")||(a=e.find("form")),i.$validator=a.each(function(){$(this).validate(i.options.validationOptions)}),i.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return e&&(o.model.object_type=o.options.object_type),EntityEmbed.apiService.set({path:o.options.httpPaths.set,data:o.model})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,i){var a=this;a.$el=$(e),a.options=$.extend(!0,{},t,o),a.scope={},i&&(a.scope=i),a.scope.modalCtrl=a,a.$el.data("scope",a.scope),a.options.functions.init.before(a.scope),a.init(),a.options.functions.init.after(a.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e,t){var o=e.$el.data("scope");e.isActive=t,e.$el.toggle(e.isActive).toggleClass("in",e.isActive),e.$backdrop.toggle(e.isActive).toggleClass("in",e.isActive),o.parentModal||$("body").toggleClass("embed-modal-open",e.isActive)},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$el.click(function(t){t.target===e.$el[0]&&e.$el.abortModal()}),e.options.showCloseBtn&&(e.$closeBtn=e.$el.find(".close"),e.$closeBtn.click(function(){e.$el.abortModal()})),e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,i){var a=this;a.$el.find(e).on(t,function(e){o(e,a.$el.data("scope"),i)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t=$.data(this[0],"ctrl");if(t){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");return t.promise=$.Deferred(),t.options.functions.open.before(a),t.toggle(t,!0),t.options.functions.open.after(a),t.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),i=$.extend(!0,{},o,e);t.$el.data("scope",i)}var a=t.$el.data("scope");t.options.functions.abort.before(a)&&(t.toggle(t,!1),t.options.functions.abort.after(a),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t,o,i,a,n,l=$.data(this,"ctrl");l&&l.isActive&&(e&&(t=l.$el.data("scope"),o=$.extend(!0,{},t,e),l.$el.data("scope",o)),i=l.$el.data("scope"),a=l.options.functions.complete.before(i),"function"==typeof a.state?n=a:(n=$.Deferred(),a?n.resolve():n.reject()),n.done(function(e){e&&(i.currentEmbedType.model=e),l.toggle(l,!1),l.options.functions.complete.after(i),"pending"===l.promise.state()&&l.promise.resolve()}))})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e)}var t={modalId:"leave-confirmation-modal",viewPath:"modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(e){var t=this;t.$abortEl=$("#"+t.options.abortElId,e.$modalEl),t.$completeEl=$("#"+t.options.completeElId,e.$modalEl)},e.prototype.functions={init:{before:function(e){},after:function(e){}
},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3,selectExistingSingle:4};var t=void 0,o=!1,i={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{saveSpinner:"#embed-modal-spinner",headerText:".header-title"}},a=function(e,t){function o(o){e[o]=e[o]||{};for(key in i[o])i[o].hasOwnProperty(key)&&(e[o][key]=$(i[o][key],t))}for(groupKey in i)i.hasOwnProperty(groupKey)&&o(groupKey)},n=function(e,t){$(".editable").attr("contenteditable",t)},l=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},d=function(e,t){if(t){e.currentEmbedType&&(delete e.currentEmbedType.model,e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=e.modalCtrl.scope.currentEmbedType=p(t,e.embedTypes),e.currentEmbedType.clearForm(e.currentEmbedType.$view),e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex;var o="Add ";e.modalType===EntityEmbed.embedModalTypes.edit&&(o="Edit "),e.embedId||(o+="New "),o+=e.currentEmbedType.options.displayName,e.elements.headerText.text(o)}},r=function(e){var t=e.embedTypes[0].options.object_type;d(e,t),e.$embedTypeSelect.show()},s=function(e){function t(t){return"ERROR"===t.status?(console.log("POST failed (API)"),void r.reject()):"string"==typeof t.response?(console.log("Failed to POST embed type: "+t.response),void r.reject()):(e.currentEmbedType.model=t.response,n&&(e.currentEmbedType.model.object_id=t.response.object_id),console.log("POST succeeded",t),e.successCallback&&e.successCallback(t.response),void r.resolve(t.response))}function i(t,o,i){console.log("POST failed (XHR)",i),e.failCallback&&e.failCallback(),r.reject()}function a(t){o=!1,e.elements.saveSpinner.hide(),e.alwaysCallback&&e.alwaysCallback()}for(var n=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,l=e.currentEmbedType.validate(e.currentEmbedType.$view,n),d=!0,r=$.Deferred(),s={},m=0;m<l.length;m++)d=$(e.currentEmbedType.$validator[m]).valid()&&d;return o||!d?(r.reject(),r):(o=!0,e.elements.saveSpinner.show(),e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),e.buffered?(s.response=$.extend(!0,{},e.currentEmbedType.model),t(s),a(s)):e.currentEmbedType.saveEmbed(n).done(t).fail(i).always(a),r)},m=function(e){e.skipSave=!1,e.buttons.showSelectExisting.show(),e.isSingle?e.modalType=EntityEmbed.embedModalTypes.addSingle:(e.modalType=EntityEmbed.embedModalTypes.add,e.$embedTypeSelect.show()),e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown(),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.containers.selectExistingEmbed.find(".query-container").hide()},c=function(e){e.skipSave=!1,e.buttons.showSelectExisting.hide(),e.$embedTypeSelect.hide(),e.containers.selectExistingEmbed.is(":visible")&&(e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown()),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.buttons.showSelectExisting.hide()},u=function(e){e.skipSave=!0,e.containers.createNewEmbed.slideUp(),e.containers.selectExistingEmbed.slideDown(),e.containers.createButtons.hide(),e.containers.selectButtons.show(),e.containers.selectExistingEmbed.find("."+e.currentEmbedType.options.object_type+"-query-container").show(),e.isSingle?(e.modalType=EntityEmbed.embedModalTypes.selectExistingSingle,e.$embedTypeSelect.hide()):(e.modalType=EntityEmbed.embedModalTypes.selectExisting,e.$embedTypeSelect.show())},p=function(e,t){var o=$.grep(t,function(t){return t.options.object_type==e})[0];return o&&$.extend(!0,{},o)},b=function(e,t){var o=$("<div>").html(e.parseForEditor());o.children().first().addClass("entity-embed");var i='<figure contenteditable="false" id="'+e.model.object_id+'" data-embed-type="'+e.options.object_type+'" >'+o.html()+'<div class="entity-embed-blocker"></div></figure>';return t?'<div class="entity-embed-container">'+i+"</div>":i},f=function(e,t){var o=(t.modalCtrl,/^[^.]*staging[^.]*\.|\.dev$/),i=o.test(window.location.host),a={auth_token:EntityEmbed.apiService.getAuthToken(),object_type:e.options.object_type};i&&(a.debug=1);var n={ajaxSettings:{dataType:"json",method:"POST",data:a},requestDelay:600,url:function(t){return a.title=t,EntityEmbed.apiService.getDomainName()+e.options.httpPaths.getAll},listLocation:function(e){return e.response.data},getValue:function(e){return e.title},preparePostData:function(o){return o.title=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(),JSON.stringify(o)},list:{maxNumberOfElements:20,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var o=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').getSelectedItemData(),i=o.object_id;t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(""),EntityEmbed.apiService.get({path:e.options.httpPaths.get,data:{object_id:i}}).done(function(o){if("string"==typeof o.response)return void console.log("Failed to get list of current embed types for the Select Existing page: "+o.response);var i=jQuery.Event("existingItemSelected");i.embedModel=o.response,t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').trigger(i)}).fail(function(e){console.log("failed to get embed type!")})}}};t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').easyAutocomplete(n),t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').closest(".easy-autocomplete").removeAttr("style")},v=function(e){return'<div class="embed-modal-row '+e.options.object_type+'-query-container query-container"><div class="embed-modal-full-column"><label class="embed-modal-label" for="query">Search for '+e.options.displayName+'</label><input type="text" class="embed-modal-form-control" name="'+e.options.object_type+'-query" placeholder="begin typing '+e.options.displayName+' title "></div></div>'};e.prototype.generateEmbedHtml=b,e.prototype.functions={init:{before:function(e){a(e,e.modalCtrl.$el),t=e.embedTypes,e.elements.saveSpinner.hide()},after:function(e){function t(t,o){t.initModal(o,e.modalCtrl)}var o,a,n,l,r,s,c,p;for(e.modalCtrl.registerEvent(e.buttons.showSelectExisting,"click",function(e,t){u(t)}),e.modalCtrl.registerEvent(e.buttons.cancelSelectExisting,"click",function(e,t){m(t)}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(t,o){var i=t.currentTarget.options[t.currentTarget.selectedIndex].value;console.log("embedModalDefaults::embedTypeSelect",i),o.currentEmbedType.clearForm(o.currentEmbedType.$view),d(o,i),o.modalType===EntityEmbed.embedModalTypes.selectExisting&&(e.containers.selectExistingEmbed.find(".query-container").hide(),e.containers.selectExistingEmbed.find("."+o.currentEmbedType.options.object_type+"-query-container").show())}),p=0;p<e.embedTypes.length;p++)s=e.embedTypes[p],e.containers.selectExistingEmbed.append(v(s)),o=e.containers.selectExistingEmbed.find('input[name="'+s.options.object_type+'-query"]'),f(s,e),e.containers.selectExistingEmbed.find("."+s.options.object_type+"-query-container").hide(),e.modalCtrl.registerEvent(o,"existingItemSelected",function(e,t){t.currentEmbedType.model=e.embedModel,t.modalCtrl.$el.completeModal()}),e.$embedTypeSelect.append('<option value="'+s.options.object_type+'">'+s.options.displayName+"</option>"),a=$('<div id="'+s.name+'"></div>'),e.containers.createNewEmbed.append(a),c=e.modalHtmlLocation+s.options.viewPath,EntityEmbed.templateCache&&EntityEmbed.templateCache[c]?(a.html(EntityEmbed.templateCache[c]),t(s,a)):a.load(c,function(e,o){return function(i,a,n){console.log(e.options.viewPath+" load completed with status: "+a),EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[o]=$(this).html(),t(e,$(this))}}(s,c)),s.$view=a,s.optionIndex=p,a.hide();r=new EntityEmbed.confirmModalDefaults,i.elements.confirmModal="#"+r.options.modalId,n=e.elements.confirmModal=$(i.elements.confirmModal,e.$modalEl),c=e.modalHtmlLocation+r.options.viewPath,l={parentModalCtrl:e.modalCtrl,$modalEl:n},EntityEmbed.templateCache&&EntityEmbed.templateCache[c]?(n.html(EntityEmbed.templateCache[c]),r.init(l),n.modal(r,l)):n.load(c,function(e,t,o){console.log("leave confirmation modal load completed with status: "+t),"error"!==t&&(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[c]=n.html(),r.init(l),n.modal(r,l))})}},open:{before:function(e){e.isSingle=e.modalType===EntityEmbed.embedModalTypes.addSingle||e.modalType===EntityEmbed.embedModalTypes.selectExistingSingle,n(e,"false"),e.embedType?(d(e,e.embedType),delete e.embedType):r(e)},after:function(e){function t(t){t=t||{},d(e,t.object_type),e.currentEmbedType.model=t,e.staleModel=$.extend(!0,{},t),e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view)}switch(e.modalType){case EntityEmbed.embedModalTypes.edit:if(c(e),e.buffered){t(e.embedData),delete e.embedData;break}EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(e){return"string"==typeof e.response?void console.log("Failed to get embed type: "+e.response):void t(e.response)}).fail(function(e){console.log("failed to get embed type!")});break;case EntityEmbed.embedModalTypes.add:m(e);break;case EntityEmbed.embedModalTypes.addSingle:m(e),e.$embedTypeSelect.hide();break;case EntityEmbed.embedModalTypes.selectExisting:u(e);break;case EntityEmbed.embedModalTypes.selectExistingSingle:u(e,!0)}}},abort:{before:function(e){function t(e){var t;if(e)switch(typeof e){case"array":case"object":t=JSON.stringify(e);break;default:t=e}return t||null}var o,i,a=this;if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var n in e.currentEmbedType.model)if(o=t(e.staleModel[n]),i=t(e.currentEmbedType.model[n]),o!==i)return e.elements.confirmModal.openModal({parentModal:a}),!1}else if(l(e.currentEmbedType.$view))return e.elements.confirmModal.openModal({parentModal:a}),!1;return e.currentEmbedType.clearForm(e.currentEmbedType.$view),delete e.confirmedLeave,!0},after:function(e){n(e,"true")}},complete:{before:function(e){return!!e.skipSave||s(e)},after:function(e){var t,o,i,a;if(n(e,"true"),e.$currentEditorLocation.length>0){for(o=e.$currentEditorLocation.attr("class").split(" "),o.push(e.currentEmbedType.defaultStyle),t=$(b(e.currentEmbedType,!0)),i=0,a=o.length;a>i;i++)t.addClass(o[i]);e.$currentEditorLocation.after(t),e.$currentEditorLocation.remove(),e.$currentEditorLocation=t}e.modalCtrl.promise.resolve({data:$.extend(!0,{},e.currentEmbedType.model),embedType:e.currentEmbedType,$embed:e.$currentEditorLocation}),e.currentEmbedType.clearForm(e.currentEmbedType.$view)}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="audio",o={viewPath:"modal_audio.html",displayName:"Audio",object_type:"audio",audioLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",upload:{required:!0,extension:"mp3"},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"admin/embed/file-upload"}},i=".uploaded-audio-file",a=".cancel-upload-file-btn",n=".edit-chosen-file-btn",l=".embed-modal-file-input",d=function(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(e="/"+t),e+t):""};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=3,e.prototype.audioPreviewClass="audio-preview",e.prototype.cleanModel=function(){return{title:null,url_path:null,credit:null,creditLink:null}},e.prototype.initModal=function(e){var t=this;t.$mp3Form=e.find('input[name="upload"]'),e.find(n).on("click",function(){e.find(i).hide(),e.find(n).hide(),t.$mp3Form.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$mp3Form.hide(),e.find(a).hide(),t.$mp3Form.parent().find("#upload-error").is(":visible")&&t.$mp3Form.parent().find("#upload-error").hide(),e.find(n).show(),e.find(i).show()}),e.find(l).on("change",function(){var t=e.find(l)[0].files[0].name;e.find("[name=title]").val(t)})},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.audioPreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(n).hide(),t.$mp3Form.show()},e.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},e.prototype.generateUploadedPreview=function(){var e=this;if(e.model.object_id){var t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1);return'<audio controls class="'+e.audioPreviewClass+'"><source src="'+d(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio>'}return'<div class="'+e.audioPreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},e.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$mp3Form.hide(),e.find(i).show(),e.find(n).show(),e.find(i).append(t.generateUploadedPreview()))},e.prototype.parseForEditor=function(){var e=this,t="mp3";return e.model.url_path&&""!==e.model.url_path&&(t=e.model.url_path.substring(e.model.url_path.lastIndexOf(".")+1)),'<div class="audio-embed"><audio controls><source src="'+d(e.options.audioLocation,e.model.url_path)+'" type="audio/'+t+'"></audio><div class="credit">Credit: '+e.model.credit+'</div><div class="link">Link: '+e.model.creditLink+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var o=this;o.parent.constructor(e,i,t,o)}var t="customText",o="custom-text-editor",i={viewPath:"modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=5,e.prototype.getModelFromForm=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e,o=$(this),i=o.attr("name"),a=o.data("editor");e=a?a.getContent():o.val(),e=e.replace(/^\s+|\s+$/,""),t.model[i]=e||null})},e.prototype.cleanModel=function(){return{title:null,displayTitle:"",text:null}},e.prototype.clearForm=function(e,t){var o=t||this,i=e.find(".embed-modal-form-control");o.parent.clearForm(e,o),i.each(function(){var e=$(this),t=e.data("editor");t?t.setContent(""):e.val(null)}),o.model=o.cleanModel()},e.prototype.populateFormWithModel=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e=$(this),o=e.attr("name"),i=t.model[o],a=e.data("editor");a?a.setContent(i):e.val(i)})},e.prototype.initModal=function(e){var t=$("#"+o),i=new MediumEditor(t[0],{placeholder:{text:"Type your text. Highlight words to trigger the styles editor"}});t.data("editor",i)},e.prototype.parseForEditor=function(){var e=this,t=['<div class="custom-text">'+e.model.customText+"</div>"];return e.model.displayTitle&&t.unshift('<div class="display-title">'+e.model.displayTitle+"</div>"),'<div class="custom-text-embed entity-embed-secondary-toolbar-locator">'+t.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="externalLink",o={viewPath:"modal_externalLink.html",displayName:"External Link",object_type:"external-link",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",url:"required",linkText:"required"}},httpPaths:{uploadFile:"admin/embed/file-upload"}},i=".uploaded-image-file",a=".cancel-upload-image-btn",n=".edit-chosen-file-btn",l=".embed-modal-file-input",d=function(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t):""};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=9,e.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null}},e.prototype.initModal=function(e){var t=this;t.$imageForm=e.find('input[name="upload"]'),e.find(n).on("click",function(){e.find(i).hide(),e.find(n).hide(),t.$imageForm.css("display","inline-block"),e.find(a).show()}),e.find(a).on("click",function(){t.$imageForm.hide(),e.find(a).hide(),t.$imageForm.parent().find("#upload-error").is(":visible")&&t.$imageForm.parent().find("#upload-error").hide(),e.find(i).show(),e.find(n).show()}),e.find(l).on("change",function(){var t=e.find(l)[0].files[0].name;e.find("[name=title]").val(t)})},e.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},e.prototype.populateFormWithModel=function(e){var t=this;t.parent.populateFormWithModel(e,t),(t.model.upload||t.model.url_path)&&(t.$imageForm.hide(),e.find(i).show(),e.find(n).show(),e.find(i).append(t.generateUploadedImgPreview()))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).find("."+t.imagePreviewClass).remove(),e.find(i).hide(),e.find(a).hide(),e.find(n).hide(),t.$imageForm.show()},e.prototype.generateUploadedImgPreview=function(){var e=this;return e.model.object_id?'<img class="'+e.imagePreviewClass+'" src="'+d(e.options.imageLocation,e.model.url_path)+'">':'<div class="'+e.imagePreviewClass+'">'+(e.model.url_path||e.model.upload.name)+"</div>"},e.prototype.parseForEditor=function(){var e=this;return'<div class="external-link-embed entity-embed-secondary-toolbar-locator"><img src="'+d(e.options.imageLocation,e.model.url_path)+'"><div class="text-container"><div class="display-title">'+e.model.displayTitle+'</div><div class="teaser">'+e.model.teaser+'</div></div><a href="'+e.model.url+'">'+e.model.linkText+"</a></div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="facebook",i={viewPath:"modal_facebook.html",displayName:"Facebook",object_type:"facebook",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=7,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a=o[i].name,n=o[i].value;a&&n&&(t.model[a]=n)}var l="embedCode",d='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s);js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));</script><div class="fb-post" data-href="'+this.model.url+'" data-width="500"></div>';t.model[l]=d},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"},t.prototype.activateEmbed=function(){e.FB&&e.FB.XFBML.parse()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="globalBuzz",o={viewPath:"modal_globalBuzz.html",displayName:"Global Buzz",object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",url:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=13,e.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null}},e.prototype.parseForEditor=function(){var e=this;return'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><img class ="buzz-field-quote-png" src="http://www.pri.org/sites/all/themes/pri/images/icon-open-quote.png"><div class="buzz-quote-inner">'+e.model.quote+'</div></div><div class="buzz-field-quote-credit">'+e.model.credit+'</div><a class="btn btn-primary global-buzz-link" href="'+e.model.quoteUrl+'">'+e.model.quoteUrlText+"</a></div></article></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="iframe",o={viewPath:"modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required",height:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=11,e.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1,width:null,height:300}},e.prototype.parseForEditor=function(){var e=this.model.height,t=this.model.width||this.model.height,o=e/t*100,i=!!this.model.width,a=["<div",' class="iframe-embed'+(i?" iframe-embed-responsive":"")+'"',i?' style="padding-bottom: '+o+'%"':"",">",'<iframe src="'+this.model.url+'"',' frameborder="0"',' scrolling="'+this.model.allowsScroll+'"',' height="'+(this.model.height||300)+'"',' width="'+(this.model.width?this.model.width:"100%")+'"',"></iframe>","</div>"].join("");return i&&(a=['<div class="iframe-embed-responsive-wrapper" style="max-width:'+this.model.width+'px">',a,"</div>"].join("")),a}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={},i=[];return o.title=t.name,e.byline&&i.push(e.byline),e.credit&&i.push(e.credit),e.copyright&&i.push(e.copyright),o.credit=i.join(" / "),o.caption=e.caption&&e.caption.replace(/\s*\([^\)]+\)\s*$/,""),o.altText=e.headline,o}function t(e,t){return t&&""!==t?t.indexOf(e)>=0?t:(e.endsWith("/")&&(e=e.substring(0,e.length-1)),t.startsWith("/")||(t="/"+t),e+t):""}function o(e,t){e.$ui=e.$ui||{form:t};for(key in m)m.hasOwnProperty(key)&&(e.$ui[key]=$(m[key],t));return e.$ui}function i(e,t){function o(){n(e),l.resolve(),$(this).off("load",o)}var i,a=e.$ui,l=(new Image,$.Deferred());return a.imageEditorPreviewImage.on("load",o),t&&(e.model.upload=t),i=e.getImageUrl(),a.imageEditorPreview.css("background-image",'url("'+i+'")'),a.imageEditorPreviewImage.attr("src",i),l}function a(t,o){var i=t.$ui,a=$.Deferred();return o||(o=t.model.upload),EXIF.getData(o,function(){var n,l,d,r,s,m,u,p=this.iptcdata;if(t.licenses&&t.licenses.length)for(s=0,m=t.licenses.length;m>s;s++)u=c[t.licenses[s].license],u&&"function"==typeof u.claimData&&u.claimData(p)&&(d="function"==typeof u.getModelFromData&&u.getModelFromData(p,this)||{},d.license=t.licenses[s].license);l=e(p,this),t.getModelFromForm(i.form),n=$.extend(!0,{},t.model);for(r in n)n.hasOwnProperty(r)&&null===n[r]&&delete n[r];t.model=$.extend(!0,{},l,d||{},n),t.model.upload=o,t.populateFormWithModel(i.form).done(function(){a.resolve()})}),a}function n(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadImageBtn.hide(),t.imageEditorPreview.show(),t.editImageFileBtn.show(),t.undoUploadImageBtn.toggle(!!e.model.url_path&&!!e.model.upload)}function l(e){var t=e.$ui;t.imageEditorPreview.hide(),t.editImageFileBtn.hide(),t.undoUploadImageBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadImageBtn.toggle(!(!e.model.url_path&&!e.model.upload))}function d(e){var t=this;t.parent.constructor(e,s,r,t)}var r="image",s={viewPath:"modal_image.html",displayName:"Image",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"admin/image-license/list",uploadFile:"admin/embed/file-upload"}},m={imageEditorPreview:".image_editor-preview",imageEditorPreviewImage:".image_editor-preview_image",editImageFileBtn:".js-upload",cancelUploadImageBtn:".js-upload-cancel",undoUploadImageBtn:".js-upload-undo",uploadFileInputContainer:".image_editor-intro",uploadFileInput:".embed-modal-file-input",imageEditor:".image_editor"},c={ap:{claimData:function(e){var t=/(AP Images|Associated Press)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},getty:{claimData:function(e){var t=/(Getty ?Images)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},reuters:{claimData:function(e){return!!e.credit&&"reuters"===e.credit.toLowerCase()},getModelFromData:function(e,t){var o={},i=[];return e.byline&&i.push(e.byline.replace(/^\W*\u00A9\s*/,"")),e.copyright&&i.push(e.copyright),o.credit=i.length?i.join(" / "):void 0,o.caption=e.caption.replace(/\s+REUTERS\/.+$/gm,""),o}}};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[r]=d,d.prototype.orderIndex=1,d.prototype.imageEditorPreviewImageClass="image-preview",d.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null}},d.prototype.getImageUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):t(this.options.imageLocation,this.model.url_path)},d.prototype.loadLicenses=function(e){var t=this,o=e.find('[name="license"]');return o.children().length>1?void o.val(t.model.license):void EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(e){var i;if(e.response.data){if(o.children().length>1)return void o.val(t.model.license);t.licenses=e.response.data;for(var a=0;a<e.response.data.length;a++)i=$("<option>"),i.attr("value",e.response.data[a].license).text(e.response.data[a].title),o.append(i);o.val(t.model.license)}}).fail(function(e){console.log("failed to find load image license options")})},d.prototype.updateFormWithFileMetadata=function(e,t){var o=this;t?o.model.upload=t:t=o.model.upload},d.prototype.initModal=function(e,t){var l=this,d=o(l,e);l.loadLicenses(e),d.editImageFileBtn.on("click","a",function(){d.uploadFileInput.click()}),d.cancelUploadImageBtn.on("click","a",function(){n(t.scope.currentEmbedType)}),d.undoUploadImageBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,d.uploadFileInput.val(""),i(t.scope.currentEmbedType)}),d.uploadFileInput.on("change",function(e){var o=e.target.files[0];a(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),d.imageEditor.on("dragenter",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,i=$(this),n=e.originalEvent.dataTransfer.files;if(n&&n.length){if(o=n[0],-1===o.type.indexOf("image"))return;i.addClass("js-dropped"),setTimeout(function(){a(t.scope.currentEmbedType,o).then(function(){setTimeout(function(){i.removeClass("js-dropped")},300)})},300)}})},d.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),o.imageEditorPreviewImage.removeAttr("src"),l(t)},d.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var i=t.parent.saveEmbed(e,t);return o?i.then(function(e){var i=new FormData;return i.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:i,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):i},d.prototype.generateUploadedImgPreview=function(){var e=this;return'<img class="'+e.imageEditorPreviewImageClass+'" src="'+e.getImageUrl()+'">'},d.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);!!t.$ui.uploadFileInput.is(":visible");t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},d.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.parent.populateFormWithModel(e,t),t.loadLicenses(e),t.model.upload||t.model.url_path?i(t).then(function(){o.resolve()}):o.resolve(),o},d.prototype.parseForEditor=function(){var e=this;return'<div class="images-embed"><img class="entity-embed-secondary-toolbar-locator" src="'+t(e.options.imageLocation,e.model.url_path)+'" /><div class="images-embed-caption">'+e.model.caption+'</div><div class="images-embed-credit">Credit: '+e.model.credit+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=this;t.parent.constructor(e,i,o,t)}var o="instagram",i={viewPath:"modal_instagram.html",displayName:"Instagram",object_type:"instagram",validationOptions:{rules:{title:"required",url:"required"}}};t.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[o]=t,t.prototype.orderIndex=8,t.prototype.getModelFromForm=function(e){for(var t=this,o=e.find(".embed-modal-form-control"),i=0;i<o.length;i++){var a=o[i].name,n=o[i].value;a&&n&&(t.model[a]=n)}var l="embedCode",d='<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="6" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: auto; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px); "><a href="'+t.model.url+'" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank"></a></blockquote><script async defer src="//platform.instagram.com/en_US/embeds.js"></script>';t.model[l]=d},t.prototype.cleanModel=function(){return{title:null,url:null}},t.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"},t.prototype.activateEmbed=function(){e.instgrm&&e.instgrm.Embeds.process()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="newsletterSubscribe",o={viewPath:"modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",object_type:"newsletter",validationOptions:{rules:{title:"required",newsletter:"required"}},httpPaths:{getNewsletters:"admin/newsletter/list"}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=12,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletterId:null,teaser:null}},e.prototype.initModal=function(e){var t=this,o="<option disabled selected>-- select a newsletter --</option>";EntityEmbed.apiService.get({path:t.options.httpPaths.getNewsletters}).done(function(t){if(t.response.data){var i=[];i.push(o);for(var a=0;a<t.response.data.length;a++)i.push('<option value="'+t.response.data[a].newsletter_id+'" >'+t.response.data[a].title+"</option>");
e.find('[name="newsletter"]').html(i)}}).fail(function(){console.log("failed to load newsletter subscription options")})},e.prototype.parseForEditor=function(){var e=this;return'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator"><div class="display-title">'+e.model.displayTitle+'</div><div class="subscribe-form"><div class="teaser">'+e.model.teaser+'</div><div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}if(!EntityEmbed.embedTypes)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var t="relatedLink",o={viewPath:"modal_relatedLink.html",displayName:"Related Link",object_type:"related-link",validationOptions:{rules:{title:"required",linkInput:"atLeastOne"}},httpPaths:{getContentList:"admin/content/list",getContentItem:{story:"admin/story/fetch",episode:"admin/episode/fetch"}}},i="#related-link-list",a="#add-link-eac",n="drag-link-btn",l="related-link-placeholder",d="#related-links-progress",r="remove-link-btn",s="related-link-url",m=function(e,t){var o=c(e),i=$(o);return i.data("link-data",e),i.find("."+r).on("click",function(){var e=$(this),t=e.closest("."+s);t.remove()}),i},c=function(e){return'<div class="'+s+'"><div class="related-link-control"><span class="'+n+'"><i class="fa fa-bars"></i></span></div><div class="related-link-title">'+e.title+'</div><div class="related-link-control"><button class="'+r+'"><i class="fa fa-minus"></i></button></div></div>'},u=function(e,t,o){var a=/^[^.]*staging[^.]*\.|\.dev$/,n=a.test(window.location.host),l={auth_token:EntityEmbed.apiService.getAuthToken()},d=o.find(e);n&&(l.debug=1);var r={ajaxSettings:{dataType:"json",method:"POST",data:l},requestDelay:600,url:function(e){return l.title=e,EntityEmbed.apiService.getDomainName()+t.options.httpPaths.getContentList},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},preparePostData:function(e){return e.title=d.val(),JSON.stringify(e)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var e,t=d.getSelectedItemData(),a=(t.object_id,o.find(i));t.object_id&&(e=m(t),a.append(e)),d.val("")}}};d.easyAutocomplete(r),d.closest(".easy-autocomplete").removeAttr("style")};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=10,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[]}},e.prototype.initModal=function(e){var t=this,o=e.find(i),r=e.find(d);r.parent().hide(),u(a,t,e),o.sortable({axis:"y",handle:"."+n,items:"."+s,placeholder:l,start:function(e,t){t.placeholder.height(t.helper.outerHeight())}}),$.validator.addMethod("atLeastOne",function(e,t){return $(".related-link-url").length>0},$.validator.format("One link is required."))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(i).empty()},e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),delete t.model.linkInput,t.model.links=[],e.find("."+s).each(function(){var e=$(this),o=e.data("link-data");t.model.links.push({object_id:o.object_id,object_type:o.object_type})})},e.prototype.populateFormWithModel=function(e){var t,o,a,n=this,l=e.find(i),r=e.find(d),s=[],c=[],u=0,p=0,b=0;if(n.parent.populateFormWithModel(e,n),n.model.links.length){for(r.width(0),r.parent().slideDown(0),t=0,o=n.model.links.length;o>t;t++)n.model.links[t]&&(u++,a=EntityEmbed.apiService.get({path:n.options.httpPaths.getContentItem[n.model.links[t].object_type],data:{object_id:n.model.links[t].object_id}}),a.done(function(e){return function(t){p++,b=p/u*100,r.css({width:b+"%"}),"OK"===t.status&&(c[e]=t.response)}}(t)),s.push(a));$.when.apply($,s).done(function(){var e,t,o;for(r.parent().delay(400).slideUp(500),t=0,o=c.length;o>t;t++)c[t]||c.splice(t,1);for(t=0,o=c.length;o>t;t++)e=m(c[t]),l.append(e),e.hide().delay(1e3).slideDown(150)})}},e.prototype.parseForEditor=function(){var e=this;return'<div class="relatedLink-embed"><div class="relatedLink-embed-uiText"> <strong>Embed Type:</strong> Related Link </div><div class="relatedLink-embed-uiText"> <strong>Title:</strong> '+e.model.title+'</div><div class="relatedLink-embed-uiText"> <strong>Links:</strong> '+e.model.links.length+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,o){var a=o.$ui;o.$currentSlide=e,a.slides.find("."+m).removeClass(m),e.addClass(m),a.slides.sortable("refresh"),t(o),i(o)}function t(e){var t,o=new EntityEmbed.embedTypes.image,i=e.$ui,a=e.$currentSlide.data("model"),n=a.creditLink?"a":"span",l=!!a.caption,d=!!a.credit,r=l||d;o.model=a,t=o.getImageUrl(),i.slideText.toggle(r),i.slideImage.css("background-image",'url("'+t+'")').find("img").attr("src",t),i.slideCaption.toggle(l).text(a.caption),i.slideCreditBlock.toggle(d),i.slideCredit.text(a.credit).hide().filter(n).show(),i.slideCreditBlock.find("a:visible").attr("href",a.creditLink)}function o(e){var t=e.$ui;t.intro.show(),t.editor.hide(),t.slides.empty(),t.slideImage.css("background-image","none").find("img").removeAttr("src"),t.slideText.hide(),t.slideCaption.empty(),t.slideCreditBlock.hide(),t.slideCredit.empty().filter("a").removeAttr("href")}function i(e){var t=e.$ui;t.intro.hide(),t.editor.show()}function a(e,t){e.$ui=e.$ui||{};for(key in E)E.hasOwnProperty(key)&&(e.$ui[key]=$(E[key],t));return e.$ui}function n(e){var t=this;t.parent.constructor(e,d,l,t)}var l="slideshow",d={viewPath:"modal_slideshow.html",displayName:"Slideshow",object_type:"slideshow",validationOptions:{rules:{title:"required"}}},r={modalElId:"embed-modal-slideshow-image",embedTypes:{image:{}},modalOptions:{embedTypeStr:"image",bufferData:!0}},s="slideshow_editor-nav_item",m="active",c="slideshow_editor-nav_handle",u="slideshow_editor-nav_ind",p="fa-circle-o",b="fa-star",f="fa-star-o",v="fa-circle-o-notch fa-spin",h="fa-check",y="fa-exclamation",g="slideshow_editor-slide_placholder",E={addSlide:".js-add_slide",intro:".slideshow_intro",editor:".slideshow_editor",slideImage:".js-slide_image",slideCaption:".js-slide_caption",slideCreditBlock:".slideshow_editor-slide_credit-container",slideCredit:".js-slide_credit",slideText:".js-slide_text",slides:".js-slides",slideTemplate:".js-slide_template",removeSlide:".js-remove_slide",editSlide:".js-edit_slide"};n.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=n,n.prototype.orderIndex=2,n.prototype.cleanModel=function(){return{title:null,displayTitle:null,images:[]}},n.prototype.initModal=function(n,l){var d,v=this;v.model=v.cleanModel(),v.$el=r.modalContainer=n,r.modalOptions.parentModal=l,d=a(v,n),d.slideTemplate.removeClass("js-slide_template").detach(),d.slideTemplate.on("click","a",function(t){var o=$(this),i=o.closest("."+s);e(i,v)}),d.slides.sortable({axis:"x",handle:"."+c,placeholder:g}),d.addSlide.on("click",function(){delete r.modalOptions.id,delete r.modalOptions.embedData,$.embed_modal_open(r).done(function(t){var o=d.slideTemplate.clone(!0),a=t.data.object_id?p:b;o.data("model",t.data),o.find("."+u).addClass(a),d.slides.append(o),e(o,v),i(v)})}),d.editSlide.on("click",function(){var e=v.$ui.slides.find("."+m),o=e.data("model");v.$currentSlide=e,r.modalOptions.id=o.object_id,r.modalOptions.embedData=o,$.embed_modal_open(r).done(function(i){e.data("model",i.data),o.object_id&&e.find("."+u).removeClass(p).addClass(f),t(v)})}),d.removeSlide.on("click",function(){var t,i=v.$ui.slides.find("."+m),a=i.prev(),n=i.next();switch(i.remove(),!0){case!!n.length:t=n;break;case!!a.length:t=a}t?e(t,v):(v.$currentSlide=void 0,o(v))})},n.prototype.saveEmbed=function(e){var t=this,o=[],i=new EntityEmbed.embedTypes.image,a=t.$ui.slides.children();return t.model.images=[],a.removeClass(m).each(function(e){var a,n=$(this),l=n.data("model"),d=!l.object_id;n.addClass("saving").find("."+u).removeClass([b,p].join(" ")).addClass(v),i.model=l,a=i.saveEmbed(d),a.done(function(e,o){return function(i){return"ERROR"==i.status?void console.log("failed to put/post a slideshow image"):(o.removeClass("saving").addClass("complete").find("."+u).removeClass(v).addClass(h),void(t.model.images[e]={object_id:i.response.object_id,order:e}))}}(e,n)).fail(function(e,t){return function(o,i,a){console.log("failed to save a slideshow image number "+e,a),t.removeClass("saving").addClass("error").find("."+u).removeClass(v).addClass(y)}}(e,n)),o.push(a)}),$.when.apply($,o).then(function(){return console.log("all images saved.",t.model.images),t.parent.saveEmbed(e,t)})},n.prototype.getModelFromForm=function(e){var t=this,o=t.$ui.slides.children();t.parent.getModelFromForm(e.find("form").first(),t),t.model.images=[],o.each(function(e){var o=$(this),i=o.data("model");t.model.images[e]={object_id:i.object_id,order:e}})},n.prototype.populateFormWithModel=function(t){var a=this,n=a.$ui,l=new EntityEmbed.embedTypes.image,d=[];if(a.parent.populateFormWithModel(t.find("form").first(),a),!a.model.images.length)return void o(a);a.model.images.sort(function(e,t){return!!e&&!!t&&e.order-t.order});for(var r=0;r<a.model.images.length;r++)if(a.model.images[r]){var s=EntityEmbed.apiService.get({path:l.options.httpPaths.get,data:{object_id:a.model.images[r].object_id+"err",auth_token:EntityEmbed.apiService.getAuthToken}});s.done(function(e){return function(t){return"ERROR"===t.status||"string"==typeof t.response?void console.log("Could not load slideshow image number "+e.order,e,t):void $.extend(!0,e,t.response)}}(a.model.images[r])).fail(function(e){return function(t,o,i){console.log("Could not load slideshow image number "+e.order,e,i)}}(a.model.images[r])),d.push(s)}$.when.apply($,d).done(function(){var t,o,l,d;for(t=0,o=a.model.images.length;o>t;t++)l=n.slideTemplate.clone(!0),l.data("model",a.model.images[t]),n.slides.append(l),0===t&&(d=l);e(d,a),i(a)})},n.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),o(t)}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="twitter",o={viewPath:"modal_twitter.html",displayName:"Twitter",object_type:"twitter",validationOptions:{rules:{title:"required",url:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=6,e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),t.model.embedCode='<blockquote class="twitter-tweet" data-lang="en"><a href="'+t.model.url+'"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>'},e.prototype.cleanModel=function(){return{title:null,url:null,embedCode:null}},e.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed"><div class="overlay">'+e.model.embedCode+"</div></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var i=this;i.parent.constructor(e,o,t,i)}var t="video",o={viewPath:"modal_video.html",displayName:"Video",object_type:"video",validationOptions:{rules:{title:"required",url:{required:!0,validDomain:!0}}}},i=function(e){if(-1!==e.indexOf("vimeo.com")){var t="?"+["title=0","portrait=0","byline=0","color=dc5555"].join("&");return"//player.vimeo.com/video/"+a(e)+t}if(-1!==e.indexOf("youtube.com")){var t="?"+["showinfo=0","modestbranding=1","rel=0"].join("&");return"//www.youtube.com/embed/"+n(e)+t}return""},a=function(e){var t=e.indexOf("/")>-1?e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},n=function(e){var t=e.indexOf("/")>-1?e.indexOf("/watch")>-1?e.match(/v=([^&]+)(?:&|$)/i)[1]:e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=4,e.prototype.cleanModel=function(){return{title:null,url:null}},e.prototype.init=function(e){var t=this;t.parent.init(e,t),$.validator.addMethod("validDomain",function(e,t,o){var i=-1!=e.indexOf("youtube.com")||-1!=e.indexOf("vimeo.com");return this.optional(t)||i},"The video must be from YouTube or Vimeo")},e.prototype.parseForEditor=function(){var e=this;return'<div class="video-embed"><div class="overlay"><iframe src="'+i(e.model.url)+'"	frameborder="0"></iframe></div></div>'}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e,t){var o;o=t.id||t.embedData?EntityEmbed.embedModalTypes.edit:t.embedTypeStr?t.selectExisting?EntityEmbed.embedModalTypes.selectExistingSingle:EntityEmbed.embedModalTypes.addSingle:t.selectExisting?EntityEmbed.embedModalTypes.selectExisting:EntityEmbed.embedModalTypes.add;var i={$currentEditorLocation:t.$currentEditorLocation,modalType:o,embedId:t.id,embedType:t.embedTypeStr,parentModal:t.parentModal,buffered:t.bufferData,embedData:t.embedData};return e.openModal(i)}$.embed_modal_create=function(e){function t(){var t;o.$embedTypeSelect&&o.$embedTypeSelect.length||(o.$embedTypeSelect=a.find(e.embedTypeSelect)),o.$modalBody&&o.$modalBody.length||(o.$modalBody=a.find(e.modalBody)),e.modalOptions.$abortEl&&e.modalOptions.$abortEl.length||(e.modalOptions.$abortEl=a.find(e.abortEl)),e.modalOptions.$completeEl&&e.modalOptions.$completeEl.length||(e.modalOptions.$completeEl=a.find(e.completeEl)),t=new EntityEmbed.embedModalDefaults,e.modalOptions=$.extend(!0,{},t,e.modalOptions),a.modal(e.modalOptions,o),a.hide(),m.resolve(a)}var o,i,a,n,l,d,r={modalOptions:{},modalScope:{$embedTypeSelect:null,$modalBody:null,$abortEl:null},$modalEl:null,modalHtmlLocation:"modal/",modalContainer:"body",modalFileName:"modal_main.html",modalElId:"embed-modal",modalBody:".embed-modal-body",abortEl:"#btn-abort-modal",completeEl:"#btn-save-modal",embedTypeSelect:"#select-embed-type",authToken:null,domainName:null,embedTypes:{image:{},slideshow:{},video:{},audio:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},globalBuzz:{},newsletterSubscribe:{},iframe:{},customText:{}}},s=[],m=$.Deferred();if(l=$.extend(!0,{},r,e),l.modalOptions&&l.modalOptions.parentModal&&(d=l.modalOptions.parentModal.scope.currentEmbedType),l.embedTypes=!!e&&e.embedTypes,l.embedTypes||(l.embedTypes=r.embedTypes),d&&delete l.embedTypes[d.name],e=l,i=$(e.modalContainer),a=e.$modalEl&&e.$modalEl.length?e.$modalEl:i.find("#"+e.modalElId),a.length||(a=$('<div class="embed-modal" id="'+e.modalElId+'"></div>'),i.append(a)),o=a.data("scope"))return m.resolve(a),m;o={$modalEl:a};for(var c in EntityEmbed.embedTypes)if(e.embedTypes[c]){var u=new EntityEmbed.embedTypes[c](e.embedTypes[c]);s.push(u),e.modalOptions.embedTypeStr&&e.modalOptions.embedTypeStr===c&&(o.currentEmbedType=u)}return s.sort(function(e,t){return e.orderIndex-t.orderIndex}),o.embedTypes=s,o=$.extend(!0,{},e.modalScope,o),o.modalHtmlLocation=e.modalHtmlLocation,EntityEmbed.$embedModal=a,EntityEmbed.modalExists=!0,e.authToken&&EntityEmbed.apiService.setAuthToken(e.authToken),e.domainName&&EntityEmbed.apiService.setDomainName(e.domainName),e.modalFileName?(n=e.modalHtmlLocation+e.modalFileName,EntityEmbed.templateCache&&EntityEmbed.templateCache[n]?(a.html(EntityEmbed.templateCache[n]),t()):a.load(n,function(e,o,i){return console.log("embed modal load completed with status: "+o),"error"===o?void m.reject():(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[n]=$(this).html(),void t())})):t(),m},$.embed_modal_open=function(t){var o={$currentEditorLocation:$(""),embedTypeStr:null,id:null,selectExisting:!1},i=$.Deferred();return $.embed_modal_create(t).done(function(a){e(a,$.extend(!0,{},o,t.modalOptions||{})).done(function(e){i.resolve(e)}).fail(function(){i.reject()})}),i}}();var EntityEmbed=EntityEmbed||{};!function(e,t,o,i){"use strict";function a(e){var t,o,i="[[",a="]]";return o=[m,e.index,e.id].join(":"),t=[i,o,a].join("")}function n(t,o){var i=e.grep(o,function(e){return e.options.object_type==t})[0];return i&&e.extend(!0,{},i)}function l(){var e;return t.getSelection?e=t.getSelection():o.getSelection?e=o.getSelection():o.selection&&(e=o.selection.createRange()),e}function d(e,i){var a,n;e.focus(),"undefined"!=typeof t.getSelection&&"undefined"!=typeof o.createRange?(a=o.createRange(),n=t.getSelection(),a.selectNodeContents(e),a.collapse(i),n.removeAllRanges(),n.addRange(a)):"undefined"!=typeof o.body.createTextRange&&(a=o.body.createTextRange(),a.moveToElementText(e),a.collapse(i),a.select())}function r(o,i){var a=this;a.el=o,a.$el=e(o),a.templates=t.MediumInsert.Templates,a.core=a.$el.data("plugin_"+s),a.options=e.extend(!0,{},b,i),a._defaults=b,a._name=s,a.toolbarManager=new EntityEmbed.toolbarManager(a,a.options.styles,a.options.actions,c),a.core.getEditor()&&(a.core.getEditor().get_content=function(){return a.getContent()},a.core.getEditor().load_content=function(e){a.loadContent(e)}),a.init()}var s="mediumInsert",m="EntityEmbeds",c="entity-embed-active",u=".medium-insert-active",c="entity-embed-active",p="entity-embed-container",b={label:'<span class="fa fa-code"></span>',authToken:null,domainName:null,styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}},newline:{label:'<span class="fa fa-i-cursor"></span>',clicked:function(e,t){e.addNewline(t)}}}};r.prototype.init=function(){var o=this;o.options.authToken&&EntityEmbed.apiService.setAuthToken(o.options.authToken),o.options.domainName&&EntityEmbed.apiService.setDomainName(o.options.domainName),o.toolbarManager.createActionToolbar(e("body")),o.$el.sortable({handle:".entity-embed-blocker",placeholder:"entity-embed-placeholder",distance:5,start:function(e,t){var i=[t.placeholder.attr("class"),t.helper.attr("class")].join(" ");t.placeholder.attr("class",i),t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.width()),o.toolbarManager.hideToolbar()},stop:function(i,a){var n=a.item.find("figure"),l=n.data("embed"),d=EntityEmbed.embedModalDefaults.prototype.generateEmbedHtml(l),r=e(d);a.item.height(a.placeholder.height()),n.html(r.html()),o.activateEmbed(l),o.core.triggerInput(),t.setTimeout(function(){a.item.removeAttr("style")},2e3)},change:function(){o.core.positionButtons(),o.core.getEditor().checkSelection()}}),o.events(),e.embed_modal_create().done(function(t){var i=t.data("scope");o.$embedModal=t,o.embedTypes=i.embedTypes;for(var a=0,n=o.embedTypes.length;n>a;a++)o.toolbarManager.createStyleToolbar(e("body"),o.embedTypes[a])})},r.prototype.events=function(){function i(e){var t=e.parent();return t[0]!==a.el?i(t):e}var a=this,n=n=a.core.getEditor();n.subscribe("editableInput",function(t,o){var i=["p > ol","p > ul","p > p","p > div"].join(","),a=["li > span[style]"].join(","),l="<p><br></p>",d=e(o),r=d.find(i),s=d.find(a);r.each(function(){var t=e(this);t.unwrap(),n.selectElement(this)}),s.removeAttr("style"),d.find("div > br:only-child").parent().replaceWith(l),d.children().not(".medium-insert-buttons").length||d.prepend(l)}),e(t).on("resize",function(){var t=e("."+c);a.toolbarManager.positionToolbars(t)}),e(o).on("click",function(t){e(t.target).is(".medium-editor-action")||e(t.target.parentElement).is(".medium-editor-action")||0==a.$el.find("."+c).length||(e("."+c).removeClass(c),a.toolbarManager.hideToolbar())}),a.$el.on("click","."+p,function(t){a.toggleSelectEmbed(e(this)),t.stopPropagation()}).on("keydown",function(t){var o,r,s,m,c,u,b,f,v,h,y=[".entity-embed-container","[contenteditable]"].join(","),g=":not("+y+")";8!==t.which&&46!==t.which||(o=l(),o.rangeCount&&(r=o.getRangeAt(0),m=r.endOffset-r.startOffset,f=e(o.anchorNode),s=f.text().length,c=a.$el.children().not(".medium-insert-buttons").length,u=!1,b=!1,m>0||(3===f[0].nodeType&&(f=f.closest(g)),f=i(f),u=f.is(g)&&!f.text().length,8===t.which&&0===o.anchorOffset?v=f.prev():46===t.which&&o.anchorOffset===s&&(v=f.next()),v&&(b=v.is("."+p),v.children().length||v.text().length||v.append("<br>")),(u&&1>=c||b)&&t.preventDefault(),u&&c>1&&(t.preventDefault(),8===t.which?h=f.prevAll(g).first():46===t.which&&(h=f.nextAll(g).first()),h.children().length||h.text().length||h.append("<br>"),n.selectElement(h[0]),d(h[0],46===t.which),n.checkSelection(),f.remove(),a.core.triggerInput()))))}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=a.$el.find("."+c).length&&a.toolbarManager.hideToolbar()})},r.prototype.getCore=function(){return this.core},r.prototype.getContent=function(){var t=this,o=t.core.getEditor().serialize(),i={html:"",embeds:[]};return e.each(o,function(t){var n,l;n=e("<div />").html(o[t].value),l=n.find(".entity-embed-container",n),l.removeClass(c),l.each(function(t){var o,n,l,d;o=e(this),n=o.find("figure"),n?(l={index:t,id:n.attr("id"),type:n.attr("data-embed-type")},i.embeds.push(l),d=a(l),o.html(d)):o.remove()}),i.html+=n.html()}),i},r.prototype.loadContent=function(t){function o(t){var o;if(!t)return void i();if(l=t.html||"",!t.embeds)return void i();r=[],o=[];for(var m=0;m<t.embeds.length;m++)if(d=n(t.embeds[m].type,s.embedTypes)){d.model=d.cleanModel(),t.embeds[m].embedType=d;var c=EntityEmbed.apiService.get({path:t.embeds[m].embedType.options.httpPaths.get,data:{object_id:t.embeds[m].id}});c.done(function(e){return function(t){var o,i;return"ERROR"===t.status?(console.log("failed to get embed object!"),t):(e.embedType.model=t.response,r.push(e),i=a(e),o=EntityEmbed.embedModalDefaults.prototype.generateEmbedHtml(e.embedType,!1),void(l=l.split(i).join(o)))}}(t.embeds[m])),o.push(c)}e.when.apply(e,o).done(function(){var e,t,o,a={};i();for(var n=0;n<r.length;n++)e=r[n],a[e.id]||(a[e.id]=!0,t=s.$el.find('[id="'+e.id+'"]'),o=t.html(),t.html(o),s.addEmbed(t,e.embedType,!0))})}function i(){s.core.getEditor().setContent(l),s.$el.sortable("refresh")}var l,d,r,s=this,m="string"==typeof t,c=m&&/<[^>]>/g.test(t);return t?(l=m?c?t:"":t.html,void(m&&!c?EntityEmbed.apiService.get({path:"admin/embed/edit",data:{object_id:t}}).done(function(e){return"ERROR"===e.status?void console.log("Failed to get story with id "+t):void o(e.repsonse)}).fail(function(e){console.log("Failed to get story with id "+t)}):o(t))):void console.log("Must provide either story id or serialized story data.")},r.prototype.add=function(){var t=this,o={modalOptions:{$currentEditorLocation:e(u)}};e.embed_modal_open(o).done(function(e){t.addEmbed(e.$embed,e.embedType)})},r.prototype.editEmbed=function(t){var o=this,i=t.find("figure").attr("id"),a={modalOptions:{$currentEditorLocation:e("."+c),id:i,embedTypeStr:t.find("[data-embed-type]").attr("data-embed-type")}};o.toolbarManager.hideToolbar(),e.embed_modal_open(a).done(function(t){var a=e("[id="+i+"]",o.$el),n=e.extend(!0,{},t.embedType);a.each(function(){var t=e(this),o=EntityEmbed.embedModalDefaults.prototype.generateEmbedHtml(n),i=e(o);t.data("embed",n),t.html(i.html())}),o.activateEmbed(n),o.core.triggerInput()})},r.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove(),t.core.triggerInput()},r.prototype.addNewline=function(e){var t=this,o="<p><br></p>";e.before(o),e.after(o),t.toolbarManager.positionToolbars(e)},r.prototype.toggleSelectEmbed=function(t){var o=this,i=e("."+c),a=t.find("[data-embed-type]").attr("data-embed-type"),l=n(a,o.embedTypes);o.toolbarManager.hideToolbar(),i.toggleClass(c),t.toggleClass(c),o.options.actions&&(t.hasClass(c)?o.toolbarManager.showToolbars(t,l.name):o.toolbarManager.hideToolbar())},r.prototype.addEmbed=function(t,o,i){var a,n=this,l=o.defaultStyle.replace("entity-embed-","");t.is("figure")&&(t=t.closest("."+p)),a=t.find("figure"),n.toolbarManager.addStyle(t,o.defaultStyle,l,!1),e('[id="'+o.model.object_id+'"]',n.$el).data("embed",e.extend(!0,{},o)),n.activateEmbed(o),n.$el.sortable("refresh"),n.core.hideButtons(),i||n.core.triggerInput()},r.prototype.activateEmbed=function(e){var t=e.embedType||e;"function"==typeof t.activateEmbed&&t.activateEmbed()},e.fn[s+m]=function(t){return this.each(function(){e.data(this,"plugin_"+s+m)||e.data(this,"plugin_"+s+m,new r(this,t))})}}(jQuery,window,document);var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),o>t?-1:t>o?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,i=e.categories.length;i>o;o+=1){var a=e.categories[o];for(var n in d.categories[0])void 0===a[n]&&(a[n]=d.categories[0][n]);t.push(a)}e.categories=t}}function o(){function t(e,o){var i=e||{};for(var a in e)void 0!==o[a]&&null!==o[a]&&("object"!=typeof o[a]||o[a]instanceof Array?i[a]=o[a]:t(e[a],o[a]));return void 0!==o.data&&null!==o.data&&"object"==typeof o.data&&(i.data=o.data),i}d=t(d,e)}function i(){if("list-required"!==d.url&&"function"!=typeof d.url){var t=d.url;d.url=function(){return t}}if(void 0!==d.ajaxSettings.url&&"function"!=typeof d.ajaxSettings.url){var t=d.ajaxSettings.url;d.ajaxSettings.url=function(){return t}}if("string"==typeof d.listLocation){var o=d.listLocation;"XML"===d.dataType.toUpperCase()?d.listLocation=function(e){return $(e).find(o)}:d.listLocation=function(e){return e[o]}}if("string"==typeof d.getValue){var i=d.getValue;d.getValue=function(e){return e[i]}}void 0!==e.categories&&(d.categoriesAssigned=!0)}function a(){void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?d.ajaxSettings=e.ajaxSettings:d.ajaxSettings={}}function n(e){return void 0!==d[e]&&null!==d[e]}function l(e,t){function o(t,i){for(var a in i)void 0===t[a]&&e.log("Property '"+a+"' does not exist in EasyAutocomplete options API."),"object"==typeof t[a]&&-1===$.inArray(a,r)&&o(t[a],i[a])}o(d,t)}var d={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=d.getValue(e),t=d.getValue(t),t>e?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e,t){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},r=["ajaxSettings","template"];this.get=function(e){return d[e]},this.equals=function(e,t){return!(!n(e)||d[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==d.url||"list-required"!==d.data},this.checkRequiredProperties=function(){for(var e in d)if("required"===d[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){l(e,t)},t(),o(),d.loggerEnabled===!0&&l(console,e),a(),i()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function o(t,o){function i(){var i,a={};return void 0!==t.xmlElementName&&(a.xmlElementName=t.xmlElementName),void 0!==t.listLocation?i=t.listLocation:void 0!==e.get("listLocation")&&(i=e.get("listLocation")),void 0!==i?"string"==typeof i?a.data=$(o).find(i):"function"==typeof i&&(a.data=i(o)):a.data=o,a}function a(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=o[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(o)):e.data=o,e}var n={};if(n="XML"===e.get("dataType").toUpperCase()?i():a(),void 0!==t.header&&(n.header=t.header),void 0!==t.maxNumberOfElements&&(n.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(n.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var l=t.getValue;n.getValue=function(e){return e[l]}}else"function"==typeof t.getValue&&(n.getValue=t.getValue);else n.getValue=e.get("getValue");return n}function i(t){var o=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){o.push(this)}),o}this.init=function(t){var o=[],i={};return i.data=e.get("listLocation")(t),i.getValue=e.get("getValue"),i.maxListSize=e.get("list").maxNumberOfElements,o.push(i),o},this.updateCategories=function(t,i){if(e.get("categoriesAssigned")){t=[];for(var a=0;a<e.get("categories").length;a+=1){var n=o(e.get("categories")[a],i);t.push(n)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var o=0;o<t.length;o+=1)t[o].data=i(t[o]);return t},this.processData=function(o,i){for(var a=0,n=o.length;n>a;a+=1)o[a].data=t(e,o[a],i);return o},this.checkIfDataExists=function(e){for(var t=0,o=e.length;o>t;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(t,o,i){function a(e,o){var i=[],a="";if(t.get("list").match.enabled)for(var l=0,d=e.length;d>l;l+=1)a=t.get("getValue")(e[l]),n(a,o)&&i.push(e[l]);else i=e;return i}function n(e,o){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),o=o.toLowerCase()),!!t.get("list").match.method(e,o)}function l(e){return void 0!==o.maxNumberOfElements&&e.length>o.maxNumberOfElements&&(e=e.slice(0,o.maxNumberOfElements)),e}function d(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}e.proccess.match=n;var r=o.data,s=i;return r=a(r,s),r=l(r),r=d(r)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},o=function(e){var o,i=e.fields;return"description"===e.type?(o=t.description.method,"string"==typeof i.description?o=function(e,t){return e+" - <span>"+t[i.description]+"</span>"}:"function"==typeof i.description&&(o=function(e,t){return e+" - <span>"+i.description(t)+"</span>"}),o):"iconRight"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return e+"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"}:"function"==typeof i.iconSrc&&(o=function(e,t){return e+"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"}),
o):"iconLeft"===e.type?("string"==typeof i.iconSrc?o=function(e,t){return"<img class='eac-icon' src='"+t[i.iconSrc]+"' />"+e}:"function"==typeof i.iconSrc&&(o=function(e,t){return"<img class='eac-icon' src='"+i.iconSrc(t)+"' />"+e}),o):"links"===e.type?("string"==typeof i.link?o=function(e,t){return"<a href='"+t[i.link]+"' >"+e+"</a>"}:"function"==typeof i.link&&(o=function(e,t){return"<a href='"+i.link(t)+"' >"+e+"</a>"}),o):"custom"===e.type?e.method:t.basic.method},i=function(e){return e&&e.type&&e.type&&t[e.type]?o(e):t.basic.method},a=function(e){var o=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var o=t[e.type].cssClass;return function(){return o}}():o};this.getTemplateClass=a(e),this.build=i(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,o){function i(){return 0===g.length?void f.error("Input field doesn't exist."):b.checkDataUrlProperties()?b.checkRequiredProperties()?(a(),void l()):void f.error("Will not work without mentioned properties."):void f.error("One of options variables 'data' or 'url' must be defined.")}function a(){function e(){var e=$("<div>"),o=p.getValue("WRAPPER_CSS_CLASS");b.get("theme")&&""!==b.get("theme")&&(o+=" eac-"+b.get("theme")),b.get("cssClasses")&&""!==b.get("cssClasses")&&(o+=" "+b.get("cssClasses")),""!==v.getTemplateClass()&&(o+=" "+v.getTemplateClass()),e.addClass(o),g.wrap(e),b.get("adjustWidth")===!0&&t()}function t(){var e=g.outerWidth();g.parent().css("width",e)}function o(){g.unwrap()}function i(){var e=$("<div>").addClass(p.getValue("CONTAINER_CLASS"));e.attr("id",n()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(b.get("list").showAnimation.type){case"slide":var t=b.get("list").showAnimation.time,o=b.get("list").showAnimation.callback;e.find("ul").slideDown(t,o);break;case"fade":var t=b.get("list").showAnimation.time,o=b.get("list").showAnimation.callback;e.find("ul").fadeIn(t),o;break;default:e.find("ul").show()}b.get("list").onShowListEvent()}).on("hide.eac",function(){switch(b.get("list").hideAnimation.type){case"slide":var t=b.get("list").hideAnimation.time,o=b.get("list").hideAnimation.callback;e.find("ul").slideUp(t,o);break;case"fade":var t=b.get("list").hideAnimation.time,o=b.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,o);break;default:e.find("ul").hide()}b.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(T).addClass("selected"),b.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,o,i){var a="",n=e.find("ul");n.empty().detach(),w=[];for(var d=0,r=0,m=o.length;m>r;r+=1){var c=o[r].data;if(0!==c.length){void 0!==o[r].header&&o[r].header.length>0&&n.append("<div class='eac-category' >"+o[r].header+"</div>");for(var u=0,p=c.length;p>u&&d<o[r].maxListSize;u+=1)a=$("<li><div class='eac-item'></div></li>"),function(){var e=u,t=d,n=o[r].getValue(c[e]);a.find(" > div").on("click",function(){g.val(n).trigger("change"),T=t,s(t),b.get("list").onClickEvent(),b.get("list").onChooseEvent()}).mouseover(function(){T=t,s(t),b.get("list").onMouseOverEvent()}).mouseout(function(){b.get("list").onMouseOutEvent()}).html(v.build(l(n,i),c[e]))}(),n.append(a),w.push(c[u]),d+=1}}e.append(n),b.get("list").onLoadEvent()})}(),g.after(e)}function a(){g.next("."+p.getValue("CONTAINER_CLASS")).remove()}function l(e,t){return b.get("highlightPhrase")&&""!==t?r(e,t):e}function d(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function r(e,t){var o=d(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}g.parent().hasClass(p.getValue("WRAPPER_CSS_CLASS"))&&(a(),o()),e(),i(),E=$("#"+n()),b.get("placeholder")&&g.attr("placeholder",b.get("placeholder"))}function n(){var e=g.attr("id");return e=p.getValue("CONTAINER_ID")+e}function l(){function e(){y("autocompleteOff",!0)&&p(),t(),o(),i(),a(),n(),l()}function t(){g.focusout(function(){var e,t=g.val();b.get("list").match.caseSensitive||(t=t.toLowerCase());for(var o=0,i=w.length;i>o;o+=1)if(e=b.get("getValue")(w[o]),b.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return T=o,void s(T)})}function o(){g.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=b.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];return e}function o(e,t){return b.get("matchResponseProperty")!==!1?"string"==typeof b.get("matchResponseProperty")?t[b.get("matchResponseProperty")]===e:"function"==typeof b.get("matchResponseProperty")?b.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<b.get("minCharNumber"))){if("list-required"!==b.get("data")){var i=b.get("data"),a=h.init(i);a=h.updateCategories(a,i),a=h.processData(a,e),m(a,e),g.parent().find("li").length>0?d():r()}var n=t();void 0!==n.url&&""!==n.url||(n.url=b.get("url")),void 0!==n.dataType&&""!==n.dataType||(n.dataType=b.get("dataType")),void 0!==n.url&&"list-required"!==n.url&&(n.url=n.url(e),n.data=b.get("preparePostData")(n.data,e),$.ajax(n).done(function(t){var i=h.init(t);i=h.updateCategories(i,t),i=h.convertXml(i),o(e,t)&&(i=h.processData(i,e),m(i,e)),h.checkIfDataExists(i)&&g.parent().find("li").length>0?d():r(),b.get("ajaxCallback")()}).fail(function(){f.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:r(),c();break;case 38:e.preventDefault(),w.length>0&&T>0&&(T-=1,g.val(b.get("getValue")(w[T])),s(T));break;case 40:e.preventDefault(),w.length>0&&T<w.length-1&&(T+=1,g.val(b.get("getValue")(w[T])),s(T));break;default:if(e.keyCode>40||8===e.keyCode){var o=g.val();b.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?b.get("requestDelay")>0?(void 0!==u&&clearTimeout(u),u=setTimeout(function(){t(o)},b.get("requestDelay"))):t(o):r()}}})}function i(){g.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&T>-1&&(g.val(b.get("getValue")(w[T])),b.get("list").onKeyEnterEvent(),b.get("list").onChooseEvent(),T=-1,r(),e.preventDefault())})}function a(){g.off("keypress")}function n(){g.focus(function(){""!==g.val()&&w.length>0&&(T=-1,d())})}function l(){g.blur(function(){setTimeout(function(){T=-1,r()},250)})}function p(){g.attr("autocomplete","off")}e()}function d(){E.trigger("show.eac")}function r(){E.trigger("hide.eac")}function s(e){E.trigger("selectElement.eac",e)}function m(e,t){E.trigger("loadElements.eac",[e,t])}function c(){g.trigger("blur")}var u,p=new e.Constans,b=new e.Configuration(o),f=new e.Logger,v=new e.Template(o.template),h=new e.ListBuilderService(b,e.proccess),y=b.equals,g=t,E="",w=[],T=-1;e.consts=p,this.getConstants=function(){return p},this.getConfiguration=function(){return b},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return T},this.getItems=function(){return w},this.getItemData=function(e){return w.length<e||void 0===w[e]?-1:w[e]},this.getSelectedItemData=function(){return this.getItemData(T)},this.build=function(){a()},this.init=function(){i()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e.setHandle=function(t,o){e.eacHandles[o]=t},e}(EasyAutocomplete||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each(function(){var o=e(this),i=new EasyAutocomplete.main(o,t);EasyAutocomplete.inputHasId(o)||EasyAutocomplete.assignRandomId(o),i.init(),EasyAutocomplete.setHandle(i,o.attr("id"))})},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var o=e(this).attr("id");return void 0!==o&&t>-1?EasyAutocomplete.getHandle(o).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery);