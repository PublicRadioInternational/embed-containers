var EntityEmbed=EntityEmbed||{};!function(){function e(e){e=$.extend(!0,{},l,e);var t={timeout:15e3,crossDomain:!0,type:e.methodType,dataType:"json",jsonp:!1,url:e.domainName+e.path};return e.headers?(e.headers["x-auth-token"]=e.auth_token,e.headers["x-debug"]=e.debug,t.headers=e.headers,t.processData=!1,t.contentType=!1,t.data=e.data,"function"==typeof e.xhr&&(t.xhr=e.xhr)):(e.data.debug=e.debug,e.data.auth_token=e.auth_token,t.data=JSON.stringify(e.data)),$.ajax(t)}function t(t){return t.methodType="POST",e(t)}function o(t){return t.methodType="POST",e(t)}function n(t){return t.methodType="POST",e(t)}function i(e){l.auth_token=e}function r(e){return l.auth_token}function a(e){return l.domainName}function d(e){l.domainName=e,l.domainName.endsWith("/")||(l.domainName+="/")}var l={data:{},debug:0,auth_token:"",domainName:"",path:""},s=/^[^.]*staging[^.]*\.|\.dev$/,c=s.test(window.location.host);c&&(l.auth_token="abc123",l.debug=1),EntityEmbed.apiService={set:t,get:o,uploadFile:n,setAuthToken:i,getAuthToken:r,getDomainName:a,setDomainName:d}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+n);return o}function t(e){var t=e.closest("[contenteditable]"),o=t.data("plugin_"+n+i);return o}var o={},n="mediumInsert",i="EntityEmbeds",r="entity-embed-active",a="medium-editor-button-active",d="medium-insert-images-toolbar",l="medium-insert-images-toolbar2",s=".entity-embed-secondary-toolbar-locator",c="entityEmbedToolbarEventsReady",u="entity-embed-toolbar",p=function(e,t){var o=u;t?(o+=" medium-insert-images-toolbar medium-editor-toolbar medium-editor-stalker-toolbar medium-toolbar-arrow-under medium-editor-toolbar-active ",o+=t+"StyleToolbar"):o+=" medium-insert-images-toolbar2 medium-editor-toolbar medium-toolbar-arrow-after medium-editor-toolbar-active";var n='<div class="'+o+'"><ul class="medium-editor-toolbar-actions clearfix">';for(var i in e){var r=e[i];r.label&&(n+='<li><button class="medium-editor-action" data-action="'+i+'">'+r.label+"</button></li>")}return n+="</ul></div>"};toolbarManager=function(e,t,o,n){var i=this;i.mediumEditorAddon=e,i.styles=t,i.actions=o,i.embedTypes=[],n&&(r=n),i.events()},toolbarManager.prototype.events=function(){var e=this,t=$(document);t.data(c)||t.data(c,!0).on("click","."+d+" .medium-editor-action",function(){e.styleToolbarDo($(this))}).on("click","."+l+" .medium-editor-action",function(){e.actionToolbarDo($(this))})},toolbarManager.prototype.createActionToolbar=function(e){var t=this,o=e.find("."+l);o.length||(o=$(p(t.actions)),e.append(o)),t.$actionToolbar=o,t.$actionToolbar.hide()},toolbarManager.prototype.createStyleToolbar=function(e,t){var n=this,i=$.extend(n.styles,{}),r=!0,a=e.find("."+d+"."+t.name+"StyleToolbar");if(n.embedTypes[t.name]=t,t.options.styles){for(var l in t.options.styles)t.options.styles[l]?r=!1:delete i[l];r||(a.length||(a=$(p(i,t.name)),e.append(a)),o[t.name]=a,o[t.name].hide())}},toolbarManager.prototype.showToolbars=function(e,t){var n,i=this,d=$("."+r);i.currentToolbarEmbedType=t,i.$actionToolbar.show(),o[i.currentToolbarEmbedType]&&(o[i.currentToolbarEmbedType].find("button").each(function(){d.hasClass("entity-embed-"+$(this).data("action"))&&(n=$(this),n.addClass(a))}),o[i.currentToolbarEmbedType].show(),n&&n.addClass(a)),i.positionToolbars(e)},toolbarManager.prototype.styleToolbarDo=function(t){var o=this,n=t.closest("li").closest("ul"),i=$("."+r),d=e(i);n.find("."+a).removeClass(a),t.addClass(a),n.find("button").each(function(){var e=$(this),t="entity-embed-"+e.data("action");e.hasClass(a)?o.addStyle(i,t,e.data("action"),!0):(i.removeClass(t),o.styles[e.data("action")].removed&&o.styles[e.data("action")].removed(i))}),o.mediumEditorAddon.renderEmbed(i,!0),d.triggerInput()},toolbarManager.prototype.addStyle=function(e,t,o,n){function i(){var t=e.width(),o=e.height();t===a&&o===d||(l=1,a=t,d=o,r.positionToolbars(e)),20>l?(l++,r.positionToolbarsTimeout=window.setTimeout(function(){i()},100)):delete r.positionToolbarsTimeout}var r=this,a=e.width(),d=e.height(),l=0;window.clearTimeout(r.positionToolbarsTimeout),e.addClass(t),r.styles[o].added&&r.styles[o].added(e),n&&i()},toolbarManager.prototype.actionToolbarDo=function(e){var o=this,n=$("."+r),i=o.actions[e.data("action")].clicked,a=t(n);i(a,n)},toolbarManager.prototype.hideToolbar=function(){var e=this,t=$("."+u);t.hide(),t.find("button").removeClass(a),e.currentToolbarEmbedType=null,e.positionToolbarsTimeout&&(window.clearTimeout(e.positionToolbarsTimeout),delete e.positionToolbarsTimeout)},toolbarManager.prototype.positionToolbars=function(e){var t=this,n=e.find("> figure"),i=n.data("embed"),r=i.options.actionToolbarLocatorClass||s;if(e.length){var a=e.find(r);0===a.length&&(a=e),c=e.offset().top+e.height()/2-t.$actionToolbar.height()/2;var d=a.offset().left+a.outerWidth()+8+4;d>$(window).width()-t.$actionToolbar.width()&&(d=$(window).width()-t.$actionToolbar.width()-50),t.$actionToolbar.css({top:Math.min(c,e.offset().top),left:d});var l=o[t.currentToolbarEmbedType];if(l){var c=e.offset().top-l.height()-8-2-5;0>c&&(c=0),l.css({top:c,left:e.offset().left+e.width()/2-l.width()/2})}}},EntityEmbed.toolbarManager=toolbarManager}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t,o,n){var i=n||this;i.name=o,t=$.extend(!0,{},i.defaultOptions,t),i.options=$.extend(!0,{},t,e),i.init()}e.prototype.defaultOptions={viewPath:"",displayName:"Generic",httpPaths:{set:"admin/embed/edit",get:"admin/embed/fetch",getAll:"admin/embed/list"},styles:{left:!0,right:!0,center:!0,wide:!0},validationOptions:{focusCleanup:!0,errorPlacement:function(e,t){var o=t.parent();o.is(".embed-modal-input-group, .input-group")?e.insertAfter(o):e.insertAfter(t)}}},e.prototype.cleanModel=function(){return{}},e.prototype.defaultStyle="entity-embed-center",e.prototype.init=function(){var e=this;e.model=e.cleanModel()},e.prototype.initModal=function(e,t,o){var n=o||this;n.modalCtrl=t,n.$el=e},e.prototype.getModelFromForm=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control, .embed-modal-file-input"),i=0;i<n.length;i++){var r=n[i].name,a=n[i].type,d=null;"file"===a?d=n[i].files[0]:n[i].value.length&&(d=n[i].value),r&&(o.model[r]=d)}},e.prototype.populateFormWithModel=function(e,t){for(var o=t||this,n=e.find(".embed-modal-form-control"),i=0;i<n.length;i++)if(!n[i].type||-1===n[i].type.indexOf("file"))if(n[i].type&&-1!==n[i].type.indexOf("select")){var r=$(n[i]).find("option"),a=o.model[n[i].name],d=0;r.each(function(e){this.value===a&&(d=e)}),n[i].selectedIndex=d}else o.model[n[i].name]&&(n[i].value=o.model[n[i].name])},e.prototype.clearForm=function(e,t){var o=t||this,n=e;n.is("form")||(n=e.find("form")),n.each(function(){$(this).validate(o.options.validationOptions).resetForm()});for(var i=e.find("form"),r=0;r<i.length;r++)i[r].reset();o.model=o.cleanModel()},e.prototype.parseForEditor=function(){var e=this;return'<div class="embedded-content"><div class="ui-text"> <strong>Embed Type: </strong>'+e.options.object_type+'</div><div class="ui-text"> <strong>Title: </strong> '+e.model.title+"</div></div>"},e.prototype.validate=function(e,t,o){var n=o||this,i=e;return i.is("form")||(i=e.find("form")),n.$validator=i.each(function(){$(this).validate(n.options.validationOptions)}),n.$validator},e.prototype.saveEmbed=function(e,t){var o=t||this;return o.model.object_type||(o.model.object_type=o.options.object_type),EntityEmbed.apiService.set({path:o.options.httpPaths.set,data:o.model}).done(function(e){o.staleModel=$.extend(!0,{},o.model)})},EntityEmbed.embedTypes={genericEmbed:e},Function.prototype.inherits||(Function.prototype.inherits=function(e){var t=this;return t.prototype=new e,t.prototype.constructor=t,t.prototype.parent=e.prototype,t})}(),function(){"use strict";function e(e,o,n){var i=this;i.$el=$(e),i.options=$.extend(!0,{},t,o),i.scope={},n&&(i.scope=n),i.scope.modalCtrl=i,i.$el.data("scope",i.scope),i.options.functions.init.before(i.scope),i.init(),i.options.functions.init.after(i.scope)}var t={contentClass:"embed-modal",backdropClass:"embed-modal-backdrop",closeBtnIcon:"fa fa-times",showCloseBtn:!0,$openEl:$(""),$abortEl:$(""),$completeEl:$(""),functions:{init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return!0},after:function(e){}}}};e.prototype.isActive=!1,e.prototype.activeClass="em-active",e.prototype.closeBtnClass="em-close-btn",e.prototype.generateId=function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.prototype.backdropHtml=function(e){var t=this;return'<div id="'+e+'" class="'+t.options.backdropClass+'"></div>'},e.prototype.closeBtnHtml=function(e){var t=this,o=t.closeBtnClass+" "+t.options.closeBtnIcon;return'<i id="'+e+'"" class="'+o+'"></i>'},e.prototype.toggle=function(e,t){var o=e.$el.data("scope");e.isActive=t,e.$el.toggle(e.isActive).toggleClass("in",e.isActive),e.$backdrop.toggle(e.isActive).toggleClass("in",e.isActive),o.parentModal||$("body").toggleClass("embed-modal-open",e.isActive)},e.prototype.init=function(){var e=this;e.$el.addClass(e.options.contentClass);var t=e.generateId();e.$el.before(e.backdropHtml(t)),e.$backdrop=$("#"+t),e.$el.click(function(t){t.target===e.$el[0]&&e.$el.abortModal()}),e.options.showCloseBtn&&(e.$closeBtn=e.$el.find(".close"),e.$closeBtn.click(function(){e.$el.abortModal()})),e.options.$openEl.click(function(){e.$el.openModal()}),e.options.$completeEl.click(function(){e.$el.completeModal()}),e.options.$abortEl.click(function(){e.$el.abortModal()})},e.prototype.registerEvent=function(e,t,o,n){var i=this;i.$el.find(e).on(t,function(e){o(e,i.$el.data("scope"),n)})},$.fn.modal=function(t,o){return this.each(function(){t||(t={}),$.data(this,"ctrl",new e(this,t,o))})},$.fn.openModal=function(e){var t=$.data(this[0],"ctrl");if(t){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");return t.promise=$.Deferred(),t.options.functions.open.before(i),t.toggle(t,!0),t.options.functions.open.after(i),t.promise}},$.fn.abortModal=function(e){return this.each(function(){var t=$.data(this,"ctrl");if(t&&t.isActive){if(e){var o=t.$el.data("scope"),n=$.extend(!0,{},o,e);t.$el.data("scope",n)}var i=t.$el.data("scope");t.options.functions.abort.before(i)&&(t.toggle(t,!1),t.options.functions.abort.after(i),"pending"===t.promise.state()&&t.promise.reject())}})},$.fn.completeModal=function(e){return this.each(function(){var t,o,n,i,r,a=$.data(this,"ctrl");a&&a.isActive&&(e&&(t=a.$el.data("scope"),o=$.extend(!0,{},t,e),a.$el.data("scope",o)),n=a.$el.data("scope"),i=a.options.functions.complete.before(n),"function"==typeof i.state?r=i:(r=$.Deferred(),i?r.resolve():r.reject()),r.done(function(e){e&&(n.currentEmbedType.model=e),a.toggle(a,!1),a.options.functions.complete.after(n),"pending"===a.promise.state()&&a.promise.resolve()}))})}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e){var o=this;e||(e={}),o.options=$.extend(!0,{},t,e)}var t={modalId:"leave-confirmation-modal",viewPath:"modal_confirmation.html",abortElId:"btn-cancel-leave",completeElId:"btn-confirm-leave"};e.prototype.init=function(e){var t=this;t.$abortEl=$("#"+t.options.abortElId,e.$modalEl),t.$completeEl=$("#"+t.options.completeElId,e.$modalEl)},e.prototype.functions={init:{before:function(e){},after:function(e){}},open:{before:function(e){},after:function(e){}},abort:{before:function(e){return!0},after:function(e){}},complete:{before:function(e){return e.parentModalCtrl.$el.abortModal({confirmedLeave:!0}),!0},after:function(e){}}},EntityEmbed.confirmModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){function e(){}EntityEmbed.embedModalTypes={add:0,addSingle:1,edit:2,selectExisting:3,selectExistingSingle:4};var t=void 0,o=!1,n={buttons:{saveEmbed:"#btn-save-modal",abortModal:"#btn-abort-modal",showSelectExisting:"#btn-show-select-existing",cancelSelectExisting:"#btn-cancel-select-existing"},containers:{createNewEmbed:"#embed-modal-create-new",selectExistingEmbed:"#embed-modal-select-existing",createButtons:"#embed-modal-buttons-create",selectButtons:"#embed-modal-buttons-select"},elements:{saveSpinner:"#embed-modal-spinner",headerText:".header-title"}},i=function(e,t){function o(o){e[o]=e[o]||{};for(key in n[o])n[o].hasOwnProperty(key)&&(e[o][key]=$(n[o][key],t))}for(groupKey in n)n.hasOwnProperty(groupKey)&&o(groupKey)},r=function(e,t){$(".editable").attr("contenteditable",t)},a=function(e){var t=!1;return e.find(":input:not(:button):not([type=hidden])").each(function(){var e=this;if(("text"==e.type||"textarea"==e.type||"hidden"==e.type)&&e.defaultValue!=e.value)return t=!0,!1;if(("radio"==e.type||"checkbox"==e.type)&&e.defaultChecked!=e.checked)return t=!0,!1;if("select-one"==this.type||"select-multiple"==this.type)for(var o=0;o<this.length;o++)if(this.options[o].selected!=this.options[o].defaultSelected)return hasChanges=!0,!1}),t},d=function(e,t){var o;t&&(e.isAdd=e.modalCtrl.isAdd=e.modalType===EntityEmbed.embedModalTypes.add||e.modalType===EntityEmbed.embedModalTypes.addSingle,e.isSingle=e.modalCtrl.isSingle=e.modalType===EntityEmbed.embedModalTypes.addSingle||e.modalType===EntityEmbed.embedModalTypes.selectExistingSingle,e.currentEmbedType&&(delete e.currentEmbedType.model,e.currentEmbedType.$view.hide(),e.currentEmbedType.clearForm(e.currentEmbedType.$view)),e.currentEmbedType=e.modalCtrl.scope.currentEmbedType=m(t,e.embedTypes),e.currentEmbedType.clearForm(e.currentEmbedType.$view),e.currentEmbedType.$view.show(),e.$embedTypeSelect[0].selectedIndex=e.currentEmbedType.optionIndex,o=e.headerText,o||(o="Add ",e.modalType===EntityEmbed.embedModalTypes.edit&&(o="Edit "),e.embedId||(o+="New "),o+=e.currentEmbedType.options.displayName),e.elements.headerText.text(o))},l=function(e){var t=e.embedTypes[0].options.object_type;d(e,t),e.$embedTypeSelect.show()},s=function(e){function t(){e.buffered?(u.response=$.extend(!0,{},e.currentEmbedType.model),n(u),r(u)):e.currentEmbedType.saveEmbed(d,e.currentEmbedType).done(n).fail(i).always(r)}function n(t){return"ERROR"===t.status?(console.log("POST failed (API)"),void c.reject()):"string"==typeof t.response?(console.log("Failed to POST embed type: "+t.response),void c.reject()):(e.currentEmbedType.model=t.response,d&&(e.currentEmbedType.model.object_id=t.response.object_id),console.log("POST succeeded",t),e.successCallback&&e.successCallback(t.response),void c.resolve(t.response))}function i(t,o,n){console.log("POST failed (XHR)",n),e.failCallback&&e.failCallback(),c.reject()}function r(t){o=!1,e.elements.saveSpinner.hide(),e.alwaysCallback&&e.alwaysCallback()}for(var a,d=e.modalType==EntityEmbed.embedModalTypes.add||e.modalType==EntityEmbed.embedModalTypes.addSingle,l=e.currentEmbedType.validate(e.currentEmbedType.$view,d),s=!0,c=$.Deferred(),u={},p=0;p<l.length;p++)s=$(e.currentEmbedType.$validator[p]).valid()&&s;return o||!s?(c.reject(),c):(o=!0,e.elements.saveSpinner.show(),a=e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view),"object"==typeof a&&"function"==typeof a.then?a.always(function(){t()}):t(),c)},c=function(e){e.skipSave=!1,e.buttons.showSelectExisting.toggle(!e.addOnly),e.isSingle?e.modalType=EntityEmbed.embedModalTypes.addSingle:(e.modalType=EntityEmbed.embedModalTypes.add,e.$embedTypeSelect.show()),e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown(),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.containers.selectExistingEmbed.find(".query-container").hide()},u=function(e){e.skipSave=!1,e.buttons.showSelectExisting.hide(),e.$embedTypeSelect.hide(),e.containers.selectExistingEmbed.is(":visible")&&(e.containers.selectExistingEmbed.slideUp(),e.containers.createNewEmbed.slideDown()),e.containers.selectButtons.hide(),e.containers.createButtons.show(),e.buttons.showSelectExisting.hide()},p=function(e){e.skipSave=!0,e.containers.createNewEmbed.slideUp(),e.containers.selectExistingEmbed.slideDown(),e.containers.createButtons.hide(),e.containers.selectButtons.show(),e.containers.selectExistingEmbed.find("."+e.currentEmbedType.options.object_type+"-query-container").show(),e.isSingle?(e.modalType=EntityEmbed.embedModalTypes.selectExistingSingle,e.$embedTypeSelect.hide()):(e.modalType=EntityEmbed.embedModalTypes.selectExisting,e.$embedTypeSelect.show())},m=function(e,t){var o=$.grep(t,function(t){return t.options.object_type==e})[0];return o&&$.extend(!0,{},o)},f=function(e,t){var o=(t.modalCtrl,/^[^.]*staging[^.]*\.|\.dev$/),n=o.test(window.location.host),i={auth_token:EntityEmbed.apiService.getAuthToken(),object_type:e.options.object_type};n&&(i.debug=1);var r={ajaxSettings:{dataType:"json",method:"POST",data:i},requestDelay:600,url:function(t){return i.title=t,EntityEmbed.apiService.getDomainName()+e.options.httpPaths.getAll},listLocation:function(e){return e.response.data},getValue:function(e){return e.title},preparePostData:function(o){return o.title=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(),JSON.stringify(o)},list:{maxNumberOfElements:20,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var o=t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').getSelectedItemData(),n=o.object_id;t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').val(""),EntityEmbed.apiService.get({path:e.options.httpPaths.get,data:{object_id:n}}).done(function(o){if("string"==typeof o.response)return void console.log("Failed to get list of current embed types for the Select Existing page: "+o.response);var n=jQuery.Event("existingItemSelected");n.embedModel=o.response,t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').trigger(n)}).fail(function(e){console.log("failed to get embed type!")})}}};t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').easyAutocomplete(r),t.containers.selectExistingEmbed.find('input[name="'+e.options.object_type+'-query"]').closest(".easy-autocomplete").removeAttr("style")},h=function(e){return'<div class="embed-modal-row '+e.options.object_type+'-query-container query-container"><div class="embed-modal-full-column"><label class="embed-modal-label" for="query">Search for '+e.options.displayName+'</label><input type="text" class="embed-modal-form-control" name="'+e.options.object_type+'-query" placeholder="begin typing '+e.options.displayName+' title "></div></div>'};e.prototype.functions={init:{before:function(e){i(e,e.modalCtrl.$el),t=e.embedTypes,e.elements.saveSpinner.hide()},after:function(e){function t(t,o){t.initModal(o,e.modalCtrl)}var o,i,r,a,l,s,u,m;for(e.modalCtrl.registerEvent(e.buttons.showSelectExisting,"click",function(e,t){p(t)}),e.modalCtrl.registerEvent(e.buttons.cancelSelectExisting,"click",function(e,t){c(t)}),e.modalCtrl.registerEvent(e.$embedTypeSelect,"change",function(t,o){var n=t.currentTarget.options[t.currentTarget.selectedIndex].value;o.currentEmbedType.clearForm(o.currentEmbedType.$view),d(o,n),o.modalType===EntityEmbed.embedModalTypes.selectExisting&&(e.containers.selectExistingEmbed.find(".query-container").hide(),e.containers.selectExistingEmbed.find("."+o.currentEmbedType.options.object_type+"-query-container").show())}),m=0;m<e.embedTypes.length;m++)s=e.embedTypes[m],e.containers.selectExistingEmbed.append(h(s)),o=e.containers.selectExistingEmbed.find('input[name="'+s.options.object_type+'-query"]'),f(s,e),e.containers.selectExistingEmbed.find("."+s.options.object_type+"-query-container").hide(),e.modalCtrl.registerEvent(o,"existingItemSelected",function(e,t){t.currentEmbedType.model=e.embedModel,t.modalCtrl.$el.completeModal()}),e.$embedTypeSelect.append('<option value="'+s.options.object_type+'">'+s.options.displayName+"</option>"),i=$('<div id="'+s.name+'"></div>'),e.containers.createNewEmbed.append(i),u=e.modalHtmlLocation+s.options.viewPath,EntityEmbed.templateCache&&EntityEmbed.templateCache[u]?(i.html(EntityEmbed.templateCache[u]),t(s,i)):i.load(u,function(e,o){return function(n,i,r){console.log(e.options.viewPath+" load completed with status: "+i),EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[o]=$(this).html(),t(e,$(this))}}(s,u)),s.$view=i,s.optionIndex=m,i.hide();l=new EntityEmbed.confirmModalDefaults,n.elements.confirmModal="#"+l.options.modalId,r=e.elements.confirmModal=$(n.elements.confirmModal,e.$modalEl),u=e.modalHtmlLocation+l.options.viewPath,a={parentModalCtrl:e.modalCtrl,$modalEl:r},EntityEmbed.templateCache&&EntityEmbed.templateCache[u]?(r.html(EntityEmbed.templateCache[u]),l.init(a),r.modal(l,a)):r.load(u,function(e,t,o){console.log("leave confirmation modal load completed with status: "+t),"error"!==t&&(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[u]=r.html(),l.init(a),r.modal(l,a))})}},open:{before:function(e){r(e,"false"),e.embedType?(d(e,e.embedType),delete e.embedType):l(e)},after:function(e){function t(t){t=t||{},t.html_rendered&&(t.html_rendered=null),d(e,t.object_type),e.currentEmbedType.model=t,e.currentEmbedType.staleModel=$.extend(!0,{},t),e.currentEmbedType.populateFormWithModel(e.currentEmbedType.$view)}switch(e.modalType){case EntityEmbed.embedModalTypes.edit:if(u(e),e.buffered){t(e.embedData),delete e.embedData;break}EntityEmbed.apiService.get({path:e.currentEmbedType.options.httpPaths.get,data:{object_id:e.embedId}}).done(function(e){return"string"==typeof e.response?void console.log("Failed to get embed type: "+e.response):void t(e.response)}).fail(function(e){console.log("failed to get embed type!")});break;case EntityEmbed.embedModalTypes.add:c(e);break;case EntityEmbed.embedModalTypes.addSingle:c(e),e.$embedTypeSelect.hide();break;case EntityEmbed.embedModalTypes.selectExisting:p(e);break;case EntityEmbed.embedModalTypes.selectExistingSingle:p(e,!0)}}},abort:{before:function(e){function t(e){var t;if(e)switch(typeof e){case"array":case"object":t=JSON.stringify(e);break;default:t=e}return t||null}var o,n,i=this;if(!e.confirmedLeave)if(e.modalType===EntityEmbed.embedModalTypes.edit&&e.currentEmbedType.staleModel){e.currentEmbedType.getModelFromForm(e.currentEmbedType.$view);for(var r in e.currentEmbedType.model)if(o=t(e.currentEmbedType.staleModel[r]),n=t(e.currentEmbedType.model[r]),o!==n)return e.elements.confirmModal.openModal({parentModal:i}),!1}else if(a(e.currentEmbedType.$view))return e.elements.confirmModal.openModal({parentModal:i}),!1;return e.currentEmbedType.clearForm(e.currentEmbedType.$view),delete e.confirmedLeave,!0},after:function(e){r(e,"true")}},complete:{before:function(e){return!!e.skipSave||s(e)},after:function(e){r(e,"true"),e.modalCtrl.promise.resolve({data:$.extend(!0,{},e.currentEmbedType.model),embedType:e.currentEmbedType}),e.currentEmbedType.clearForm(e.currentEmbedType.$view)}}},EntityEmbed.embedModalDefaults=e}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={};return o.title=t.name,o.credit=e.artist,o}function t(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function o(e,t){e.$ui=e.$ui||{form:t};for(key in s)s.hasOwnProperty(key)&&(e.$ui[key]=$(s[key],t));return e.$ui}function n(e){var t=e.$ui,o=$.Deferred(),n=e.getAudioUrl();return t.previewAudio.attr("src",n),r(e),o.resolve(),o}function i(e,t){var o=e.$ui,n=$.Deferred();return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(o.form).done(function(){n.resolve()})}),n}function r(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadBtn.hide(),t.previewContainer.show(),t.editFileBtn.show(),t.undoUploadBtn.toggle(!!e.model.url_path&&!!e.model.upload)}function a(e){var t=e.$ui;t.uploadFileInput.val(""),t.previewContainer.hide(),t.editFileBtn.hide(),t.undoUploadBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadBtn.toggle(!!(e.model.url_path||e.model.upload||e.model.url_external))}function d(e){var t=this;t.parent.constructor(e,c,l,t)}var l="audio",s={audioEditor:".audio_editor",previewContainer:".audio_editor-preview",previewAudio:".audio_editor-preview_audio",editFileBtn:".js-edit-file",cancelUploadBtn:".js-upload-cancel",undoUploadBtn:".js-upload-undo",uploadFileInputContainer:".audio_editor-intro",uploadFileInput:".embed-modal-file-input",urlExternalInput:".embed-modal-url-external",setUrlBtn:".js-set-url"},c={viewPath:"modal_audio.html",displayName:"Audio",object_type:"audio",validationOptions:{rules:{title:"required",url:"required",upload:{required:{depends:function(e){return!$(s.urlExternalInput,$(e).closest("form")).val()}},extension:"mp3"},url_external:{required:{depends:function(e){return!$(s.uploadFileInput,$(e).closest("form")).val()}}},wavFile:{extension:"wav"}}},httpPaths:{uploadFile:"admin/embed/file-upload"}};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=d,d.prototype.orderIndex=3,d.prototype.audioPreviewClass="audio-preview",d.prototype.cleanModel=function(){return{title:null,url_path:null,url_external:null,credit:null,creditLink:null,object_type:c.object_type}},d.prototype.getAudioUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):this.model.url_external?this.model.url_external:t(this.model.url_path)},d.prototype.initModal=function(e,t){var d,l=this;l.parent.initModal(e,t,l),d=o(l,e),d.editFileBtn.on("click","a",function(){a(t.scope.currentEmbedType)}),d.cancelUploadBtn.on("click","a",function(){r(t.scope.currentEmbedType)}),d.undoUploadBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,d.uploadFileInput.val(""),n(t.scope.currentEmbedType)}),d.uploadFileInput.on("change",function(e){var o=e.target.files[0];d.urlExternalInput.val(""),i(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),d.audioEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,n=$(this),r=e.originalEvent.dataTransfer.files;if(r&&r.length){if(o=r[0],console.log("dropped file",o),!/(?:mpeg|mp3)/.test(o.type))return;n.addClass("js-dropped"),setTimeout(function(){i(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){n.removeClass("js-dropped")},300)})},300)}}),d.setUrlBtn.on("click",function(e){var o=$(this),i=o.html();e.preventDefault(),t.scope.currentEmbedType.getModelFromForm(d.form),console.log("Set URL",t.scope.currentEmbedType.model),t.scope.currentEmbedType.model.url_external&&(d.uploadFileInput.val(""),delete t.scope.currentEmbedType.model.upload,delete t.scope.currentEmbedType.model.url_path,o.html("Loading..."),n(t.scope.currentEmbedType).done(function(){o.html(i)}))})},d.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),t.$ui.previewAudio.removeAttr("src").removeAttr("type"),a(t)},d.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var n=t.parent.saveEmbed(e,t);return o?n.then(function(e){var n=new FormData;return n.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:n,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):n},d.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},d.prototype.getModelFromFile=function(t){function o(e){var o,i;o=$.extend(!0,{},n.model);for(i in o)o.hasOwnProperty(i)&&null===o[i]&&delete o[i];n.model=$.extend(!0,{},e,o),n.model.upload=t,r.resolve(n.model)}var n=this,i=n.$ui,r=$.Deferred(),a="function"==typeof define&&define.amd?require("musicmetadata"):window.musicmetadata;return console.log("musicmetadata: ",a),t||(t=n.model.upload),i&&n.getModelFromForm(i.form),a?a(t,function(n,i){console.log("file tags",i),o(e(i,t))}):o(e({},t)),r},d.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.parent.populateFormWithModel(e,t),t.model.upload||t.model.url_path||t.model.url_external?n(t).done(function(){o.resolve()}):o.resolve(),o},d.prototype.parseForEditor=function(){var e=this,t=e.model.url_external||e.getAudioUrl(e.model.url_path),o=['<audio controls class="entity-embed-secondary-toolbar-locator" src="'+t+'"></audio>'];return e.model.credit&&o.push('<div class="credit">Credit: '+e.model.credit+"</div>"),e.model.creditLink&&o.push('<div class="link">Link: '+e.model.creditLink+"</div>"),'<div class="audio-embed">'+o.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var o=this;o.parent.constructor(e,n,t,o)}var t="customText",o="custom-text-editor",n={viewPath:"modal_customText.html",displayName:"Custom Text",object_type:"custom",validationOptions:{rules:{title:"required",customText:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=5,e.prototype.getModelFromForm=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e,o=$(this),n=o.attr("name"),i=o.data("editor");e=i?i.getContent():o.val(),e=e.replace(/^\s+|\s+$/,""),t.model[n]=e||null})},e.prototype.cleanModel=function(){return{title:null,displayTitle:"",text:null,object_type:n.object_type}},e.prototype.clearForm=function(e,t){var o=t||this,n=e.find(".embed-modal-form-control");o.parent.clearForm(e,o),n.each(function(){var e=$(this),t=e.data("editor");t?t.setContent(""):e.val(null)}),o.model=o.cleanModel()},e.prototype.populateFormWithModel=function(e){var t=this,o=e.find(".embed-modal-form-control");o.each(function(){var e=$(this),o=e.attr("name"),n=t.model[o],i=e.data("editor");i?i.setContent(n):e.val(n)})},e.prototype.initModal=function(e,t){var n=this,i=$("#"+o),r=new MediumEditor(i[0],{placeholder:{text:"Type your text. Highlight words to trigger the styles editor"}});n.parent.initModal(e,t,n),i.data("editor",r)},e.prototype.parseForEditor=function(){var e=this,t=['<div class="custom-text">'+e.model.customText+"</div>"];return e.model.displayTitle&&t.unshift('<div class="display-title">'+e.model.displayTitle+"</div>"),'<div class="custom-text-embed entity-embed-secondary-toolbar-locator">'+t.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function t(e,t){var o={};return o}function o(e,t){e.$ui=e.$ui||{form:t};for(key in u)u.hasOwnProperty(key)&&(e.$ui[key]=$(u[key],t));return e.$ui}function n(e,t){function o(){d(e),r.resolve(),$(this).off("load",o)}var n,i=e.$ui,r=(new Image,$.Deferred());return i.imageEditorPreviewImage.on("load",o),t&&(e.model.upload=t),n=e.getImageUrl(),i.imageEditorPreview.css("background-image",'url("'+n+'")'),i.imageEditorPreviewImage.attr("src",n),r}function i(e,t){var o=(e.$ui,$.Deferred());return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(e.$el).done(function(){o.resolve()})}),o}function r(e){var t=e.$ui;e.model.upload=null,e.model.url_path=null,a(t.uploadFileInput)}function a(e){e.attr("type","").attr("type","file")}function d(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadImageBtn.hide(),t.imageEditorPreview.show(),t.editImageFileBtn.show(),t.undoUploadImageBtn.toggle(!!e.model.url_path&&!!e.model.upload),t.removeUploadImageBtn.toggle(!!e.model.url_path||!!e.model.upload)}function l(e){var t=e.$ui;t.imageEditorPreview.hide(),t.editImageFileBtn.hide(),t.removeUploadImageBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadImageBtn.toggle(!(!e.model.url_path&&!e.model.upload)),
t.undoUploadImageBtn.toggle(!!e.staleModel&&!!e.staleModel.url_path&&!(e.model.url_path||e.model.upload))}function s(e){var t=this;t.parent.constructor(e,p,c,t)}var c="externalLink",u={imageEditor:".image_editor",imageEditorPreview:".image_editor-preview",imageEditorPreviewImage:".image_editor-preview_image",editImageFileBtn:".js-upload",cancelUploadImageBtn:".js-upload-cancel",removeUploadImageBtn:".js-upload-remove",undoUploadImageBtn:".js-upload-undo",uploadFileInputContainer:".image_editor-intro",uploadFileInput:".embed-modal-file-input",teaserTitleInput:".js-input-displayTitle"},p={viewPath:"modal_externalLink.html",displayName:"External Link",object_type:"external-link",validationOptions:{rules:{title:"required",url:"required",linkText:"required",teaser:{required:{depends:function(e){return!!$(u.teaserTitleInput,$(e).closest("form")).val()}}}},messages:{teaser:{required:"Teaser required when Teaser Title is set."}}},httpPaths:{uploadFile:"admin/embed/file-upload"}};s.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[c]=s,s.prototype.orderIndex=9,s.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,displayTitle:null,teaser:null,linkText:null,url:null,object_type:p.object_type}},s.prototype.getImageUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):e(this.model.url_path)},s.prototype.initModal=function(e,t){var s,c=this;c.parent.initModal(e,t,c),s=o(c,e),s.editImageFileBtn.on("click","a",function(){s.uploadFileInput.click()}),s.cancelUploadImageBtn.on("click","a",function(){d(t.scope.currentEmbedType)}),s.removeUploadImageBtn.on("click","a",function(){r(t.scope.currentEmbedType),l(t.scope.currentEmbedType)}),s.undoUploadImageBtn.on("click","a",function(){t.scope.currentEmbedType.model;delete t.scope.currentEmbedType.model.upload,a(s.uploadFileInput),t.scope.currentEmbedType.model.url_path=t.scope.currentEmbedType.model.url_path||t.scope.currentEmbedType.staleModel.url_path,n(t.scope.currentEmbedType)}),s.uploadFileInput.on("change",function(e){var o=e.target.files[0];i(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),s.imageEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,n=$(this),r=e.originalEvent.dataTransfer.files;if(r&&r.length){if(o=r[0],-1===o.type.indexOf("image"))return;n.addClass("js-dropped"),setTimeout(function(){i(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){n.removeClass("js-dropped")},300)})},300)}})},s.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var n=t.parent.saveEmbed(e,t);return o?n.then(function(e){var n=new FormData;return n.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:n,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):n},s.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},s.prototype.getModelFromFile=function(e){var o=this,n=(o.$ui,$.Deferred());return e||(e=o.model.upload),EXIF.getData(e,function(){var i,r,a,d=this.iptcdata;r=t(d,this),o.getModelFromForm(o.$el),i=$.extend(!0,{},o.model);for(a in i)i.hasOwnProperty(a)&&null===i[a]&&delete i[a];o.model=$.extend(!0,{},r,i),o.model.upload=e,n.resolve(o.model)}),n},s.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.model.linkText=t.model.linkText||t.model.linkText,t.model.url=t.model.url||t.model.url,t.model.displayTitle=t.model.displayTitle||t.model.displayTitle,t.parent.populateFormWithModel(e,t),t.model.upload||t.model.url_path?n(t).done(function(){o.resolve()}):o.resolve(),o},s.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),o.imageEditorPreviewImage.removeAttr("src"),l(t)},s.prototype.parseForEditor=function(){var t=this,o=[],n=[],i=[];return t.model.url_path&&n.push('<div class="external_link-teaser-image"><img src="'+e(t.model.url_path)+'"></div>'),t.model.teaser&&(t.model.displayTitle&&i.push('<div class="external_link-teaser-title">'+t.model.displayTitle+"</div>"),i.push('<div class="external_link-teaser-teaser">'+t.model.teaser+"</div>"),n.push('<div class="external_link-teaser-text">'+i.join("")+"</div>")),n.length&&o.push('<div class="external_link-teaser">'+n.join("")+"</div>"),o.push('<a class="external_link-link" href="'+t.model.url+'">'+t.model.linkText+"</a>"),'<div class="external_link">'+o.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(){var e="fb-root",t="facebook-jssdk",o="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3",n=$("body"),i=$("#"+e),r=$("#"+t),a=$("script");i.length||(i=$("<div>").attr("id",e),n.prepend(i)),r.length||(r=$("<script>").attr("id",t).attr("src",o),a.eq(0).before(r))}function o(e){var t=($.Deferred(),"video"===r(e)?"https://www.facebook.com/plugins/video/oembed.json/":"https://www.facebook.com/plugins/post/oembed.json/"),o={timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:t,data:{url:e}};return $.ajax(o).done(function(e){console.log("facebookEmbed > getOembedData",e)})}function n(e){var t,o,n,i,a,d,l,s="video"===r(e.url),c=s?"blockquote":'a[href="'+e.url+'"]',u=s?'a[href="'+e.url+'"]':"blockquote",p=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),n=t.find(c),i=n.text().match(p)[0],d=e.title,d||(t=$("<div>").html(e.html),o=t.find(u),d=o.text()),l=d.split(" ").slice(0,10).join(" "),l!==d&&(l+="..."),a=[e.author_name,i,l].join(" - ")}function i(e){var t=$("<div>").html(e).find(".fb-post, .fb-video"),o=$("<div>").html(t);return o.html()}function r(e){return/\/video(?:s\/|\.php)/i.test(e)?"video":"post"}function a(e,t){e.$ui=e.$ui||{};for(var o in f)f.hasOwnProperty(o)&&(e.$ui[o]=$(f[o],t));return e.$ui}function d(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function l(e){var t=e.$ui;$("<div>").html(e.model.embedCode).find(".fb-post, .fb-video");t.previewPost.html(i(e.model.embedCode)),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),e.activateEmbed(),t.intro.hide(),t.cancelBtn.hide()}function s(e,t){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=n(t)),e.model.embedCode=t.html,e.model.oembed=t}function c(e){var t=/^(?:https:)?\/\/www\.facebook\.com\/(?:[^\/]+\/)?(?:activity|media|notes|permalink|photos?|posts|questions|videos?)/i;return t.test(e)}function u(e){var t=this;t.parent.constructor(e,m,p,t)}var p="facebook",m={viewPath:"modal_facebook.html",displayName:"Facebook",object_type:"facebook",actionToolbarLocatorClass:".fb-post, .fb-video",validationOptions:{rules:{title:"required",url:{required:!0,validFacebookUrl:!0}}}},f={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};u.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[p]=u,u.prototype.orderIndex=7,u.prototype.initModal=function(e,t){var o,n=this;n.parent.initModal(e,t,n),o=a(n,e),$.validator.addMethod("validFacebookUrl",function(e,t,o){var n=c(e);return this.optional(t)||n},"The URL must be to a valid Facebook post or video."),o.previewBtn.on("click",function(t){t.preventDefault(),n.getModelFromForm(e).done(function(){c(n.model.url)&&l(n)})}),o.editBtn.on("click",function(e){e.preventDefault(),d(n)}),o.cancelBtn.on("click",function(e){e.preventDefault(),l(n)}),o.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,n=e.originalEvent.dataTransfer.getData("text/plain"),i=e.originalEvent.dataTransfer.getData("text/html"),r=$(i),a=$("<div>");n?t=n:r.length&&(a.append(r),t=a.find("[href]").attr("href")),t&&c(t)&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},u.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:m.object_type}},u.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),d(t),t.$ui.previewPost.empty()},u.prototype.getModelFromForm=function(e){var t=this,n=$.Deferred();return t.parent.getModelFromForm(e.find("form").first(),t),o(t.model.url).done(function(e){s(t,e),t.model.object_id?n.resolve():EntityEmbed.apiService.get({path:t.options.httpPaths.getAll,data:{url:t.model.url,object_type:t.options.object_type}}).done(function(e){var o,i,r,a=e.response&&e.response.data||[],d=[];if(console.log("List Facebook Embeds by URL:",e),a.length)for(o=0,i=a.length;i>o;o++)r=EntityEmbed.apiService.get({path:t.options.httpPaths.get,data:{object_id:a[o].object_id}}).done(function(e){t.model.object_id||-1===e.response.embedCode.indexOf(t.model.url)||(t.model.object_id=e.response.object_id)}),d.push(r);else n.resolve();$.when.apply($,d).always(function(){n.resolve()})}).fail(function(){n.resolve()})}).fail(function(){n.resolve()}),n},u.prototype.populateFormWithModel=function(e){function t(){n.model.object_id?l(n):d(n)}var n=this;n.$ui;n.parent.populateFormWithModel(e.find("form").first(),n),n.model.object_id&&!n.model.oembed?o(n.model.url).done(function(e){return s(n,e),n.saveEmbed()}).always(function(){t()}):t()},u.prototype.parseForEditor=function(){var e=this;return'<div class="facebook-embed">'+i(e.model.embedCode)+"</div>"},u.prototype.activateEmbed=function(){e.FB?e.FB.XFBML.parse():t()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var n=this;n.parent.constructor(e,o,t,n)}var t="globalBuzz",o={viewPath:"modal_globalBuzz.html",displayName:"Global Buzz",object_type:"global-buzz",validationOptions:{rules:{title:"required",quote:"required",quoteUrlText:"required",quoteUrlText:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=13,e.prototype.cleanModel=function(){return{title:null,quote:null,credit:null,quoteUrl:null,quoteUrlText:null,object_type:o.object_type}},e.prototype.parseForEditor=function(){var e,t=this;return e=t.model.credit?'<div class="buzz-field-quote-credit">'+t.model.credit+"</div>":"",'<div class="global-buzz"><article class="global-buzz-quote-wrapper engagement-badge-wrapper"><div class="engagement-badge"></div><div><h1 class="global-buzz-teaser">Global Buzz</h1><div class="buzz-field-quote"><div class="buzz-quote-inner">'+t.model.quote+"</div></div>"+e+'<a class="btn btn-primary global-buzz-link" href="'+t.model.quoteUrl+'">'+t.model.quoteUrlText+"</a></div></article></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var n=this;n.parent.constructor(e,o,t,n)}var t="iframe",o={viewPath:"modal_iframe.html",displayName:"iFrame",object_type:"iframe",validationOptions:{rules:{title:"required",url:"required",height:"required"}}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=11,e.prototype.cleanModel=function(){return{title:null,url:null,allowsScroll:!1,width:null,height:300,object_type:o.object_type}},e.prototype.parseForEditor=function(){var e=this.model.height,t=this.model.width||this.model.height,o=e/t*100,n=!!this.model.width,i=["<div",' class="iframe-embed'+(n?" iframe-embed-responsive":"")+'"',n?' style="padding-bottom: '+o+'%"':"",">",'<iframe src="'+this.model.url+'"',' frameborder="0"',' scrolling="'+this.model.allowsScroll+'"',' height="'+(this.model.height||300)+'"',' width="'+(this.model.width?this.model.width:"100%")+'"',"></iframe>","</div>"].join("");return n&&(i=['<div class="iframe-embed-responsive-wrapper" style="max-width:'+this.model.width+'px">',i,"</div>"].join("")),i}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,t){var o={},n=[];return o.title=t.name,e.byline&&n.push(e.byline),e.credit&&n.push(e.credit),e.copyright&&n.push(e.copyright),o.credit=n.join(" / "),o.caption=e.caption&&e.caption.replace(/\s*\([^\)]+\)\s*$/,""),o.altText=e.headline,o}function t(e){var t=EntityEmbed.apiService.getDomainName();return e&&""!==e?e.indexOf(t)>=0?e:(t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.startsWith("/")||(e="/"+e),t+e):""}function o(e,t){e.$ui=e.$ui||{form:t};for(key in c)c.hasOwnProperty(key)&&(e.$ui[key]=$(c[key],t));return e.$ui}function n(e,t){function o(){r(e),a.resolve(),$(this).off("load",o)}var n,i=e.$ui,a=(new Image,$.Deferred());return i.imageEditorPreviewImage.on("load",o),t&&(e.model.upload=t),n=e.getImageUrl(),i.imageEditorPreview.css("background-image",'url("'+n+'")'),i.imageEditorPreviewImage.attr("src",n),a}function i(e,t){var o=e.$ui,n=$.Deferred();return e.getModelFromFile(t).done(function(t){e.populateFormWithModel(o.form).done(function(){n.resolve()})}),n}function r(e){var t=e.$ui;t.uploadFileInputContainer.hide(),t.cancelUploadImageBtn.hide(),t.imageEditorPreview.show(),t.editImageFileBtn.show(),t.undoUploadImageBtn.toggle(!!e.model.url_path&&!!e.model.upload)}function a(e){var t=e.$ui;t.imageEditorPreview.hide(),t.editImageFileBtn.hide(),t.undoUploadImageBtn.hide(),t.uploadFileInput.removeClass("error").parent().find("#upload-error").remove(),t.uploadFileInputContainer.show(),t.cancelUploadImageBtn.toggle(!(!e.model.url_path&&!e.model.upload))}function d(e,t){var o=this;o.parent.constructor(e,s,l,o),t&&o.getModelFromFile(t)}var l="image",s={viewPath:"modal_image.html",displayName:"Image",object_type:"image",imageLocation:"https://test-services.pri.org",validationOptions:{rules:{title:"required",altText:"required",license:"required",upload:{required:!0,extension:"png|jpg|jpeg|gif"}}},httpPaths:{getLicenses:"admin/image-license/list",uploadFile:"admin/embed/file-upload"}},c={imageEditorPreview:".image_editor-preview",imageEditorPreviewImage:".image_editor-preview_image",editImageFileBtn:".js-upload",cancelUploadImageBtn:".js-upload-cancel",undoUploadImageBtn:".js-upload-undo",uploadFileInputContainer:".image_editor-intro",uploadFileInput:".embed-modal-file-input",imageEditor:".image_editor"},u={ap:{claimData:function(e){var t=/(AP Images|Associated Press)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},getty:{claimData:function(e){var t=/(Getty ?Images)/gi;return!!e.credit&&t.test(e.credit)||!!e.copyright&&t.test(e.copyright)}},reuters:{claimData:function(e){return!!e.credit&&"reuters"===e.credit.toLowerCase()},getModelFromData:function(e,t){var o={},n=[];return e.byline&&n.push(e.byline.replace(/^\W*\u00A9\s*/,"")),e.copyright&&n.push(e.copyright),o.credit=n.length?n.join(" / "):void 0,o.caption=e.caption.replace(/\s+REUTERS\/.+$/gm,""),o}}};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=d,d.prototype.orderIndex=1,d.prototype.imageEditorPreviewImageClass="image-preview",d.prototype.cleanModel=function(){return{url_path:null,upload:null,title:null,altText:null,credit:null,creditLink:null,caption:null,license:null,object_type:s.object_type}},d.prototype.getImageUrl=function(){return this.model.upload?window.URL.createObjectURL(this.model.upload):t(this.model.url_path)},d.prototype.loadLicenses=function(e){var t=this,o=e.find('[name="license"]');return o.children().length>1?void o.val(t.model.license):void EntityEmbed.apiService.get({path:t.options.httpPaths.getLicenses}).done(function(e){var n;if(e.response.data){if(o.children().length>1)return void o.val(t.model.license);t.licenses=e.response.data;for(var i=0;i<e.response.data.length;i++)n=$("<option>"),n.attr("value",e.response.data[i].license).text(e.response.data[i].title),o.append(n);o.val(t.model.license)}}).fail(function(e){console.log("failed to find load image license options")})},d.prototype.initModal=function(e,t){var a,d=this;d.parent.initModal(e,t,d),a=o(d,e),d.loadLicenses(e),a.editImageFileBtn.on("click","a",function(){a.uploadFileInput.click()}),a.cancelUploadImageBtn.on("click","a",function(){r(t.scope.currentEmbedType)}),a.undoUploadImageBtn.on("click","a",function(){delete t.scope.currentEmbedType.model.upload,a.uploadFileInput.val(""),n(t.scope.currentEmbedType)}),a.uploadFileInput.on("change",function(e){var o=e.target.files[0];i(t.scope.currentEmbedType,o)}),$(document).on("dragover drop",function(e){e.preventDefault()}),a.imageEditor.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.preventDefault();var o,n=$(this),r=e.originalEvent.dataTransfer.files;if(r&&r.length){if(o=r[0],-1===o.type.indexOf("image"))return;n.addClass("js-dropped"),setTimeout(function(){i(t.scope.currentEmbedType,o).done(function(){setTimeout(function(){n.removeClass("js-dropped")},300)})},300)}})},d.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),o.imageEditorPreviewImage.removeAttr("src"),a(t)},d.prototype.saveEmbed=function(e){var t=this,o=t.model.upload;delete t.model.upload;var n=t.parent.saveEmbed(e,t);return o?n.then(function(e){var n=new FormData;return n.append("upload",o),EntityEmbed.apiService.uploadFile({path:t.options.httpPaths.uploadFile,data:n,headers:{"x-object-id":e.response.object_id}})}).done(function(e){t.model.url_path=e.response.url_path}):n},d.prototype.getModelFromForm=function(e){var t=this,o=$.extend(!0,{},t.model);t.parent.getModelFromForm(e,t),o.upload&&!t.model.upload&&(t.model.upload=o.upload)},d.prototype.getModelFromFile=function(t){var o=this,n=(o.$ui,$.Deferred());return t||(t=o.model.upload),EXIF.getData(t,function(){var i,r,a,d,l,s=this.iptcdata;for(d in u)u.hasOwnProperty(d)&&(l=u[d],"function"==typeof l.claimData&&l.claimData(s)&&(a="function"==typeof l.getModelFromData?l.getModelFromData(s,this):{},a.license=d));r=e(s,this),o.$el&&o.getModelFromForm(o.$el),i=$.extend(!0,{},o.model);for(d in i)i.hasOwnProperty(d)&&null===i[d]&&delete i[d];o.model=$.extend(!0,{},r,a||{},i),o.model.upload=t,n.resolve(o.model)}),n},d.prototype.populateFormWithModel=function(e){var t=this,o=$.Deferred();return t.parent.populateFormWithModel(e,t),t.loadLicenses(e),t.model.upload||t.model.url_path?n(t).done(function(){o.resolve()}):o.resolve(),o},d.prototype.parseForEditor=function(){var e=this,o=['<img class="entity-embed-secondary-toolbar-locator" src="'+t(e.model.url_path)+'" />'];return e.model.caption&&o.push('<div class="images-embed-caption">'+e.model.caption+"</div>"),e.model.credit&&o.push('<div class="images-embed-credit">Credit: '+e.model.credit+"</div>"),'<div class="images-embed">'+o.join("")+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(e){"use strict";function t(e){var t=($.Deferred(),{timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:"https://api.instagram.com/oembed",data:{url:e}});return $.ajax(t).done(function(t){return console.log("instagramEmbed > getOembedData",t),t.url=t.url||e,t})}function o(e){var t,o,n,i,r,a,d,l="time",s='a[href="'+e.url+'"]',c=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),n=t.find(l),i=n.text().match(c)[0],a=e.title,a||(o=t.find(s),a=o.text()),d=a.split(" ").slice(0,10).join(" "),d!==a&&(d+="..."),r=[e.author_name,i,d].join(" - ")}function n(e,t){e.$ui=e.$ui||{};for(var o in u)u.hasOwnProperty(o)&&(e.$ui[o]=$(u[o],t));return e.$ui}function i(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function r(e){var t=e.$ui;t.previewPost.html(e.model.embedCode),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),e.activateEmbed(),t.intro.hide(),t.cancelBtn.hide()}function a(e,t){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=o(t)),e.model.embedCode=t.html,e.model.oembed=t}function d(e){var t=/^(?:https?:)?\/\/(?:www\.)?(?:instagr\.am|instagram\.com)\/p\/([^\/]+)\/?/i;return t.test(e)}function l(e){var t=this;t.parent.constructor(e,c,s,t)}var s="instagram",c={viewPath:"modal_instagram.html",displayName:"Instagram",object_type:"instagram",actionToolbarLocatorClass:".instagram-media",validationOptions:{rules:{title:"required",url:{required:!0,validInstagramUrl:!0}}}},u={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};l.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[s]=l,l.prototype.orderIndex=8,l.prototype.initModal=function(e,t){var o,a=this;a.parent.initModal(e,t,a),o=n(a,e),$.validator.addMethod("validInstagramUrl",function(e,t,o){var n=d(e);return this.optional(t)||n},"The URL must be to a valid Facebook post or video."),o.previewBtn.on("click",function(e){e.preventDefault(),a.getModelFromForm(a.$el).done(function(){console.log("Instagram Embed Model:",a.model),d(a.model.url)&&r(a)})}),o.editBtn.on("click",function(e){e.preventDefault(),i(a)}),o.cancelBtn.on("click",function(e){e.preventDefault(),r(a)}),o.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,n=e.originalEvent.dataTransfer.getData("text/plain"),i=e.originalEvent.dataTransfer.getData("text/html"),r=$(i),a=$("<div>");n?t=n:r.length&&(a.append(r),t=a.find("[href]").attr("href")),console.log("dropped",t,n,i),t&&d(t)&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},l.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:c.object_type}},l.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),i(t),t.$ui.previewPost.empty()},l.prototype.getModelFromForm=function(e){var o=this,n=$.Deferred();return o.parent.getModelFromForm(e.find("form").first(),o),t(o.model.url).done(function(e){a(o,e),o.model.object_id?n.resolve():EntityEmbed.apiService.get({path:o.options.httpPaths.getAll,data:{url:o.model.url,object_type:o.options.object_type}}).done(function(e){var t,i,r,a=e.response&&e.response.data||[],d=[];if(console.log("List Instagram Embeds by URL:",e),a.length)for(t=0,i=a.length;i>t;t++)r=EntityEmbed.apiService.get({path:o.options.httpPaths.get,data:{object_id:a[t].object_id}}).done(function(e){o.model.object_id||-1===e.response.embedCode.indexOf(o.model.url)||(o.model.object_id=e.response.object_id)}),d.push(r);else n.resolve();$.when.apply($,d).always(function(){n.resolve()})}).fail(function(){n.resolve()})}).fail(function(){n.resolve()}),n},l.prototype.populateFormWithModel=function(e){function o(){n.model.object_id?r(n):i(n)}var n=this;n.$ui;n.parent.populateFormWithModel(e.find("form").first(),n),n.model.object_id&&!n.model.oembed?t(n.model.url).done(function(e){return a(n,e),n.saveEmbed()}).always(function(){o()}):o()},l.prototype.parseForEditor=function(){var e=this;return'<div class="instagram-embed">'+e.model.embedCode+"</div>"},l.prototype.activateEmbed=function(){e.instgrm&&e.instgrm.Embeds.process()}}(window);var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var n=this;n.parent.constructor(e,o,t,n)}var t="newsletterSubscribe",o={viewPath:"modal_newsletterSubscribe.html",displayName:"Newsletter Subscribe",object_type:"newsletter",validationOptions:{rules:{title:"required",newsletter:"required"}},httpPaths:{getNewsletters:"admin/newsletter/list"}};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=12,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,newsletter:null,teaser:null,object_type:o.object_type}},e.prototype.initModal=function(e,t){var o=this,n="<option disabled selected>-- select a newsletter --</option>";o.parent.initModal(e,t,o),EntityEmbed.apiService.get({path:o.options.httpPaths.getNewsletters}).done(function(t){if(t.response.data){var o=[];o.push(n);for(var i=0;i<t.response.data.length;i++)o.push('<option value="'+t.response.data[i].newsletter_id+'" >'+t.response.data[i].title+"</option>");e.find('[name="newsletter"]').html(o)}}).fail(function(){console.log("failed to load newsletter subscription options")})},e.prototype.parseForEditor=function(){var e,t,o=this;return e=o.model.displayTitle?'<div class="display-title">'+o.model.displayTitle+"</div>":"",t=o.model.teaser?'<div class="teaser">'+o.model.teaser+"</div>":"",'<div class="newsletter-subscribe-embed entity-embed-secondary-toolbar-locator">'+e+'<div class="subscribe-form">'+t+'<div class="embed-modal-form"><input name="email" type="text" placeholder="user@domain.com" class="embed-modal-form-control subscribe-input"></div><button class="btn btn-primary subscribe-btn">Subscribe</button>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var n=this;n.parent.constructor(e,o,t,n)}if(!EntityEmbed.embedTypes)return void console.log("Could not find EntityEmbedTypes namespace. Please ensure that the genericEmbed has loaded before this one.");var t="relatedLink",o={viewPath:"modal_relatedLink.html",displayName:"Related Link",object_type:"related-link",validationOptions:{rules:{title:"required",linkInput:"atLeastOne"}},httpPaths:{getContentList:"admin/content/list",getContentItem:{story:"admin/story/fetch",episode:"admin/episode/fetch"}}},n="#related-link-list",i="#add-link-eac",r="drag-link-btn",a="related-link-placeholder",d="#related-links-progress",l="remove-link-btn",s="related-link-url",c=function(e,t){var o=u(e),n=$(o);return n.data("link-data",e),n.find("."+l).on("click",function(){var e=$(this),t=e.closest("."+s);t.remove()}),n},u=function(e){return'<div class="'+s+'"><div class="related-link-control"><span class="'+r+'"><i class="fa fa-bars"></i></span></div><div class="related-link-title">'+e.title+'</div><div class="related-link-control"><button class="'+l+'"><i class="fa fa-minus"></i></button></div></div>'},p=function(e,t,o){var i=/^[^.]*staging[^.]*\.|\.dev$/,r=i.test(window.location.host),a={auth_token:EntityEmbed.apiService.getAuthToken()},d=o.find(e);r&&(a.debug=1);var l={ajaxSettings:{dataType:"json",method:"POST",data:a},requestDelay:600,url:function(e){return a.title=e,EntityEmbed.apiService.getDomainName()+t.options.httpPaths.getContentList},listLocation:function(e){return e.response.data},getValue:function(e){return 1==e.pub_state?e.title:""},preparePostData:function(e){return e.title=d.val(),JSON.stringify(e)},list:{maxNumberOfElements:10,match:{enabled:!0},sort:{enabled:!0},onChooseEvent:function(){var e,t=d.getSelectedItemData(),i=(t.object_id,o.find(n));t.object_id&&(e=c(t),i.append(e)),d.val("")}}};d.easyAutocomplete(l),d.closest(".easy-autocomplete").removeAttr("style")};e.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[t]=e,e.prototype.orderIndex=10,e.prototype.cleanModel=function(){return{title:null,displayTitle:null,links:[],object_type:o.object_type}},e.prototype.initModal=function(e,t){var o=this,l=e.find(n),c=e.find(d);o.parent.initModal(e,t,o),c.parent().hide(),p(i,o,e),l.sortable({axis:"y",handle:"."+r,items:"."+s,placeholder:a,start:function(e,t){t.placeholder.height(t.helper.outerHeight())}}),$.validator.addMethod("atLeastOne",function(e,t){return $(".related-link-url").length>0},$.validator.format("One link is required."))},e.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),e.find(n).empty()},e.prototype.getModelFromForm=function(e){var t=this;t.parent.getModelFromForm(e,t),delete t.model.linkInput,t.model.links=[],e.find("."+s).each(function(){var e=$(this),o=e.data("link-data");t.model.links.push({object_id:o.object_id,object_type:o.object_type})})},e.prototype.populateFormWithModel=function(e){var t,o,i,r=this,a=e.find(n),l=e.find(d),s=[],u=[],p=0,m=0,f=0;if(r.parent.populateFormWithModel(e,r),r.model.links.length){for(l.width(0),l.parent().slideDown(0),t=0,o=r.model.links.length;o>t;t++)r.model.links[t]&&(p++,i=EntityEmbed.apiService.get({path:r.options.httpPaths.getContentItem[r.model.links[t].object_type],data:{object_id:r.model.links[t].object_id}}),i.done(function(e){return function(t){m++,f=m/p*100,l.css({width:f+"%"}),"OK"===t.status&&(u[e]=t.response)}}(t)),s.push(i));$.when.apply($,s).done(function(){var e,t,o;for(l.parent().delay(400).slideUp(500),t=0,o=u.length;o>t;t++)u[t]||u.splice(t,1);for(t=0,o=u.length;o>t;t++)e=c(u[t]),a.append(e),e.hide().delay(1e3).slideDown(150)})}},e.prototype.parseForEditor=function(){var e,t,o,n,i=this,r=[],a=[],d=[],l=["related_link",i.model.object_id,(new Date).getTime()].join("_");for(console.log(i.model.links),t=0,o=i.model.links.length;o>t;t++)n=EntityEmbed.apiService.get({path:i.options.httpPaths.getContentItem[i.model.links[t].object_type],data:{object_id:i.model.links[t].object_id}}),n.done(function(e){return function(t){"OK"===t.status&&(a[e]=t.response)}}(t)),r.push(n);return $.when.apply($,r).done(function(){var t,o,n=$("#"+l);for(i.model.displayTitle&&d.push(i.model.displayTitle+":"),t=0,o=a.length;o>t;t++)a[t]||a.splice(t,1);for(t=0,o=a.length;o>t;t++)e='<a href="'+a[t].url_path+'">'+a[t].title+"</a>",d.push(e);n.html(d.join(""))}),'<div id="'+l+'" class="relatedLink-embed"></div>'}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e,o){var i=o.$ui;o.$currentSlide=e,i.slides.find("."+c).removeClass(c),e.addClass(c),i.slides.sortable("refresh"),t(o),n(o)}function t(e){var t,o=new EntityEmbed.embedTypes.image,n=e.$ui,i=e.$currentSlide.data("model"),r=i.creditLink?"a":"span",a=!!i.caption,d=!!i.credit,l=a||d;o.model=i,t=o.getImageUrl(),n.slideText.toggle(l),n.slideImage.css("background-image",'url("'+t+'")').find("img").attr("src",t),n.slideCaption.toggle(a).text(i.caption),n.slideCreditBlock.toggle(d),n.slideCredit.text(i.credit).hide().filter(r).show(),n.slideCreditBlock.find("a:visible").attr("href",i.creditLink)}function o(e){var t=e.$ui;t.intro.show(),t.editor.hide(),t.slides.empty(),t.slideImage.css("background-image","none").find("img").removeAttr("src"),t.slideText.hide(),t.slideCaption.empty(),t.slideCreditBlock.hide(),t.slideCredit.empty().filter("a").removeAttr("href")}function n(e){var t=e.$ui;t.intro.hide(),t.editor.show()}function i(e,t){e.$ui=e.$ui||{};for(var o in E)E.hasOwnProperty(o)&&(e.$ui[o]=$(E[o],t));return e.$ui}function r(e){var t=this;t.parent.constructor(e,d,a,t)}var a="slideshow",d={viewPath:"modal_slideshow.html",displayName:"Slideshow",object_type:"slideshow",validationOptions:{rules:{title:"required"}}},l={modalElId:"embed-modal-slideshow-image",embedTypes:{image:{}},modalOptions:{embedTypeStr:"image",bufferData:!0}},s="slideshow_editor-nav_item",c="active",u="slideshow_editor-nav_handle",p="slideshow_editor-nav_ind",m="fa-circle-o",f="fa-star",h="fa-star-o",v="fa-circle-o-notch fa-spin",b="fa-check",g="fa-exclamation",y="slideshow_editor-slide_placholder",E={addSlide:".js-add_slide",intro:".slideshow_intro",editor:".slideshow_editor",slideImage:".js-slide_image",slideCaption:".js-slide_caption",slideCreditBlock:".slideshow_editor-slide_credit-container",
slideCredit:".js-slide_credit",slideText:".js-slide_text",slides:".js-slides",slideTemplate:".js-slide_template",removeSlide:".js-remove_slide",editSlide:".js-edit_slide",dropFiles:".slideshow_drop_files"};r.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[a]=r,r.prototype.orderIndex=2,r.prototype.cleanModel=function(){return{title:null,displayTitle:null,images:[]}},r.prototype.initModal=function(r,a){var d,v=this;v.parent.initModal(r,a,v),v.model=v.cleanModel(),l.modalContainer=r,l.modalOptions.parentModal=a,d=i(v,r),d.slideTemplate.removeClass("js-slide_template").detach(),d.slideTemplate.on("click","a",function(){var t=$(this),o=t.closest("."+s);e(o,v)}),d.slides.sortable({axis:"x",handle:"."+u,placeholder:y}),d.addSlide.on("click",function(){delete l.modalOptions.id,delete l.modalOptions.embedData,$.embed_modal_open(l).done(function(t){var o=d.slideTemplate.clone(!0),i=t.data.object_id?m:f;o.data("model",t.data),o.find("."+p).addClass(i),d.slides.append(o),e(o,v),n(v)})}),d.editSlide.on("click",function(){var e=v.$ui.slides.find("."+c),o=e.data("model");v.$currentSlide=e,l.modalOptions.id=o.object_id,l.modalOptions.embedData=o,$.embed_modal_open(l).done(function(n){e.data("model",n.data),o.object_id&&e.find("."+p).removeClass(m).addClass(h),t(v)})}),d.removeSlide.on("click",function(){var t,n=v.$ui.slides.find("."+c),i=n.prev(),r=n.next();switch(n.remove(),!0){case!!r.length:t=r;break;case!!i.length:t=i}t?e(t,v):(v.$currentSlide=void 0,o(v))}),d.dropFiles.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(t){function o(t){var c,u=r.length-a.length;-1!==t.type.indexOf("image")&&(c=new EntityEmbed.embedTypes.image,c.getModelFromFile(t).done(function(t){delete l.modalOptions.id,l.modalOptions.headerText=["Add Image",u,"of",r.length].join(" "),l.modalOptions.embedData=t,$.embed_modal_open(l).done(function(e){var t=d.slideTemplate.clone(!0),o=e.data.object_id?m:f;t.data("model",e.data),t.find("."+p).addClass(o),s.push(t)}).always(function(){if(delete l.modalOptions.headerText,a.length)o(a.shift());else for(n=0,i=s.length;i>n;n++)d.slides.append(s[n]),0===n&&e(s[n],v)})}))}var n,i,r=t.originalEvent.dataTransfer.files,a=[],s=[];if(t.preventDefault(),r.length){for(n=0,i=r.length;i>n;n++)a[n]=r[n];o(a.shift())}})},r.prototype.saveEmbed=function(e){var t=this,o=[],n=new EntityEmbed.embedTypes.image,i=t.$ui.slides.children();return t.model.images=[],i.removeClass(c).each(function(e){var i,r=$(this),a=r.data("model"),d=!a.object_id;r.addClass("saving").find("."+p).removeClass([f,m].join(" ")).addClass(v),n.model=a,i=n.saveEmbed(d),i.done(function(e,o){return function(n){return"ERROR"==n.status?void console.log("failed to put/post a slideshow image"):(o.removeClass("saving").addClass("complete").find("."+p).removeClass(v).addClass(b),void(t.model.images[e]={object_id:n.response.object_id,order:e}))}}(e,r)).fail(function(e,t){return function(o,n,i){console.log("failed to save a slideshow image number "+e,i),t.removeClass("saving").addClass("error").find("."+p).removeClass(v).addClass(g)}}(e,r)),o.push(i)}),$.when.apply($,o).then(function(){return console.log("all images saved.",t.model.images),t.parent.saveEmbed(e,t)})},r.prototype.getModelFromForm=function(e){var t=this,o=t.$ui.slides.children();t.parent.getModelFromForm(e.find("form").first(),t),t.model.images=[],o.each(function(e){var o=$(this),n=o.data("model");t.model.images[e]={object_id:n.object_id,order:e}})},r.prototype.populateFormWithModel=function(t){var i=this,r=i.$ui,a=new EntityEmbed.embedTypes.image,d=[];if(i.parent.populateFormWithModel(t.find("form").first(),i),!i.model.images.length)return void o(i);i.model.images.sort(function(e,t){return!!e&&!!t&&e.order-t.order});for(var l=0;l<i.model.images.length;l++)if(i.model.images[l]){var s=EntityEmbed.apiService.get({path:a.options.httpPaths.get,data:{object_id:i.model.images[l].object_id}});s.done(function(e){return function(t){return"ERROR"===t.status||"string"==typeof t.response?void console.log("Could not load slideshow image number "+e.order,e,t):void $.extend(!0,e,t.response)}}(i.model.images[l])).fail(function(e){return function(t,o,n){console.log("Could not load slideshow image number "+e.order,e,n)}}(i.model.images[l])),d.push(s)}$.when.apply($,d).done(function(){var t,o,a,d;for(t=0,o=i.model.images.length;o>t;t++)a=r.slideTemplate.clone(!0),a.data("model",i.model.images[t]),r.slides.append(a),0===t&&(d=a);e(d,i),n(i)})},r.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),o(t)},r.prototype.parseForEditor=function(){var e,t,o,n=new EntityEmbed.embedTypes.image,i=this,r=["img",i.model.images[0].object_id,(new Date).getTime()].join("_"),a=['<img id="'+r+'" />'],d=[];for(EntityEmbed.apiService.get({path:n.options.httpPaths.get,data:{object_id:i.model.images[0].object_id}}).done(function(e){var t=e.response,o=$("#"+r),i=o.parent();n.model=t,o.attr("src",n.getImageUrl(t.url_path)),t.caption&&i.append('<div class="slideshow-embed-caption">'+t.caption+"</div>"),t.credit&&i.append('<div class="slideshow-embed-credit">Credit :'+t.credit+"</div>")}),e='<div class="slideshow-embed-slides"><div class="slideshow-embed-slide">'+a.join("")+"</div></div>",t=0,o=i.model.images.length;o>t;t++)d.push('<li class="slideshow-embed-dot"></li>');return'<div class="slideshow-embed">'+e+'<ul class="slideshow-embed-dots">'+d.join("")+"</ul></div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=($.Deferred(),{timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:"https://api.twitter.com/1.1/statuses/oembed.json",data:{url:e}});return $.ajax(t).done(function(e){console.log("twitterEmbed > getOembedData",e)})}function t(e){var t,o,n,i,r,a,d,l='a[href="'+e.url+'"]',s="blockquote",c=/\w+\s\d{1,2},\s\d{4}/;return t=$("<div>").html(e.html),n=t.find(l),i=n.text().match(c)[0],a=e.title,a||(o=t.find(s),a=o.text()),d=a.split(" ").slice(0,10).join(" "),d!==a&&(d+="..."),r=[e.author_name,i,d].join(" - ")}function o(e,t){e.$ui=e.$ui||{};for(var o in c)c.hasOwnProperty(o)&&(e.$ui[o]=$(c[o],t));return e.$ui}function n(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function i(e){var t=e.$ui;t.previewPost.html(e.model.embedCode),t.titleInput.val(e.model.title),t.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),t.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),t.editBtn.toggle(!!e.modalCtrl.isAdd),t.preview.show(),t.intro.hide(),t.cancelBtn.hide()}function r(e,o){e.model.title=e.model.title||e.$ui.titleInput.val(),e.model.title||(e.model.title=t(o)),e.model.embedCode=o.html,e.model.oembed=o}function a(e){var t=/^(?:https:)?\/\/(?:www\.)?twitter\.com\/(?:[^\/]+\/)?(?:status)/i;return t.test(e)}function d(e){var t=this;t.parent.constructor(e,s,l,t)}var l="twitter",s={viewPath:"modal_twitter.html",displayName:"Twitter",object_type:"twitter",actionToolbarLocatorClass:".twitter-tweet",validationOptions:{rules:{title:"required",url:{required:!0,validTwitterUrl:!0}}}},c={intro:".social_editor-intro",previewBtn:".js-btn-preview",preview:".social_editor-preview",previewPost:".social_editor-preview_post",previewTitle:".social_editor-preview_title",previewAuthor:".social_editor-preview_author",previewProvider:".social_editor-preview_provider",titleInput:".js-input-title",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",dropTarget:".social_editor-intro_inner"};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=d,d.prototype.orderIndex=6,d.prototype.initModal=function(e,t){var r,d=this;d.parent.initModal(e,t,d),r=o(d,e),$.validator.addMethod("validTwitterUrl",function(e,t,o){var n=a(e);return this.optional(t)||n},"The URL must be to a valid Facebook post or video."),r.previewBtn.on("click",function(t){t.preventDefault(),d.getModelFromForm(e).done(function(){a(d.model.url)&&i(d)})}),r.editBtn.on("click",function(e){e.preventDefault(),n(d)}),r.cancelBtn.on("click",function(e){e.preventDefault(),i(d)}),r.dropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,o=e.originalEvent.dataTransfer.getData("text/plain"),n=e.originalEvent.dataTransfer.getData("text/html"),i=$(n),d=$("<div>");o?t=o:i.length&&(d.append(i),t=d.find("[href]").attr("href")),t&&a(t)&&(r.urlInput.val(t),r.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},d.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,embedCode:null,object_type:s.object_type}},d.prototype.clearForm=function(e){var t=this;t.parent.clearForm(e,t),n(t),t.$ui.previewPost.empty()},d.prototype.getModelFromForm=function(t){var o=this,n=$.Deferred();return o.parent.getModelFromForm(t.find("form").first(),o),e(o.model.url).done(function(e){r(o,e),o.model.object_id?n.resolve():EntityEmbed.apiService.get({path:o.options.httpPaths.getAll,data:{url:o.model.url,object_type:o.options.object_type}}).done(function(e){var t,i,r,a=e.response&&e.response.data||[],d=[];if(console.log("List Twitter Embeds by URL:",e),a.length)for(t=0,i=a.length;i>t;t++)r=EntityEmbed.apiService.get({path:o.options.httpPaths.get,data:{object_id:a[t].object_id}}).done(function(e){o.model.object_id||-1===e.response.embedCode.indexOf(o.model.url)||(o.model.object_id=e.response.object_id)}),d.push(r);else n.resolve();$.when.apply($,d).always(function(){n.resolve()})}).fail(function(){n.resolve()})}).fail(function(){n.resolve()}),n},d.prototype.populateFormWithModel=function(t){function o(){a.model.object_id?i(a):n(a)}var a=this;a.$ui;a.parent.populateFormWithModel(t.find("form").first(),a),a.model.object_id&&!a.model.oembed?e(a.model.url).done(function(e){return r(a,e),a.saveEmbed()}).always(function(){o()}):o()},d.prototype.parseForEditor=function(){var e=this;return'<div class="twitter-embed">'+e.model.embedCode+"</div>"}}();var EntityEmbed=EntityEmbed||{};!function(){"use strict";function e(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push([o,e[o]].join("="));return t.join("&")}function t(t){var o="";if(-1!==t.indexOf("vimeo.com")){var n="?"+e(p);o="//player.vimeo.com/video/"+m(t)+n}else if(-1!==t.indexOf("youtube.com")){var n="?"+e(u);o="//www.youtube.com/embed/"+f(t)+n}return o}function o(e){var t="";return-1!==e.indexOf("vimeo.com")?t="https://vimeo.com/"+m(e):-1!==e.indexOf("youtube.com")&&(t="https://www.youtube.com/watch?v="+f(e)),t}function n(e,t){e.$ui=e.$ui||{};for(var o in c)c.hasOwnProperty(o)&&(e.$ui[o]=$(c[o],t));return e.$ui}function i(e){var t=e.$ui;t.cancelBtn.toggle(!(!e.modalCtrl.isAdd||!e.model.oembed)),t.intro.show(),t.preview.hide(),t.editBtn.hide()}function r(e){var o=e.$ui,n=e.model.oembed.height/e.model.oembed.width*100,i=t(e.model.url);o.previewWrapper.css({paddingTop:n+"%"}),o.previewIframe.attr("src")!==i&&o.previewIframe.attr("src",i),o.previewTitle.text(e.model.title),o.previewAuthor.attr("href",e.model.oembed.author_url).text(e.model.oembed.author_name),o.previewProvider.attr("href",e.model.oembed.provider_url).text(e.model.oembed.provider_name),o.editBtn.toggle(!!e.modalCtrl.isAdd),o.preview.show(),o.intro.hide(),o.cancelBtn.hide()}function a(e,t){e.model.title=t.title,e.model.embedCode=t.html,e.model.oembed=t}function d(e){var t=this;t.parent.constructor(e,s,l,t)}var l="video",s={viewPath:"modal_video.html",displayName:"Video",object_type:"video",validationOptions:{rules:{title:"required",url:{required:!0,validVideoDomain:!0}}}},c={intro:".video_editor-intro",previewBtn:".js-btn-preview",preview:".video_editor-preview",previewIframe:".js-preview-iframe",previewTitle:".video_editor-preview_title",previewAuthor:".video_editor-preview_author",previewProvider:".video_editor-preview_provider",previewWrapper:".js-preview-wrapper",urlInput:".js-input-url",editBtn:".js-btn-edit",cancelBtn:".js-btn-cancel",videoDropTarget:".video_editor-intro_inner"},u={showinfo:0,modestbranding:1,rel:0},p={title:0,portrait:0,byline:0,color:"dc5555"},m=function(e){var t=e.indexOf("/")>-1?e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},f=function(e){var t=e.indexOf("/")>-1?e.indexOf("/watch")>-1?e.match(/v=([^&]+)(?:&|$)/i)[1]:e.match(/\/([^?\/]+)(?:\?|$)/i)[1]:e;return t},h=function(e){var t,o;$.Deferred();switch(!0){case-1!==e.indexOf("vimeo.com"):t="https://vimeo.com/api/oembed.json",o=$.extend(!0,{},p);break;case-1!==e.indexOf("youtube.com"):t="https://noembed.com/embed",o={}}o.url=e;var n={timeout:2e3,crossDomain:!0,type:"GET",dataType:"jsonp",url:t,data:o,success:function(e){console.log(e)}};return $.ajax(n)};d.inherits(EntityEmbed.embedTypes.genericEmbed),EntityEmbed.embedTypes[l]=d,d.prototype.orderIndex=4,d.prototype.cleanModel=function(){return{title:null,url:null,oembed:null,object_type:s.object_type}},d.prototype.clearForm=function(e){var t=this,o=t.$ui;t.parent.clearForm(e,t),i(t),o.previewIframe.removeAttr("src"),o.previewTitle.empty(),o.previewAuthor.removeAttr("href").empty(),o.previewProvider.removeAttr("href").empty()},d.prototype.initModal=function(e,t){var o,a=this;a.parent.initModal(e,t,a),o=n(a,e),$.validator.addMethod("validVideoDomain",function(e,t,o){var n=-1!=e.indexOf("youtube.com")||-1!=e.indexOf("vimeo.com");return this.optional(t)||n},"The video must be from YouTube or Vimeo"),o.previewBtn.on("click",function(t){t.preventDefault(),a.getModelFromForm(e).done(function(){r(a)})}),o.editBtn.on("click",function(e){e.preventDefault(),i(a)}),o.cancelBtn.on("click",function(e){e.preventDefault(),r(a)}),o.videoDropTarget.on("dragenter dragover",function(){$(this).addClass("js-dragover")}).on("dragleave drop",function(){$(this).removeClass("js-dragover")}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t,n=e.originalEvent.dataTransfer.getData("text/plain"),i=e.originalEvent.dataTransfer.getData("text/html"),r=$(i),a=$("<div>");n?t=n:r.length&&(a.append(r),t=a.find("[href]").attr("href")),t&&(o.urlInput.val(t),o.previewBtn.click())}),$(document).on("dragover drop",function(e){e.preventDefault()})},d.prototype.parseForEditor=function(){var e=this;return'<div class="video-embed"><div class="video-embed-inner"><iframe src="'+t(e.model.url)+'"	frameborder="0"></iframe></div></div>'},d.prototype.getModelFromForm=function(e){var t=this,n=$.Deferred();return t.parent.getModelFromForm(e.find("form").first(),t),t.model.url=o(t.model.url),h(t.model.url).done(function(e){e.error?n.resolve():(a(t,e),t.model.object_id?n.resolve():EntityEmbed.apiService.get({path:t.options.httpPaths.getAll,data:{title:t.model.title,object_type:t.options.object_type}}).done(function(e){var o,i,r,a=e.response&&e.response.data||[],d=[];if(a.length)for(o=0,i=a.length;i>o;o++)r=EntityEmbed.apiService.get({path:t.options.httpPaths.get,data:{object_id:a[o].object_id}}).done(function(e){t.model.object_id||e.response.url!==t.model.url||(t.model.object_id=e.response.object_id)}),d.push(r);else n.resolve();$.when.apply($,d).always(function(){n.resolve()})}).fail(function(){n.resolve()}))}),n},d.prototype.populateFormWithModel=function(e){function t(){o.model.object_id?r(o):i(o)}var o=this;o.$ui;o.parent.populateFormWithModel(e.find("form").first(),o),o.model.url&&!o.model.oembed?h(o.model.url).done(function(e){return e.error||(o.model.oembed=e,e.title===o.model.title)?void 0:(o.model.title=e.title,o.saveEmbed())}).always(function(){t()}):t()}}();var EntityEmbed=EntityEmbed||{};!function(){function e(e,t){var o;o=t.id||t.embedData?EntityEmbed.embedModalTypes.edit:t.embedTypeStr?t.selectExisting?EntityEmbed.embedModalTypes.selectExistingSingle:EntityEmbed.embedModalTypes.addSingle:t.selectExisting?EntityEmbed.embedModalTypes.selectExisting:EntityEmbed.embedModalTypes.add;var n={$currentEditorLocation:t.$currentEditorLocation,modalType:o,addOnly:t.addOnly,embedId:t.id,embedType:t.embedTypeStr,parentModal:t.parentModal,buffered:t.bufferData,embedData:t.embedData,headerText:t.headerText};return e.openModal(n)}$.embed_modal_create=function(e){function t(){var t;o.$embedTypeSelect&&o.$embedTypeSelect.length||(o.$embedTypeSelect=i.find(e.embedTypeSelect)),o.$modalBody&&o.$modalBody.length||(o.$modalBody=i.find(e.modalBody)),e.modalOptions.$abortEl&&e.modalOptions.$abortEl.length||(e.modalOptions.$abortEl=i.find(e.abortEl)),e.modalOptions.$completeEl&&e.modalOptions.$completeEl.length||(e.modalOptions.$completeEl=i.find(e.completeEl)),t=new EntityEmbed.embedModalDefaults,e.modalOptions=$.extend(!0,{},t,e.modalOptions),i.modal(e.modalOptions,o),i.hide(),c.resolve(i)}var o,n,i,r,a,d,l={modalOptions:{},modalScope:{$embedTypeSelect:null,$modalBody:null,$abortEl:null},$modalEl:null,modalHtmlLocation:"modal/",modalContainer:"body",modalFileName:"modal_main.html",modalElId:"embed-modal",modalBody:".embed-modal-body",abortEl:"#btn-abort-modal",completeEl:"#btn-save-modal",embedTypeSelect:"#select-embed-type",authToken:null,domainName:null,embedTypes:{image:{},slideshow:{},video:{},audio:{},twitter:{},instagram:{},facebook:{},relatedLink:{},externalLink:{},globalBuzz:{},newsletterSubscribe:{},iframe:{},customText:{}}},s=[],c=$.Deferred();if(a=$.extend(!0,{},l,e),a.modalOptions&&a.modalOptions.parentModal&&(d=a.modalOptions.parentModal.scope.currentEmbedType),a.embedTypes=!!e&&e.embedTypes,a.embedTypes||(a.embedTypes=l.embedTypes),d&&delete a.embedTypes[d.name],e=a,n=$(e.modalContainer),i=e.$modalEl&&e.$modalEl.length?e.$modalEl:n.find("#"+e.modalElId),i.length||(i=$('<div class="embed-modal" id="'+e.modalElId+'"></div>'),n.append(i)),o=i.data("scope"))return c.resolve(i),c;o={$modalEl:i};for(var u in EntityEmbed.embedTypes)if(e.embedTypes[u]){var p=new EntityEmbed.embedTypes[u](e.embedTypes[u]);s.push(p),e.modalOptions.embedTypeStr&&e.modalOptions.embedTypeStr===u&&(o.currentEmbedType=p)}return s.sort(function(e,t){return e.orderIndex-t.orderIndex}),o.embedTypes=s,o=$.extend(!0,{},e.modalScope,o),o.modalHtmlLocation=e.modalHtmlLocation,EntityEmbed.$embedModal=i,EntityEmbed.modalExists=!0,e.authToken&&EntityEmbed.apiService.setAuthToken(e.authToken),e.domainName&&EntityEmbed.apiService.setDomainName(e.domainName),e.modalFileName?(r=e.modalHtmlLocation+e.modalFileName,EntityEmbed.templateCache&&EntityEmbed.templateCache[r]?(i.html(EntityEmbed.templateCache[r]),t()):i.load(r,function(e,o,n){return console.log("embed modal load completed with status: "+o),"error"===o?void c.reject():(EntityEmbed.templateCache=EntityEmbed.templateCache||{},EntityEmbed.templateCache[r]=$(this).html(),void t())})):t(),c},$.embed_modal_open=function(t){var o={$currentEditorLocation:$(""),embedTypeStr:null,id:null,selectExisting:!1,addOnly:!1},n=$.Deferred();return $.embed_modal_create(t).done(function(i){e(i,$.extend(!0,{},o,t.modalOptions||{})).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n}}();var EntityEmbed=EntityEmbed||{};!function(e,t,o,n){"use strict";function i(e){var t,o,n="[[",i="]]";return o=[c,e.index,e.id].join(":"),t=[n,o,i].join("")}function r(t,o){var n=e.grep(o,function(e){return e.options.object_type==t})[0];return n&&e.extend(!0,{},n)}function a(){var e;return t.getSelection?e=t.getSelection():o.getSelection?e=o.getSelection():o.selection&&(e=o.selection.createRange()),e}function d(e,n){var i,r;e.focus(),"undefined"!=typeof t.getSelection&&"undefined"!=typeof o.createRange?(i=o.createRange(),r=t.getSelection(),i.selectNodeContents(e),i.collapse(n),r.removeAllRanges(),r.addRange(i)):"undefined"!=typeof o.body.createTextRange&&(i=o.body.createTextRange(),i.moveToElementText(e),i.collapse(n),i.select())}function l(o,i){var r=this;r.el=o,r.$el=e(o),r.templates=t.MediumInsert.Templates,r.core=r.$el.data("plugin_"+s),r.options=e.extend(!0,{},h,i),r._defaults=h,r._name=s,r.$el.attr("readonly")!==n&&(r.options.readonly=!0),r.toolbarManager=new EntityEmbed.toolbarManager(r,r.options.styles,r.options.actions,u),r.core.getEditor()&&(r.core.getEditor().get_content=function(){return r.getContent()},r.core.getEditor().load_content=function(e){r.loadContent(e)}),r.init()}var s="mediumInsert",c="EntityEmbeds",u="entity-embed-active",p="entity-embed-",m=".medium-insert-active",u="entity-embed-active",f="entity-embed-container",h={label:'<span class="fa fa-code"></span>',authToken:null,domainName:null,styles:{left:{label:'<span class="fa fa-align-left"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},center:{label:'<span class="fa fa-align-center"></span>'},right:{label:'<span class="fa fa-align-right"></span>',added:function(e){e.addClass("clearfix")},removed:function(e){e.removeClass("clearfix")}},wide:{label:'<span class="fa fa-align-justify"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(e,t){e.removeEmbed(t)}},edit:{label:'<span class="fa fa-cog"></span>',clicked:function(e,t){e.editEmbed(t)}},newline:{label:'<span class="fa fa-i-cursor"></span>',clicked:function(e,t){e.addNewline(t)}}}};l.prototype.init=function(){var o=this;o.options.authToken&&EntityEmbed.apiService.setAuthToken(o.options.authToken),o.options.domainName&&EntityEmbed.apiService.setDomainName(o.options.domainName),o.toolbarManager.createActionToolbar(e("body")),o.options.readonly?(o.core.getEditor().stopSelectionUpdates(),o.$el.attr("contenteditable",!1).attr("readonly","")):o.$el.sortable({handle:".entity-embed-blocker",placeholder:"entity-embed-placeholder",distance:5,start:function(e,t){var n=[t.placeholder.attr("class"),t.helper.attr("class")].join(" ");t.placeholder.attr("class",n),t.placeholder.height(t.helper.outerHeight()),t.placeholder.width(t.helper.width()),o.toolbarManager.hideToolbar()},stop:function(e,n){n.item.height(n.placeholder.height()),o.renderEmbed(n.item,!0),o.core.triggerInput(),t.setTimeout(function(){n.item.removeAttr("style")},2e3)},change:function(){o.core.positionButtons(),o.core.getEditor().checkSelection()}}),o.events(),e.embed_modal_create().done(function(t){var n=t.data("scope");o.$embedModal=t,o.embedTypes=n.embedTypes;for(var i=0,r=o.embedTypes.length;r>i;i++)o.toolbarManager.createStyleToolbar(e("body"),o.embedTypes[i])})},l.prototype.events=function(){function n(e){var t=e.parent();return t[0]!==i.el?n(t):e}var i=this,r=r=i.core.getEditor();r.subscribe("editableInput",function(t,o){var n=["p > ol","p > ul","p > p","p > div"].join(","),i=["li > span[style]"].join(","),a="<p><br></p>",d=e(o),l=d.find(n),s=d.find(i);l.each(function(){var t=e(this);t.unwrap(),r.selectElement(this)}),s.removeAttr("style"),d.find("div > br:only-child").parent().replaceWith(a),d.children().not(".medium-insert-buttons").length||d.prepend(a)}),e(t).on("resize",function(){var t=e("."+u);t.length&&i.toolbarManager.positionToolbars(t)}),e(o).on("click",function(t){e(t.target).is(".medium-editor-action")||e(t.target.parentElement).is(".medium-editor-action")||0==i.$el.find("."+u).length||(e("."+u).removeClass(u),i.toolbarManager.hideToolbar())}),i.$el.on("click","."+f,function(t){i.options.readonly||i.toggleSelectEmbed(e(this)),t.stopPropagation()}).on("keydown",function(t){var o,l,s,c,u,p,m,h,v,b,g=[".entity-embed-container","[contenteditable]"].join(","),y=":not("+g+")";8!==t.which&&46!==t.which||(o=a(),o.rangeCount&&(l=o.getRangeAt(0),c=l.endOffset-l.startOffset,h=e(o.anchorNode),s=h.text().length,u=i.$el.children().not(".medium-insert-buttons").length,p=!1,m=!1,c>0||(3===h[0].nodeType&&(h=h.closest(y)),h=n(h),p=h.is(y)&&!h.text().length,8===t.which&&0===o.anchorOffset?v=h.prev():46===t.which&&o.anchorOffset===s&&(v=h.next()),v&&(m=v.is("."+f),v.children().length||v.text().length||v.append("<br>")),(p&&1>=u||m)&&t.preventDefault(),p&&u>1&&(t.preventDefault(),8===t.which?b=h.prevAll(y).first():46===t.which&&(b=h.nextAll(y).first()),b.children().length||b.text().length||b.append("<br>"),r.selectElement(b[0]),d(b[0],46===t.which),r.checkSelection(),h.remove(),i.core.triggerInput()))))}).on("keydown",function(e){8!=e.which&&46!=e.which||0!=i.$el.find("."+u).length&&i.toolbarManager.hideToolbar()})},l.prototype.getCore=function(){return this.core},l.prototype.getContent=function(){var t=this,o=t.core.getEditor().serialize(),n={html:"",embeds:[]};return e.each(o,function(t){var r,a;r=e("<div />").html(o[t].value),a=r.find(".entity-embed-container",r),a.removeClass(u),a.each(function(t){var o,r,a,d;o=e(this),r=o.find("figure"),r?(a={index:t,id:r.attr("id"),type:r.attr("data-embed-type")},n.embeds.push(a),d=i(a),o.html(d)):o.remove()}),n.html+=r.html()}),n},l.prototype.loadContent=function(t){function o(t){var o;if(!t)return void n();if(a=t.html||"",!t.embeds)return void n();l=[],o=[];for(var c=0;c<t.embeds.length;c++)if(d=r(t.embeds[c].type,s.embedTypes)){d.model=d.cleanModel(),t.embeds[c].embedType=d;var u=EntityEmbed.apiService.get({path:t.embeds[c].embedType.options.httpPaths.get,data:{object_id:t.embeds[c].id}});u.done(function(e){return function(t){var o,n;return"ERROR"===t.status?(console.log("failed to get embed object!"),t):(e.embedType.model=t.response,l.push(e),n=i(e),o=s.generateEmbedHtml(e.embedType),void(a=a.split(n).join(o)))}}(t.embeds[c])),o.push(u)}e.when.apply(e,o).done(function(){var e,t,o,i={};n();for(var r=0;r<l.length;r++)e=l[r],i[e.id]||(i[e.id]=!0,t=s.$el.find('[id="'+e.id+'"]'),o=t.html(),t.html(o),s.addEmbed(t,e.embedType,!0))})}function n(){s.core.getEditor().setContent(a),s.options.readonly||s.$el.sortable("refresh")}var a,d,l,s=this,c="string"==typeof t,u=c&&/<[^>]>/g.test(t);return t?(a=c?u?t:"":t.html,void(c&&!u?EntityEmbed.apiService.get({path:"admin/embed/edit",data:{object_id:t}}).done(function(e){return"ERROR"===e.status?void console.log("Failed to get story with id "+t):void o(e.repsonse)}).fail(function(e){console.log("Failed to get story with id "+t)}):o(t))):void console.log("Must provide either story id or serialized story data.")},l.prototype.add=function(){var t=this,o={modalOptions:{}};e.embed_modal_open(o).done(function(e){t.addEmbed(null,e.embedType)})},l.prototype.editEmbed=function(t){var o=this,n=t.find("figure"),i=n.data("embed"),r={modalOptions:{id:i.model.object_id,embedTypeStr:t.find("[data-embed-type]").attr("data-embed-type")}};o.toolbarManager.hideToolbar(),e.embed_modal_open(r).done(function(t){var n=e.extend(!0,{},t.embedType),i=e("[id="+n.model.object_id+"]",o.$el);i.each(function(){var t=e(this);t.data("embed",n),o.renderEmbed(t.closest("."+f))}),o.activateEmbed(n),o.core.triggerInput()})},l.prototype.renderEmbed=function(t,o){var n=this,i=t.find("> figure"),r=i.data("embed"),a=n.generateEmbedHtml(r),d=e(a);t.addClass(p+r.options.object_type),i.html(d.html()),o&&n.activateEmbed(r)},l.prototype.removeEmbed=function(e){var t=this;t.toolbarManager.hideToolbar(),e.remove(),t.core.triggerInput()},l.prototype.addNewline=function(e){var t=this,o="<p><br></p>";e.before(o),e.after(o),t.toolbarManager.positionToolbars(e)},l.prototype.toggleSelectEmbed=function(t){var o=this,n=e("."+u),i=t.find("[data-embed-type]").attr("data-embed-type"),a=r(i,o.embedTypes);o.toolbarManager.hideToolbar(),n.toggleClass(u),t.toggleClass(u),o.options.actions&&(t.hasClass(u)?o.toolbarManager.showToolbars(t,a.name):o.toolbarManager.hideToolbar())},l.prototype.generateEmbedHtml=function(t){var o=e("<div>").html(t.parseForEditor());o.children().first().addClass("entity-embed");var n='<figure contenteditable="false" id="'+t.model.object_id+'" data-embed-type="'+t.options.object_type+'" >'+o.html()+'<div class="entity-embed-blocker"></div></figure>';return n},l.prototype.addEmbed=function(t,o,n){var i,r,a=this,d=o.defaultStyle.replace("entity-embed-","");t||(r=e(m,a.$el),t=e("<div>").addClass(f),t.html(a.generateEmbedHtml(o)),r.replaceWith(t)),t.is("figure")&&(t=t.closest("."+f)),t.addClass(p+o.options.object_type),a.toolbarManager.addStyle(t,o.defaultStyle,d,!1),i=t.find("figure"),i.data("embed",e.extend(!0,{},o)),a.renderEmbed(t,!0),a.options.readonly||a.$el.sortable("refresh"),a.core.hideButtons(),n||a.core.triggerInput()},l.prototype.activateEmbed=function(e){var t=e.embedType||e;"function"==typeof t.activateEmbed&&t.activateEmbed()},e.fn[s+c]=function(t){return this.each(function(){e.data(this,"plugin_"+s+c)||e.data(this,"plugin_"+s+c,new l(this,t))})}}(jQuery,window,document);var EasyAutocomplete=function(e){return e.Configuration=function(e){function t(){if("xml"===e.dataType&&(e.getValue||(e.getValue=function(e){return $(e).text()}),e.list||(e.list={}),e.list.sort||(e.list.sort={}),e.list.sort.method=function(t,o){return t=e.getValue(t),o=e.getValue(o),o>t?-1:t>o?1:0},e.list.match||(e.list.match={}),e.list.match.method=function(e,t){return e.search(t)>-1}),void 0!==e.categories&&e.categories instanceof Array){for(var t=[],o=0,n=e.categories.length;n>o;o+=1){var i=e.categories[o];for(var r in d.categories[0])void 0===i[r]&&(i[r]=d.categories[0][r]);t.push(i)}e.categories=t}}function o(){function t(e,o){var n=e||{};for(var i in e)void 0!==o[i]&&null!==o[i]&&("object"!=typeof o[i]||o[i]instanceof Array?n[i]=o[i]:t(e[i],o[i]));return void 0!==o.data&&null!==o.data&&"object"==typeof o.data&&(n.data=o.data),n}d=t(d,e)}function n(){if("list-required"!==d.url&&"function"!=typeof d.url){var t=d.url;d.url=function(){return t}}if(void 0!==d.ajaxSettings.url&&"function"!=typeof d.ajaxSettings.url){var t=d.ajaxSettings.url;d.ajaxSettings.url=function(){return t}}if("string"==typeof d.listLocation){var o=d.listLocation;"XML"===d.dataType.toUpperCase()?d.listLocation=function(e){return $(e).find(o)}:d.listLocation=function(e){return e[o]}}if("string"==typeof d.getValue){var n=d.getValue;d.getValue=function(e){return e[n]}}void 0!==e.categories&&(d.categoriesAssigned=!0)}function i(){void 0!==e.ajaxSettings&&"object"==typeof e.ajaxSettings?d.ajaxSettings=e.ajaxSettings:d.ajaxSettings={}}function r(e){return void 0!==d[e]&&null!==d[e]}function a(e,t){function o(t,n){for(var i in n)void 0===t[i]&&e.log("Property '"+i+"' does not exist in EasyAutocomplete options API."),"object"==typeof t[i]&&-1===$.inArray(i,l)&&o(t[i],n[i])}o(d,t)}var d={data:"list-required",url:"list-required",dataType:"json",listLocation:function(e){return e},xmlElementName:"",getValue:function(e){return e},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(e,t){return e=d.getValue(e),t=d.getValue(t),t>e?-1:e>t?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(e,t){return e.search(t)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(e,t){return e},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},l=["ajaxSettings","template"];this.get=function(e){return d[e]},this.equals=function(e,t){return!(!r(e)||d[e]!==t)},this.checkDataUrlProperties=function(){return"list-required"!==d.url||"list-required"!==d.data},this.checkRequiredProperties=function(){for(var e in d)if("required"===d[e])return logger.error("Option "+e+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(e,t){a(e,t)},t(),o(),d.loggerEnabled===!0&&a(console,e),i(),n()},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Logger=function(){this.error=function(e){console.log("ERROR: "+e)},this.warning=function(e){console.log("WARNING: "+e)}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Constans=function(){var e={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"
};this.getValue=function(t){return e[t]}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.ListBuilderService=function(e,t){function o(t,o){function n(){var n,i={};return void 0!==t.xmlElementName&&(i.xmlElementName=t.xmlElementName),void 0!==t.listLocation?n=t.listLocation:void 0!==e.get("listLocation")&&(n=e.get("listLocation")),void 0!==n?"string"==typeof n?i.data=$(o).find(n):"function"==typeof n&&(i.data=n(o)):i.data=o,i}function i(){var e={};return void 0!==t.listLocation?"string"==typeof t.listLocation?e.data=o[t.listLocation]:"function"==typeof t.listLocation&&(e.data=t.listLocation(o)):e.data=o,e}var r={};if(r="XML"===e.get("dataType").toUpperCase()?n():i(),void 0!==t.header&&(r.header=t.header),void 0!==t.maxNumberOfElements&&(r.maxNumberOfElements=t.maxNumberOfElements),void 0!==e.get("list").maxNumberOfElements&&(r.maxListSize=e.get("list").maxNumberOfElements),void 0!==t.getValue)if("string"==typeof t.getValue){var a=t.getValue;r.getValue=function(e){return e[a]}}else"function"==typeof t.getValue&&(r.getValue=t.getValue);else r.getValue=e.get("getValue");return r}function n(t){var o=[];return void 0===t.xmlElementName&&(t.xmlElementName=e.get("xmlElementName")),$(t.data).find(t.xmlElementName).each(function(){o.push(this)}),o}this.init=function(t){var o=[],n={};return n.data=e.get("listLocation")(t),n.getValue=e.get("getValue"),n.maxListSize=e.get("list").maxNumberOfElements,o.push(n),o},this.updateCategories=function(t,n){if(e.get("categoriesAssigned")){t=[];for(var i=0;i<e.get("categories").length;i+=1){var r=o(e.get("categories")[i],n);t.push(r)}}return t},this.convertXml=function(t){if("XML"===e.get("dataType").toUpperCase())for(var o=0;o<t.length;o+=1)t[o].data=n(t[o]);return t},this.processData=function(o,n){for(var i=0,r=o.length;r>i;i+=1)o[i].data=t(e,o[i],n);return o},this.checkIfDataExists=function(e){for(var t=0,o=e.length;o>t;t+=1)if(void 0!==e[t].data&&e[t].data instanceof Array&&e[t].data.length>0)return!0;return!1}},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.proccess=function(t,o,n){function i(e,o){var n=[],i="";if(t.get("list").match.enabled)for(var a=0,d=e.length;d>a;a+=1)i=t.get("getValue")(e[a]),r(i,o)&&n.push(e[a]);else n=e;return n}function r(e,o){return t.get("list").match.caseSensitive||("string"==typeof e&&(e=e.toLowerCase()),o=o.toLowerCase()),!!t.get("list").match.method(e,o)}function a(e){return void 0!==o.maxNumberOfElements&&e.length>o.maxNumberOfElements&&(e=e.slice(0,o.maxNumberOfElements)),e}function d(e){return t.get("list").sort.enabled&&e.sort(t.get("list").sort.method),e}e.proccess.match=r;var l=o.data,s=n;return l=i(l,s),l=a(l),l=d(l)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.Template=function(e){var t={basic:{type:"basic",method:function(e){return e},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(e){return e+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(e){return e},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(e){return e},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(e){return e},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},o=function(e){var o,n=e.fields;return"description"===e.type?(o=t.description.method,"string"==typeof n.description?o=function(e,t){return e+" - <span>"+t[n.description]+"</span>"}:"function"==typeof n.description&&(o=function(e,t){return e+" - <span>"+n.description(t)+"</span>"}),o):"iconRight"===e.type?("string"==typeof n.iconSrc?o=function(e,t){return e+"<img class='eac-icon' src='"+t[n.iconSrc]+"' />"}:"function"==typeof n.iconSrc&&(o=function(e,t){return e+"<img class='eac-icon' src='"+n.iconSrc(t)+"' />"}),o):"iconLeft"===e.type?("string"==typeof n.iconSrc?o=function(e,t){return"<img class='eac-icon' src='"+t[n.iconSrc]+"' />"+e}:"function"==typeof n.iconSrc&&(o=function(e,t){return"<img class='eac-icon' src='"+n.iconSrc(t)+"' />"+e}),o):"links"===e.type?("string"==typeof n.link?o=function(e,t){return"<a href='"+t[n.link]+"' >"+e+"</a>"}:"function"==typeof n.link&&(o=function(e,t){return"<a href='"+n.link(t)+"' >"+e+"</a>"}),o):"custom"===e.type?e.method:t.basic.method},n=function(e){return e&&e.type&&e.type&&t[e.type]?o(e):t.basic.method},i=function(e){var o=function(){return""};return e&&e.type&&e.type&&t[e.type]?function(){var o=t[e.type].cssClass;return function(){return o}}():o};this.getTemplateClass=i(e),this.build=n(e)},e}(EasyAutocomplete||{}),EasyAutocomplete=function(e){return e.main=function(t,o){function n(){return 0===y.length?void h.error("Input field doesn't exist."):f.checkDataUrlProperties()?f.checkRequiredProperties()?(i(),void a()):void h.error("Will not work without mentioned properties."):void h.error("One of options variables 'data' or 'url' must be defined.")}function i(){function e(){var e=$("<div>"),o=m.getValue("WRAPPER_CSS_CLASS");f.get("theme")&&""!==f.get("theme")&&(o+=" eac-"+f.get("theme")),f.get("cssClasses")&&""!==f.get("cssClasses")&&(o+=" "+f.get("cssClasses")),""!==v.getTemplateClass()&&(o+=" "+v.getTemplateClass()),e.addClass(o),y.wrap(e),f.get("adjustWidth")===!0&&t()}function t(){var e=y.outerWidth();y.parent().css("width",e)}function o(){y.unwrap()}function n(){var e=$("<div>").addClass(m.getValue("CONTAINER_CLASS"));e.attr("id",r()).prepend($("<ul>")),function(){e.on("show.eac",function(){switch(f.get("list").showAnimation.type){case"slide":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").slideDown(t,o);break;case"fade":var t=f.get("list").showAnimation.time,o=f.get("list").showAnimation.callback;e.find("ul").fadeIn(t),o;break;default:e.find("ul").show()}f.get("list").onShowListEvent()}).on("hide.eac",function(){switch(f.get("list").hideAnimation.type){case"slide":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").slideUp(t,o);break;case"fade":var t=f.get("list").hideAnimation.time,o=f.get("list").hideAnimation.callback;e.find("ul").fadeOut(t,o);break;default:e.find("ul").hide()}f.get("list").onHideListEvent()}).on("selectElement.eac",function(){e.find("ul li").removeClass("selected"),e.find("ul li").eq(T).addClass("selected"),f.get("list").onSelectItemEvent()}).on("loadElements.eac",function(t,o,n){var i="",r=e.find("ul");r.empty().detach(),w=[];for(var d=0,l=0,c=o.length;c>l;l+=1){var u=o[l].data;if(0!==u.length){void 0!==o[l].header&&o[l].header.length>0&&r.append("<div class='eac-category' >"+o[l].header+"</div>");for(var p=0,m=u.length;m>p&&d<o[l].maxListSize;p+=1)i=$("<li><div class='eac-item'></div></li>"),function(){var e=p,t=d,r=o[l].getValue(u[e]);i.find(" > div").on("click",function(){y.val(r).trigger("change"),T=t,s(t),f.get("list").onClickEvent(),f.get("list").onChooseEvent()}).mouseover(function(){T=t,s(t),f.get("list").onMouseOverEvent()}).mouseout(function(){f.get("list").onMouseOutEvent()}).html(v.build(a(r,n),u[e]))}(),r.append(i),w.push(u[p]),d+=1}}e.append(r),f.get("list").onLoadEvent()})}(),y.after(e)}function i(){y.next("."+m.getValue("CONTAINER_CLASS")).remove()}function a(e,t){return f.get("highlightPhrase")&&""!==t?l(e,t):e}function d(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function l(e,t){var o=d(t);return(e+"").replace(new RegExp("("+o+")","gi"),"<b>$1</b>")}y.parent().hasClass(m.getValue("WRAPPER_CSS_CLASS"))&&(i(),o()),e(),n(),E=$("#"+r()),f.get("placeholder")&&y.attr("placeholder",f.get("placeholder"))}function r(){var e=y.attr("id");return e=m.getValue("CONTAINER_ID")+e}function a(){function e(){g("autocompleteOff",!0)&&m(),t(),o(),n(),i(),r(),a()}function t(){y.focusout(function(){var e,t=y.val();f.get("list").match.caseSensitive||(t=t.toLowerCase());for(var o=0,n=w.length;n>o;o+=1)if(e=f.get("getValue")(w[o]),f.get("list").match.caseSensitive||(e=e.toLowerCase()),e===t)return T=o,void s(T)})}function o(){y.off("keyup").keyup(function(e){function t(e){function t(){var e={},t=f.get("ajaxSettings")||{};for(var o in t)e[o]=t[o];return e}function o(e,t){return f.get("matchResponseProperty")!==!1?"string"==typeof f.get("matchResponseProperty")?t[f.get("matchResponseProperty")]===e:"function"==typeof f.get("matchResponseProperty")?f.get("matchResponseProperty")(t)===e:!0:!0}if(!(e.length<f.get("minCharNumber"))){if("list-required"!==f.get("data")){var n=f.get("data"),i=b.init(n);i=b.updateCategories(i,n),i=b.processData(i,e),c(i,e),y.parent().find("li").length>0?d():l()}var r=t();void 0!==r.url&&""!==r.url||(r.url=f.get("url")),void 0!==r.dataType&&""!==r.dataType||(r.dataType=f.get("dataType")),void 0!==r.url&&"list-required"!==r.url&&(r.url=r.url(e),r.data=f.get("preparePostData")(r.data,e),$.ajax(r).done(function(t){var n=b.init(t);n=b.updateCategories(n,t),n=b.convertXml(n),o(e,t)&&(n=b.processData(n,e),c(n,e)),b.checkIfDataExists(n)&&y.parent().find("li").length>0?d():l(),f.get("ajaxCallback")()}).fail(function(){h.warning("Fail to load response data")}).always(function(){}))}}switch(e.keyCode){case 27:l(),u();break;case 38:e.preventDefault(),w.length>0&&T>0&&(T-=1,y.val(f.get("getValue")(w[T])),s(T));break;case 40:e.preventDefault(),w.length>0&&T<w.length-1&&(T+=1,y.val(f.get("getValue")(w[T])),s(T));break;default:if(e.keyCode>40||8===e.keyCode){var o=y.val();f.get("list").hideOnEmptyPhrase!==!0||8!==e.keyCode||""!==o?f.get("requestDelay")>0?(void 0!==p&&clearTimeout(p),p=setTimeout(function(){t(o)},f.get("requestDelay"))):t(o):l()}}})}function n(){y.on("keydown",function(e){e=e||window.event;var t=e.keyCode;return 38===t?(suppressKeypress=!0,!1):void 0}).keydown(function(e){13===e.keyCode&&T>-1&&(y.val(f.get("getValue")(w[T])),f.get("list").onKeyEnterEvent(),f.get("list").onChooseEvent(),T=-1,l(),e.preventDefault())})}function i(){y.off("keypress")}function r(){y.focus(function(){""!==y.val()&&w.length>0&&(T=-1,d())})}function a(){y.blur(function(){setTimeout(function(){T=-1,l()},250)})}function m(){y.attr("autocomplete","off")}e()}function d(){E.trigger("show.eac")}function l(){E.trigger("hide.eac")}function s(e){E.trigger("selectElement.eac",e)}function c(e,t){E.trigger("loadElements.eac",[e,t])}function u(){y.trigger("blur")}var p,m=new e.Constans,f=new e.Configuration(o),h=new e.Logger,v=new e.Template(o.template),b=new e.ListBuilderService(f,e.proccess),g=f.equals,y=t,E="",w=[],T=-1;e.consts=m,this.getConstants=function(){return m},this.getConfiguration=function(){return f},this.getContainer=function(){return E},this.getSelectedItemIndex=function(){return T},this.getItems=function(){return w},this.getItemData=function(e){return w.length<e||void 0===w[e]?-1:w[e]},this.getSelectedItemData=function(){return this.getItemData(T)},this.build=function(){i()},this.init=function(){n()}},e.eacHandles=[],e.getHandle=function(t){return e.eacHandles[t]},e.inputHasId=function(e){return void 0!==$(e).attr("id")&&$(e).attr("id").length>0},e.assignRandomId=function(t){var o="";do o="eac-"+Math.floor(1e4*Math.random());while(0!==$("#"+o).length);elementId=e.consts.getValue("CONTAINER_ID")+o,$(t).attr("id",o)},e.setHandle=function(t,o){e.eacHandles[o]=t},e}(EasyAutocomplete||{});!function(e){e.fn.easyAutocomplete=function(t){return this.each(function(){var o=e(this),n=new EasyAutocomplete.main(o,t);EasyAutocomplete.inputHasId(o)||EasyAutocomplete.assignRandomId(o),n.init(),EasyAutocomplete.setHandle(n,o.attr("id"))})},e.fn.getSelectedItemIndex=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemIndex():-1},e.fn.getItems=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getItems():-1},e.fn.getItemData=function(t){var o=e(this).attr("id");return void 0!==o&&t>-1?EasyAutocomplete.getHandle(o).getItemData(t):-1},e.fn.getSelectedItemData=function(){var t=e(this).attr("id");return void 0!==t?EasyAutocomplete.getHandle(t).getSelectedItemData():-1}}(jQuery);